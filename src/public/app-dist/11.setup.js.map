{"version":3,"sources":["webpack://trilium/./src/public/app/dialogs/options/credentials.js"],"names":["ChangePasswordOptions","$","html","this","$username","$form","$oldPassword","$newPassword1","$newPassword2","on","save","options","text","username","oldPassword","val","newPassword1","newPassword2","alert","then","result","success","message"],"mappings":"8JA6Be,MAAMA,EACjB,cACIC,EAAE,wBAAwBC,KA3BtB,svBA6BJC,KAAKC,UAAYH,EAAE,yBACnBE,KAAKE,MAAQJ,EAAE,yBACfE,KAAKG,aAAeL,EAAE,iBACtBE,KAAKI,cAAgBN,EAAE,kBACvBE,KAAKK,cAAgBP,EAAE,kBAEvBE,KAAKE,MAAMI,GAAG,SAAU,IAAMN,KAAKO,QAGvC,cAAcC,GACVR,KAAKC,UAAUQ,KAAKD,EAAQE,UAGhC,OACI,MAAMC,EAAcX,KAAKG,aAAaS,MAChCC,EAAeb,KAAKI,cAAcQ,MAClCE,EAAed,KAAKK,cAAcO,MAMxC,OAJAZ,KAAKG,aAAaS,IAAI,IACtBZ,KAAKI,cAAcQ,IAAI,IACvBZ,KAAKK,cAAcO,IAAI,IAEnBC,IAAiBC,GACjBC,MAAM,oCACC,IAGX,SAAY,kBAAmB,CAC3B,iBAAoBJ,EACpB,aAAgBE,IACjBG,KAAKC,IACAA,EAAOC,SACPH,MAAM,2EAGN,6BAGA,oBAAuBE,EAAOE,YAI/B","file":"11.setup.js","sourcesContent":["import server from \"../../services/server.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\nimport toastService from \"../../services/toast.js\";\n\nconst TPL = `\n<h3>Username</h3>\n\n<p>Your username is <strong id=\"credentials-username\"></strong>.</p>\n\n<h3>Change password</h3>\n<form id=\"change-password-form\">\n    <div class=\"form-group\">\n        <label for=\"old-password\">Old password</label>\n        <input class=\"form-control\" id=\"old-password\" type=\"password\">\n    </div>\n\n    <div class=\"form-group\">\n        <label for=\"new-password1\">New password</label>\n        <input class=\"form-control\" id=\"new-password1\" type=\"password\">\n    </div>\n\n    <div class=\"form-group\">\n        <label for=\"new-password2\">New password once more</label>\n        <input class=\"form-control\" id=\"new-password2\" type=\"password\">\n    </div>\n\n    <button class=\"btn btn-primary\">Change password</button>\n</form>`;\n\nexport default class ChangePasswordOptions {\n    constructor() {\n        $(\"#options-credentials\").html(TPL);\n\n        this.$username = $(\"#credentials-username\");\n        this.$form = $(\"#change-password-form\");\n        this.$oldPassword = $(\"#old-password\");\n        this.$newPassword1 = $(\"#new-password1\");\n        this.$newPassword2 = $(\"#new-password2\");\n\n        this.$form.on('submit', () => this.save());\n    }\n\n    optionsLoaded(options) {\n        this.$username.text(options.username);\n    }\n\n    save() {\n        const oldPassword = this.$oldPassword.val();\n        const newPassword1 = this.$newPassword1.val();\n        const newPassword2 = this.$newPassword2.val();\n\n        this.$oldPassword.val('');\n        this.$newPassword1.val('');\n        this.$newPassword2.val('');\n\n        if (newPassword1 !== newPassword2) {\n            alert(\"New passwords are not the same.\");\n            return false;\n        }\n\n        server.post('password/change', {\n            'current_password': oldPassword,\n            'new_password': newPassword1\n        }).then(result => {\n            if (result.success) {\n                alert(\"Password has been changed. Trilium will be reloaded after you press OK.\");\n\n                // password changed so current protected session is invalid and needs to be cleared\n                protectedSessionHolder.resetProtectedSession();\n            }\n            else {\n                toastService.showError(result.message);\n            }\n        });\n\n        return false;\n    }\n}"],"sourceRoot":""}