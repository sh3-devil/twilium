(()=>{var __webpack_modules__={5708:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});const o=class{constructor(t,e){this.treeCache=t,this.update(e)}update(t){this.attributeId=t.attributeId,this.noteId=t.noteId,this.type=t.type,this.name=t.name,this.value=t.value,this.position=t.position,this.isInheritable=t.isInheritable}getNote(){return this.treeCache.notes[this.noteId]}get targetNoteId(){return"relation"===this.type?this.value:void 0}get jsonValue(){try{return JSON.parse(this.value)}catch(t){return null}}get toString(){return`Attribute(attributeId=${this.attributeId}, type=${this.type}, name=${this.name}, value=${this.value})`}isAffecting(t){if(!t)return!1;const e=this.getNote();if(!e)return!1;const n=[t,...t.getTemplateNotes()];for(const t of n)if(t.noteId===e.noteId)return!0;if(this.isInheritable)for(const t of n)if(t.hasAncestor(e))return!0;return!1}}},3215:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});const o=class{constructor(t,e){this.treeCache=t,this.update(e)}update(t){this.branchId=t.branchId,this.noteId=t.noteId,this.parentNoteId=t.parentNoteId,this.notePosition=t.notePosition,this.prefix=t.prefix,this.isExpanded=!!t.isExpanded,this.isDeleted=!!t.isDeleted}async getNote(){return this.treeCache.getNote(this.noteId)}async getParentNote(){return this.treeCache.getNote(this.parentNoteId)}isTopLevel(){return"root"===this.parentNoteId}get toString(){return`Branch(branchId=${this.branchId})`}}},8003:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>Z});var o=n(9806),i=n(394),s=n(6221);class a extends s.Z{jumpToNoteCommand(){n.e(667).then(n.bind(n,1667)).then(t=>t.showDialog())}showRecentChangesCommand(){n.e(583).then(n.bind(n,6583)).then(t=>t.showDialog())}showAttributesCommand(){n.e(31).then(n.bind(n,6031)).then(t=>t.showDialog())}showNoteInfoCommand(){n.e(753).then(n.bind(n,8753)).then(t=>t.showDialog())}showNoteRevisionsCommand(){n.e(387).then(n.bind(n,7387)).then(t=>t.showCurrentNoteRevisions())}showNoteSourceCommand(){n.e(516).then(n.bind(n,1516)).then(t=>t.showDialog())}showLinkMapCommand(){n.e(694).then(n.bind(n,1694)).then(t=>t.showDialog())}pasteMarkdownIntoTextCommand(){n.e(665).then(n.bind(n,9665)).then(t=>t.importMarkdownInline())}async editBranchPrefixCommand(){const t=Z.tabManager.getActiveTabNotePath();if(t){(await n.e(233).then(n.bind(n,1233))).showDialog(t)}}async cloneNoteIdsToCommand({noteIds:t}){(await n.e(365).then(n.bind(n,4365))).showDialog(t)}async moveBranchIdsToCommand({branchIds:t}){(await n.e(704).then(n.bind(n,8704))).showDialog(t)}showOptionsCommand(){n.e(152).then(n.bind(n,9152)).then(t=>t.showDialog())}showHelpCommand(){n.e(461).then(n.bind(n,9461)).then(t=>t.showDialog())}showSQLConsoleCommand(){n.e(205).then(n.bind(n,8205)).then(t=>t.showDialog())}showBackendLogCommand(){n.e(639).then(n.bind(n,7639)).then(t=>t.showDialog())}}var r=n(9046),d=n(383),c=n(3968),l=n(9800),h=n(6885),p=n(8181),u=n(1520);class g extends s.Z{constructor(){super(),jQuery.hotkeys&&(jQuery.hotkeys.options.filterInputAcceptingElements=!1,jQuery.hotkeys.options.filterContentEditable=!1,jQuery.hotkeys.options.filterTextInputs=!1),$(document).on("click","a[data-action='note-revision']",async t=>{const e=$(t.target),o=e.attr("data-note-path"),i=e.attr("data-note-revision-id");return(await n.e(387).then(n.bind(n,7387))).showNoteRevisionsDialog(o,i),!1})}openDevToolsCommand(){r.Z.isElectron()&&r.Z.dynamicRequire("electron").remote.getCurrentWindow().toggleDevTools()}findInTextCommand(){if(!r.Z.isElectron())return;const{remote:t}=r.Z.dynamicRequire("electron"),{FindInPage:e}=r.Z.dynamicRequire("electron-find");new e(t.getCurrentWebContents(),{offsetTop:10,offsetRight:10,boxBgColor:"var(--main-background-color)",boxShadowColor:"#000",inputColor:"var(--input-text-color)",inputBgColor:"var(--input-background-color)",inputFocusColor:"#555",textColor:"var(--main-text-color)",textHoverBgColor:"#555",caseSelectedColor:"var(--main-border-color)"}).openFindWindow()}async createNoteIntoDayNoteCommand(){const t=await d.Z.getTodayNote(),{note:e}=await l.Z.post(`notes/${t.noteId}/children?target=into`,{title:"new note",content:"",type:"text",isProtected:t.isProtected});await u.Z.waitForMaxKnownSyncId(),await Z.tabManager.openTabWithNote(e.noteId,!0),Z.triggerEvent("focusAndSelectTitle")}async toggleNoteHoistingCommand(){const t=Z.tabManager.getActiveTabNote(),e=c.Z.getHoistedNoteId();t.noteId===e?c.Z.unhoist():"search"!==t.type&&c.Z.setHoistedNoteId(t.noteId)}copyWithoutFormattingCommand(){r.Z.copySelectionToClipboard()}toggleFullscreenCommand(){if(r.Z.isElectron()){const t=r.Z.dynamicRequire("electron").remote.getCurrentWindow();t.isFullScreenable()&&t.setFullScreen(!t.isFullScreen())}else this.$widget.find(".toggle-fullscreen-button").hide()}toggleZenModeCommand(){this.zenModeActive?($(".hide-in-zen-mode,.gutter").removeClass("hidden-by-zen-mode"),$("#root-widget").removeClass("zen-mode"),this.zenModeActive=!1):($(".hide-in-zen-mode,.gutter").addClass("hidden-by-zen-mode"),$("#root-widget").addClass("zen-mode"),this.zenModeActive=!0)}reloadFrontendAppCommand(){r.Z.reloadApp()}logoutCommand(){const t=$('<form action="logout" method="POST">').append($(`<input type="hidden" name="_csrf" value="${glob.csrfToken}"/>`));$("body").append(t),t.trigger("submit")}backInNoteHistoryCommand(){if(r.Z.isElectron()){const t=r.Z.dynamicRequire("electron").remote.getCurrentWebContents(),e=parseInt(t.getActiveIndex());t.goToIndex(e-1)}else window.history.back()}forwardInNoteHistoryCommand(){if(r.Z.isElectron()){const t=r.Z.dynamicRequire("electron").remote.getCurrentWebContents(),e=parseInt(t.getActiveIndex());t.goToIndex(e+1)}else window.history.forward()}async searchForResultsCommand({searchText:t}){const e=await l.Z.get("search/"+encodeURIComponent(t));e.success?(this.triggerEvent("searchResults",{results:e.results}),h.default.showMessage("Search finished successfully.")):h.default.showError("Search failed.",3e3)}async switchToDesktopVersionCommand(){r.Z.setCookie("trilium-device","desktop"),r.Z.reloadApp()}createTopLevelNoteCommand(){p.Z.createNewTopLevelNote()}async openInWindowCommand({notePath:t}){if(r.Z.isElectron()){const{ipcRenderer:e}=r.Z.dynamicRequire("electron");e.send("create-extra-window",{notePath:t})}else{const e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?extra=1#"+t;window.open(e,"","width=1000,height=800")}}async openNewWindowCommand(){this.openInWindowCommand({notePath:""})}async runActiveNoteCommand(){const t=Z.tabManager.getActiveTabNote();t&&"code"===t.type&&(t.mime.endsWith("env=frontend")&&await i.Z.getAndExecuteBundle(t.noteId),t.mime.endsWith("env=backend")&&await l.Z.post("script/run/"+t.noteId),h.default.showMessage("Note executed"))}}var b=n(4378),m=n(503),f=n(1902),w=n(8481),y=n(2040);class v extends s.Z{constructor(t=null){super(),this.tabId=t||r.Z.randomString(4)}setEmpty(){this.triggerEvent("tabNoteSwitched",{tabContext:this,notePath:this.notePath})}async setNote(t,e=!0){const n=w.Z.getNoteIdFromNotePath(t);let i;if((await o.Z.getNote(n)).isDeleted)i=t;else{if(i=await w.Z.resolveNotePath(t),!i)return void console.error("Cannot resolve note path "+t);if(i===this.notePath)return;if(!1===await c.Z.checkNoteAccess(i))return}await this.triggerEvent("beforeNoteSwitch",{tabContext:this}),r.Z.closeActiveDialog(),this.notePath=i,this.noteId=n,this.autoBookDisabled=!1,this.textPreviewDisabled=!1,this.codePreviewDisabled=!1,setTimeout(async()=>{i&&i===this.notePath&&await l.Z.post("recent-notes",{noteId:this.note.noteId,notePath:this.notePath})},5e3),y.Z.touchProtectedSessionIfNecessary(this.note),e&&await this.triggerEvent("tabNoteSwitched",{tabContext:this,notePath:this.notePath})}get note(){return o.Z.notes[this.noteId]}async getNoteComplement(){return this.noteId?await o.Z.getNoteComplement(this.noteId):null}isActive(){return Z.tabManager.activeTabId===this.tabId}getTabState(){return this.notePath?{tabId:this.tabId,notePath:this.notePath,active:this.isActive()}:null}async entitiesReloadedEvent({loadResults:t}){if(t.isNoteReloaded(this.noteId)){(await o.Z.getNote(this.noteId)).isDeleted&&(this.noteId=null,this.notePath=null,this.triggerEvent("tabNoteSwitched",{tabContext:this,notePath:this.notePath}))}}}const x=v;class I extends s.Z{constructor(){super(),this.activeTabId=null,this.tabsUpdate=new f.Z(async()=>{if(!Z.isMainWindow)return;const t=this.tabContexts.map(t=>t.getTabState()).filter(t=>!!t);await l.Z.put("options",{openTabs:JSON.stringify(t)})})}get tabContexts(){return this.children}async loadTabs(){const t=Z.isMainWindow&&b.Z.getJson("openTabs")||[];if(window.location.hash){const e=window.location.hash.substr(1),n=w.Z.getNoteIdFromNotePath(e);if(n&&await o.Z.noteExists(n)){for(const e of t)e.active=!1;const o=t.find(t=>n===w.Z.getNoteIdFromNotePath(t.notePath));o?o.active=!0:t.push({notePath:e,active:!0})}}let e=[];for(const n of t){const t=w.Z.getNoteIdFromNotePath(n.notePath);await o.Z.noteExists(t)&&e.push(n)}r.Z.isMobile()&&(e=e.filter(t=>t.active)),0===e.length&&e.push({notePath:this.isMainWindow?"root":"",active:!0}),e.find(t=>t.active)||(e[0].active=!0),await this.tabsUpdate.allowUpdateWithoutChange(async()=>{for(const t of e)await this.openTabWithNote(t.notePath,t.active,t.tabId)})}tabNoteSwitchedEvent({tabContext:t}){t.isActive()&&this.setCurrentNotePathToHash(),this.tabsUpdate.scheduleUpdate()}setCurrentNotePathToHash(){const t=this.getActiveTabContext();if(0===window.history.length||t&&t.notePath!==w.Z.getHashValueFromAddress()[0]){const e="#"+(t.notePath||"")+"-"+t.tabId;window.history.pushState(null,"",e),document.title="Trilium Notes",t.note&&(document.title+=" - "+t.note.title)}this.triggerEvent("activeNoteChanged")}getTabContexts(){return this.tabContexts}getTabContextById(t){return this.tabContexts.find(e=>e.tabId===t)}getActiveTabContext(){return this.getTabContextById(this.activeTabId)}getActiveTabNotePath(){const t=this.getActiveTabContext();return t?t.notePath:null}getActiveTabNote(){const t=this.getActiveTabContext();return t?t.note:null}getActiveTabNoteId(){const t=this.getActiveTabNote();return t?t.noteId:null}getActiveTabNoteType(){const t=this.getActiveTabNote();return t?t.type:null}async switchToTab(t,e){const n=this.tabContexts.find(e=>e.tabId===t)||await this.openEmptyTab();this.activateTab(n.tabId),await n.setNote(e)}async openAndActivateEmptyTab(){const t=await this.openEmptyTab();await this.activateTab(t.tabId),await t.setEmpty()}async openEmptyTab(t){const e=new x(t);return this.child(e),await this.triggerEvent("newTabOpened",{tabContext:e}),e}async openTabWithNote(t,e,n=null){const o=await this.openEmptyTab(n);t&&await o.setNote(t,!e),e&&(this.activateTab(o.tabId,!1),await this.triggerEvent("tabNoteSwitchedAndActivated",{tabContext:o,notePath:o.notePath}))}async activateOrOpenNote(t){for(const e of this.getTabContexts())if(e.note&&e.note.noteId===t)return void this.activateTab(e.tabId);await this.openTabWithNote(t,!0)}activateTab(t,e=!0){t!==this.activeTabId&&(this.activeTabId=t,e&&this.triggerEvent("activeTabChanged",{tabContext:this.getTabContextById(t)}),this.tabsUpdate.scheduleUpdate(),this.setCurrentNotePathToHash())}async removeTab(t){const e=this.getTabContextById(t);if(e){if($(".aa-input").autocomplete("close"),await this.triggerEvent("beforeTabRemove",{tabId:t}),this.tabContexts.length<=1)this.openAndActivateEmptyTab();else if(e.isActive()){this.tabContexts.findIndex(e=>e.tabId===t)===this.tabContexts.length-1?this.activatePreviousTabCommand():this.activateNextTabCommand()}this.children=this.children.filter(e=>e.tabId!==t),this.triggerEvent("tabRemoved",{tabId:t}),this.tabsUpdate.scheduleUpdate()}}tabReorderEvent({tabIdsInOrder:t}){const e={};for(const n in t)e[t[n]]=n;this.children.sort((t,n)=>e[t.tabId]<e[n.tabId]?-1:1),this.tabsUpdate.scheduleUpdate()}activateNextTabCommand(){const t=this.tabContexts.findIndex(t=>t.tabId===this.activeTabId),e=this.tabContexts[t===this.tabContexts.length-1?0:t+1].tabId;this.activateTab(e)}activatePreviousTabCommand(){const t=this.tabContexts.findIndex(t=>t.tabId===this.activeTabId),e=this.tabContexts[0===t?this.tabContexts.length-1:t-1].tabId;this.activateTab(e)}closeActiveTabCommand(){this.removeTab(this.activeTabId)}beforeUnloadEvent(){this.tabsUpdate.updateNowIfNecessary()}openNewTabCommand(){this.openAndActivateEmptyTab()}async removeAllTabsCommand(){for(const t of this.tabContexts.map(t=>t.tabId))await this.removeTab(t)}async removeAllTabsExceptForThisCommand({tabId:t}){for(const e of this.tabContexts.map(t=>t.tabId))e!==t&&await this.removeTab(e)}moveTabToNewWindowCommand({tabId:t}){const e=this.getTabContextById(t).notePath;this.removeTab(t),this.triggerCommand("openInWindow",{notePath:e})}async hoistedNoteChangedEvent({hoistedNoteId:t}){if("root"!==t)for(const e of this.tabContexts.splice())e.notePath&&!e.notePath.split("/").includes(t)&&await this.removeTab(e.tabId)}}var _=n(6604);class C extends s.Z{setActiveScreenCommand({screen:t}){t!==this.activeScreen&&(this.activeScreen=t,this.triggerEvent("activeScreenChanged",{activeScreen:t}))}initialRenderCompleteEvent(){this.setActiveScreenCommand({screen:"tree"})}}class N extends s.Z{get tree(){return Z.mainTreeWidget}async cloneNotesToCommand(){const t=this.tree.getSelectedOrActiveNodes().map(t=>t.data.noteId);this.triggerCommand("cloneNoteIdsTo",{noteIds:t})}async moveNotesToCommand(){const t=this.tree.getSelectedOrActiveNodes().map(t=>t.data.branchId);this.triggerCommand("moveBranchIdsTo",{branchIds:t})}async createNoteIntoCommand(){const t=Z.tabManager.getActiveTabNote();t&&await p.Z.createNote(t.noteId,{isProtected:t.isProtected,saveSelection:!1})}async createNoteAfterCommand(){const t=this.tree.getActiveNode(),e=t.data.parentNoteId,n=await w.Z.getParentProtectedStatus(t);"root"!==t.data.noteId&&t.data.noteId!==c.Z.getHoistedNoteId()&&await p.Z.createNote(e,{target:"after",targetBranchId:t.data.branchId,isProtected:n,saveSelection:!1})}}class k extends s.Z{constructor(t){super(),this.isMainWindow=t,this.executors=[]}setLayout(t){this.layout=t}async start(){await Promise.all([o.Z.initializedPromise,b.Z.initializedPromise]),$("#loading-indicator").hide(),this.showWidgets(),this.tabManager.loadTabs(),r.Z.isDesktop()&&setTimeout(()=>i.Z.executeStartupBundles(),2e3)}showWidgets(){const t=this.layout.getRootWidget(this),e=t.render();_.default.updateDisplayedShortcuts(e),$("body").append(e),e.on("click","[data-trigger-command]",(function(){const t=$(this).attr("data-trigger-command");$(this).closest(".component").prop("component").triggerCommand(t,{$el:$(this)})})),this.tabManager=new I,this.executors=[this.tabManager,new a,new g,new N],r.Z.isMobile()&&this.executors.push(new C),this.child(t);for(const t of this.executors)this.child(t);r.Z.isElectron()&&this.child(m.Z),this.triggerEvent("initialRenderComplete")}triggerEvent(t,e){return this.handleEvent(t,e)}triggerCommand(t,e={}){for(const n of this.executors){const o=n[t+"Command"];if(o)return n.callMethod(o,e)}return console.debug(`Unhandled command ${t}, converting to event.`),this.triggerEvent(t,e)}getComponentByEl(t){return $(t).closest(".component").prop("component")}}const T=new k(window.glob.isMainWindow);$(window).on("beforeunload",()=>{T.triggerEvent("beforeUnload")}),$(window).on("hashchange",(function(){if(function(){const[t,e]=w.Z.getHashValueFromAddress();return t.startsWith("root")||""===t&&!!e}()){const[t,e]=w.Z.getHashValueFromAddress();if(!t)return void console.log(`Invalid hash value "${document.location.hash}", ignoring.`);T.tabManager.switchToTab(e,t)}}));const Z=T},5819:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var o=n(9800);const i={initAttributeNameAutocomplete:function({$el:t,attributeType:e,open:n}){t.hasClass("aa-input")||t.autocomplete({appendTo:document.querySelector("body"),hint:!1,openOnFocus:!0,minLength:0,tabAutocomplete:!1},[{displayKey:"name",cache:!1,source:async(t,n)=>{const i="function"==typeof e?e():e;n((await o.Z.get(`attributes/names/?type=${i}&query=${encodeURIComponent(t)}`)).map(t=>({name:t})))}}]),n&&t.autocomplete("open")},initLabelValueAutocomplete:async function({$el:t,open:e}){if(!t.hasClass("aa-input")){const e=t.parent().parent().find(".attribute-name").val();if(""===e.trim())return;const n=(await o.Z.get("attributes/values/"+encodeURIComponent(e))).map(t=>({value:t}));if(0===n.length)return;t.autocomplete({appendTo:document.querySelector("body"),hint:!1,openOnFocus:!0,minLength:0,tabAutocomplete:!1},[{displayKey:"value",source:function(t,e){t=t.toLowerCase(),e(n.filter(e=>e.value.toLowerCase().includes(t)))}}])}e&&t.autocomplete("open")}}},8159:(t,e,n)=>{"use strict";n.d(e,{Z:()=>h});var o=n(9046),i=n(9800),s=n(6885),a=n(9806),r=n(3968),d=n(1520);function c(t){const e=r.Z.getHoistedNoteId();return t.filter(t=>{const n=a.Z.getBranch(t);return"root"!==n.noteId&&n.noteId!==e})}function l(t,e){return{id:t,title:"Delete status",message:e,icon:"trash"}}d.Z.subscribeToMessages(async t=>{if("delete-notes"===t.taskType)if("task-error"===t.type)s.default.closePersistent(t.taskId),s.default.showError(t.message);else if("task-progress-count"===t.type)s.default.showPersistent(l(t.taskId,"Delete notes in progress: "+t.progressCount));else if("task-succeeded"===t.type){const e=l(t.taskId,"Delete finished successfully.");e.closeAfter=5e3,s.default.showPersistent(e)}}),d.Z.subscribeToMessages(async t=>{if("undelete-notes"===t.taskType)if("task-error"===t.type)s.default.closePersistent(t.taskId),s.default.showError(t.message);else if("task-progress-count"===t.type)s.default.showPersistent(l(t.taskId,"Undeleting notes in progress: "+t.progressCount));else if("task-succeeded"===t.type){const e=l(t.taskId,"Undeleting notes finished successfully.");e.closeAfter=5e3,s.default.showPersistent(e)}});const h={moveBeforeBranch:async function(t,e){if(t=c(t),"root"!==e)for(const n of t){const t=await i.Z.put(`branches/${n}/move-before/${e}`);if(!t.success)return void alert(t.message)}else alert("Cannot move notes before root note.")},moveAfterBranch:async function(t,e){t=c(t);const n=await a.Z.getBranch(e).getNote();if("root"!==n.noteId&&n.noteId!==r.Z.getHoistedNoteId()){t.reverse();for(const n of t){const t=await i.Z.put(`branches/${n}/move-after/${e}`);if(!t.success)return void alert(t.message)}}else alert("Cannot move notes after root note.")},moveToParentNote:async function(t,e){t=c(t);for(const n of t){const t=a.Z.getBranch(n);if(t.noteId===r.Z.getHoistedNoteId()||"search"===(await t.getParentNote()).type)continue;const o=await i.Z.put(`branches/${n}/move-to/${e}`);if(!o.success)return void alert(o.message)}},deleteNotes:async function(t){if(0===(t=c(t)).length)return!1;const e=$('<div class="form-check">').append($('<input type="checkbox" class="form-check-input" id="delete-clones-checkbox">')).append($('<label for="delete-clones-checkbox">').text("delete also all note clones").attr("title","all clones of selected notes will be deleted and as such the whole note will be deleted.")),s=$("<ul>");for(const e of t){const t=await a.Z.getBranch(e).getNote();s.append($("<li>").text(t.title))}const r=$("<div>").append($("<p>").text("This will delete the following notes and their sub-notes: ")).append(s).append(e),d=await n.e(590).then(n.bind(n,590));if(!await d.confirm(r))return!1;const l=e.find("input").is(":checked"),h=o.Z.randomString(10);let p=0;for(const e of t){p++;const n=`?taskId=${h}&last=${p===t.length?"true":"false"}`,o=a.Z.getBranch(e);l?await i.Z.remove("notes/"+o.noteId+n):await i.Z.remove("branches/"+e+n)}return!0},moveNodeUpInHierarchy:async function(t){if(r.Z.isRootNode(t)||r.Z.isTopLevelNode(t)||"search"===t.getParent().data.noteType)return;const e=await i.Z.put("branches/"+t.data.branchId+"/move-after/"+t.getParent().data.branchId);e.success?!r.Z.isTopLevelNode(t)&&t.getParent().getChildren().length<=1&&(t.getParent().folder=!1,t.getParent().renderTitle()):alert(e.message)},cloneNoteAfter:async function(t,e){const n=await i.Z.put("notes/"+t+"/clone-after/"+e);n.success||alert(n.message)},cloneNoteTo:async function(t,e,n){const o=await i.Z.put(`notes/${t}/clone-to/${e}`,{prefix:n});o.success||alert(o.message)}}},394:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _script_context_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2064),_server_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9800),_toast_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6885);async function getAndExecuteBundle(t,e=null){const n=await _server_js__WEBPACK_IMPORTED_MODULE_1__.Z.get("script/bundle/"+t);return await executeBundle(n,e)}async function executeBundle(bundle,originEntity,$container){const apiContext=await(0,_script_context_js__WEBPACK_IMPORTED_MODULE_0__.Z)(bundle.noteId,bundle.allNoteIds,originEntity,$container);try{return await function(){return eval(`const apiContext = this; (async function() { ${bundle.script}\r\n})()`)}.call(apiContext)}catch(t){_toast_js__WEBPACK_IMPORTED_MODULE_2__.default.showAndLogError(`Execution of ${bundle.noteId} failed with error: ${t.message}`)}}async function executeStartupBundles(){const t=await _server_js__WEBPACK_IMPORTED_MODULE_1__.Z.get("script/startup");for(const e of t)await executeBundle(e)}class WidgetsByParent{constructor(){this.byParent={}}add(t){t.parentWidget?(this.byParent[t.parentWidget]=this.byParent[t.parentWidget]||[],this.byParent[t.parentWidget].push(t)):console.log("Custom widget does not have mandatory 'getParent()' method defined")}get(t){return this.byParent[t]||[]}}async function getWidgetBundlesByParent(){const t=await _server_js__WEBPACK_IMPORTED_MODULE_1__.Z.get("script/widgets"),e=new WidgetsByParent;for(const n of t){let t;try{t=await executeBundle(n)}catch(t){console.error("Widget initialization failed: ",t);continue}e.add(t)}return e}const __WEBPACK_DEFAULT_EXPORT__={executeBundle,getAndExecuteBundle,executeStartupBundles,getWidgetBundlesByParent}},1035:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var o=n(8159),i=n(6885),s=(n(3968),n(9806));let a=[],r=null;function d(){return a=a.filter(t=>!!s.Z.getBranch(t)),0===a.length}const c={pasteAfter:async function(t){if(!d())if("cut"===r)await o.Z.moveAfterBranch(a,t),a=[],r=null;else if("copy"===r){const e=a.map(t=>s.Z.getBranch(t));for(const n of e){const e=await n.getNote();await o.Z.cloneNoteAfter(e.noteId,t)}}else i.default.throwError("Unrecognized clipboard mode="+r)},pasteInto:async function(t){if(!d())if("cut"===r)await o.Z.moveToParentNote(a,t),a=[],r=null;else if("copy"===r){const e=a.map(t=>s.Z.getBranch(t));for(const n of e){const e=await n.getNote();await o.Z.cloneNoteTo(e.noteId,t)}}else i.default.throwError("Unrecognized clipboard mode="+mode)},cut:function(t){a=t,a.length>0&&(r="cut",i.default.showMessage("Note(s) have been cut into clipboard."))},copy:function(t){a=t,r="copy",i.default.showMessage("Note(s) have been copied into clipboard.")},isClipboardEmpty:d}},7112:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var o=n(6604);const i=new class{constructor(){this.$widget=$("#context-menu-container"),this.dateContextMenuOpenedMs=0,$(document).on("click",()=>this.hide())}async show(t){this.options=t,this.$widget.empty(),this.addItems(this.$widget,t.items),o.default.updateDisplayedShortcuts(this.$widget),this.positionMenu(),this.dateContextMenuOpenedMs=Date.now()}positionMenu(){const t=document.documentElement.clientHeight,e=this.$widget.outerHeight()+30;let n;n=this.options.y+e>t?t-e-10:this.options.y-10,this.$widget.css({display:"block",top:n,left:this.options.x-20}).addClass("show")}addItems(t,e){for(const n of e)if("----"===n.title)t.append($("<div>").addClass("dropdown-divider"));else{const e=$("<span>");n.uiIcon?e.addClass("bx bx-"+n.uiIcon):e.append("&nbsp;");const o=$("<span>").append(e).append(" &nbsp; ").append(n.title),i=$("<li>").addClass("dropdown-item").append(o).on("mousedown",t=>(t.stopPropagation(),this.hide(),n.handler&&n.handler(n,t),this.options.selectMenuItemHandler(n,t),!1));if(void 0===n.enabled||n.enabled||i.addClass("disabled"),n.items){i.addClass("dropdown-submenu"),o.addClass("dropdown-toggle");const t=$("<ul>").addClass("dropdown-menu");this.addItems(t,n.items),i.append(t)}t.append(i)}}hide(){Date.now()-this.dateContextMenuOpenedMs>300&&this.$widget.hide()}}},383:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var o=n(9806),i=n(9800);async function s(t){const e=await i.Z.get("date-notes/date/"+t,"date-note");return await o.Z.getNote(e.noteId)}const a={getTodayNote:async function(){return await s(dayjs().format("YYYY-MM-DD"))},getDateNote:s,getMonthNote:async function(t){const e=await i.Z.get("date-notes/month/"+t,"date-note");return await o.Z.getNote(e.noteId)},getYearNote:async function(t){const e=await i.Z.get("date-notes/year/"+t,"date-note");return await o.Z.getNote(e.noteId)}}},3968:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(4378),i=n(8003),s=n(8481);function a(){return o.Z.get("hoistedNoteId")}async function r(t){await o.Z.save("hoistedNoteId",t),i.default.triggerEvent("hoistedNoteChanged",{noteId:t})}async function d(){await r("root")}function c(t){return"root"===t.data.noteId||t.data.noteId===a()}const l={getHoistedNoteId:a,setHoistedNoteId:r,unhoist:d,isTopLevelNode:function(t){return c(t.getParent())},isRootNode:c,checkNoteAccess:async function(t){const e=await s.Z.getRunPath(t);if(!e)return console.log("Cannot activate "+t),!1;const o=a();if("root"!==o&&!e.includes(o)){const t=await n.e(590).then(n.bind(n,590));if(!await t.confirm("Requested note is outside of hoisted note subtree and you must unhoist to access the note. Do you want to proceed with unhoisting?"))return!1;await d()}return!0}}},6604:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var o=n(9800),i=n(9046),s=n(8003);const a={},r=o.Z.get("keyboard-actions").then(t=>{t=t.filter(t=>!!t.actionName);for(const e of t)e.effectiveShortcuts=e.effectiveShortcuts.filter(t=>!t.startsWith("global:")),a[e.actionName]=e;return t});async function d(t){return(await r).filter(e=>e.scope===t)}async function c(t,e=!1){await r;const n=a[t];if(!n){if(!e)throw new Error("Cannot find action "+t);console.log("Cannot find action "+t)}return n}d("window").then(t=>{for(const e of t)for(const t of e.effectiveShortcuts)i.Z.bindGlobalShortcut(t,()=>s.default.triggerCommand(e.actionName))}),o.Z.get("keyboard-shortcuts-for-notes").then(t=>{for(const e in t)i.Z.bindGlobalShortcut(e,async()=>{s.default.tabManager.getActiveTabContext().setNote(t[e])})});const l={setElementActionHandler:function(t,e,n){r.then(()=>{const o=a[e];if(!o)throw new Error(`Cannot find keyboard action '${e}'`);for(const e of o.effectiveShortcuts)e&&i.Z.bindElShortcut(t,e,n)})},updateDisplayedShortcuts:function(t){t.find("kbd[data-command]").each(async(t,e)=>{const n=$(e).attr("data-command"),o=await c(n,!0);o&&$(e).text(o.effectiveShortcuts.join(", "))}),t.find("[data-trigger-command]").each(async(t,e)=>{const n=$(e).attr("data-trigger-command"),o=await c(n,!0);if(o){const t=$(e).attr("title"),n=o.effectiveShortcuts.join(", "),i=t&&t.trim()?`${t} (${n})`:n;$(e).attr("title",i)}})},setupActionsForElement:async function(t,e,n){const o=await d(t);for(const t of o)for(const o of t.effectiveShortcuts)i.Z.bindElShortcut(e,o,()=>n.triggerCommand(t.actionName))},getActionsForScope:d}},6707:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});const o={};async function i(t){o[t]||(o[t]=$.ajax({url:t,dataType:"script",cache:!0})),await o[t]}async function s(t){Array.from(document.querySelectorAll("link")).map(t=>t.href).some(e=>e.endsWith(t))||$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",t))}const a={requireCss:s,requireLibrary:async function(t){if(t.css&&t.css.map(t=>s(t)),t.js)for(const e of t.js)await i(e)},CKEDITOR:{js:["libraries/ckeditor/ckeditor.js"]},CODE_MIRROR:{js:["libraries/codemirror/codemirror.js","libraries/codemirror/addon/mode/loadmode.js","libraries/codemirror/addon/fold/xml-fold.js","libraries/codemirror/addon/edit/matchbrackets.js","libraries/codemirror/addon/edit/matchtags.js","libraries/codemirror/addon/search/match-highlighter.js","libraries/codemirror/mode/meta.js","libraries/codemirror/addon/lint/lint.js","libraries/codemirror/addon/lint/eslint.js"],css:["libraries/codemirror/codemirror.css","libraries/codemirror/addon/lint/lint.css"]},ESLINT:{js:["libraries/eslint.js"]},COMMONMARK:{js:["libraries/commonmark.min.js"]},RELATION_MAP:{js:["libraries/jsplumb.js","libraries/panzoom.js"],css:["stylesheets/relation_map.css"]},LINK_MAP:{js:["libraries/jsplumb.js","libraries/panzoom.js","libraries/springy.js"],css:["stylesheets/link_map.css"]},PRINT_THIS:{js:["libraries/printThis.js"]},KNOCKOUT:{js:["libraries/knockout.min.js"]},CALENDAR_WIDGET:{css:["stylesheets/calendar.css"]}}},7844:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(8481),i=n(7112),s=n(8003);function a(t){const e=/#(root[A-Za-z0-9/]*)$/.exec(t);return null===e?null:e[1]}function r(t){const e=t.attr("data-note-path");if(e)return e;const n=t.attr("href");return n?a(n):null}function d(t){t.preventDefault(),t.stopPropagation();const e=$(t.target).closest("a"),n=r(e);if(n)if(1===t.which&&t.ctrlKey||2===t.which)s.default.tabManager.openTabWithNote(n);else{if(1!==t.which)return!1;s.default.tabManager.getActiveTabContext().setNote(n)}else{if(1!==t.which)return!1;{const t=e.attr("href");t&&t.startsWith("http")&&window.open(t,"_blank")}}return!0}function c(t){const e=r($(t.target).closest("a"));e&&(t.preventDefault(),i.Z.show({x:t.pageX,y:t.pageY,items:[{title:"Open note in new tab",command:"openNoteInNewTab",uiIcon:"empty"},{title:"Open note in new window",command:"openNoteInNewWindow",uiIcon:"window-open"}],selectMenuItemHandler:({command:t})=>{"openNoteInNewTab"===t?s.default.tabManager.openTabWithNote(e):"openNoteInNewWindow"===t&&s.default.openInNewWindow(e)}}))}$(document).on("mousedown","a[data-action='note']",d),$(document).on("mousedown","div.popover-content a, div.ui-tooltip-content a",d),$(document).on("dblclick",".note-detail-text a",d),$(document).on("mousedown",".note-detail-text a:not(.reference-link)",(function(t){const e=$(t.target).closest("a"),n=r(e);if(1===t.which&&t.ctrlKey||2===t.which){if(t.preventDefault(),n)s.default.tabManager.openTabWithNote(n,!1);else{const t=e.attr("href");window.open(t,"_blank")}return!0}})),$(document).on("mousedown",".note-detail-book a",d),$(document).on("mousedown",".note-detail-render a",d),$(document).on("mousedown",".note-detail-text a.reference-link",d),$(document).on("mousedown",".note-detail-readonly-text a.reference-link",d),$(document).on("mousedown",".note-detail-readonly-text a",d),$(document).on("mousedown","a.ck-link-actions__preview",d),$(document).on("click","section.include-note a",d),$(document).on("click","a.ck-link-actions__preview",t=>{t.preventDefault(),t.stopPropagation()}),$(document).on("contextmenu","a.ck-link-actions__preview",c),$(document).on("contextmenu",".note-detail-text a",c),$(document).on("contextmenu",".note-detail-readonly-text a",c),$(document).on("contextmenu","a[data-action='note']",c),$(document).on("contextmenu",".note-detail-render a",c),$(document).on("contextmenu",".note-paths-widget a",c),$(document).on("contextmenu","section.include-note a",c);const l={getNotePathFromUrl:a,createNoteLink:async function(t,e={}){if(!t||!t.trim())return console.error("Missing note path"),$("<span>").text("[missing note]");let n=e.title;const i=void 0===e.showTooltip||e.showTooltip,s=void 0!==e.showNotePath&&e.showNotePath;if(!n){const{noteId:e,parentNoteId:i}=o.Z.getNoteIdAndParentIdFromNotePath(t);n=await o.Z.getNoteTitle(e,i)}const a=$("<a>",{href:"javascript:",text:n}).attr("data-action","note").attr("data-note-path",t);i||a.addClass("no-tooltip-preview");const r=$("<span>").append(a);if(s&&(t=await o.Z.resolveNotePath(t))){const e=t.split("/");e.pop();const n=e.join("/").trim();n&&r.append($("<small>").text(" ("+await o.Z.getNotePathTitle(n)+")"))}return r},goToLink:d}},236:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var o=n(4378);const i=[{default:!0,title:"Plain text",mime:"text/plain"},{title:"APL",mime:"text/apl"},{title:"PGP",mime:"application/pgp"},{title:"ASN.1",mime:"text/x-ttcn-asn"},{title:"Asterisk",mime:"text/x-asterisk"},{title:"Brainfuck",mime:"text/x-brainfuck"},{default:!0,title:"C",mime:"text/x-csrc"},{default:!0,title:"C++",mime:"text/x-c++src"},{title:"Cobol",mime:"text/x-cobol"},{default:!0,title:"C#",mime:"text/x-csharp"},{title:"Clojure",mime:"text/x-clojure"},{title:"ClojureScript",mime:"text/x-clojurescript"},{title:"Closure Stylesheets (GSS)",mime:"text/x-gss"},{title:"CMake",mime:"text/x-cmake"},{title:"CoffeeScript",mime:"text/coffeescript"},{title:"Common Lisp",mime:"text/x-common-lisp"},{title:"Cypher",mime:"application/x-cypher-query"},{title:"Cython",mime:"text/x-cython"},{title:"Crystal",mime:"text/x-crystal"},{default:!0,title:"CSS",mime:"text/css"},{title:"CQL",mime:"text/x-cassandra"},{title:"D",mime:"text/x-d"},{title:"Dart",mime:"application/dart"},{title:"diff",mime:"text/x-diff"},{title:"Django",mime:"text/x-django"},{title:"Dockerfile",mime:"text/x-dockerfile"},{title:"DTD",mime:"application/xml-dtd"},{title:"Dylan",mime:"text/x-dylan"},{title:"EBNF",mime:"text/x-ebnf"},{title:"ECL",mime:"text/x-ecl"},{title:"edn",mime:"application/edn"},{title:"Eiffel",mime:"text/x-eiffel"},{title:"Elm",mime:"text/x-elm"},{title:"Embedded Javascript",mime:"application/x-ejs"},{title:"Embedded Ruby",mime:"application/x-erb"},{title:"Erlang",mime:"text/x-erlang"},{title:"Esper",mime:"text/x-esper"},{title:"Factor",mime:"text/x-factor"},{title:"FCL",mime:"text/x-fcl"},{title:"Forth",mime:"text/x-forth"},{title:"Fortran",mime:"text/x-fortran"},{title:"F#",mime:"text/x-fsharp"},{title:"Gas",mime:"text/x-gas"},{title:"Gherkin",mime:"text/x-feature"},{title:"GitHub Flavored Markdown",mime:"text/x-gfm"},{default:!0,title:"Go",mime:"text/x-go"},{default:!0,title:"Groovy",mime:"text/x-groovy"},{title:"HAML",mime:"text/x-haml"},{default:!0,title:"Haskell",mime:"text/x-haskell"},{title:"Haskell (Literate)",mime:"text/x-literate-haskell"},{title:"Haxe",mime:"text/x-haxe"},{title:"HXML",mime:"text/x-hxml"},{title:"ASP.NET",mime:"application/x-aspx"},{default:!0,title:"HTML",mime:"text/html"},{default:!0,title:"HTTP",mime:"message/http"},{title:"IDL",mime:"text/x-idl"},{title:"Pug",mime:"text/x-pug"},{default:!0,title:"Java",mime:"text/x-java"},{title:"Java Server Pages",mime:"application/x-jsp"},{default:!0,title:"JS frontend",mime:"application/javascript;env=frontend"},{default:!0,title:"JS backend",mime:"application/javascript;env=backend"},{default:!0,title:"JSON",mime:"application/json"},{title:"JSON-LD",mime:"application/ld+json"},{title:"JSX",mime:"text/jsx"},{title:"Jinja2",mime:"text/jinja2"},{title:"Julia",mime:"text/x-julia"},{default:!0,title:"Kotlin",mime:"text/x-kotlin"},{title:"LESS",mime:"text/x-less"},{title:"LiveScript",mime:"text/x-livescript"},{title:"Lua",mime:"text/x-lua"},{default:!0,title:"Markdown",mime:"text/x-markdown"},{title:"mIRC",mime:"text/mirc"},{title:"MariaDB SQL",mime:"text/x-mariadb"},{title:"Mathematica",mime:"text/x-mathematica"},{title:"Modelica",mime:"text/x-modelica"},{title:"MUMPS",mime:"text/x-mumps"},{title:"MS SQL",mime:"text/x-mssql"},{title:"mbox",mime:"application/mbox"},{title:"MySQL",mime:"text/x-mysql"},{title:"Nginx",mime:"text/x-nginx-conf"},{title:"NSIS",mime:"text/x-nsis"},{title:"NTriples",mime:"application/n-triples"},{title:"Objective-C",mime:"text/x-objectivec"},{title:"OCaml",mime:"text/x-ocaml"},{title:"Octave",mime:"text/x-octave"},{title:"Oz",mime:"text/x-oz"},{title:"Pascal",mime:"text/x-pascal"},{title:"PEG.js",mime:"null"},{default:!0,title:"Perl",mime:"text/x-perl"},{default:!0,title:"PHP",mime:"text/x-php"},{title:"Pig",mime:"text/x-pig"},{title:"PLSQL",mime:"text/x-plsql"},{title:"PostgreSQL",mime:"text/x-pgsql"},{title:"PowerShell",mime:"application/x-powershell"},{title:"Properties files",mime:"text/x-properties"},{title:"ProtoBuf",mime:"text/x-protobuf"},{default:!0,title:"Python",mime:"text/x-python"},{title:"Puppet",mime:"text/x-puppet"},{title:"Q",mime:"text/x-q"},{title:"R",mime:"text/x-rsrc"},{title:"reStructuredText",mime:"text/x-rst"},{title:"RPM Changes",mime:"text/x-rpm-changes"},{title:"RPM Spec",mime:"text/x-rpm-spec"},{default:!0,title:"Ruby",mime:"text/x-ruby"},{title:"Rust",mime:"text/x-rustsrc"},{title:"SAS",mime:"text/x-sas"},{title:"Sass",mime:"text/x-sass"},{title:"Scala",mime:"text/x-scala"},{title:"Scheme",mime:"text/x-scheme"},{title:"SCSS",mime:"text/x-scss"},{default:!0,title:"Shell",mime:"text/x-sh"},{title:"Sieve",mime:"application/sieve"},{title:"Slim",mime:"text/x-slim"},{title:"Smalltalk",mime:"text/x-stsrc"},{title:"Smarty",mime:"text/x-smarty"},{title:"Solr",mime:"text/x-solr"},{title:"SML",mime:"text/x-sml"},{title:"Soy",mime:"text/x-soy"},{title:"SPARQL",mime:"application/sparql-query"},{title:"Spreadsheet",mime:"text/x-spreadsheet"},{default:!0,title:"SQL",mime:"text/x-sql"},{title:"SQLite",mime:"text/x-sqlite"},{title:"Squirrel",mime:"text/x-squirrel"},{title:"Stylus",mime:"text/x-styl"},{default:!0,title:"Swift",mime:"text/x-swift"},{title:"sTeX",mime:"text/x-stex"},{title:"LaTeX",mime:"text/x-latex"},{title:"SystemVerilog",mime:"text/x-systemverilog"},{title:"Tcl",mime:"text/x-tcl"},{title:"Textile",mime:"text/x-textile"},{title:"TiddlyWiki ",mime:"text/x-tiddlywiki"},{title:"Tiki wiki",mime:"text/tiki"},{title:"TOML",mime:"text/x-toml"},{title:"Tornado",mime:"text/x-tornado"},{title:"troff",mime:"text/troff"},{title:"TTCN",mime:"text/x-ttcn"},{title:"TTCN_CFG",mime:"text/x-ttcn-cfg"},{title:"Turtle",mime:"text/turtle"},{title:"TypeScript",mime:"application/typescript"},{title:"TypeScript-JSX",mime:"text/typescript-jsx"},{title:"Twig",mime:"text/x-twig"},{title:"Web IDL",mime:"text/x-webidl"},{title:"VB.NET",mime:"text/x-vb"},{title:"VBScript",mime:"text/vbscript"},{title:"Velocity",mime:"text/velocity"},{title:"Verilog",mime:"text/x-verilog"},{title:"VHDL",mime:"text/x-vhdl"},{title:"Vue.js Component",mime:"text/x-vue"},{default:!0,title:"XML",mime:"text/xml"},{title:"XQuery",mime:"application/xquery"},{title:"Yacas",mime:"text/x-yacas"},{default:!0,title:"YAML",mime:"text/x-yaml"},{title:"Z80",mime:"text/x-z80"},{title:"mscgen",mime:"text/x-mscgen"},{title:"xu",mime:"text/x-xu"},{title:"msgenny",mime:"text/x-msgenny"}];let s=null;function a(){s=JSON.parse(JSON.stringify(i));const t=o.Z.getJson("codeNotesMimeTypes")||i.filter(t=>t.default).map(t=>t.mime);for(const e of s)e.enabled=t.includes(e.mime)||"text/plain"===e.mime}const r={getMimeTypes:async function(){return null===s&&a(),s},loadMimeTypes:a}},4585:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});const o=new class{constructor(){this.attributes={}}invalidate(){this.attributes={}}}},9847:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var o=n(9800),i=n(8003),s=n(9046);async function a(t,e){const n=await o.Z.get("autocomplete?query="+encodeURIComponent(t)+"&activeNoteId="+i.default.tabManager.getActiveTabNoteId());0===n.length&&n.push({pathTitle:"No results",path:""}),e(n)}function r(t){s.Z.isMobile()||(t.setSelectedPath(""),t.autocomplete("val","").trigger("change"))}function d(t){s.Z.isMobile()||(t.setSelectedPath(""),t.autocomplete("val",""),t.trigger("focus"))}const c={autocompleteSource:a,initNoteAutocomplete:function(t,e){if(t.hasClass("note-autocomplete-input")||s.Z.isMobile())return t;e=e||{},t.addClass("note-autocomplete-input");const n=$("<a>").addClass("input-group-text input-clearer-button bx bx-x").prop("title","Clear text field"),o=$("<a>").addClass("input-group-text show-recent-notes-button bx bx-time").prop("title","Show recent notes"),i=$("<a>").addClass("input-group-text go-to-selected-note-button bx bx-arrow-to-right").attr("data-action","note"),c=$("<div>").addClass("input-group-append").append(n).append(o);return e.hideGoToSelectedNoteButton||c.append(i),t.after(c),n.on("click",()=>r(t)),o.on("click",e=>(d(t),!1)),t.autocomplete({appendTo:document.querySelector("body"),hint:!1,autoselect:!0,openOnFocus:!0,minLength:0,tabAutocomplete:!1},[{source:a,displayKey:"pathTitle",templates:{suggestion:function(t){return t.highlightedTitle}},cache:!1}]),t.on("autocomplete:selected",(e,n)=>t.setSelectedPath(n.path)),t.on("autocomplete:closed",()=>{t.val().trim()||r(t)}),t},showRecentNotes:d,init:function(){$.fn.getSelectedPath=function(){return $(this).val().trim()?$(this).attr("data-note-path"):""},$.fn.setSelectedPath=function(t){t=t||"",$(this).attr("data-note-path",t),$(this).closest(".input-group").find(".go-to-selected-note-button").toggleClass("disabled",!t.trim()).attr("data-note-path",t)}}}},8181:(t,e,n)=>{"use strict";n.d(e,{Z:()=>p});var o=n(3968),i=n(8003),s=n(9046),a=n(2040),r=n(9800),d=n(1520),c=n(9806),l=n(6885);async function h(t,e={}){(e=Object.assign({activate:!0,target:"into"},e)).isProtected&&a.Z.isProtectedSessionAvailable()||(e.isProtected=!1),"text"!==i.default.tabManager.getActiveTabNoteType()&&(e.saveSelection=!1),e.saveSelection&&s.Z.isCKEditorInitialized()&&([e.title,e.content]=function(t){const e=$.parseHTML(t);if(e.length>0&&e[0].tagName&&e[0].tagName.match(/h[1-6]/i)){const n=$(e[0]).text(),o=t.replace(e[0].outerHTML,"");return[n,o]}return[null,t]}(window.cutToNote.getSelectedHtml()));const n=e.title||"new note",{note:o,branch:c}=await r.Z.post(`notes/${t}/children?target=${e.target}&targetBranchId=${e.targetBranchId}`,{title:n,content:e.content||"",isProtected:e.isProtected,type:e.type});if(e.saveSelection&&s.Z.isCKEditorInitialized()&&window.cutToNote.removeSelection(),e.activate){await d.Z.waitForMaxKnownSyncId();const t=i.default.tabManager.getActiveTabContext();await t.setNote(o.noteId),i.default.triggerCommand("focusAndSelectTitle")}return{note:o,branch:c}}const p={createNote:h,createNewTopLevelNote:async function(){const t=o.Z.getHoistedNoteId();await h(t)},duplicateNote:async function(t,e){const{note:n}=await r.Z.post(`notes/${t}/duplicate/${e}`);await d.Z.waitForMaxKnownSyncId(),await i.default.tabManager.activateOrOpenNote(n.noteId);const o=await c.Z.getNote(t);l.default.showMessage(`Note "${o.title}" has been duplicated`)}}},4716:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var o=n(8481),i=n(7844),s=n(9806),a=n(9046);async function r(){const t=$(this);if(t.hasClass("no-tooltip-preview")||t.hasClass("disabled")||"note-revision"===t.attr("data-action"))return;if(t.closest(".ck-link-actions").length)return;let e=i.Z.getNotePathFromUrl(t.attr("href"));if(e||(e=t.attr("data-note-path")),!e)return;const n=o.Z.getNoteIdFromNotePath(e),r=await s.Z.getNote(n),d=await s.Z.getNoteComplement(n),c=await async function(t,e){if(t.isDeleted)return"<div>Note has been deleted.</div>";const n=t.getAttributes();let o="";const s=n.filter(t=>"label-definition"===t.type||"relation-definition"===t.type).filter(t=>!t.name.startsWith("child:")).filter(t=>{const e=t.jsonValue;return e&&e.isPromoted});if(s.length>0){const t=$("<table>").addClass("promoted-attributes-in-tooltip");for(const e of s){const o=e.type,s=o.substr(0,o.length-11);let a=n.filter(t=>t.name===e.name&&t.type===s);for(const n of a){if(!n.value)continue;let o="";"label"===s?o=$("<td>").text(n.value):"relation"===s&&n.value&&(o=$("<td>").append(await i.Z.createNoteLink(n.value)));const a=$("<tr>").append($("<th>").text(e.name)).append(o);t.append(a)}}o+=t.prop("outerHTML")}"text"!==t.type||a.Z.isHtmlEmpty(e.content)?"code"===t.type&&e.content&&e.content.trim()?o+=$("<pre>").text(e.content).prop("outerHTML"):"image"===t.type&&(o+=$("<img>").prop("src",`api/images/${t.noteId}/${t.title}`).prop("outerHTML")):o+='<div class="ck-content">'+e.content+"</div>";return o}(r,d);$(this).is(":hover")&&($(this).tooltip({delay:{show:300,hide:100},container:"body",placement:"auto",trigger:"manual",boundary:"window",title:c,html:!0,template:'<div class="tooltip note-tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',sanitize:!1}),$(this).tooltip("show"))}function d(){$(this).tooltip("dispose")}const c={setupGlobalTooltip:function(){$(document).on("mouseenter","a",r),$(document).on("mouseleave","a",d),$(document).on("click",()=>$(".note-tooltip").remove())},setupElementTooltip:function(t){t.on("mouseenter",r),t.on("mouseleave",d)}}},4378:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var o=n(9800);const i=new class{constructor(){this.initializedPromise=o.Z.get("options").then(t=>this.load(t))}load(t){this.arr=t}get(t){return this.arr[t]}getNames(){return Object.keys(this.arr)}getJson(t){try{return JSON.parse(this.arr[t])}catch(t){return null}}getInt(t){return parseInt(this.arr[t])}getFloat(t){return parseFloat(this.arr[t])}is(t){return"true"===this.arr[t]}set(t,e){this.arr[t]=e}async save(t,e){this.set(t,e);const n={};n[t]=e,await o.Z.put("options",n)}}},7336:(t,e,n)=>{"use strict";n.d(e,{Z:()=>p});n(9046);var o=n(9800),i=n(2040),s=n(6885),a=n(1520),r=n(8003),d=n(9806);let c=null;function l(){const t=$.Deferred();return i.Z.isProtectedSessionAvailable()?t.resolve(!1):(c=t,n.e(261).then(n.bind(n,6261)).then(t=>t.show())),t.promise()}function h(t,e,n){return{id:t.taskId,title:e+" status",message:n,icon:t.data.protect?"check-shield":"shield"}}a.Z.subscribeToMessages(async t=>{if("protect-notes"!==t.taskType)return;const e=t.data.protect?"Protecting":"Unprotecting";if("task-error"===t.type)s.default.closePersistent(t.taskId),s.default.showError(t.message);else if("task-progress-count"===t.type)s.default.showPersistent(h(t,e,e+" in progress: "+t.progressCount));else if("task-succeeded"===t.type){const n=h(t,e,e+" finished successfully.");n.closeAfter=3e3,s.default.showPersistent(n)}});const p={protectNote:async function(t,e,n){await l(),await o.Z.put(`notes/${t}/protect/${e?1:0}?subtree=${n?1:0}`)},enterProtectedSession:l,leaveProtectedSession:async function(){i.Z.isProtectedSessionAvailable()&&i.Z.resetProtectedSession()},setupProtectedSession:async function(t){const e=await async function(t){return await o.Z.post("login/protected",{password:t})}(t);e.success?(i.Z.setProtectedSessionId(e.protectedSessionId),i.Z.touchProtectedSession(),await async function(){const t=Object.keys(d.Z.notes);await d.Z.loadInitialTree(),await d.Z.reloadNotes(t,!0)}(),await r.default.triggerEvent("treeCacheReloaded"),r.default.triggerEvent("protectedSessionStarted"),null!==c&&(n.e(261).then(n.bind(n,6261)).then(t=>t.close()),c.resolve(!0),c=null),s.default.showMessage("Protected session has been started.")):s.default.showError("Wrong password.",3e3)}}},2040:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(9046),i=n(4378);let s=0;function a(t){o.Z.setSessionCookie("protectedSessionId",t)}function r(){o.Z.setSessionCookie("protectedSessionId",null),o.Z.reloadApp()}function d(){return!!o.Z.getCookie("protectedSessionId")}function c(){d()&&(s=Date.now(),a(o.Z.getCookie("protectedSessionId")))}setInterval(()=>{const t=i.Z.getInt("protectedSessionTimeout");s&&Date.now()-s>1e3*t&&r()},5e3);const l={setProtectedSessionId:a,resetProtectedSession:r,isProtectedSessionAvailable:d,touchProtectedSession:c,touchProtectedSessionIfNecessary:function(t){t&&t.isProtected&&d()&&c()}}},2064:(t,e,n)=>{"use strict";n.d(e,{Z:()=>y});n(8481);var o=n(9800),i=n(9046),s=n(6885),a=n(7844),r=n(9806),d=n(4716),c=n(7336),l=n(383),h=n(2078),p=n(1520),u=n(3968),g=n(8003),b=n(986),m=n(4122),f=n(1167);const w=function(t,e,n=null,w=null){const y=$("#plugin-buttons");function v(t){return t?t.map(t=>"function"==typeof t?"!@#Function: "+t.toString():t):t}this.$container=w,this.startNote=t,this.currentNote=e,this.originEntity=n,this.dayjs=dayjs,this.CollapsibleWidget=h.Z,this.TabAwareWidget=b.Z,this.TabCachingWidget=m.Z,this.BasicWidget=f.Z,this.activateNote=async t=>{await g.default.tabManager.getActiveTabContext().setNote(t)},this.activateNewNote=async t=>{await p.Z.waitForMaxKnownSyncId(),await g.default.tabManager.getActiveTabContext().setNote(t),g.default.triggerEvent("focusAndSelectTitle")},this.addButtonToToolbar=t=>{const e="toolbar-button-"+t.title.replace(/[^a-zA-Z0-9]/g,"-"),n=$("<button>").addClass("btn btn-sm").on("click",t.action);t.icon&&n.append($("<span>").addClass("bx bx-"+t.icon)).append("&nbsp;"),n.append($("<span>").text(t.title)),n.attr("id",e),0===$("#"+e).replaceWith(n).length&&y.append(n),t.shortcut&&(i.Z.bindGlobalShortcut(t.shortcut,t.action),n.attr("title","Shortcut "+t.shortcut))},this.runOnBackend=async(i,s=[])=>{"function"==typeof i&&(i=i.toString());const a=await o.Z.post("script/exec",{script:i,params:v(s),startNoteId:t.noteId,currentNoteId:e.noteId,originEntityName:"notes",originEntityId:n?n.noteId:null},"script");if(a.success)return await p.Z.waitForSyncId(a.maxSyncId),a.executionResult;throw new Error("server error: "+a.error)},this.runOnServer=this.runOnBackend,this.searchForNotes=async t=>{const e=await this.runOnServer(async t=>(await api.searchForNotes(t)).map(t=>t.noteId),[t]);return await r.Z.getNotes(e)},this.searchForNote=async t=>{const e=await this.searchForNotes(t);return e.length>0?e[0]:null},this.getNote=async t=>await r.Z.getNote(t),this.getNotes=async(t,e=!1)=>await r.Z.getNotes(t,e),this.reloadNotes=async t=>await r.Z.reloadNotes(t),this.getInstanceName=()=>window.glob.instanceName,this.formatDateISO=i.Z.formatDateISO,this.parseDate=i.Z.parseDate,this.showMessage=s.default.showMessage,this.showError=s.default.showError,this.refreshTree=()=>{},this.createNoteLink=a.Z.createNoteLink,this.addTextToActiveTabEditor=t=>g.default.triggerCommand("addTextToActiveEditor",{text:t}),this.getActiveTabNote=()=>g.default.tabManager.getActiveTabNote(),this.getActiveTabTextEditor=t=>g.default.triggerCommand("executeInActiveEditor",{callback:t}),this.getActiveTabNotePath=()=>g.default.tabManager.getActiveTabNotePath(),this.setupElementTooltip=d.Z.setupElementTooltip,this.protectActiveNote=async()=>{const t=g.default.tabManager.getActiveTabNote();await c.Z.protectNote(t.noteId,!0,!1)},this.protectNote=async(t,e)=>{await c.Z.protectNote(t,e,!1)},this.protectSubTree=async(t,e)=>{await c.Z.protectNote(t,e,!0)},this.getTodayNote=l.Z.getTodayNote,this.getDateNote=l.Z.getDateNote,this.getMonthNote=l.Z.getMonthNote,this.getYearNote=l.Z.getYearNote,this.setHoistedNoteId=u.Z.setHoistedNoteId,this.bindGlobalShortcut=i.Z.bindGlobalShortcut,this.waitUntilSynced=p.Z.waitForMaxKnownSyncId,this.refreshIncludedNote=t=>g.default.triggerEvent("refreshIncludedNote",{noteId:t})};const y=async function(t,e,n=null,o=null){const s={};await r.Z.initializedPromise;const a=await r.Z.getNote(t),d=await r.Z.getNotes(e);return{modules:s,notes:i.Z.toObject(d,t=>[t.noteId,t]),apis:i.Z.toObject(d,t=>[t.noteId,new w(a,t,n,o)]),require:t=>e=>{const n=d.filter(e=>t.includes(e.noteId)).find(t=>t.title===e);if(!n)throw new Error("Could not find module note "+e);return s[n.noteId].exports}}}},9800:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(9046);function i(t){const e={"trilium-source-id":glob.sourceId,"trilium-local-now-datetime":o.Z.localNowDateTime(),"x-csrf-token":glob.csrfToken};for(const n in t)t[n]&&(e[n]=t[n]);return o.Z.isElectron()&&(e.cookie=document.cookie),e}let s=1;const a={};let r=0;async function d(t,e,n,d={}){let l;const h=Date.now();if(o.Z.isElectron()){const r=o.Z.dynamicRequire("electron").ipcRenderer,c=s++;l=await new Promise((o,s)=>{a[c]=o,r.send("server-request",{requestId:c,headers:i(d),method:t,url:"/"+baseApiUrl+e,data:n})})}else l=await c(e,t,n,d);const p=Date.now();glob.PROFILING_LOG&&console.log(`${t} ${e} took ${p-h}ms`);const u=l.headers["trilium-max-sync-id"];return u&&u.trim()&&(r=Math.max(r,parseInt(u))),l.body}function c(t,e,o,s){return new Promise((a,r)=>{const d={url:baseApiUrl+t,type:e,headers:i(s),timeout:6e4,success:(t,e,n)=>{const o={};n.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(t=>{const e=t.split(": "),n=e.shift();o[n]=e.join(": ")}),a({body:t,headers:o})},error:async(o,i,s)=>{const a="Error when calling "+e+" "+t+": "+i+" - "+s,d=(await Promise.resolve().then(n.bind(n,6885))).default;d.showError(a),d.throwError(a),r(s)}};if(o){try{d.data=JSON.stringify(o)}catch(t){console.log("Can't stringify data: ",o," because of error: ",t)}d.contentType="application/json"}$.ajax(d)})}if(o.Z.isElectron()){o.Z.dynamicRequire("electron").ipcRenderer.on("server-response",(t,e)=>{a[e.requestId]({body:e.body,headers:e.headers}),delete a[e.requestId]})}const l={get:async function(t,e){return await d("GET",t,null,{"trilium-source-id":e})},post:async function(t,e,n){return await d("POST",t,e,{"trilium-source-id":n})},put:async function(t,e,n){return await d("PUT",t,e,{"trilium-source-id":n})},remove:async function(t,e){return await d("DELETE",t,null,{"trilium-source-id":e})},ajax:c,getHeaders:i,getMaxKnownSyncId:()=>r}},1902:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});class o{constructor(t,e=1e3){this.updater=t,this.lastUpdated=Date.now(),this.changed=!1,this.updateInterval=e}scheduleUpdate(){this.changeForbidden||(this.changed=!0,setTimeout(()=>this.triggerUpdate()))}async updateNowIfNecessary(){this.changed&&(this.changed=!1,await this.updater())}triggerUpdate(){this.changed&&(Date.now()-this.lastUpdated>this.updateInterval?(this.updater(),this.lastUpdated=Date.now(),this.changed=!1):this.scheduleUpdate())}async allowUpdateWithoutChange(t){this.changeForbidden=!0;try{await t()}finally{this.changeForbidden=!1}}}},6885:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var o=n(1520),i=n(9046);function s(t){const e=$(`<div class="toast" role="alert" aria-live="assertive" aria-atomic="true">\n    <div class="toast-header">\n        <strong class="mr-auto"><span class="bx bx-${t.icon}"></span> ${t.title}</strong>\n        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n        </button>\n    </div>\n    <div class="toast-body">\n        ${t.message}\n    </div>\n</div>`);return t.id&&e.attr("id","toast-"+t.id),$("#toast-container").append(e),e.toast({delay:t.delay||3e3,autohide:!!t.autohide}),e.on("hidden.bs.toast",t=>t.target.remove()),e.toast("show"),e}function a(t,e=1e4){console.log(i.Z.now(),"error: ",t),s({title:"Error",icon:"alert",message:t,autohide:!0,delay:e})}const r={showMessage:function(t,e=2e3){console.debug(i.Z.now(),"message: ",t),s({title:"Info",icon:"check",message:t,autohide:!0,delay:e})},showError:a,showAndLogError:function(t,e=1e4){a(t,e),o.Z.logError(t)},throwError:function(t){throw o.Z.logError(t),new Error(t)},showPersistent:function(t){let e=$("#toast-"+t.id);e.length>0?e.find(".toast-body").html(t.message):(t.autohide=!1,e=s(t)),t.closeAfter&&setTimeout(()=>e.remove(),t.closeAfter)},closePersistent:function(t){$("#toast-"+t).remove()}}},8481:(t,e,n)=>{"use strict";n.d(e,{Z:()=>p});var o=n(1520),i=n(9046),s=n(9800),a=n(9806),r=n(3968),d=n(8003);async function c(t,e=!0){if(i.Z.assertArguments(t),0===(t=t.split("-")[0].trim()).length)return;const n=t.split("/").reverse();n.includes("root")||n.push("root");const s=r.Z.getHoistedNoteId(),d=[];let c=null,h=0;for(;!(h>=n.length);){const t=n[h++];if(null!==c){const n=await a.Z.getNote(c);if(!n)return void console.log("Can't find note "+c);const s=n.getParentNotes();if(!s)return void o.Z.logError("No parents found for "+c);if(!s.some(e=>e.noteId===t)){if(e&&console.log(i.Z.now(),"Did not find parent "+t+" for child "+c),s.length>0){e&&console.log(i.Z.now(),"Available parents:",s);const t=await l(s[0]);if(t){const e=t.split("/").reverse();for(const t of e)d.push(t);d.push("root")}break}return void(e&&console.log("No parents so no run path."))}}if(d.push(t),c=t,t===s)break}return d.reverse()}async function l(t){i.Z.assertArguments(t);const e=[];let n=t;for(;"root"!==n.noteId;){e.push(n.noteId);const t=n.getParentNotes();if(!t.length)return void console.error("Can't find parents for note "+n.noteId);n=t[0]}return e.push("root"),e.reverse().join("/")}async function h(t,e=null){i.Z.assertArguments(t);const n=await a.Z.getNote(t);if(!n)return"[not found]";let{title:o}=n;if(null!==e){const t=n.parentToBranch[e];if(t){const e=a.Z.getBranch(t);e&&e.prefix&&(o=e.prefix+" - "+o)}}return o}o.Z.subscribeToMessages(t=>{if("open-note"===t.type&&(d.default.tabManager.activateOrOpenNote(t.noteId),i.Z.isElectron())){i.Z.dynamicRequire("electron").remote.getCurrentWindow().show()}});const p={sortAlphabetically:async function(t){await s.Z.put("notes/"+t+"/sort")},resolveNotePath:async function(t){const e=await c(t);return e?e.join("/"):null},getSomeNotePath:l,getRunPath:c,getParentProtectedStatus:function(t){return r.Z.isRootNode(t)?0:t.getParent().data.isProtected},getNotePath:function(t){if(!t)return console.error("Node is null"),"";const e=[];for(;t&&!r.Z.isRootNode(t);)t.data.noteId&&e.push(t.data.noteId),t=t.getParent();return t&&e.push(t.data.noteId),e.reverse().join("/")},getNoteIdFromNotePath:function(t){if(!t)return null;const e=t.split("/");return e[e.length-1].split("-")[0]},getNoteIdAndParentIdFromNotePath:function(t){if("root"===t)return{noteId:"root",parentNoteId:"none"};let e="root",n="";if(t){const o=t.split("/");n=o[o.length-1].split("-")[0],o.length>1&&(e=o[o.length-2])}return{parentNoteId:e,noteId:n}},getNoteTitle:h,getNotePathTitle:async function(t){i.Z.assertArguments(t);const e=[];if(t.startsWith("root/")&&(t=t.substr(5)),"root"===t)return await h(t);let n="root";for(const o of t.split("/"))e.push(await h(o,n)),n=o;return e.join(" / ")},getHashValueFromAddress:function(){return(document.location.hash?document.location.hash.substr(1):"").split("-")},parseNotePath:function(t){let e=t.split("/");return"root"!==e[0]&&(e=["root"].concat(e)),e}}},9806:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(3215),i=n(9800),s=n(5708),a=n(4585);const r="label";const d=class{constructor(t,e){this.treeCache=t,this.attributes=[],this.targetRelations=[],this.parents=[],this.children=[],this.parentToBranch={},this.childToBranch={},this.update(e)}update(t){this.noteId=t.noteId,this.title=t.title,this.contentLength=t.contentLength,this.isProtected=!!t.isProtected,this.type=t.type,this.mime=t.mime,this.isDeleted=t.isDeleted}addParent(t,e){this.parents.includes(t)||this.parents.push(t),this.parentToBranch[t]=e}addChild(t,e){this.children.includes(t)||this.children.push(t),this.childToBranch[t]=e;const n={};for(const t of Object.values(this.childToBranch))n[t]=this.treeCache.getBranch(t).notePosition;this.children.sort((t,e)=>n[this.childToBranch[t]]<n[this.childToBranch[e]]?-1:1)}isJson(){return"application/json"===this.mime}async getContent(){return(await i.Z.get("notes/"+this.noteId)).content}async getJsonContent(){const t=await this.getContent();try{return JSON.parse(t)}catch(t){return console.log(`Cannot parse content of note ${this.noteId}: `,t.message),null}}getBranchIds(){return Object.values(this.parentToBranch)}getBranches(){const t=Object.values(this.parentToBranch);return this.treeCache.getBranches(t)}hasChildren(){return this.children.length>0}getChildBranches(){const t=this.children.map(t=>this.childToBranch[t]);return this.treeCache.getBranches(t)}getParentNoteIds(){return this.parents}getParentNotes(){return this.treeCache.getNotesFromCache(this.parents)}getChildNoteIds(){return this.children}async getChildNotes(){return await this.treeCache.getNotes(this.children)}getOwnedAttributes(t,e){const n=this.attributes.map(t=>this.treeCache.attributes[t]).filter(Boolean);return this.__filterAttrs(n,t,e)}getAttributes(t,e){return this.__filterAttrs(this.__getCachedAttributes([]),t,e)}__getCachedAttributes(t){if(t.includes(this.noteId))return[];if(!(this.noteId in a.Z)){const e=this.getOwnedAttributes(),n=[e],o=[...t,this.noteId];for(const t of e.filter(t=>"relation"===t.type&&"template"===t.name)){const e=this.treeCache.notes[t.value];e&&e.noteId!==this.noteId&&n.push(e.__getCachedAttributes(o))}if("root"!==this.noteId)for(const t of this.getParentNotes())"search"!==t.type&&n.push(t.__getInheritableAttributes(o));a.Z.attributes[this.noteId]=n.flat()}return a.Z.attributes[this.noteId]}__filterAttrs(t,e,n){return e||n?e&&n?t.filter(t=>t.type===e&&t.name===n):e?t.filter(t=>t.type===e):n?t.filter(t=>t.name===n):void 0:t}__getInheritableAttributes(t){return this.__getCachedAttributes(t).filter(t=>t.isInheritable)}getOwnedLabels(t){return this.getOwnedAttributes(r,t)}getLabels(t){return this.getAttributes(r,t)}getLabelDefinitions(t){return this.getAttributes("label-definition",t)}getOwnedRelations(t){return this.getOwnedAttributes("relation",t)}getRelations(t){return this.getAttributes("relation",t)}getRelationDefinitions(t){return this.getAttributes("relation-definition",t)}hasAttribute(t,e){return!!this.getAttribute(t,e)}hasOwnedAttribute(t,e){return!!this.getOwnedAttribute(t,e)}getOwnedAttribute(t,e){const n=this.getOwnedAttributes(t,e);return n.length>0?n[0]:0}getAttribute(t,e){const n=this.getAttributes(t,e);return n.length>0?n[0]:0}getOwnedAttributeValue(t,e){const n=this.getOwnedAttribute(t,e);return n?n.value:null}getAttributeValue(t,e){const n=this.getAttribute(t,e);return n?n.value:null}hasOwnedLabel(t){return this.hasOwnedAttribute(r,t)}hasLabel(t){return this.hasAttribute(r,t)}hasOwnedRelation(t){return this.hasOwnedAttribute("relation",t)}hasRelation(t){return this.hasAttribute("relation",t)}getOwnedLabel(t){return this.getOwnedAttribute(r,t)}getLabel(t){return this.getAttribute(r,t)}getOwnedRelation(t){return this.getOwnedAttribute("relation",t)}getRelation(t){return this.getAttribute("relation",t)}getOwnedLabelValue(t){return this.getOwnedAttributeValue(r,t)}getLabelValue(t){return this.getAttributeValue(r,t)}getOwnedRelationValue(t){return this.getOwnedAttributeValue("relation",t)}getRelationValue(t){return this.getAttributeValue("relation",t)}async getRelationTarget(t){const e=await this.getRelationTargets(t);return e.length>0?e[0]:null}async getRelationTargets(t){const e=this.getRelations(t),n=[];for(const t of e)n.push(await this.treeCache.getNote(t.value));return n}getTemplateNotes(){return this.getRelations("template").map(t=>this.treeCache.notes[t.value])}hasAncestor(t){if(this.noteId===t.noteId)return!0;for(const e of this.getTemplateNotes())if(e.hasAncestor(t))return!0;for(const e of this.getParentNotes())if(e.hasAncestor(t))return console.log(e),!0;return!1}invalidateAttributeCache(){this.__attributeCache=null}getTargetRelations(){return this.targetRelations.map(t=>this.treeCache.attributes[t])}async getNoteComplement(){return await this.treeCache.getNoteComplement(this.noteId)}get toString(){return`Note(noteId=${this.noteId}, title=${this.title})`}get dto(){const t=Object.assign({},this);return delete t.treeCache,t}getCssClass(){return this.getLabels("cssClass").map(t=>t.value).join(" ")}};const c=class{constructor(t){this.noteId=t.noteId,this.content=t.content,this.dateCreated=t.dateCreated,this.dateModified=t.dateModified,this.utcDateCreated=t.utcDateCreated,this.utcDateModified=t.utcDateModified}};const l=new class{constructor(){this.initializedPromise=this.loadInitialTree()}async loadInitialTree(){const t=await i.Z.get("tree");await this.loadParents(t,!1),this.notes={},this.branches={},this.attributes={},this.noteComplementPromises={},this.addResp(t)}async loadParents(t,e){const n=new Set(t.notes.map(t=>t.noteId)),o=[],s=e?this.notes:{};for(const e of t.branches)e.parentNoteId in s||n.has(e.parentNoteId)||"none"===e.parentNoteId||o.push(e.parentNoteId);for(const e of t.attributes)"relation"!==e.type||"template"!==e.name||e.value in s||n.has(e.value)||o.push(e.value),e.noteId in s||n.has(e.noteId)||o.push(e.noteId);if(o.length>0){const n=await i.Z.post("tree/load",{noteIds:o});t.notes=t.notes.concat(n.notes),t.branches=t.branches.concat(n.branches),t.attributes=t.attributes.concat(n.attributes),await this.loadParents(t,e)}}addResp(t){const e=t.notes,n=t.branches,i=t.attributes;for(const t of e){const{noteId:e}=t,n=this.notes[e];if(n){for(const t of n.children){const n=this.notes[t];n&&(n.parents=n.parents.filter(t=>t!==e),delete this.branches[n.parentToBranch[e]],delete n.parentToBranch[e])}for(const t of n.parents){const n=this.notes[t];n&&(n.children=n.children.filter(t=>t!==e),delete this.branches[n.childToBranch[e]],delete n.childToBranch[e])}}const o=new d(this,t);this.notes[o.noteId]=o}for(const t of n){const e=new o.Z(this,t);this.branches[e.branchId]=e;const n=this.notes[e.noteId];n&&n.addParent(e.parentNoteId,e.branchId);const i=this.notes[e.parentNoteId];i&&i.addChild(e.noteId,e.branchId)}for(const t of i){const{attributeId:e}=t;this.attributes[e]=new s.Z(this,t);const n=this.notes[t.noteId];if(n.attributes.includes(e)||n.attributes.push(e),"relation"===t.type){const n=this.notes[t.value];n&&(n.targetRelations.includes(e)||n.targetRelations.push(e))}}}async reloadNotes(t){if(0===t.length)return;t=Array.from(new Set(t));const e=await i.Z.post("tree/load",{noteIds:t});await this.loadParents(e,!0),this.addResp(e);for(const t of e.notes)if("search"===t.type){const n=await i.Z.get("search-note/"+t.noteId);if(!n)throw new Error(`Search note ${t.noteId} failed.`);await this.getNotes(n.map(t=>t.noteId));const o=e.branches.filter(e=>e.noteId===t.noteId||e.parentNoteId===t.noteId);n.forEach((e,n)=>o.push({branchId:"virt"+e.noteId+"-"+t.noteId,noteId:e.noteId,parentNoteId:t.noteId,prefix:this.getBranch(e.branchId).prefix,notePosition:10*(n+1)})),this.addResp({notes:[t],branches:o,attributes:[]})}}getNotesFromCache(t,e=!1){return t.map(t=>this.notes[t]||e?this.notes[t]:(console.log(`Can't find note "${t}"`),null)).filter(t=>!!t)}async getNotes(t,e=!1){const n=t.filter(t=>!this.notes[t]);return await this.reloadNotes(n),t.map(t=>this.notes[t]||e?this.notes[t]:(console.log(`Can't find note "${t}"`),null)).filter(t=>!!t)}async noteExists(t){return 1===(await this.getNotes([t],!0)).length}async getNote(t,e=!1){return"none"===t?(console.trace("No 'none' note."),null):t?(await this.getNotes([t],e))[0]:(console.log(`Falsy noteId ${t}, returning null.`),null)}getNoteFromCache(t){return this.notes[t]}getBranches(t,e=!1){return t.map(t=>this.getBranch(t,e)).filter(t=>!!t)}getBranch(t,e=!1){if(t in this.branches)return this.branches[t];e||console.error("Not existing branch "+t)}async getBranchId(t,e){const n=await this.getNote(e);return n?n.parentToBranch[t]:(console.error(`Could not find branchId for parent=${t}, child=${e} since child does not exist`),null)}async getNoteComplement(t){return this.noteComplementPromises[t]||(this.noteComplementPromises[t]=i.Z.get("notes/"+t).then(t=>new c(t))),await this.noteComplementPromises[t]}}},9046:(t,e,n)=>{"use strict";function o(t){return(t<=9?"0":"")+t}function i(t){return o(t.getHours())+":"+o(t.getMinutes())}function s(t){return o(t.getHours())+":"+o(t.getMinutes())+":"+o(t.getSeconds())}function a(t){return r(t)}function r(t){return t.getFullYear()+"-"+o(t.getMonth()+1)+"-"+o(t.getDate())}function d(){return!!(window&&window.process&&window.process.type)}n.d(e,{Z:()=>y});const c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function l(t){return/[^\w_-]/.test(t)?'"'+t+'"':t}function h(t,e,n){u()&&(e=p(e),t.bind("keydown",e,t=>{n(t),t.preventDefault(),t.stopPropagation()}))}function p(t){return t.toLowerCase().replace("enter","return").replace("delete","del").replace("ctrl+alt","alt+ctrl").replace("meta+alt","alt+meta")}function u(){return"desktop"===window.device||!window.device&&!/Mobi/.test(navigator.userAgent)}function g(){glob.activeDialog&&(glob.activeDialog.modal("hide"),glob.activeDialog=null)}let b=null;function m(){b=$(":focus")}function f(){if(b){if(b.hasClass("ck")){b.closest(".ck-editor__editable").prop("ckeditorInstance").editing.view.focus()}else b.focus();b=null}}function w(t){return"undefined"!=typeof require?require(t):n(3676)(t)}const y={reloadApp:function(){window.location.reload(!0)},parseDate:function(t){try{return new Date(Date.parse(t))}catch(e){throw new Error("Can't parse date from "+t+": "+e.stack)}},padNum:o,formatTime:i,formatTimeWithSeconds:s,formatDate:a,formatDateISO:r,formatDateTime:function(t){return a(t)+" "+i(t)},localNowDateTime:function(){return dayjs().format("YYYY-MM-DD HH:mm:ss.SSSZZ")},now:function(){return s(new Date)},isElectron:d,isMac:function(){return navigator.platform.indexOf("Mac")>-1},assertArguments:function(){for(const t in arguments)arguments[t]||console.trace(`Argument idx#${t} should not be falsy: ${arguments[t]}`)},escapeHtml:function(t){return t.replace(/[&<>"'`=\/]/g,t=>c[t])},stopWatch:async function(t,e){const n=new Date,o=await e(),i=Date.now()-n.getTime();return console.log(`${t} took ${i}ms`),o},formatLabel:function(t){let e="@"+l(t.name);return""!==t.value&&(e+="="+l(t.value)),e},download:function(t){if(t+="?"+Date.now(),d()){w("electron").remote.getCurrentWebContents().downloadURL(t)}else window.location.href=t},toObject:function(t,e){const n={};for(const o of t){const[t,i]=e(o);n[t]=i}return n},randomString:function(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},bindGlobalShortcut:function(t,e){h($(document),t,e)},bindElShortcut:h,isMobile:function(){return"mobile"===window.device||!window.device&&/Mobi/.test(navigator.userAgent)},isDesktop:u,setCookie:function(t,e){const n="; expires="+new Date(Date.now()+31536e7).toUTCString();document.cookie=t+"="+(e||"")+n+";"},setSessionCookie:function(t,e){document.cookie=t+"="+(e||"")+";"},getCookie:function(t){const e=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return e?e[2]:null},getNoteTypeClass:function(t){return"type-"+t},getMimeTypeClass:function(t){const e=t.indexOf(";");return-1!==e&&(t=t.substr(0,e)),"mime-"+t.toLowerCase().replace(/[\W_]+/g,"-")},closeActiveDialog:g,openDialog:async function(t){g(),glob.activeDialog=t,m(),t.modal(),t.on("hidden.bs.modal",()=>{glob.activeDialog&&glob.activeDialog!==t||f()}),(await Promise.resolve().then(n.bind(n,6604))).default.updateDisplayedShortcuts(t)},saveFocusedElement:m,focusSavedElement:f,isHtmlEmpty:function(t){return!t||!(t=t.toLowerCase()).includes("<img")&&!t.includes("<section")&&0===$("<div>").html(t).text().trim().length},clearBrowserCache:async function(){if(d()){const t=w("electron").remote.getCurrentWindow();await t.webContents.session.clearCache()}},getUrlForDownload:function(t){return d()?function(){const t=new URL(window.location.href);return t.protocol+"//"+t.hostname+":"+t.port}()+"/"+t:t},normalizeShortcut:p,copySelectionToClipboard:function(){const t=window.getSelection().toString();navigator.clipboard&&navigator.clipboard.writeText(t)},isCKEditorInitialized:function(){return!(!window||!window.cutToNote)},dynamicRequire:w,timeLimit:function(t,e){const n=new Error("Process exceeded time limit "+e);return new Promise((o,i)=>{let s=!1;t.then(t=>{s=!0,o(t)}),setTimeout(()=>{s||i(n)},e)})}}},1520:(t,e,n)=>{"use strict";n.d(e,{Z:()=>Z});var o=n(9046),i=n(6885),s=n(9800);class a{constructor(t){this.treeCache=t,this.noteIdToSourceId={},this.sourceIdToNoteIds={},this.branches=[],this.attributes=[],this.noteReorderings=[],this.noteRevisions=[],this.contentNoteIdToSourceId=[],this.options=[]}addNote(t,e){this.noteIdToSourceId[t]=this.noteIdToSourceId[t]||[],this.noteIdToSourceId[t].includes(e)||this.noteIdToSourceId[t].push(e),this.sourceIdToNoteIds[e]=this.sourceIdToNoteIds[e]||[],this.sourceIdToNoteIds[e]||this.sourceIdToNoteIds[e].push(t)}addBranch(t,e){this.branches.push({branchId:t,sourceId:e})}getBranches(){return this.branches.map(t=>this.treeCache.branches[t.branchId]).filter(t=>!!t)}addNoteReordering(t,e){this.noteReorderings.push(t)}getNoteReorderings(){return this.noteReorderings}addAttribute(t,e){this.attributes.push({attributeId:t,sourceId:e})}getAttributes(t="none"){return this.attributes.filter(e=>e.sourceId!==t).map(t=>this.treeCache.attributes[t.attributeId]).filter(t=>!!t)}addNoteRevision(t,e,n){this.noteRevisions.push({noteRevisionId:t,noteId:e,sourceId:n})}hasNoteRevisionForNote(t){return!!this.noteRevisions.find(e=>e.noteId===t)}getNoteIds(){return Object.keys(this.noteIdToSourceId)}isNoteReloaded(t,e=null){if(!t)return!1;const n=this.noteIdToSourceId[t];return n&&!!n.find(t=>t!==e)}addNoteContent(t,e){this.contentNoteIdToSourceId.push({noteId:t,sourceId:e})}isNoteContentReloaded(t,e){return!!t&&this.contentNoteIdToSourceId.find(n=>n.noteId===t&&n.sourceId!==e)}addOption(t){this.options.push(t)}isOptionReloaded(t){this.options.includes(t)}hasAttributeRelatedChanges(){return 0===this.branches.length&&0===this.attributes.length}isEmpty(){return 0===Object.keys(this.noteIdToSourceId).length&&0===this.branches.length&&0===this.attributes.length&&0===this.noteReorderings.length&&0===this.noteRevisions.length&&0===this.contentNoteIdToSourceId.length&&0===this.options.length}}var r=n(3215),d=n(5708),c=n(4378),l=n(9806),h=n(4585);const p=$("#outstanding-syncs-count"),u=[];let g,b,m=window.glob.maxSyncIdAtLoad,f=window.glob.maxSyncIdAtLoad,w=[];function y(t){console.log(o.Z.now(),t),console.trace(),g&&1===g.readyState&&g.send(JSON.stringify({type:"log-error",error:t,stack:(new Error).stack}))}function v(t){u.push(t)}let x=null;const I=new Set;async function _(t){const e=JSON.parse(t.data);for(const t of u)t(e);if("sync"===e.type){let t=e.data;if(b=Date.now(),p.html(e.outstandingSyncs),t.length>0){for(!function(t){const e=t.filter(t=>!I.has(t.id)&&"recent_notes"!==t.entityName&&("options"!==t.entityName||"openTabs"!==t.entityId));e.length>0&&console.debug(o.Z.now(),"Sync data: ",e)}(t),w.push(...t),m=Math.max(m,t[t.length-1].id),T();x;)await x;try{x=async function(){if(w.length>0){const t=w;w=[];const e=t.filter(t=>!I.has(t.id));try{await o.Z.timeLimit(async function(t){const e=[];for(const{entityName:n,entity:o}of t)"branches"!==n||o.parentNoteId in l.Z.notes?"attributes"!==n||"relation"!==o.type||"template"!==o.name||o.noteId in l.Z.notes||e.push(o.value):e.push(o.parentNoteId);e.length>0&&await l.Z.reloadNotes(e);const o=new a(l.Z);for(const e of t.filter(t=>"notes"===t.entityName)){const t=l.Z.notes[e.entityId];t&&(t.update(e.entity),o.addNote(e.entityId,e.sourceId))}for(const e of t.filter(t=>"branches"===t.entityName)){let t=l.Z.branches[e.entityId];const n=l.Z.notes[e.entity.noteId],i=l.Z.notes[e.entity.parentNoteId];t?(t.update(e.entity),o.addBranch(e.entityId,e.sourceId),e.entity.isDeleted?(n&&(n.parents=n.parents.filter(t=>t!==e.entity.parentNoteId),delete n.parentToBranch[e.entity.parentNoteId]),i&&(i.children=i.children.filter(t=>t!==e.entity.noteId),delete i.childToBranch[e.entity.noteId])):(n&&n.addParent(t.parentNoteId,t.branchId),i&&i.addChild(t.noteId,t.branchId))):e.entity.isDeleted||(n||i)&&(t=new r.Z(l.Z,e.entity),l.Z.branches[t.branchId]=t,o.addBranch(e.entityId,e.sourceId),n&&n.addParent(t.parentNoteId,t.branchId),i&&i.addChild(t.noteId,t.branchId))}for(const e of t.filter(t=>"note_reordering"===t.entityName)){for(const t in e.positions){const n=l.Z.branches[t];n&&(n.notePosition=e.positions[t])}o.addNoteReordering(e.entityId,e.sourceId)}for(const e of t.filter(t=>"attributes"===t.entityName)){let t=l.Z.attributes[e.entityId];const n=l.Z.notes[e.entity.noteId],i="relation"===e.entity.type&&l.Z.notes[e.entity.value];t?(t.update(e.entity),o.addAttribute(e.entityId,e.sourceId),e.entity.isDeleted&&(n&&(n.attributes=n.attributes.filter(e=>e!==t.attributeId)),i&&(i.targetRelations=i.targetRelations.filter(e=>e!==t.attributeId)))):e.entity.isDeleted||(n||i)&&(t=new d.Z(l.Z,e.entity),l.Z.attributes[t.attributeId]=t,o.addAttribute(e.entityId,e.sourceId),n&&!n.attributes.includes(t.attributeId)&&n.attributes.push(t.attributeId),i&&!i.targetRelations.includes(t.attributeId)&&i.targetRelations.push(t.attributeId))}for(const e of t.filter(t=>"note_contents"===t.entityName))delete l.Z.noteComplementPromises[e.entityId],o.addNoteContent(e.entityId,e.sourceId);for(const e of t.filter(t=>"note_revisions"===t.entityName))o.addNoteRevision(e.entityId,e.noteId,e.sourceId);for(const e of t.filter(t=>"options"===t.entityName))"openTabs"!==e.entity.name&&(c.Z.set(e.entity.name,e.entity.value),o.addOption(e.entity.name));if(!o.isEmpty()){o.hasAttributeRelatedChanges()&&h.Z.invalidate();const t=(await Promise.resolve().then(n.bind(n,8003))).default;await t.triggerEvent("entitiesReloaded",{loadResults:o})}}(e),5e3)}catch(t){y(`Encountered error ${t.message}: ${t.stack}, reloading frontend.`),o.Z.reloadApp()}for(const t of e)I.add(t.id);f=Math.max(f,t[t.length-1].id)}C.filter(t=>t.desiredSyncId<=f).forEach(t=>t.resolvePromise()),C=C.filter(t=>t.desiredSyncId>f),C.filter(t=>Date.now()>t.start-6e4).forEach(t=>console.log(`Waiting for syncId ${t.desiredSyncId} while current is ${f} for ${Math.floor((Date.now()-t.start)/1e3)}s`))}(),await x}finally{x=null}}}else"sync-hash-check-failed"===e.type?i.default.showError("Sync check failed!",6e4):"consistency-checks-failed"===e.type&&i.default.showError("Consistency checks failed! See logs for details.",3e6)}let C=[];function N(t){return t<=f?Promise.resolve():(console.debug("Waiting for",t,"current is",f),new Promise((e,n)=>{C.push({desiredSyncId:t,resolvePromise:e,start:Date.now()})}))}function k(){const t=window.location,e=("https:"===t.protocol?"wss:":"ws:")+"//"+t.host+t.pathname,n=new WebSocket(e);return n.onopen=()=>console.debug(o.Z.now(),`Connected to server ${e} with WebSocket`),n.onmessage=_,n}async function T(){Date.now()-b>3e4&&console.log(o.Z.now(),"Lost websocket connection to the backend. If you keep having this issue repeatedly, you might want to check your reverse proxy (nginx, apache) configuration and allow/unblock WebSocket."),g.readyState===g.OPEN?g.send(JSON.stringify({type:"ping",lastSyncId:m})):g.readyState!==g.CLOSED&&g.readyState!==g.CLOSING||(console.log(o.Z.now(),"WS closed or closing, trying to reconnect"),g=k())}setTimeout(()=>{g=k(),b=Date.now(),setInterval(T,1e3)},0),v(t=>{"sync-pull-in-progress"===t.type?i.default.showPersistent({id:"sync",title:"Sync status",message:"Sync update in progress",icon:"refresh"}):"sync-pull-finished"===t.type&&setTimeout(()=>i.default.closePersistent("sync"),1e3)});const Z={logError:y,subscribeToMessages:v,waitForSyncId:N,waitForMaxKnownSyncId:function(){return N(s.Z.getMaxKnownSyncId())}}},503:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var o=n(4378),i=n(6221),s=n(9046);class a extends i.Z{constructor(){super(),s.Z.isElectron()&&o.Z.initializedPromise.then(()=>{this.setZoomFactor(o.Z.getFloat("zoomFactor"))})}setZoomFactor(t){t=parseFloat(t),s.Z.dynamicRequire("electron").webFrame.setZoomFactor(t)}async setZoomFactorAndSave(t){t>=.5&&t<=2?(this.setZoomFactor(t),await o.Z.save("zoomFactor",t)):console.log(`Zoom factor ${t} outside of the range, ignored.`)}getCurrentZoom(){return s.Z.dynamicRequire("electron").webFrame.getZoomFactor()}zoomOutEvent(){this.setZoomFactorAndSave(this.getCurrentZoom()-.1)}zoomInEvent(){this.setZoomFactorAndSave(this.getCurrentZoom()+.1)}setZoomFactorAndSaveEvent({zoomFactor:t}){this.setZoomFactorAndSave(t)}}const r=new a},3676:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=3676,t.exports=e},1167:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var o=n(6221);class i extends o.Z{constructor(){super(),this.attrs={style:""},this.classes=[]}id(t){return this.attrs.id=t,this}class(t){return this.classes.push(t),this}css(t,e){return this.attrs.style+=`${t}: ${e};`,this}collapsible(){return this.css("min-height","0"),this}filling(){return this.css("flex-grow","1"),this}hideInZenMode(){return this.class("hide-in-zen-mode"),this}cssBlock(t){return this.cssEl=t,this}render(){const t=this.doRender();if(t.addClass("component").prop("component",this),this.toggleInt(this.isEnabled()),this.cssEl){const e=this.cssEl.trim().startsWith("<style>")?this.cssEl:`<style>${this.cssEl}</style>`;t.append(e)}for(const e in this.attrs)if("style"===e){if(this.attrs[e]){let n=t.attr("style");n=n?`${n}; ${this.attrs[e]}`:this.attrs[e],t.attr(e,n)}}else t.attr(e,this.attrs[e]);for(const e of this.classes)t.addClass(e);return t}isEnabled(){return!0}doRender(){}toggleInt(t){this.$widget.toggleClass("hidden-int",!t)}toggleExt(t){this.$widget.toggleClass("hidden-ext",!t)}isVisible(){return this.$widget.is(":visible")}getPosition(){return this.position}remove(){this.$widget&&this.$widget.remove()}cleanup(){}}const s=i},2078:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var o=n(986),i=n(4378);class s extends o.Z{get widgetTitle(){return"Untitled widget"}get headerActions(){return[]}get help(){return{}}doRender(){return this.$widget=$('\n<div class="card widget">\n    <div class="card-header">\n        <div>           \n            <button class="btn btn-sm widget-title" data-toggle="collapse" data-target="#[to be set]">\n                Collapsible Group Item\n            </button>\n            \n            <a class="widget-help external no-arrow bx bx-info-circle"></a>\n        </div>\n        \n        <div class="widget-header-actions"></div>\n    </div>\n\n    <div id="[to be set]" class="collapse body-wrapper" style="transition: none; ">\n        <div class="card-body"></div>\n    </div>\n</div>'),this.$widget.find("[data-target]").attr("data-target","#"+this.componentId),this.$bodyWrapper=this.$widget.find(".body-wrapper"),this.$bodyWrapper.attr("id",this.componentId),this.widgetName=this.widgetTitle.replace(/[^[a-zA-Z0-9]/g,"_"),i.Z.is(this.widgetName+"Collapsed")||this.$bodyWrapper.collapse("show"),this.$bodyWrapper.on("hide.bs.collapse",()=>this.saveCollapsed(!0)),this.$bodyWrapper.on("show.bs.collapse",()=>this.saveCollapsed(!1)),this.$body=this.$bodyWrapper.find(".card-body"),this.$title=this.$widget.find(".widget-title"),this.$title.text(this.widgetTitle),this.$help=this.$widget.find(".widget-help"),this.help.title?(this.$help.attr("title",this.help.title),this.$help.attr("href",this.help.url||"javascript:"),this.help.url||this.$help.addClass("no-link")):this.$help.hide(),this.$headerActions=this.$widget.find(".widget-header-actions"),this.$headerActions.append(...this.headerActions),this.initialized=this.doRenderBody(),this.decorateWidget(),this.$widget}saveCollapsed(t){i.Z.save(this.widgetName+"Collapsed",t.toString()),this.triggerEvent("widgetCollapsedStateChanged",{widgetName:this.widgetName,collapse:t})}widgetCollapsedStateChangedEvent({widgetName:t,collapse:e}){t===this.widgetName&&this.$bodyWrapper.toggleClass("show",!e)}decorateWidget(){}async doRenderBody(){}isExpanded(){return this.$bodyWrapper.hasClass("show")}}},6221:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var o=n(9046);class i{constructor(){this.componentId="comp-"+o.Z.randomString(8),this.children=[],this.initialized=Promise.resolve()}setParent(t){return this.parent=t,this}child(...t){for(const e of t)e.setParent(this),this.children.push(e);return this}handleEvent(t,e){return Promise.all([this.initialized.then(()=>this.callMethod(this[t+"Event"],e)),this.handleEventInChildren(t,e)])}triggerEvent(t,e){return this.parent.triggerEvent(t,e)}handleEventInChildren(t,e){const n=[];for(const o of this.children)n.push(o.handleEvent(t,e));return Promise.all(n)}triggerCommand(t,e={}){const n=this[t+"Command"];return n?this.callMethod(n,e):this.parent.triggerCommand(t,e)}async callMethod(t,e){return"function"==typeof t&&(await t.call(this,e),!0)}}},986:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var o=n(1167),i=n(8003);class s extends o.Z{isTab(t){return this.tabContext&&this.tabContext.tabId===t}isNote(t){return this.noteId===t}get note(){return this.tabContext&&this.tabContext.note}get noteId(){return this.note&&this.note.noteId}get notePath(){return this.tabContext&&this.tabContext.notePath}isEnabled(){return!!this.note}async refresh(){if(this.isEnabled()){const t=Date.now();this.toggleInt(!0),await this.refreshWithNote(this.note,this.notePath);const e=Date.now();glob.PROFILING_LOG&&e-t>10&&console.log(`Refresh of ${this.componentId} took ${e-t}ms`)}else this.toggleInt(!1)}async refreshWithNote(t,e){}async tabNoteSwitchedEvent({tabContext:t,notePath:e}){t.notePath===e&&await this.noteSwitched()}async noteSwitched(){await this.refresh()}async activeTabChangedEvent({tabContext:t}){this.tabContext=t,await this.activeTabChanged()}async activeTabChanged(){await this.refresh()}async tabNoteSwitchedAndActivatedEvent({tabContext:t,notePath:e}){this.tabContext=t,this.notePath===e&&await this.refresh()}setTabContextEvent({tabContext:t}){this.tabContext=t}async noteTypeMimeChangedEvent({noteId:t}){this.isNote(t)&&await this.refresh()}async treeCacheReloadedEvent(){await this.refresh()}async lazyLoadedEvent(){this.tabContext||(this.tabContext=i.default.tabManager.getActiveTabContext()),await this.refresh()}}},4122:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var o=n(986),i=n(6604);class s extends o.Z{constructor(t){super(),this.widgetFactory=t,this.widgets={}}doRender(){return this.$widget=$('<div class="marker" style="display: none;">')}async newTabOpenedEvent({tabContext:t}){const{tabId:e}=t;if(this.widgets[e])return;this.widgets[e]=this.widgetFactory();const n=this.widgets[e].render();this.widgets[e].toggleExt(!1),this.$widget.after(n),i.default.updateDisplayedShortcuts(n),await this.widgets[e].handleEvent("setTabContext",{tabContext:t}),this.child(this.widgets[e])}tabRemovedEvent({tabId:t}){const e=this.widgets[t];e&&(e.remove(),delete this.widgets[t],this.children=this.children.filter(t=>t!==e))}async refresh(){this.toggleExt(!0)}toggleInt(t){}toggleExt(t){for(const e in this.widgets)this.widgets[e].toggleExt(t&&this.isTab(e))}handleEventInChildren(t,e){if(["tabNoteSwitched","tabNoteSwitchedAndActivated"].includes(t)){const n=this.widgets[e.tabContext.tabId];return n&&(n.hasBeenAlreadyShown||"tabNoteSwitchedAndActivated"===t)?(n.hasBeenAlreadyShown=!0,n.handleEvent("tabNoteSwitched",e)):Promise.resolve()}if("activeTabChanged"===t){const n=this.widgets[e.tabContext.tabId];return n.hasBeenAlreadyShown?Promise.resolve():(n.hasBeenAlreadyShown=!0,n.handleEvent(t,e))}return super.handleEventInChildren(t,e)}}},1498:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>h});var o,i,s=n(1167),a=n(7112),r=n(9046),d=n(6604),c=n(8003);t=n.hmd(t),function(e,o){"function"==typeof define&&n.amdO?define("jquery-bridget/jquery-bridget",["jquery"],(function(t){return o(e,t)})):t.exports?t.exports=o(e,r.Z.dynamicRequire("jquery")):e.jQueryBridget=o(e,e.jQuery)}(window,(function(t,e){var n=Array.prototype.slice,o=t.console,i=void 0===o?function(){}:function(t){o.error(t)};function s(o,s,r){(r=r||e||t.jQuery)&&(s.prototype.option||(s.prototype.option=function(t){r.isPlainObject(t)&&(this.options=r.extend(!0,this.options,t))}),r.fn[o]=function(t){if("string"==typeof t){var e=n.call(arguments,1);return c=e,h="$()."+o+'("'+(d=t)+'")',(a=this).each((function(t,e){var n=r.data(e,o);if(n){var s=n[d];if(s&&"_"!=d.charAt(0)){var a=s.apply(n,c);l=void 0===l?a:l}else i(h+" is not a valid method")}else i(o+" not initialized. Cannot call methods, i.e. "+h)})),void 0!==l?l:a}var a,d,c,l,h,p;return p=t,this.each((function(t,e){var n=r.data(e,o);n?(n.option(p),n._init()):(n=new s(e,p),r.data(e,o,n))})),this},a(r))}function a(t){!t||t&&t.bridget||(t.bridget=s)}return a(e||t.jQuery),s})),o=window,i=function(){function t(t){var e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}var e="undefined"==typeof console?function(){}:function(t){console.error(t)},n=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],o=n.length;function i(t){var n=getComputedStyle(t);return n||e("Style returned "+n+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),n}var s,a=!1;return function e(r){if(function(){if(!a){a=!0;var n=document.createElement("div");n.style.width="200px",n.style.padding="1px 2px 3px 4px",n.style.borderStyle="solid",n.style.borderWidth="1px 2px 3px 4px",n.style.boxSizing="border-box";var o=document.body||document.documentElement;o.appendChild(n);var r=i(n);e.isBoxSizeOuter=s=200==t(r.width),o.removeChild(n)}}(),"string"==typeof r&&(r=document.querySelector(r)),r&&"object"==typeof r&&r.nodeType){var d=i(r);if("none"==d.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<o;e++)t[n[e]]=0;return t}();var c={};c.width=r.offsetWidth,c.height=r.offsetHeight;for(var l=c.isBorderBox="border-box"==d.boxSizing,h=0;h<o;h++){var p=n[h],u=d[p],g=parseFloat(u);c[p]=isNaN(g)?0:g}var b=c.paddingLeft+c.paddingRight,m=c.paddingTop+c.paddingBottom,f=c.marginLeft+c.marginRight,w=c.marginTop+c.marginBottom,y=c.borderLeftWidth+c.borderRightWidth,v=c.borderTopWidth+c.borderBottomWidth,x=l&&s,I=t(d.width);!1!==I&&(c.width=I+(x?0:b+y));var _=t(d.height);return!1!==_&&(c.height=_+(x?0:m+v)),c.innerWidth=c.width-(b+y),c.innerHeight=c.height-(m+v),c.outerWidth=c.width+f,c.outerHeight=c.height+w,c}}},"function"==typeof define&&n.amdO?define("get-size/get-size",[],(function(){return i()})):t.exports?t.exports=i():o.getSize=i(),function(e,o){"function"==typeof define&&n.amdO?define("ev-emitter/ev-emitter",o):t.exports?t.exports=o():e.EvEmitter=o()}("undefined"!=typeof window?window:void 0,(function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var n=this._events=this._events||{},o=n[t]=n[t]||[];return-1==o.indexOf(e)&&o.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var n=this._onceEvents=this._onceEvents||{};return(n[t]=n[t]||{})[e]=!0,this}},e.off=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){var o=n.indexOf(e);return-1!=o&&n.splice(o,1),this}},e.emitEvent=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){n=n.slice(0),e=e||[];for(var o=this._onceEvents&&this._onceEvents[t],i=0;i<n.length;i++){var s=n[i];o&&o[s]&&(this.off(t,s),delete o[s]),s.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t})),function(e,o){"function"==typeof define&&n.amdO?define("unipointer/unipointer",["ev-emitter/ev-emitter"],(function(t){return o(e,t)})):t.exports?t.exports=o(e,r.Z.dynamicRequire("ev-emitter")):e.Unipointer=o(e,e.EvEmitter)}(window,(function(t,e){function n(){}var o=n.prototype=Object.create(e.prototype);o.bindStartEvent=function(t){this._bindStartEvent(t,!0)},o.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},o._bindStartEvent=function(e,n){var o=(n=void 0===n||n)?"addEventListener":"removeEventListener",i="mousedown";t.PointerEvent?i="pointerdown":"ontouchstart"in t&&(i="touchstart"),e[o](i,this)},o.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},o.getTouch=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.identifier==this.pointerIdentifier)return n}},o.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this._pointerDown(t,t)},o.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},o.onpointerdown=function(t){this._pointerDown(t,t)},o._pointerDown=function(t,e){t.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDown(t,e))},o.pointerDown=function(t,e){this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e])};var i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return o._bindPostStartEvents=function(e){if(e){var n=i[e.type];n.forEach((function(e){t.addEventListener(e,this)}),this),this._boundPointerEvents=n}},o._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach((function(e){t.removeEventListener(e,this)}),this),delete this._boundPointerEvents)},o.onmousemove=function(t){this._pointerMove(t,t)},o.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},o.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerMove(t,e)},o._pointerMove=function(t,e){this.pointerMove(t,e)},o.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])},o.onmouseup=function(t){this._pointerUp(t,t)},o.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},o.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerUp(t,e)},o._pointerUp=function(t,e){this._pointerDone(),this.pointerUp(t,e)},o.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])},o._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},o._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},o.pointerDone=function(){},o.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},o.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerCancel(t,e)},o._pointerCancel=function(t,e){this._pointerDone(),this.pointerCancel(t,e)},o.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])},n.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},n})),function(e,o){"function"==typeof define&&n.amdO?define("unidragger/unidragger",["unipointer/unipointer"],(function(t){return o(e,t)})):t.exports?t.exports=o(e,r.Z.dynamicRequire("unipointer")):e.Unidragger=o(e,e.Unipointer)}(window,(function(t,e){function n(){}var o=n.prototype=Object.create(e.prototype);o.bindHandles=function(){this._bindHandles(!0)},o.unbindHandles=function(){this._bindHandles(!1)},o._bindHandles=function(e){for(var n=(e=void 0===e||e)?"addEventListener":"removeEventListener",o=e?this._touchActionValue:"",i=0;i<this.handles.length;i++){var s=this.handles[i];this._bindStartEvent(s,e),s[n]("click",this),t.PointerEvent&&(s.style.touchAction=o)}},o._touchActionValue="none",o.pointerDown=function(t,e){this.okayPointerDown(t)&&(this.pointerDownPointer=e,t.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e]))};var i={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},s={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return o.okayPointerDown=function(t){var e=i[t.target.nodeName],n=s[t.target.type],o=!e||n;return o||this._pointerReset(),o},o.pointerDownBlur=function(){var t=document.activeElement;t&&t.blur&&t!=document.body&&t.blur()},o.pointerMove=function(t,e){var n=this._dragPointerMove(t,e);this.emitEvent("pointerMove",[t,e,n]),this._dragMove(t,e,n)},o._dragPointerMove=function(t,e){var n={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this._dragStart(t,e),n},o.hasDragStarted=function(t){return 3<Math.abs(t.x)||3<Math.abs(t.y)},o.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e]),this._dragPointerUp(t,e)},o._dragPointerUp=function(t,e){this.isDragging?this._dragEnd(t,e):this._staticClick(t,e)},o._dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(t,e)},o.dragStart=function(t,e){this.emitEvent("dragStart",[t,e])},o._dragMove=function(t,e,n){this.isDragging&&this.dragMove(t,e,n)},o.dragMove=function(t,e,n){t.preventDefault(),this.emitEvent("dragMove",[t,e,n])},o._dragEnd=function(t,e){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(t,e)},o.dragEnd=function(t,e){this.emitEvent("dragEnd",[t,e])},o.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},o._staticClick=function(t,e){this.isIgnoringMouseUp&&"mouseup"==t.type||(this.staticClick(t,e),"mouseup"!=t.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},o.staticClick=function(t,e){this.emitEvent("staticClick",[t,e])},n.getPointerPoint=e.getPointerPoint,n})),function(e,o){"function"==typeof define&&n.amdO?define(["get-size/get-size","unidragger/unidragger"],(function(t,n){return o(e,t,n)})):t.exports?t.exports=o(e,r.Z.dynamicRequire("get-size"),r.Z.dynamicRequire("unidragger")):e.Draggabilly=o(e,e.getSize,e.Unidragger)}(window,(function(t,e,n){function o(t,e){for(var n in e)t[n]=e[n];return t}var i=t.jQuery;function s(t,e){this.element="string"==typeof t?document.querySelector(t):t,i&&(this.$element=i(this.element)),this.options=o({},this.constructor.defaults),this.option(e),this._create()}var a=s.prototype=Object.create(n.prototype);s.defaults={},a.option=function(t){o(this.options,t)};var r={relative:!0,absolute:!0,fixed:!0};function d(t,e,n){return n=n||"round",e?Math[n](t/e)*e:t}return a._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=o({},this.position);var t=getComputedStyle(this.element);r[t.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},a.dispatchEvent=function(t,e,n){var o=[e].concat(n);this.emitEvent(t,o),this.dispatchJQueryEvent(t,e,n)},a.dispatchJQueryEvent=function(e,n,o){var i=t.jQuery;if(i&&this.$element){var s=i.Event(n);s.type=e,this.$element.trigger(s,o)}},a._getPosition=function(){var t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,"width"),n=this._getPositionCoord(t.top,"height");this.position.x=isNaN(e)?0:e,this.position.y=isNaN(n)?0:n,this._addTransformPosition(t)},a._getPositionCoord=function(t,n){if(-1!=t.indexOf("%")){var o=e(this.element.parentNode);return o?parseFloat(t)/100*o[n]:0}return parseInt(t,10)},a._addTransformPosition=function(t){var e=t.transform;if(0===e.indexOf("matrix")){var n=e.split(","),o=0===e.indexOf("matrix3d")?12:4,i=parseInt(n[o],10),s=parseInt(n[o+1],10);this.position.x+=i,this.position.y+=s}},a.onPointerDown=function(t,e){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",t,[e])},a.dragStart=function(t,e){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",t,[e]),this.animate())},a.measureContainment=function(){var t=this.getContainer();if(t){var n=e(this.element),o=e(t),i=this.element.getBoundingClientRect(),s=t.getBoundingClientRect(),a=o.borderLeftWidth+o.borderRightWidth,r=o.borderTopWidth+o.borderBottomWidth,d=this.relativeStartPosition={x:i.left-(s.left+o.borderLeftWidth),y:i.top-(s.top+o.borderTopWidth)};this.containSize={width:o.width-a-d.x-n.width,height:o.height-r-d.y-n.height}}},a.getContainer=function(){var t=this.options.containment;if(t)return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):this.element.parentNode},a.onPointerMove=function(t,e,n){this.dispatchJQueryEvent("pointerMove",t,[e,n])},a.dragMove=function(t,e,n){if(this.isEnabled){var o=n.x,i=n.y,s=this.options.grid,a=s&&s[0],r=s&&s[1];o=d(o,a),i=d(i,r),o=this.containDrag("x",o,a),i=this.containDrag("y",i,r),o="y"==this.options.axis?0:o,i="x"==this.options.axis?0:i,this.position.x=this.startPosition.x+o,this.position.y=this.startPosition.y+i,this.dragPoint.x=o,this.dragPoint.y=i,this.dispatchEvent("dragMove",t,[e,n])}},a.containDrag=function(t,e,n){if(!this.options.containment)return e;var o="x"==t?"width":"height",i=d(-this.relativeStartPosition[t],n,"ceil"),s=this.containSize[o];return s=d(s,n,"floor"),Math.max(i,Math.min(s,e))},a.onPointerUp=function(t,e){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",t,[e])},a.dragEnd=function(t,e){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",t,[e]))},a.animate=function(){if(this.isDragging){this.positionDrag();var t=this;requestAnimationFrame((function(){t.animate()}))}},a.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},a.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},a.staticClick=function(t,e){this.dispatchEvent("staticClick",t,[e])},a.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},a.enable=function(){this.isEnabled=!0},a.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},a.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},a._init=function(){},i&&i.bridget&&i.bridget("draggabilly",s),s}));const l=window.Draggabilly;class h extends s.Z{doRender(){return this.$widget=$('\n<div class="note-tab-row">\n    <style>\n    .note-tab-row {\n        box-sizing: border-box;\n        position: relative;\n        height: 34px;\n        min-height: 34px;\n        width: 100%;\n        background: var(--main-background-color);\n        border-radius: 5px 5px 0 0;\n        overflow: hidden;\n        margin-top: 2px;\n    }\n    .note-tab-row * {\n        box-sizing: inherit;\n        font: inherit;\n    }\n    .note-tab-row .note-tab-row-container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    .note-tab-row .note-tab {\n        position: absolute;\n        left: 0;\n        height: 33px;\n        width: 240px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        pointer-events: none;\n    }\n    \n    .note-new-tab {\n        position: absolute;\n        left: 0;\n        height: 33px;\n        width: 32px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        text-align: center;\n        font-size: 24px;\n        cursor: pointer;\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .note-new-tab:hover {\n        background-color: var(--accented-background-color);\n        border-radius: 5px;\n    }\n    \n    .tab-row-filler {\n        -webkit-app-region: drag;\n        position: absolute;\n        left: 0;\n        height: 33px;\n    }\n    \n    .tab-row-filler .tab-row-border {\n        position: relative;\n        background: linear-gradient(to right, var(--main-border-color), transparent);\n        height: 1px;\n        margin-top: 32px;\n    }\n    \n    .note-tab-row .note-tab[active] {\n        z-index: 5;\n    }\n    \n    .note-tab-row .note-tab,\n    .note-tab-row .note-tab * {\n        user-select: none;\n        cursor: default;\n    }\n    \n    .note-tab-row .note-tab.note-tab-was-just-added {\n        top: 10px;\n        animation: note-tab-was-just-added 120ms forwards ease-in-out;\n    }\n    \n    .note-tab-row .note-tab .note-tab-wrapper {\n        position: absolute;\n        display: flex;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        padding: 5px 8px;\n        border-top-left-radius: 8px;\n        border-top-right-radius: 8px;\n        overflow: hidden;\n        pointer-events: all;\n        background-color: var(--accented-background-color);\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .note-tab-row .note-tab[active] .note-tab-wrapper {\n        background-color: var(--main-background-color);\n        border: 1px solid var(--main-border-color);\n        border-bottom: 0;\n        font-weight: bold;\n    }\n    \n    .note-tab-row .note-tab[is-mini] .note-tab-wrapper {\n        padding-left: 2px;\n        padding-right: 2px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-title {\n        flex: 1;\n        vertical-align: top;\n        overflow: hidden;\n        white-space: nowrap;\n        color: var(--muted-text-color);\n    }\n    \n    .note-tab-row .note-tab[is-small] .note-tab-title {\n        margin-left: 0;\n    }\n    \n    .note-tab-row .note-tab[active] .note-tab-title {\n        color: var(--main-text-color);\n    }\n    \n    .note-tab-row .note-tab .note-tab-drag-handle {\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        border-top-left-radius: 8px;\n        border-top-right-radius: 8px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close {\n        flex-grow: 0;\n        flex-shrink: 0;\n        border-radius: 50%;\n        z-index: 100;\n        width: 24px;\n        height: 24px;\n        text-align: center;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close span {\n        font-size: 24px;\n        position: relative;\n        top: -6px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close:hover {\n        background-color: var(--hover-item-background-color);\n        color: var(--hover-item-text-color);\n    }\n    \n    .note-tab-row .note-tab[is-smaller] .note-tab-close {\n        margin-left: auto;\n    }\n    .note-tab-row .note-tab[is-mini]:not([active]) .note-tab-close {\n        display: none;\n    }\n    .note-tab-row .note-tab[is-mini][active] .note-tab-close {\n        margin-left: auto;\n        margin-right: auto;\n    }\n    @-moz-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-webkit-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-o-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    .note-tab-row.note-tab-row-is-sorting .note-tab:not(.note-tab-is-dragging),\n    .note-tab-row:not(.note-tab-row-is-sorting) .note-tab.note-tab-was-just-dragged {\n        transition: transform 120ms ease-in-out;\n    }\n    </style>\n\n    <div class="note-tab-row-container"></div>\n</div>'),this.draggabillies=[],this.eventListeners={},this.setupStyle(),this.setupEvents(),this.setupDraggabilly(),this.setupNewButton(),this.setupFiller(),this.layoutTabs(),this.setVisibility(),this.$widget.on("contextmenu",".note-tab",t=>{t.preventDefault();const e=$(t.target).closest(".note-tab").attr("data-tab-id");a.Z.show({x:t.pageX,y:t.pageY,items:[{title:"Move this tab to a new window",command:"moveTabToNewWindow",uiIcon:"window-open"},{title:"Close all tabs",command:"removeAllTabs",uiIcon:"x"},{title:"Close all tabs except for this",command:"removeAllTabsExceptForThis",uiIcon:"x"}],selectMenuItemHandler:({command:t})=>{this.triggerCommand(t,{tabId:e})}})}),this.$widget}setupStyle(){this.$style=$("<style>"),this.$widget.append(this.$style)}setupEvents(){const t=t=>{this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs()};"undefined"!=typeof ResizeObserver?new ResizeObserver(t).observe(this.$widget[0]):window.addEventListener("resize",t),this.tabEls.forEach(t=>this.setTabCloseEvent(t))}setVisibility(){this.$widget.show()}get tabEls(){return Array.prototype.slice.call(this.$widget.find(".note-tab"))}get $tabContainer(){return this.$widget.find(".note-tab-row-container")}get tabWidths(){const t=this.tabEls.length,e=this.$tabContainer[0].clientWidth-32-50,n=e/t,o=Math.max(24,Math.min(240,n)),i=Math.floor(o),s=[];let a=e-i*t;for(let e=0;e<t;e+=1){const t=i<240&&a>0?1:0;s.push(i+t),a>0&&(a-=1)}return this.$filler&&this.$filler.css("width",a+50+"px"),s}getTabPositions(){const t=[];let e=0;return this.tabWidths.forEach(n=>{t.push(e),e+=n}),{tabPositions:t,newTabPosition:e,fillerPosition:e+32}}layoutTabs(){const t=this.tabWidths;this.tabEls.forEach((e,n)=>{const o=t[n];e.style.width=o+"px",e.removeAttribute("is-small"),e.removeAttribute("is-smaller"),e.removeAttribute("is-mini"),o<84&&e.setAttribute("is-small",""),o<60&&e.setAttribute("is-smaller",""),o<48&&e.setAttribute("is-mini","")});let e="";const{tabPositions:n,newTabPosition:o,fillerPosition:i}=this.getTabPositions();n.forEach((t,n)=>{e+=`.note-tab:nth-child(${n+1}) { transform: translate3d(${t}px, 0, 0)} `}),e+=`.note-new-tab { transform: translate3d(${o}px, 0, 0) } `,e+=`.tab-row-filler { transform: translate3d(${i}px, 0, 0) } `,this.$style.html(e)}addTab(t){const e=$('\n<div class="note-tab">\n  <div class="note-tab-wrapper">\n    <div class="note-tab-title"></div>\n    <div class="note-tab-drag-handle"></div>\n    <div class="note-tab-close" title="Close tab" data-trigger-command="closeActiveTab"><span></span></div>\n  </div>\n</div>').attr("data-tab-id",t);d.default.updateDisplayedShortcuts(e),e.addClass("note-tab-was-just-added"),setTimeout(()=>e.removeClass("note-tab-was-just-added"),500),this.$newTab.before(e),this.setVisibility(),this.setTabCloseEvent(e),this.updateTitle(e,"New tab"),this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs(),this.setupDraggabilly()}closeActiveTabCommand({$el:t}){const e=t.closest(".note-tab").attr("data-tab-id");c.default.tabManager.removeTab(e)}setTabCloseEvent(t){t.on("mousedown",e=>{if(2===e.which)return c.default.tabManager.removeTab(t.attr("data-tab-id")),!0})}get activeTabEl(){return this.$widget.find(".note-tab[active]")[0]}activeTabChangedEvent(){const t=c.default.tabManager.getActiveTabContext();if(!t)return;const e=this.getTabById(t.tabId)[0],n=this.activeTabEl;n!==e&&(n&&n.removeAttribute("active"),e&&e.setAttribute("active",""))}newTabOpenedEvent({tabContext:t}){this.addTab(t.tabId)}removeTab(t){const e=this.getTabById(t)[0];e&&(e.parentNode.removeChild(e),this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs(),this.setupDraggabilly(),this.setVisibility())}getTabIdsInOrder(){return this.tabEls.map(t=>t.getAttribute("data-tab-id"))}updateTitle(t,e){t.find(".note-tab-title").text(e)}getTabById(t){return this.$widget.find(`[data-tab-id='${t}']`)}tabRemovedEvent({tabId:t}){this.removeTab(t)}cleanUpPreviouslyDraggedTabs(){this.tabEls.forEach(t=>t.classList.remove("note-tab-was-just-dragged"))}setupDraggabilly(){const t=this.tabEls,{tabPositions:e}=this.getTabPositions();this.isDragging&&(this.isDragging=!1,this.$widget.removeClass("note-tab-row-is-sorting"),this.draggabillyDragging.element.classList.remove("note-tab-is-dragging"),this.draggabillyDragging.element.style.transform="",this.draggabillyDragging.dragEnd(),this.draggabillyDragging.isDragging=!1,this.draggabillyDragging.positionDrag=t=>{},this.draggabillyDragging.destroy(),this.draggabillyDragging=null),this.draggabillies.forEach(t=>t.destroy()),t.forEach((t,n)=>{const o=e[n],i=new l(t,{axis:"x",handle:".note-tab-drag-handle",containment:this.$tabContainer[0]});this.draggabillies.push(i),i.on("pointerDown",e=>{c.default.tabManager.activateTab(t.getAttribute("data-tab-id"))}),i.on("dragStart",e=>{this.isDragging=!0,this.draggabillyDragging=i,t.classList.add("note-tab-is-dragging"),this.$widget.addClass("note-tab-row-is-sorting")}),i.on("dragEnd",e=>{this.isDragging=!1;const n=parseFloat(t.style.left,10);t.style.transform="translate3d(0, 0, 0)",requestAnimationFrame(e=>{t.style.left="0",t.style.transform=`translate3d(${n}px, 0, 0)`,requestAnimationFrame(e=>{t.classList.remove("note-tab-is-dragging"),this.$widget.removeClass("note-tab-row-is-sorting"),t.classList.add("note-tab-was-just-dragged"),requestAnimationFrame(e=>{t.style.transform="",this.layoutTabs(),this.setupDraggabilly()})})})}),i.on("dragMove",(n,i,s)=>{const a=this.tabEls,r=a.indexOf(t),d=o+s.x,c=this.closest(d,e),l=Math.max(0,Math.min(a.length,c));r!==l&&this.animateTabMove(t,r,l)})})}animateTabMove(t,e,n){if(n<e)t.parentNode.insertBefore(t,this.tabEls[n]);else{const e=this.tabEls[n+1]||this.$newTab[0];t.parentNode.insertBefore(t,e)}this.triggerEvent("tabReorder",{tabIdsInOrder:this.getTabIdsInOrder()}),this.layoutTabs()}setupNewButton(){this.$newTab=$('<div class="note-new-tab" data-trigger-command="openNewTab" title="Add new tab">+</div>'),this.$tabContainer.append(this.$newTab)}setupFiller(){this.$filler=$('<div class="tab-row-filler">\n    <div class="tab-row-border"></div>\n</div>'),this.$tabContainer.append(this.$filler)}closest(t,e){let n=1/0,o=-1;return e.forEach((e,i)=>{Math.abs(t-e)<n&&(n=Math.abs(t-e),o=i)}),o}tabNoteSwitchedAndActivatedEvent({tabContext:t}){this.activeTabChangedEvent(),this.updateTabById(t.tabId)}tabNoteSwitchedEvent({tabContext:t}){this.updateTabById(t.tabId)}updateTabById(t){const e=this.getTabById(t),{note:n}=c.default.tabManager.getTabContextById(t);this.updateTab(e,n)}updateTab(t,e){if(t.length){for(const e of Array.from(t[0].classList))"note-tab"!==e&&t.removeClass(e);e?(this.updateTitle(t,e.title),t.addClass(e.getCssClass()),t.addClass(r.Z.getNoteTypeClass(e.type)),t.addClass(r.Z.getMimeTypeClass(e.mime))):this.updateTitle(t,"New tab")}}async entitiesReloadedEvent({loadResults:t}){for(const e of c.default.tabManager.tabContexts)if(t.isNoteReloaded(e.noteId)){const t=this.getTabById(e.tabId);this.updateTab(t,e.note)}}treeCacheReloadedEvent(){for(const t of c.default.tabManager.tabContexts){const e=this.getTabById(t.tabId);this.updateTab(e,t.note)}}}}},__webpack_module_cache__={};function __webpack_require__(t){if(__webpack_module_cache__[t])return __webpack_module_cache__[t].exports;var e=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t](e,e.exports,__webpack_require__),e.loaded=!0,e.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.f={},__webpack_require__.e=t=>Promise.all(Object.keys(__webpack_require__.f).reduce((e,n)=>(__webpack_require__.f[n](t,e),e),[])),__webpack_require__.u=t=>t+".desktop.js",__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.p="app-dist/",(()=>{var t={8:0};__webpack_require__.f.j=(e,n)=>{var o=__webpack_require__.o(t,e)?t[e]:void 0;if(0!==o)if(o)n.push(o[2]);else{var i=new Promise((n,i)=>{o=t[e]=[n,i]});n.push(o[2]=i);var s,a=__webpack_require__.p+__webpack_require__.u(e),r=document.createElement("script");r.charset="utf-8",r.timeout=120,__webpack_require__.nc&&r.setAttribute("nonce",__webpack_require__.nc),r.src=a;var d=new Error;s=n=>{s=()=>{},r.onerror=r.onload=null,clearTimeout(c);var i=(()=>{if(__webpack_require__.o(t,e)&&(0!==(o=t[e])&&(t[e]=void 0),o))return o[1]})();if(i){var a=n&&("load"===n.type?"missing":n.type),l=n&&n.target&&n.target.src;d.message="Loading chunk "+e+" failed.\n("+a+": "+l+")",d.name="ChunkLoadError",d.type=a,d.request=l,i(d)}};var c=setTimeout(()=>{s({type:"timeout",target:r})},12e4);r.onerror=r.onload=s,document.head.appendChild(r)}};var e=window.webpackJsonptrilium=window.webpackJsonptrilium||[],n=e.push.bind(e);e.push=function(e){for(var n,i,s=e[0],a=e[1],r=e[3],d=0,c=[];d<s.length;d++)i=s[d],__webpack_require__.o(t,i)&&t[i]&&c.push(t[i][0]),t[i]=0;for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);for(r&&r(__webpack_require__),o&&o(e);c.length;)c.shift()()};var o=n})(),(()=>{"use strict";var t=__webpack_require__(8003),e=__webpack_require__(9046),n=__webpack_require__(4716),o=__webpack_require__(394),i=__webpack_require__(9847);function s(t){return document.execCommand(t),!1}const a={init:function(){e.Z.isElectron()&&e.Z.isMac()&&(e.Z.bindGlobalShortcut("meta+c",()=>s("copy")),e.Z.bindGlobalShortcut("meta+v",()=>s("paste")),e.Z.bindGlobalShortcut("meta+x",()=>s("cut")),e.Z.bindGlobalShortcut("meta+a",()=>s("selectAll")),e.Z.bindGlobalShortcut("meta+z",()=>s("undo")),e.Z.bindGlobalShortcut("meta+y",()=>s("redo")))}};var r=__webpack_require__(7112),d=__webpack_require__(1167);class c extends d.Z{constructor(t){if(super(),!t||!["row","column"].includes(t))throw new Error(`Direction argument given as "${t}", use either 'row' or 'column'`);this.attrs.style=`display: flex; flex-direction: ${t};`,this.children=[],this.positionCounter=10}child(...t){if(!t)return this;super.child(...t);for(const e of t)e.position||(e.position=this.positionCounter,this.positionCounter+=10);return this.children.sort((t,e)=>t.position-e.position<0?-1:1),this}doRender(){this.$widget=$("<div>");for(const t of this.children)this.$widget.append(t.render());return this.$widget}}var l=__webpack_require__(9800),h=__webpack_require__(6885);const p={syncNow:async function(){const t=await l.Z.post("sync/now");t.success?h.default.showMessage("Sync finished successfully."):(t.message.length>100&&(t.message=t.message.substr(0,100)),h.default.showError("Sync failed: "+t.message))},forceNoteSync:async function(t){await l.Z.post("sync/force-note-sync/"+t),h.default.showMessage("Note added to sync queue.")}};class u extends d.Z{doRender(){return this.$widget=$('\n<div class="global-menu-wrapper">\n    <style>\n    .global-menu-wrapper {\n        height: 35px;\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .global-menu button {\n        margin-right: 10px;\n        height: 33px;\n        border: none;\n    }\n    \n    .global-menu .dropdown-menu {\n        width: 20em;\n    }\n    </style>\n\n    <div class="dropdown global-menu">\n        <button type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-sm dropdown-toggle">\n            <span class="bx bx-menu"></span>\n            Menu\n            <span class="caret"></span>\n        </button>\n        <div class="dropdown-menu dropdown-menu-right">\n            <a class="dropdown-item options-button" data-trigger-command="showOptions">\n                <span class="bx bx-slider"></span>\n                Options\n            </a>\n\n            <a class="dropdown-item sync-now-button" title="Trigger sync">\n                <span class="bx bx-refresh"></span>\n                Sync now (<span id="outstanding-syncs-count">0</span>)\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="openNewWindow">\n                <span class="bx bx-window-open"></span>\n                Open new window\n                <kbd data-command="openNewWindow"></kbd>\n            </a>\n\n            <a class="dropdown-item open-dev-tools-button" data-trigger-command="openDevTools">\n                <span class="bx bx-terminal"></span>\n                Open Dev Tools\n                <kbd data-command="openDevTools"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="showSQLConsole">\n                <span class="bx bx-data"></span>\n                Open SQL Console\n                <kbd data-command="showSQLConsole"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="showBackendLog">\n                <span class="bx bx-empty"></span>\n                Show backend log\n                <kbd data-command="showBackendLog"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="reloadFrontendApp" \n                title="Reload can help with some visual glitches without restarting the whole app.">\n                <span class="bx bx-empty"></span>\n                Reload frontend\n                <kbd data-command="reloadFrontendApp"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="toggleZenMode">\n                <span class="bx bx-empty"></span>\n                Toggle Zen mode\n                <kbd data-command="toggleZenMode"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="toggleFullscreen">\n                <span class="bx bx-empty"></span>\n                Toggle fullscreen\n                <kbd data-command="toggleFullscreen"></kbd>\n            </a>\n\n            <a class="dropdown-item" data-trigger-command="showHelp">\n                <span class="bx bx-info-circle"></span>\n                Show Help\n                <kbd data-command="showHelp"></kbd>\n            </a>\n\n            <a class="dropdown-item show-about-dialog-button">\n                <span class="bx bx-empty"></span>\n                About Trilium Notes\n            </a>\n\n            <a class="dropdown-item logout-button" data-trigger-command="logout">\n                <span class="bx bx-log-out"></span>\n                Logout\n            </a>\n        </div>\n    </div>\n</div>\n'),this.$widget.find(".show-about-dialog-button").on("click",()=>__webpack_require__.e(834).then(__webpack_require__.bind(__webpack_require__,6834)).then(t=>t.showDialog())),this.$widget.find(".sync-now-button").on("click",()=>p.syncNow()),this.$widget.find(".logout-button").toggle(!e.Z.isElectron()),this.$widget.find(".open-dev-tools-button").toggle(e.Z.isElectron()),this.$widget}}var g=__webpack_require__(1498),b=__webpack_require__(4378);class m extends d.Z{doRender(){if(!e.Z.isElectron()||b.Z.is("nativeTitleBarVisible"))return this.$widget=$("<div>");this.$widget=$('\n<div class="title-bar-buttons">\n    <style>\n    .title-bar-buttons {\n        margin-top: 4px;\n        flex-shrink: 0;\n    }\n    \n    .title-bar-buttons button {\n        border: none !important;\n        background: none !important;\n        font-size: 150%;\n        padding-left: 10px;\n        padding-right: 10px;\n    }\n    </style>\n\n    <button class="btn icon-action bx bx-minus minimize-btn"></button>\n    <button class="btn icon-action bx bx-checkbox maximize-btn"></button>\n    <button class="btn icon-action bx bx-x close-btn"></button>\n</div>');const t=this.$widget.find(".minimize-btn"),n=this.$widget.find(".maximize-btn"),o=this.$widget.find(".close-btn");return t.on("click",()=>{t.trigger("blur");const{remote:n}=e.Z.dynamicRequire("electron");n.BrowserWindow.getFocusedWindow().minimize()}),n.on("click",()=>{n.trigger("blur");const{remote:t}=e.Z.dynamicRequire("electron"),o=t.BrowserWindow.getFocusedWindow();o.isMaximized()?o.unmaximize():o.maximize()}),o.on("click",()=>{o.trigger("blur");const{remote:t}=e.Z.dynamicRequire("electron");t.BrowserWindow.getFocusedWindow().close()}),this.$widget}}var f=__webpack_require__(6604),w=__webpack_require__(8481);class y extends d.Z{doRender(){if(e.Z.isElectron()){this.$widget=$('\n<div class="history-navigation">\n    <style>\n    .history-navigation {\n        margin: 0 15px 0 5px;\n    }\n    </style>\n\n    <a title="Go to previous note." data-trigger-command="backInNoteHistory" class="icon-action bx bx-left-arrow-circle"></a>\n\n    <a title="Go to next note." data-trigger-command="forwardInNoteHistory" class="icon-action bx bx-right-arrow-circle"></a>\n</div>\n');const t=t=>{t.preventDefault(),this.webContents.history.length<2||this.showContextMenu(t)};this.$backInHistory=this.$widget.find("[data-trigger-command='backInNoteHistory']"),this.$backInHistory.on("contextmenu",t),this.$forwardInHistory=this.$widget.find("[data-trigger-command='forwardInNoteHistory']"),this.$forwardInHistory.on("contextmenu",t);const n=e.Z.dynamicRequire("electron");this.webContents=n.remote.getCurrentWindow().webContents,this.webContents.clearHistory(),this.refresh()}else this.$widget=$("<div>");return this.$widget}async showContextMenu(t){let e=[];const n=this.webContents.getActiveIndex();for(const t in this.webContents.history){const o=this.webContents.history[t],[i,s]=o.split("#"),[a,r]=s.split("-"),d=await w.Z.getNotePathTitle(a);e.push({title:d,idx:t,uiIcon:t==n?"radio-circle-marked":t<n?"left-arrow-alt":"right-arrow-alt"})}e.reverse(),e.length>20&&(e=e.slice(0,50)),r.Z.show({x:t.pageX,y:t.pageY,items:e,selectMenuItemHandler:({idx:t})=>this.webContents.goToIndex(t)})}refresh(){e.Z.isElectron()&&(this.$backInHistory.toggleClass("disabled",!this.webContents.canGoBack()),this.$forwardInHistory.toggleClass("disabled",!this.webContents.canGoForward()))}activeNoteChangedEvent(){this.refresh()}}var v=__webpack_require__(7336);class x extends d.Z{doRender(){this.$widget=$('\n<div class="standard-top-widget">\n    <style>\n    .standard-top-widget {\n        background-color: var(--header-background-color);\n        display: flex;\n        align-items: center;\n        padding-top: 4px;\n    }\n    \n    .standard-top-widget button {\n        padding: 1px 5px 1px 5px;\n        font-size: smaller;\n        margin-bottom: 2px;\n        margin-top: 2px;\n        margin-right: 8px;\n        border-color: transparent !important;\n    }\n    \n    .standard-top-widget button.btn-sm .bx {\n        position: relative;\n        top: 1px;\n    }\n    \n    .standard-top-widget button:hover {\n        border-color: var(--button-border-color) !important;\n    }\n    </style>\n\n    <div style="flex-grow: 100; display: flex;">\n        <button class="btn btn-sm jump-to-note-dialog-button" data-command="jumpToNote">\n            <span class="bx bx-crosshair"></span>\n            Jump to note\n        </button>\n    \n        <button class="btn btn-sm recent-changes-button" data-command="showRecentChanges">\n            <span class="bx bx-history"></span>\n    \n            Recent changes\n        </button>\n    \n        <button class="btn btn-sm enter-protected-session-button"\n                title="Enter protected session to be able to find and view protected notes">\n            <span class="bx bx-log-in"></span>\n    \n            Enter protected session\n        </button>\n    \n        <button class="btn btn-sm leave-protected-session-button"\n                title="Leave protected session so that protected notes are not accessible any more."\n                style="display: none;">\n            <span class="bx bx-log-out"></span>\n    \n            Leave protected session\n        </button>\n    </div>\n    \n    <div id="plugin-buttons"></div>\n</div>');const t=new y;return this.child(t),this.$widget.prepend(t.render()),this.$widget.find(".jump-to-note-dialog-button").on("click",()=>this.triggerCommand("jumpToNote")),this.$widget.find(".recent-changes-button").on("click",()=>this.triggerCommand("showRecentChanges")),this.$enterProtectedSessionButton=this.$widget.find(".enter-protected-session-button"),this.$enterProtectedSessionButton.on("click",v.Z.enterProtectedSession),this.$leaveProtectedSessionButton=this.$widget.find(".leave-protected-session-button"),this.$leaveProtectedSessionButton.on("click",v.Z.leaveProtectedSession),this.$widget}protectedSessionStartedEvent(){this.$enterProtectedSessionButton.hide(),this.$leaveProtectedSessionButton.show()}}class I extends c{constructor(t){super("column"),this.side=t,this.id(t+"-pane"),this.css("height","100%")}isEnabled(){return super.isEnabled()&&b.Z.is(this.side+"PaneVisible")}sidebarVisibilityChangedEvent({side:t,show:e}){this.toggleInt(this.isEnabled()),this.side===t&&e&&this.handleEvent("lazyLoaded")}}class _ extends d.Z{doRender(){return this.$widget=$('\n<div class="global-buttons">\n    <style>\n    .global-buttons {\n        display: flex;\n        justify-content: space-around;\n        border: 1px solid var(--main-border-color);\n        border-radius: 7px;\n        margin: 3px 5px 5px 5px;\n    }\n    </style>\n\n    <a data-trigger-command="createTopLevelNote"\n       title="Create new top level note" \n       class="icon-action bx bx-folder-plus"></a>\n\n    <a data-trigger-command="collapseTree"\n       title="Collapse note tree" \n       class="icon-action bx bx-layer-minus"></a>\n\n    <a data-trigger-command="scrollToActiveNote"\n       title="Scroll to active note"  \n       class="icon-action bx bx-crosshair"></a>\n\n    <a data-trigger-command="searchNotes"\n       title="Search in notes"\n       class="icon-action bx bx-search"></a>\n</div>\n')}}const C=_;var N=__webpack_require__(8181);class k extends d.Z{doRender(){return this.$widget=$('\n<div class="search-box">\n    <style>\n    .search-box {\n        display: none;\n        padding: 10px;\n        margin-top: 10px;\n    }\n    \n    .search-text {\n        border: 1px solid var(--main-border-color);\n    }\n    </style>\n\n    <div class="form-group">\n        <div class="input-group">\n            <input name="search-text" class="search-text form-control"\n                   placeholder="Search text, labels" autocomplete="off">\n\n            <div class="input-group-append">\n                <button class="do-search-button btn btn-sm icon-button bx bx-search" title="Search (enter)"></button>\n            </div>\n        </div>\n    </div>\n\n    <div style="display: flex; align-items: center; justify-content: space-evenly; flex-wrap: wrap;">\n        <button class="save-search-button btn btn-sm"\n            title="This will create new saved search note under active note.">\n            <span class="bx bx-save"></span> Save search\n        </button>\n\n        <button class="close-search-button btn btn-sm">\n            <span class="bx bx-x"></span> Close search\n        </button>\n    </div>\n</div>'),this.$searchBox=this.$widget,this.$closeSearchButton=this.$widget.find(".close-search-button"),this.$searchInput=this.$widget.find("input[name='search-text']"),this.$resetSearchButton=this.$widget.find(".reset-search-button"),this.$doSearchButton=this.$widget.find(".do-search-button"),this.$saveSearchButton=this.$widget.find(".save-search-button"),this.$searchInput.on("keyup",t=>{const e=this.$searchInput.val();t&&t.which===$.ui.keyCode.ESCAPE||""===$.trim(e)?this.$resetSearchButton.trigger("click"):t&&t.which===$.ui.keyCode.ENTER&&this.doSearch()}),this.$doSearchButton.on("click",()=>this.doSearch()),this.$resetSearchButton.on("click",()=>this.resetSearchEvent()),this.$saveSearchButton.on("click",()=>this.saveSearch()),this.$closeSearchButton.on("click",()=>this.hideSearch()),this.$widget}doSearch(t){if(t?this.$searchInput.val(t):t=this.$searchInput.val(),0===t.trim().length)return h.default.showMessage("Please enter search criteria first."),void this.$searchInput.trigger("focus");this.triggerCommand("searchForResults",{searchText:this.$searchInput.val()}),this.$searchBox.tooltip("hide")}async saveSearch(){const e=this.$searchInput.val().trim();if(0===e.length)return void alert("Write some search criteria first so there is something to save.");let n=t.default.tabManager.getActiveTabNote();"search"===n.type&&(n=n.getParentNotes()[0]),await N.Z.createNote(n.noteId,{type:"search",mime:"application/json",title:e,content:JSON.stringify({searchString:e})}),this.resetSearchEvent()}showSearchEvent(){e.Z.saveFocusedElement(),this.$searchBox.slideDown(),this.$searchBox.tooltip({trigger:"focus",html:!0,title:window.glob.SEARCH_HELP_TEXT,placement:"right",delay:{show:500,hide:200}}),this.$searchInput.trigger("focus")}hideSearch(){this.resetSearchEvent(),this.$searchBox.slideUp(),this.triggerCommand("searchFlowEnded")}toggleSearchEvent(){this.$searchBox.is(":hidden")?this.showSearchEvent():this.hideSearch()}searchNotesEvent(){this.toggleSearchEvent()}resetSearchEvent(){this.$searchInput.val("")}searchInSubtreeEvent({node:t}){const e=t.data.noteId;this.showSearchEvent(),this.$searchInput.val(`@in=${e} @text*=*`)}}class T extends d.Z{doRender(){return this.$widget=$('\n<div class="search-results">\n    <style>\n    .search-results {\n        padding: 0 5px 5px 15px;\n        flex-basis: 40%;\n        flex-grow: 1;\n        flex-shrink: 1;\n        margin-top: 10px;\n        display: none;\n        overflow: auto;\n        border-bottom: 2px solid var(--main-border-color);\n    }\n    \n    .search-results-list {\n        padding: 5px 5px 5px 15px;\n    }\n    </style>\n\n    <strong>Search results:</strong>\n\n    <ul class="search-results-list"></ul>\n</div>\n'),this.$searchResults=this.$widget,this.$searchResultsInner=this.$widget.find(".search-results-list"),this.toggleInt(!1),this.$widget}searchResultsEvent({results:t}){this.toggleInt(!0),this.$searchResultsInner.empty(),this.$searchResults.show();for(const e of t){const t=$("<a>",{href:"javascript:",text:e.title}).attr("data-action","note").attr("data-note-path",e.path),n=$("<li>").append(t);this.$searchResultsInner.append(n)}}searchFlowEndedEvent(){this.$searchResults.hide()}}var Z=__webpack_require__(3968),S=__webpack_require__(9806),E=__webpack_require__(8159),P=__webpack_require__(1520),A=__webpack_require__(986),D=__webpack_require__(1035);const M={file:"bx bx-file",image:"bx bx-image",code:"bx bx-code",render:"bx bx-extension",search:"bx bx-file-find","relation-map":"bx bx-map-alt",book:"bx bx-book"};class R extends A.Z{constructor(t){super(),this.treeName=t}doRender(){return this.$widget=$('\n<div class="tree-wrapper">\n    <style>\n    .tree-wrapper {\n        flex-grow: 1;\n        flex-shrink: 1;\n        flex-basis: 60%;\n        font-family: var(--tree-font-family);\n        font-size: var(--tree-font-size);\n        position: relative;\n        min-height: 0;\n    }\n    \n    .tree {\n        height: 100%;\n        overflow: auto;\n    }\n    \n    .refresh-search-button {\n        cursor: pointer;\n        position: relative;\n        top: -1px;\n        border: 1px solid transparent;\n        padding: 2px;\n        border-radius: 2px;\n    }\n    \n    .refresh-search-button:hover {\n        border-color: var(--button-border-color);\n    }\n    \n    .tree-settings-button {\n        position: absolute;\n        top: 10px;\n        right: 20px;\n        z-index: 100;\n    }\n    \n    .tree-settings-popup {\n        display: none; \n        position: absolute; \n        background-color: var(--accented-background-color); \n        border: 1px solid var(--main-border-color); \n        padding: 20px; \n        z-index: 1000;\n        width: 320px; \n        border-radius: 10px 0 10px 10px;\n    }\n    \n    ul.fancytree-container {\n        outline: none !important;\n        background-color: inherit !important;\n    }\n    \n    .fancytree-custom-icon {\n        font-size: 1.3em;\n    }\n    \n    span.fancytree-title {\n        color: inherit !important;\n        background: inherit !important;\n        outline: none !important;\n    }\n    \n    span.fancytree-node.protected > span.fancytree-custom-icon {\n        filter: drop-shadow(2px 2px 2px var(--main-text-color));\n    }\n    \n    span.fancytree-node.multiple-parents .fancytree-title::after {\n        content: " *"\n    }\n    \n    span.fancytree-node.fancytree-active-clone:not(.fancytree-active) .fancytree-title {\n        font-weight: bold;\n    }\n    \n    /* first nesting level has lower left padding to avoid extra left padding. Other levels are not affected */\n    .ui-fancytree > li > ul {\n        padding-left: 5px;\n    }\n    \n    span.fancytree-active .fancytree-title {\n        font-weight: bold;\n        border-color: var(--main-border-color) !important;\n        border-radius: 5px;\n    }\n    \n    span.fancytree-active:not(.fancytree-focused) .fancytree-title {\n        border-style: dashed !important;\n    }\n    \n    span.fancytree-focused .fancytree-title, span.fancytree-focused.fancytree-selected .fancytree-title {\n        color: var(--active-item-text-color) !important;\n        background-color: var(--active-item-background-color) !important;\n        border-color: var(--main-background-color) !important; /* invisible border */\n        border-radius: 5px;\n    }\n    \n    span.fancytree-selected .fancytree-title {\n        color: var(--hover-item-text-color) !important;\n        background-color: var(--hover-item-background-color) !important;\n        border-color: var(--main-background-color) !important; /* invisible border */\n        border-radius: 5px;\n        font-style: italic;\n    }\n    \n    span.fancytree-node:hover span.fancytree-title {\n        border-color: var(--main-border-color) !important;\n        border-radius: 5px;\n    }\n    \n    span.fancytree-node.archived {\n        opacity: 0.6;\n    }\n    </style>\n    \n    <button class="btn btn-sm icon-button bx bx-cog tree-settings-button" title="Tree settings"></button>\n    \n    <div class="tree-settings-popup">\n        <div class="form-check">\n            <label class="form-check-label">\n                <input class="form-check-input hide-archived-notes" type="checkbox" value="">\n            \n                Hide archived notes\n            </label>\n        </div>\n        <div class="form-check">\n            <label class="form-check-label">\n                <input class="form-check-input hide-included-images" type="checkbox" value="">\n                \n                Hide images included in a note\n                <span class="bx bx-info-circle" \n                      title="Images which are shown in the parent text note will not be displayed in the tree"></span>\n            </label>\n        </div>\n    \n        <br/>\n    \n        <button class="btn btn-sm btn-primary save-tree-settings-button" type="submit">Save & apply changes</button>\n    </div>\n    \n    <div class="tree"></div>\n</div>\n'),this.$tree=this.$widget.find(".tree"),this.$tree.on("click",".unhoist-button",Z.Z.unhoist),this.$tree.on("click",".refresh-search-button",()=>this.refreshSearch()),this.$tree.on("mousedown",".fancytree-title",e=>{if(2===e.which){const n=$.ui.fancytree.getNode(e),o=w.Z.getNotePath(n);o&&t.default.tabManager.openTabWithNote(o),e.stopPropagation(),e.preventDefault()}}),this.$treeSettingsPopup=this.$widget.find(".tree-settings-popup"),this.$hideArchivedNotesCheckbox=this.$treeSettingsPopup.find(".hide-archived-notes"),this.$hideIncludedImages=this.$treeSettingsPopup.find(".hide-included-images"),this.$treeSettingsButton=this.$widget.find(".tree-settings-button"),this.$treeSettingsButton.on("click",t=>{if(this.$treeSettingsPopup.is(":visible"))return void this.$treeSettingsPopup.hide();this.$hideArchivedNotesCheckbox.prop("checked",this.hideArchivedNotes),this.$hideIncludedImages.prop("checked",this.hideIncludedImages);let e=this.$treeSettingsButton[0].offsetTop,n=this.$treeSettingsButton[0].offsetLeft;return e+=this.$treeSettingsButton.outerHeight(),n+=this.$treeSettingsButton.outerWidth()-this.$treeSettingsPopup.outerWidth(),n<0&&(n=0),this.$treeSettingsPopup.css({display:"block",top:e,left:n}).addClass("show"),!1}),this.$treeSettingsPopup.on("click",t=>{t.stopPropagation()}),$(document).on("click",()=>this.$treeSettingsPopup.hide()),this.$saveTreeSettingsButton=this.$treeSettingsPopup.find(".save-tree-settings-button"),this.$saveTreeSettingsButton.on("click",async()=>{await this.setHideArchivedNotes(this.$hideArchivedNotesCheckbox.prop("checked")),await this.setHideIncludedImages(this.$hideIncludedImages.prop("checked")),this.$treeSettingsPopup.hide(),this.reloadTreeFromCache()}),this.initialized=this.initFancyTree(),this.setupNoteTitleTooltip(),this.$widget}setupNoteTitleTooltip(){this.$tree.on("mouseenter","span.fancytree-title",t=>{t.currentTarget.title=((t,e)=>{const n=t.offset(),o=n.top+t.outerHeight(!0),i=n.left+t.outerWidth(!0),s=e.offset(),a=s.top+e.outerHeight(!0),r=s.left+e.outerWidth(!0);return o>a&&n.top<s.top&&i>r&&n.left<s.left})(this.$tree,$(t.currentTarget))?"":t.currentTarget.innerText})}get hideArchivedNotes(){return b.Z.is("hideArchivedNotes_"+this.treeName)}async setHideArchivedNotes(t){await b.Z.save("hideArchivedNotes_"+this.treeName,t.toString())}get hideIncludedImages(){return b.Z.is("hideIncludedImages_"+this.treeName)}async setHideIncludedImages(t){await b.Z.save("hideIncludedImages_"+this.treeName,t.toString())}async initFancyTree(){const n=[await this.prepareRootNode()];this.$tree.fancytree({titlesTabbable:!0,autoScroll:!0,keyboard:!1,extensions:e.Z.isMobile()?["dnd5","clones"]:["hotkeys","dnd5","clones"],source:n,scrollParent:this.$tree,minExpandLevel:2,click:(e,n)=>{const o=n.targetType,i=n.node;if("title"===o||"icon"===o){if(e.shiftKey)i.setSelected(!i.isSelected()),i.setFocus(!0);else if(e.ctrlKey){const e=w.Z.getNotePath(i);t.default.tabManager.openTabWithNote(e)}else n.node.isActive()?this.tree.reactivate(!0):(i.setActive(),this.clearSelectedNodes());return!1}},activate:async(n,o)=>{r.Z.hide();const i=w.Z.getNotePath(o.node),s=t.default.tabManager.getActiveTabContext();await s.setNote(i),e.Z.isMobile()&&this.triggerCommand("setActiveScreen",{screen:"detail"})},expand:(t,e)=>this.setExpanded(e.node.data.branchId,!0),collapse:(t,e)=>this.setExpanded(e.node.data.branchId,!1),hotkeys:e.Z.isMobile()?void 0:{keydown:await this.getHotKeys()},dnd5:{autoExpandMS:600,dragStart:(t,e)=>{if(t.data.noteId===Z.Z.getHoistedNoteId()||"search"===t.getParent().data.noteType)return!1;const n=this.getSelectedOrActiveNodes(t).map(t=>({noteId:t.data.noteId,branchId:t.data.branchId,title:t.title}));return e.dataTransfer.setData("text",JSON.stringify(n)),!0},dragEnter:(t,e)=>!0,dragOver:(t,e)=>!0,dragDrop:async(t,e)=>{if("over"===e.hitMode&&"search"===t.data.noteType||["after","before"].includes(e.hitMode)&&(t.data.noteId===Z.Z.getHoistedNoteId()||"search"===t.getParent().data.noteType)){const t=await __webpack_require__.e(57).then(__webpack_require__.bind(__webpack_require__,4057));return void await t.info("Dropping notes into this location is not allowed.")}const n=e.dataTransfer;if(n&&n.files&&n.files.length>0){const e=[...n.files];(await __webpack_require__.e(274).then(__webpack_require__.bind(__webpack_require__,1274))).uploadFiles(t.data.noteId,e,{safeImport:!0,shrinkImages:!0,textImportedAsText:!0,codeImportedAsCode:!0,explodeArchives:!0})}else{const o=n.getData("text");let i=null;try{i=JSON.parse(o)}catch(t){return void console.error(`Cannot parse ${o} into notes for drop`)}const s=i.map(t=>t.branchId);if("before"===e.hitMode)E.Z.moveBeforeBranch(s,t.data.branchId);else if("after"===e.hitMode)E.Z.moveAfterBranch(s,t.data.branchId);else{if("over"!==e.hitMode)throw new Error("Unknown hitMode="+e.hitMode);E.Z.moveToParentNote(s,t.data.branchId)}}}},lazyLoad:(t,e)=>{const{noteId:n,noteType:o}=e.node.data;if("search"===o){if(w.Z.getNotePath(e.node.getParent()).includes(n))return void(e.result=[])}e.result=S.Z.getNote(n).then(t=>this.prepareChildren(t))},clones:{highlightActiveClones:!0},enhanceTitle:async function(t,e){const n=e.node,o=$(n.span);if("root"!==n.data.noteId&&n.data.noteId===Z.Z.getHoistedNoteId()&&0===o.find(".unhoist-button").length){const t=$('<span>&nbsp; (<a class="unhoist-button">unhoist</a>)</span>');o.append(t)}if("search"===(await S.Z.getNote(n.data.noteId)).type&&0===o.find(".refresh-search-button").length){const t=$('<span>&nbsp; <span class="refresh-search-button bx bx-refresh" title="Refresh saved search results"></span></span>');o.append(t)}},loadChildren:(t,e)=>{e.node.visit(t=>{t.isUndefined()&&t.isExpanded()&&t.load()})}}),this.$tree.on("contextmenu",".fancytree-node",t=>{const e=$.ui.fancytree.getNode(t);return __webpack_require__.e(893).then(__webpack_require__.bind(__webpack_require__,8893)).then(({default:n})=>{new n(this,e).show(t)}),!1}),this.tree=$.ui.fancytree.getTree(this.$tree)}async prepareRootNode(){await S.Z.initializedPromise;const t=Z.Z.getHoistedNoteId();let e;if("root"===t)e=S.Z.getBranch("root");else{const n=await S.Z.getNote(t);e=(await n.getBranches())[0]}return await this.prepareNode(e)}async prepareChildren(t){return"search"===t.type?await this.prepareSearchNoteChildren(t):await this.prepareNormalNoteChildren(t)}getIconClass(t){return t.getLabels("iconClass").map(t=>t.value).join(" ")}getIcon(t,e){const n=Z.Z.getHoistedNoteId(),o=this.getIconClass(t);return o||("root"===t.noteId?"bx bx-chevrons-right":t.noteId===n?"bx bxs-arrow-from-bottom":"text"===t.type?e?"bx bx-folder":"bx bx-note":M[t.type])}async prepareNode(t){const n=await t.getNote();if(!n)throw new Error("Branch has no note "+t.noteId);const o=(t.prefix?t.prefix+" - ":"")+n.title,i=Z.Z.getHoistedNoteId(),s=this.isFolder(n),a={noteId:n.noteId,parentNoteId:t.parentNoteId,branchId:t.branchId,isProtected:n.isProtected,noteType:n.type,title:e.Z.escapeHtml(o),extraClasses:this.getExtraClasses(n),icon:this.getIcon(n,s),refKey:n.noteId,lazy:!0,folder:s,expanded:t.isExpanded||i===n.noteId,key:e.Z.randomString(12)};return a.folder&&a.expanded&&(a.children=await this.prepareChildren(n)),a}isFolder(t){if("search"===t.type)return!0;return this.getChildBranches(t).length>0}async prepareNormalNoteChildren(t){e.Z.assertArguments(t);const n=[],o=this.hideArchivedNotes;for(const e of this.getChildBranches(t)){if(o){if((await e.getNote()).hasLabel("archived"))continue}const t=await this.prepareNode(e);n.push(t)}return n}getChildBranches(t){let e=t.getChildBranches();if(e){if(this.hideIncludedImages){const n=t.getRelations("imageLink");e=e.filter(t=>!n.find(e=>e.value===t.noteId))}return e}P.Z.logError(`No children for ${t}. This shouldn't happen.`)}async prepareSearchNoteChildren(t){await S.Z.reloadNotes([t.noteId]);const e=await S.Z.getNote(t.noteId);return await this.prepareNormalNoteChildren(e)}getExtraClasses(t){e.Z.assertArguments(t);const n=[];t.isProtected&&n.push("protected"),t.getParentNoteIds().length>1&&n.push("multiple-parents");const o=t.getCssClass();return o&&n.push(o),n.push(e.Z.getNoteTypeClass(t.type)),t.mime&&n.push(e.Z.getMimeTypeClass(t.mime)),t.hasLabel("archived")&&n.push("archived"),n.join(" ")}getSelectedNodes(t=!1){return this.tree.getSelectedNodes(t)}getSelectedOrActiveNodes(t=null){const e=this.getSelectedNodes(!0);return t&&!e.find(e=>e.key===t.key)&&e.push(t),0===e.length&&e.push(this.getActiveNode()),e}async setExpandedStatusForSubtree(t,e){if(!t){const e=Z.Z.getHoistedNoteId();t=this.getNodesByNoteId(e)[0]}const{branchIds:n}=await l.Z.put(`branches/${t.data.branchId}/expanded-subtree/${e?1:0}`);S.Z.getBranches(n,!0).forEach(t=>t.isExpanded=e),await this.batchUpdate(async()=>{await t.load(!0),"root"!==t.data.noteId&&await t.setExpanded(e,{noEvents:!0})})}async expandTree(t=null){await this.setExpandedStatusForSubtree(t,!0)}async collapseTree(t=null){await this.setExpandedStatusForSubtree(t,!1)}getActiveNode(){return this.tree.getActiveNode()}getFocusedNode(){return this.tree.getFocusNode()}clearSelectedNodes(){for(const t of this.getSelectedNodes())t.setSelected(!1)}async scrollToActiveNoteEvent(){const e=t.default.tabManager.getActiveTabContext();if(e&&e.notePath){this.tree.setFocus(!0);const t=await this.expandToNote(e.notePath);await t.makeVisible({scrollIntoView:!0}),t.setFocus(!0)}}async getNodeFromPath(t,n=!1,o=!0){e.Z.assertArguments(t);const i=Z.Z.getHoistedNoteId();let s=null;const a=await w.Z.getRunPath(t,o);if(a){for(const e of a)if(e!==i){if(s){if(s.isLoaded()||await s.load(),n){await s.setExpanded(!0),S.Z.getBranch(s.data.branchId).isExpanded=!0}this.updateNode(s);let a=this.findChildNode(s,e);if(!a&&(await s.load(!0),a=this.findChildNode(s,e),!a))return void(o&&P.Z.logError(`Can't find node for child node of noteId=${e} for parent of noteId=${s.data.noteId} and hoistedNoteId=${i}, requested path is ${t}`));s=a}}else s=this.getNodesByNoteId(e)[0];return s}o&&console.error("Could not find run path for notePath:",t)}findChildNode(t,e){let n=null;for(const o of t.getChildren())if(o.data.noteId===e){n=o;break}return n}async expandToNote(t,e=!0){return this.getNodeFromPath(t,!0,e)}updateNode(t){const n=S.Z.getNoteFromCache(t.data.noteId),o=S.Z.getBranch(t.data.branchId),i=this.isFolder(n),s=(o.prefix?o.prefix+" - ":"")+n.title;t.data.isProtected=n.isProtected,t.data.noteType=n.type,t.folder=i,t.icon=this.getIcon(n,i),t.extraClasses=this.getExtraClasses(n),t.title=e.Z.escapeHtml(s),t.isExpanded()!==o.isExpanded&&t.setExpanded(o.isExpanded,{noEvents:!0}),t.renderTitle()}getNodesByBranchId(t){e.Z.assertArguments(t);const n=S.Z.getBranch(t);return this.getNodesByNoteId(n.noteId).filter(e=>e.data.branchId===t)}getNodesByNoteId(t){e.Z.assertArguments(t);const n=this.tree.getNodesByRef(t);return n||[]}collapseTreeEvent(){this.collapseTree()}isEnabled(){return!!this.tabContext}async refresh(){this.toggleInt(this.isEnabled());const t=this.getActiveNode();let e=!1;if(t&&(e=t.hasFocus(),t.setActive(!1),t.setFocus(!1)),this.tabContext&&this.tabContext.notePath&&!this.tabContext.note.isDeleted){const t=await this.getNodeFromPath(this.tabContext.notePath);t&&(t.isVisible()||await this.expandToNote(this.tabContext.notePath),t.setActive(!0,{noEvents:!0,noFocus:!e}),t.makeVisible({scrollIntoView:!0}))}}async refreshSearch(){const t=this.getActiveNode();t.load(!0),t.setExpanded(!0),h.default.showMessage("Saved search note refreshed.")}async batchUpdate(t){try{this.tree.enableUpdate(!1),await t()}finally{this.tree.enableUpdate(!0)}}async entitiesReloadedEvent({loadResults:e}){const n=this.getActiveNode(),o=n&&n.hasFocus(),i=n?n.getNextSibling()||n.getPrevSibling()||n.getParent():null,s=n?w.Z.getNotePath(n):null,a=i?w.Z.getNotePath(i):null,r=n?n.data.noteId:null,d=new Set,c=new Set;for(const t of e.getAttributes())if("label"===t.type&&["iconClass","cssClass"].includes(t.name))t.isInheritable?c.add(t.noteId):d.add(t.noteId);else if("relation"===t.type&&"template"===t.name)c.add(t.noteId);else if("relation"===t.type&&"imageLink"===t.name){const e=S.Z.getNoteFromCache(t.noteId);e&&e.getChildNoteIds().includes(t.value)&&c.add(t.noteId)}for(const t of e.getBranches()){for(const e of this.getNodesByBranchId(t.branchId))if(t.isDeleted){if(e.isActive()){const t=e.getNextSibling()||e.getPrevSibling()||e.getParent();t&&t.setActive(!0,{noEvents:!0,noFocus:!0})}e.getParent()&&e.remove(),d.add(t.parentNoteId)}else d.add(t.noteId);if(!t.isDeleted)for(const e of this.getNodesByNoteId(t.parentNoteId)){if(e.isFolder()&&!e.isLoaded())continue;(e.getChildren()||[]).find(e=>e.data.noteId===t.noteId)||c.add(t.parentNoteId)}}for(const t of e.getNoteIds())d.add(t);await this.batchUpdate(async()=>{for(const t of c)for(const e of this.getNodesByNoteId(t))await e.load(!0),d.add(t);for(const t of e.getNoteReorderings())for(const e of this.getNodesByNoteId(t))e.isLoaded()&&e.sortChildren((t,e)=>{const n=S.Z.branches[t.data.branchId],o=S.Z.branches[e.data.branchId];return n&&o?n.notePosition-o.notePosition:0})});for(const t of d)for(const e of this.getNodesByNoteId(t))this.updateNode(e);if(s){let e=await this.expandToNote(s,!1);if(e&&e.data.noteId!==r){const t=this.getNodesByNoteId(r);e=1===t.length?t[0]:null}e?e.setActive(!0,{noEvents:!0,noFocus:!0}):(e=await this.expandToNote(a,!1),e&&await t.default.tabManager.getActiveTabContext().setNote(a));const n=this.getActiveNode();n&&o&&await n.setFocus(!0)}}async setExpanded(t,n){e.Z.assertArguments(t),S.Z.getBranch(t).isExpanded=n,await l.Z.put(`branches/${t}/expanded/${n?1:0}`)}async reloadTreeFromCache(){const t=this.getActiveNode(),e=null!==t?w.Z.getNotePath(t):null,n=await this.prepareRootNode();if(await this.batchUpdate(async()=>{await this.tree.reload([n])}),e){const t=await this.getNodeFromPath(e,!0);await t.setActive(!0,{noEvents:!0,noFocus:!0})}}hoistedNoteChangedEvent(){this.reloadTreeFromCache()}treeCacheReloadedEvent(){this.reloadTreeFromCache()}async getHotKeys(){const t=await f.default.getActionsForScope("note-tree"),n={left:t=>(t.navigate($.ui.keyCode.LEFT,!0),this.clearSelectedNodes(),!1),right:t=>(t.navigate($.ui.keyCode.RIGHT,!0),this.clearSelectedNodes(),!1),up:t=>(t.navigate($.ui.keyCode.UP,!0),this.clearSelectedNodes(),!1),down:t=>(t.navigate($.ui.keyCode.DOWN,!0),this.clearSelectedNodes(),!1)};for(const o of t)for(const t of o.effectiveShortcuts)n[e.Z.normalizeShortcut(t)]=t=>(this.triggerCommand(o.actionName,{node:t}),!1);return n}getSelectedOrActiveBranchIds(t){return this.getSelectedOrActiveNodes(t).map(t=>t.data.branchId)}async deleteNotesCommand({node:t}){const e=this.getSelectedOrActiveBranchIds(t);await E.Z.deleteNotes(e),this.clearSelectedNodes()}moveNoteUpCommand({node:t}){const e=t.getPrevSibling();null!==e&&E.Z.moveBeforeBranch([t.data.branchId],e.data.branchId)}moveNoteDownCommand({node:t}){const e=t.getNextSibling();null!==e&&E.Z.moveAfterBranch([t.data.branchId],e.data.branchId)}moveNoteUpInHierarchyCommand({node:t}){E.Z.moveNodeUpInHierarchy(t)}moveNoteDownInHierarchyCommand({node:t}){const e=t.getPrevSibling();null!==e&&E.Z.moveToParentNote([t.data.branchId],e.data.branchId)}addNoteAboveToSelectionCommand(){const t=this.getFocusedNode();if(!t)return;t.isActive()&&t.setSelected(!0);const e=t.getPrevSibling();e&&(e.setActive(!0,{noEvents:!0}),e.isSelected()&&t.setSelected(!1),e.setSelected(!0))}addNoteBelowToSelectionCommand(){const t=this.getFocusedNode();if(!t)return;t.isActive()&&t.setSelected(!0);const e=t.getNextSibling();e&&(e.setActive(!0,{noEvents:!0}),e.isSelected()&&t.setSelected(!1),e.setSelected(!0))}expandSubtreeCommand({node:t}){this.expandTree(t)}collapseSubtreeCommand({node:t}){this.collapseTree(t)}sortChildNotesCommand({node:t}){w.Z.sortAlphabetically(t.data.noteId)}async recentChangesInSubtreeCommand({node:t}){(await __webpack_require__.e(583).then(__webpack_require__.bind(__webpack_require__,6583))).showDialog(t.data.noteId)}selectAllNotesInParentCommand({node:t}){for(const e of t.getParent().getChildren())e.setSelected(!0)}copyNotesToClipboardCommand({node:t}){D.Z.copy(this.getSelectedOrActiveBranchIds(t))}cutNotesToClipboardCommand({node:t}){D.Z.cut(this.getSelectedOrActiveBranchIds(t))}pasteNotesFromClipboardCommand({node:t}){D.Z.pasteInto(t.data.branchId)}pasteNotesAfterFromClipboard({node:t}){D.Z.pasteAfter(t.data.branchId)}async exportNoteCommand({node:t}){const e=await __webpack_require__.e(663).then(__webpack_require__.bind(__webpack_require__,1663)),n=w.Z.getNotePath(t);e.showDialog(n,"subtree")}async importIntoNoteCommand({node:t}){(await __webpack_require__.e(900).then(__webpack_require__.bind(__webpack_require__,900))).showDialog(t.data.noteId)}forceNoteSyncCommand({node:t}){p.forceNoteSync(t.data.noteId)}editNoteTitleCommand({node:e}){t.default.triggerCommand("focusOnTitle")}activateParentNoteCommand({node:t}){Z.Z.isRootNode(t)||t.getParent().setActive().then(this.clearSelectedNodes)}protectSubtreeCommand({node:t}){v.Z.protectNote(t.data.noteId,!0,!0)}unprotectSubtreeCommand({node:t}){v.Z.protectNote(t.data.noteId,!1,!0)}duplicateNoteCommand({node:t}){const e=S.Z.getBranch(t.data.branchId);N.Z.duplicateNote(t.data.noteId,e.parentNoteId)}}var B=__webpack_require__(4122),L=__webpack_require__(7844);class O extends A.Z{doRender(){return this.$widget=$('\n<div class="note-paths-widget">\n    <style>\n    .note-paths-widget {\n        display: flex; \n        flex-direction: row;\n        border-bottom: 1px solid var(--main-border-color);\n        padding: 5px 10px 5px 10px;\n    }\n    \n    .note-path-list a.current {\n        font-weight: bold;\n    }\n    \n    .note-path-list-button {\n        padding: 0;\n        width: 24px;\n        height: 24px;\n        margin-left: 5px;\n        position: relative;\n        top: -2px;\n    }\n    \n    .note-path-list-button::after {\n        display: none !important; // disabling the standard caret\n    }\n    \n    .current-path {\n        flex-grow: 1;\n        white-space: nowrap; \n        overflow: hidden; \n        text-overflow: ellipsis;\n    }\n    </style>\n\n    <div class="current-path"></div>\n\n    <div class="dropdown hide-in-zen-mode">\n        <button class="btn btn-sm dropdown-toggle note-path-list-button bx bx-caret-down" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>\n        <ul class="note-path-list dropdown-menu dropdown-menu-right" aria-labelledby="note-path-list-button">\n        </ul>\n    </div>\n</div>'),this.$currentPath=this.$widget.find(".current-path"),this.$dropdown=this.$widget.find(".dropdown"),this.$notePathList=this.$dropdown.find(".note-path-list"),this.$dropdown.on("show.bs.dropdown",()=>this.renderDropdown()),this.$widget}async refreshWithNote(t,e){const n=w.Z.parseNotePath(e);this.$currentPath.empty();let o="root",i="",s=!1;for(let t=0;t<n.length;t++){const e=n[t];i+=(i?"/":"")+e,e===Z.Z.getHoistedNoteId()&&(s=!0),s&&(e!==Z.Z.getHoistedNoteId()||n.length-t<3)&&(this.$currentPath.append($("<a>").attr("href","#"+i).attr("data-note-path",i).addClass("no-tooltip-preview").text(await w.Z.getNoteTitle(e,o))),t!==n.length-1&&this.$currentPath.append(" / ")),o=e}}async renderDropdown(){if(this.$notePathList.empty(),this.$notePathList.append($("<div>").addClass("dropdown-header").text("This note is placed into the following paths:")),"root"===this.noteId)return void await this.addPath("root",!0);const t=w.Z.parseNotePath(this.notePath),e=t[t.length-2];for(const t of this.note.getParentNotes()){const n=await w.Z.getSomeNotePath(t),o=n?n+"/"+this.noteId:this.noteId,i=e===t.noteId;await this.addPath(o,i)}const n=$("<div>").addClass("dropdown-header").append($('<button class="btn btn-sm">').text("Clone note to new location...").on("click",()=>__webpack_require__.e(365).then(__webpack_require__.bind(__webpack_require__,4365)).then(t=>t.showDialog([this.noteId]))));this.$notePathList.append(n)}async addPath(t,e){const n=await w.Z.getNotePathTitle(t),o=await L.Z.createNoteLink(t,{title:n});o.addClass("dropdown-item"),o.find("a").addClass("no-tooltip-preview"),e&&o.addClass("current"),this.$notePathList.append(o)}entitiesReloadedEvent({loadResults:t}){t.getBranches().find(t=>t.noteId===this.noteId)&&this.refresh()}}var q=__webpack_require__(2040),W=__webpack_require__(1902);class j extends A.Z{constructor(){super(),this.spacedUpdate=new W.Z(async()=>{const t=this.$noteTitle.val();q.Z.touchProtectedSessionIfNecessary(this.note),await l.Z.put(`notes/${this.noteId}/change-title`,{title:t})})}doRender(){return this.$widget=$('\n<div class="note-title-container">\n    <style>\n    .note-title-container {\n        flex-grow: 100;\n    }\n    \n    .note-title-container input.note-title {\n        font-size: 150%;\n        border: 0;\n        min-width: 5em;\n        width: 100%;\n    }\n    \n    .note-title-container input.note-title.protected {\n        text-shadow: 4px 4px 4px var(--muted-text-color);\n    }\n    </style>\n\n    <input autocomplete="off" value="" class="note-title" tabindex="1">\n</div>'),this.$noteTitle=this.$widget.find(".note-title"),this.$noteTitle.on("input",()=>this.spacedUpdate.scheduleUpdate()),e.Z.bindElShortcut(this.$noteTitle,"return",()=>{this.triggerCommand("focusOnDetail",{tabId:this.tabContext.tabId})}),this.$widget}async refreshWithNote(t){this.$noteTitle.val(t.title),this.$noteTitle.prop("readonly",t.isProtected&&!q.Z.isProtectedSessionAvailable()),this.setProtectedStatus(t)}setProtectedStatus(t){this.$noteTitle.toggleClass("protected",!!t.isProtected)}async beforeNoteSwitchEvent({tabContext:t}){this.isTab(t.tabId)&&await this.spacedUpdate.updateNowIfNecessary()}async beforeTabRemoveEvent({tabId:t}){this.isTab(t)&&await this.spacedUpdate.updateNowIfNecessary()}focusOnTitleEvent(){this.tabContext&&this.tabContext.isActive()&&this.$noteTitle.trigger("focus")}focusAndSelectTitleEvent(){this.tabContext&&this.tabContext.isActive()&&this.$noteTitle.trigger("focus").trigger("select")}entitiesReloadedEvent({loadResults:t}){t.isNoteReloaded(this.noteId)&&this.setProtectedStatus(this.note)}beforeUnloadEvent(){this.spacedUpdate.updateNowIfNecessary()}}class F extends A.Z{doRender(){return this.$widget=$('\n<div style="display: inline-flex;">\n    <button class="btn btn-sm icon-button bx bx-play-circle render-button"\n            data-trigger-command="renderActiveNote"\n            title="Render"></button>\n    \n    <button class="btn btn-sm icon-button bx bx-play-circle execute-script-button"\n            data-trigger-command="runActiveNote"\n            title="Execute"></button>\n</div>'),this.$renderButton=this.$widget.find(".render-button"),this.$executeScriptButton=this.$widget.find(".execute-script-button"),this.$widget}refreshWithNote(t){this.$renderButton.toggle("render"===t.type),this.$executeScriptButton.toggle("code"===t.type&&t.mime.startsWith("application/javascript"))}async entitiesReloadedEvent({loadResults:t}){t.isNoteReloaded(this.noteId)&&this.refresh()}}var z=__webpack_require__(236);const U=[{type:"file",title:"File",selectable:!1},{type:"image",title:"Image",selectable:!1},{type:"search",title:"Saved search",selectable:!1},{type:"text",mime:"text/html",title:"Text",selectable:!0},{type:"relation-map",mime:"application/json",title:"Relation Map",selectable:!0},{type:"render",mime:"",title:"Render Note",selectable:!0},{type:"book",mime:"",title:"Book",selectable:!0},{type:"code",mime:"text/plain",title:"Code",selectable:!0}];class H extends A.Z{doRender(){return this.$widget=$('\n<div class="dropdown note-type">\n    <style>\n    .note-type-dropdown {\n        max-height: 500px;\n        overflow-y: auto;\n        overflow-x: hidden;\n    }\n    </style>\n    <button type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-sm dropdown-toggle note-type-button">\n        Type: <span class="note-type-desc"></span>\n        <span class="caret"></span>\n    </button>\n    <div class="note-type-dropdown dropdown-menu dropdown-menu-right"></div>\n</div>\n'),this.$widget.on("show.bs.dropdown",()=>this.renderDropdown()),this.$noteTypeDropdown=this.$widget.find(".note-type-dropdown"),this.$noteTypeButton=this.$widget.find(".note-type-button"),this.$noteTypeDesc=this.$widget.find(".note-type-desc"),this.$widget}async refreshWithNote(t){this.$noteTypeButton.prop("disabled",()=>["file","image","search"].includes(t.type)),this.$noteTypeDesc.text(await this.findTypeTitle(t.type,t.mime))}async renderDropdown(){this.$noteTypeDropdown.empty();for(const t of U.filter(t=>t.selectable)){const e=$('<a class="dropdown-item">').attr("data-note-type",t.type).append('<span class="check">&check;</span> ').append($("<strong>").text(t.title)).on("click",t=>{const n=e.attr("data-note-type"),o=U.find(t=>t.type===n);this.save(o.type,o.mime)});this.note.type===t.type&&e.addClass("selected"),this.$noteTypeDropdown.append(e),"code"!==t.type&&this.$noteTypeDropdown.append('<div class="dropdown-divider"></div>')}for(const t of await z.Z.getMimeTypes()){if(!t.enabled)continue;const e=$('<a class="dropdown-item">').attr("data-mime-type",t.mime).append('<span class="check">&check;</span> ').append($("<span>").text(t.title)).on("click",t=>{const e=$(t.target).closest(".dropdown-item");this.save("code",e.attr("data-mime-type"))});"code"===this.note.type&&this.note.mime===t.mime&&(e.addClass("selected"),this.$noteTypeDesc.text(t.title)),this.$noteTypeDropdown.append(e)}}async findTypeTitle(t,e){if("code"===t){const t=(await z.Z.getMimeTypes()).find(t=>t.mime===e);return t?t.title:e}{const e=U.find(e=>e.type===t);return e?e.title:t}}async save(t,e){t===this.note.type&&e===this.note.mime||(t===this.note.type||await this.confirmChangeIfContent())&&await l.Z.put("notes/"+this.noteId+"/type/"+encodeURIComponent(t)+"/mime/"+encodeURIComponent(e))}async confirmChangeIfContent(){const t=await this.tabContext.getNoteComplement();if(!t.content||!t.content.trim().length)return!0;const e=await __webpack_require__.e(590).then(__webpack_require__.bind(__webpack_require__,590));return await e.confirm("It is not recommended to change note type when note content is not empty. Do you want to continue anyway?")}async entitiesReloadedEvent({loadResults:t}){t.isNoteReloaded(this.noteId,this.componentId)&&this.refresh()}}class V extends A.Z{doRender(){return this.$widget=$('\n<div class="dropdown note-actions">\n    <style>\n    .note-actions .dropdown-menu {\n        width: 15em;\n    }\n    \n    .note-actions .dropdown-item[disabled], .note-actions .dropdown-item[disabled]:hover {\n        color: var(--muted-text-color) !important;\n        background-color: transparent !important;\n        pointer-events: none; /* makes it unclickable */\n    }\n    \n    /* The switch - the box around the slider */\n    .switch {\n        position: relative;\n        display: inline-block;\n        width: 50px;\n        height: 24px;\n        float: right;\n    }\n    \n    /* The slider */\n    .slider {\n        border-radius: 24px;\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: var(--more-accented-background-color);\n        transition: .4s;\n    }\n    \n    .slider:before {\n        border-radius: 50%;\n        position: absolute;\n        content: "";\n        height: 16px;\n        width: 16px;\n        left: 4px;\n        bottom: 4px;\n        background-color: var(--main-background-color);\n        -webkit-transition: .4s;\n        transition: .4s;\n    }\n    \n    .slider.checked {\n        background-color: var(--main-text-color);\n    }\n    \n    .slider.checked:before {\n        transform: translateX(26px);\n    }\n    </style>\n\n    <button type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-sm dropdown-toggle">\n        Note actions\n        <span class="caret"></span>\n    </button>\n    <div class="dropdown-menu dropdown-menu-right">\n        <div class="dropdown-item protect-button">\n            Protect the note\n        \n            <span title="Note is not protected, click to make it protected">\n                <label class="switch">\n                <span class="slider"></span>\n            </span>\n        </div>\n        <div class="dropdown-item unprotect-button">\n            Unprotect the note\n        \n            <span title="Note is protected, click to make it unprotected">\n                <label class="switch">\n                <span class="slider checked"></span>\n            </span>\n        </div>\n        <a data-trigger-command="showNoteRevisions" class="dropdown-item show-note-revisions-button">Revisions</a>\n        <a data-trigger-command="showAttributes" class="dropdown-item show-attributes-button"><kbd data-command="showAttributes"></kbd> Attributes</a>\n        <a data-trigger-command="showLinkMap" class="dropdown-item show-link-map-button"><kbd data-command="showLinkMap"></kbd> Link map</a>\n        <a data-trigger-command="showNoteSource" class="dropdown-item show-source-button"><kbd data-command="showNoteSource"></kbd> Note source</a>\n        <a class="dropdown-item import-files-button">Import files</a>\n        <a class="dropdown-item export-note-button">Export note</a>\n        <a data-trigger-command="printActiveNote" class="dropdown-item print-note-button"><kbd data-command="printActiveNote"></kbd> Print note</a>\n        <a data-trigger-command="showNoteInfo" class="dropdown-item show-note-info-button"><kbd data-command="showNoteInfo"></kbd> Note info</a>\n    </div>\n</div>'),this.$showSourceButton=this.$widget.find(".show-source-button"),this.$exportNoteButton=this.$widget.find(".export-note-button"),this.$exportNoteButton.on("click",()=>{this.$exportNoteButton.hasClass("disabled")||__webpack_require__.e(663).then(__webpack_require__.bind(__webpack_require__,1663)).then(t=>t.showDialog(this.tabContext.notePath,"single"))}),this.$importNoteButton=this.$widget.find(".import-files-button"),this.$importNoteButton.on("click",()=>__webpack_require__.e(900).then(__webpack_require__.bind(__webpack_require__,900)).then(t=>t.showDialog(this.noteId))),this.$protectButton=this.$widget.find(".protect-button"),this.$protectButton.on("click",()=>v.Z.protectNote(this.noteId,!0,!1)),this.$unprotectButton=this.$widget.find(".unprotect-button"),this.$unprotectButton.on("click",()=>v.Z.protectNote(this.noteId,!1,!1)),this.$widget}refreshWithNote(t){["text","relation-map","search","code"].includes(t.type)?this.$showSourceButton.removeAttr("disabled"):this.$showSourceButton.attr("disabled","disabled"),"text"===t.type?this.$exportNoteButton.removeAttr("disabled"):this.$exportNoteButton.attr("disabled","disabled"),this.$protectButton.toggle(!t.isProtected),this.$unprotectButton.toggle(!!t.isProtected)}entitiesReloadedEvent({loadResults:t}){t.isNoteReloaded(this.noteId)&&this.refresh()}}class J extends A.Z{doRender(){return this.$widget=$('\n<div class="promoted-attributes-wrapper">\n    <style>\n    .promoted-attributes-wrapper {\n        margin: auto;\n        /* setting the display to block since "table" doesn\'t support scrolling */\n        display: block;\n        /** flex-basis: content; - use once "content" is implemented by chrome */\n        flex-shrink: 0;\n        flex-grow: 0;\n        overflow: auto;\n    }\n    \n    .promoted-attributes td, .promoted-attributes th {\n        padding: 5px;\n        min-width: 50px; /* otherwise checkboxes can collapse into 0 width (if there are only checkboxes) */\n    }\n    </style>\n    \n    <table class="promoted-attributes"></table>\n</div>\n'),this.$container=this.$widget.find(".promoted-attributes"),this.$widget}async refreshWithNote(t){this.$container.empty();const e=t.getAttributes(),n=e.filter(t=>"label-definition"===t.type||"relation-definition"===t.type).filter(t=>!t.name.startsWith("child:")).filter(t=>{const e=t.jsonValue;return e&&e.isPromoted}),o=e.some(t=>"label"===t.type&&"hidePromotedAttributes"===t.name);if(n.length>0&&!o){const t=$("<tbody>");for(const o of n){const n=o.type,i=n.substr(0,n.length-11);let s=e.filter(t=>t.name===o.name&&t.type===i);0===s.length&&s.push({attributeId:"",type:i,name:o.name,value:""}),"singlevalue"===o.value.multiplicityType&&(s=s.slice(0,1));for(const e of s){const n=await this.createPromotedAttributeRow(o,e);t.append(n)}}this.$container.empty().append(t),this.toggleInt(!0)}else this.toggleInt(!1);return e}async createPromotedAttributeRow(t,e){const n=t.jsonValue,o=$("<tr>"),s=$("<th>").append(e.name),a=$("<input>").prop("tabindex",t.position).prop("attribute-id",e.noteId===this.noteId?e.attributeId:"").prop("attribute-type",e.type).prop("attribute-name",e.name).prop("value",e.value).addClass("form-control").addClass("promoted-attribute-input").on("change",t=>this.promotedAttributeChanged(t)),r=$("<td>").append($("<div>").addClass("input-group").append(a)),d=$("<td>"),c=$("<td>").addClass("multiplicity").attr("nowrap",!0);if(o.append(s).append(r).append(d).append(c),"label"===e.type)if("text"===n.labelType)a.prop("type","text"),l.Z.get("attributes/values/"+encodeURIComponent(e.name)).then(t=>{0!==t.length&&(t=t.map(t=>({value:t})),a.autocomplete({appendTo:document.querySelector("body"),hint:!1,autoselect:!1,openOnFocus:!0,minLength:0,tabAutocomplete:!1},[{displayKey:"value",source:function(e,n){e=e.toLowerCase(),n(t.filter(t=>t.value.toLowerCase().includes(e)))}}]),a.on("autocomplete:selected",t=>this.promotedAttributeChanged(t)))});else if("number"===n.labelType){a.prop("type","number");let t=1;for(let e=0;e<(n.numberPrecision||0)&&e<10;e++)t/=10;a.prop("step",t)}else if("boolean"===n.labelType)a.prop("type","checkbox"),"true"===e.value&&a.prop("checked","checked");else if("date"===n.labelType)a.prop("type","date");else if("url"===n.labelType){a.prop("placeholder","http://website...");const t=$("<span>").addClass("input-group-text open-external-link-button bx bx-trending-up").prop("title","Open external link").on("click",()=>window.open(a.val(),"_blank"));a.after($("<div>").addClass("input-group-append").append(t))}else P.Z.logError("Unknown labelType="+t.labelType);else{if("relation"!==e.type)return void P.Z.logError("Unknown attribute type="+e.type);e.value&&a.val(await w.Z.getNoteTitle(e.value)),i.Z.initNoteAutocomplete(a),a.on("autocomplete:selected",(t,e,n)=>{this.promotedAttributeChanged(t)}),a.setSelectedPath(e.value)}if("multivalue"===n.multiplicityType){const n=$("<span>").addClass("bx bx-plus pointer").prop("title","Add new attribute").on("click",async()=>{const n=await this.createPromotedAttributeRow(t,{attributeId:"",type:e.type,name:t.name,value:""});o.after(n),n.find("input").trigger("focus")}),i=$("<span>").addClass("bx bx-trash pointer").prop("title","Remove this attribute").on("click",async()=>{e.attributeId&&await l.Z.remove("notes/"+this.noteId+"/attributes/"+e.attributeId,this.componentId),o.remove()});c.append(n).append(" &nbsp;").append(i)}return o}async promotedAttributeChanged(t){const e=$(t.target);let n;if("checkbox"===e.prop("type"))n=e.is(":checked")?"true":"false";else if("relation"===e.prop("attribute-type")){const t=e.getSelectedPath();n=t?w.Z.getNoteIdFromNotePath(t):""}else n=e.val();const o=await l.Z.put(`notes/${this.noteId}/attribute`,{attributeId:e.prop("attribute-id"),type:e.prop("attribute-type"),name:e.prop("attribute-name"),value:n},this.componentId);e.prop("attribute-id",o.attributeId)}entitiesReloadedEvent({loadResults:t}){t.getAttributes(this.componentId).find(t=>t.isAffecting(this.note))&&this.refresh()}}var G=__webpack_require__(6707);class K extends A.Z{static getType(){}async doRefresh(t){}async refresh(){this.constructor.getType()!==await this.parent.getWidgetType()?(this.toggleInt(!1),this.cleanup()):(this.toggleInt(!0),await this.doRefresh(this.note))}isActive(){return this.$widget.is(":visible")}getContent(){}focus(){}scrollToTop(){this.$widget.scrollTop(0)}autoBookDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}textPreviewDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}codePreviewDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}}const Q={render:async function(t,e){const n=t.getRelations("renderNote").map(t=>t.value).filter(t=>t);e.empty().toggle(n.length>0);for(const i of n){const n=await l.Z.get("script/bundle/"+i),s=$("<div>");e.append(s),s.append(n.html),o.Z.executeBundle(n,t,s)}return n.length>0}};const Y={getRenderedContent:async function(t){const n=function(t){let e=t.type;t.isProtected&&(q.Z.isProtectedSessionAvailable()?q.Z.touchProtectedSession():e="protected-session");return e}(t);let o;if("text"===n){const e=await l.Z.get("notes/"+t.noteId);o=$('<div class="ck-content">').html(e.content)}else if("code"===n){const e=await l.Z.get("notes/"+t.noteId);o=$("<pre>").text(e.content)}else if("image"===n)o=$("<img>").attr("src",`api/images/${t.noteId}/${t.title}`).css("max-width","100%");else if("file"===n){function i(){return e.Z.getUrlForDownload("api/notes/"+t.noteId+"/download")}const n=$('<button class="file-download btn btn-primary" type="button">Download</button>'),s=$('<button class="file-open btn btn-primary" type="button">Open</button>');if(n.on("click",()=>e.Z.download(i())),s.on("click",()=>{if(e.Z.isElectron()){e.Z.dynamicRequire("open")(i(),{url:!0})}else window.location.href=i()}),s.toggle(!t.isProtected),o=$("<div>"),"application/pdf"===t.mime&&e.Z.isElectron()){const n=$('<iframe class="pdf-preview" style="width: 100%; height: 100%; flex-grow: 100;"></iframe>');n.attr("src",e.Z.getUrlForDownload("api/notes/"+t.noteId+"/open")),o.append(n)}o.append(n).append(" &nbsp; ").append(s)}else if("render"===n)o=$("<div>"),await Q.render(t,o,this.ctx);else if("protected-session"===n){const t=$('<button class="btn btn-sm"><span class="bx bx-log-in"></span> Enter protected session</button>').on("click",v.Z.enterProtectedSession);o=$("<div>").append("<div>This note is protected and to access it you need to enter password.</div>").append("<br/>").append(t)}else o=$("<em>Content of this note cannot be displayed in the book format</em>");return o.addClass(t.getCssClass()),{renderedContent:o,type:n}}};class X extends K{doRender(){this.$widget.on("dblclick","img",e=>{const n=$(e.target).prop("src"),o=n.match(/\/api\/images\/([A-Za-z0-9]+)\//);if(o){const e=o[1];t.default.tabManager.getActiveTabContext().setNote(e)}else window.open(n,"_blank")})}async loadIncludedNote(t,e){const n=await S.Z.getNote(t);if(n){const t=await L.Z.createNoteLink(n.noteId,{showTooltip:!1});e.empty().append($('<h4 class="include-note-title">').append(t));const{renderedContent:o}=await Y.getRenderedContent(n);e.append($('<div class="include-note-content">').append(o))}}async loadReferenceLinkTitle(t,e){const n=await S.Z.getNote(t,!0);let o;o=n?n.isDeleted?n.isErased?"[erased]":n.title+" (deleted)":n.title:"[missing]",e.text(o)}refreshIncludedNote(t,e){t&&t.find(`section[data-note-id="${e}"]`).each((t,n)=>{this.loadIncludedNote(e,$(n))})}}const tt={feeds:[{marker:"@",feed:t=>new Promise((e,n)=>{i.Z.autocompleteSource(t,t=>{1===t.length&&"No results"===t[0].title&&(t=[]);for(const e of t)e.text=e.name=e.noteTitle,e.id="@"+e.text,e.link="#"+e.path,e.notePath=e.path;e(t)})}),itemRenderer:t=>{const e=document.createElement("span");return e.classList.add("mentions-item"),e.innerHTML=t.highlightedTitle+" ",e},minimumCharacters:0}]};const et=class extends K{static getType(){return"image"}doRender(){return this.$widget=$('\n<div class="note-detail-image note-detail-printable">\n    <div class="no-print" style="display: flex; justify-content: space-evenly; margin: 10px;">\n        <button class="image-download btn btn-sm btn-primary" type="button">Download</button>\n\n        <button class="image-copy-to-clipboard btn btn-sm btn-primary" type="button">Copy to clipboard</button>\n\n        <button class="image-upload-new-revision btn btn-sm btn-primary" type="button">Upload new revision</button>\n    </div>\n\n    <div class="note-detail-image-wrapper">\n        <img class="note-detail-image-view" />\n    </div>\n\n    <div style="display: flex; justify-content: space-evenly; margin: 10px;">\n        <span>\n            <strong>Original file name:</strong>\n            <span class="image-filename"></span>\n        </span>\n\n        <span>\n            <strong>File type:</strong>\n            <span class="image-filetype"></span>\n        </span>\n\n        <span>\n            <strong>File size:</strong>\n            <span class="image-filesize"></span>\n        </span>\n    </div>\n\n    <input type="file" class="image-upload-new-revision-input" style="display: none">\n</div>'),this.$imageWrapper=this.$widget.find(".note-detail-image-wrapper"),this.$imageView=this.$widget.find(".note-detail-image-view"),this.$copyToClipboardButton=this.$widget.find(".image-copy-to-clipboard"),this.$uploadNewRevisionButton=this.$widget.find(".image-upload-new-revision"),this.$uploadNewRevisionInput=this.$widget.find(".image-upload-new-revision-input"),this.$fileName=this.$widget.find(".image-filename"),this.$fileType=this.$widget.find(".image-filetype"),this.$fileSize=this.$widget.find(".image-filesize"),this.$imageDownloadButton=this.$widget.find(".image-download"),this.$imageDownloadButton.on("click",()=>e.Z.download(this.getFileUrl())),this.$copyToClipboardButton.on("click",()=>{this.$imageWrapper.attr("contenteditable","true");try{this.selectImage(this.$imageWrapper.get(0)),document.execCommand("copy")?h.default.showMessage("Image copied to the clipboard"):h.default.showAndLogError("Could not copy the image to clipboard.")}finally{window.getSelection().removeAllRanges(),this.$imageWrapper.removeAttr("contenteditable")}}),this.$uploadNewRevisionButton.on("click",()=>{this.$uploadNewRevisionInput.trigger("click")}),this.$uploadNewRevisionInput.on("change",async()=>{const t=this.$uploadNewRevisionInput[0].files[0];this.$uploadNewRevisionInput.val("");const n=new FormData;n.append("upload",t);const o=await $.ajax({url:baseApiUrl+"images/"+this.noteId,headers:l.Z.getHeaders(),data:n,type:"PUT",timeout:36e5,contentType:!1,processData:!1});o.uploaded?(h.default.showMessage("New image revision has been uploaded."),await e.Z.clearBrowserCache(),this.refresh()):h.default.showError("Upload of a new image revision failed: "+o.message)}),this.$widget}async doRefresh(t){const n=t.getAttributes(),o=e.Z.toObject(n,t=>[t.name,t.value]);this.$widget.show(),this.$fileName.text(o.originalFileName||"?"),this.$fileSize.text(t.contentLength+" bytes"),this.$fileType.text(t.mime);const i=e.Z.randomString(10);this.$imageView.prop("src",`api/images/${t.noteId}/${t.title}?${i}`)}selectImage(t){const e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)}getFileUrl(){return e.Z.getUrlForDownload(`api/notes/${this.noteId}/download`)}};var nt=__webpack_require__(5819);const ot=[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],["Label",{label:"",id:"label",cssClass:"connection-label"}]],it=[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],["Label",{label:"",id:"label",cssClass:"connection-label"}],["Arrow",{location:0,id:"arrow2",length:14,direction:-1,foldback:.8}]],st=[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],["Label",{label:"",location:.2,id:"label-source",cssClass:"connection-label"}],["Label",{label:"",location:.8,id:"label-target",cssClass:"connection-label"}],["Arrow",{location:0,id:"arrow2",length:14,direction:-1,foldback:.8}]],at=[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}]];let rt=1;const dt={1:{width:"100%",height:"100%"},2:{width:"49%",height:"350px"},3:{width:"32%",height:"250px"},4:{width:"24%",height:"200px"},5:{width:"19%",height:"175px"},6:{width:"16%",height:"150px"}};const ct={empty:class extends K{static getType(){return"empty"}doRender(){return this.$widget=$('\n<div class="note-detail-empty note-detail-printable">\n    <div class="form-group">\n        <label>Open note by typing note\'s title into input below or choose a note in the tree.</label>\n        <div class="input-group">\n            <input class="form-control note-autocomplete" placeholder="search for note by its name">\n        </div>\n    </div>\n</div>'),this.$autoComplete=this.$widget.find(".note-autocomplete"),i.Z.initNoteAutocomplete(this.$autoComplete,{hideGoToSelectedNoteButton:!0}).on("autocomplete:selected",(function(e,n,o){if(!n.path)return!1;t.default.tabManager.getActiveTabContext().setNote(n.path)})),i.Z.showRecentNotes(this.$autoComplete),this.$widget}doRefresh(t){this.$autoComplete.trigger("focus")}},deleted:class extends K{static getType(){return"deleted"}doRender(){return this.$widget=$('\n<div class="note-detail-deleted note-detail-printable">\n    <div style="padding: 100px;">\n        <div class="alert alert-warning" style="padding: 20px;">\n            This note has been deleted.\n        </div>\n    </div>\n</div>'),this.$widget}},"editable-text":class extends X{static getType(){return"editable-text"}doRender(){return this.$widget=$('\n<div class="note-detail-text note-detail-printable">\n    <style>\n    .note-detail-text h1 { font-size: 2.0em; }\n    .note-detail-text h2 { font-size: 1.8em; }\n    .note-detail-text h3 { font-size: 1.6em; }\n    .note-detail-text h4 { font-size: 1.4em; }\n    .note-detail-text h5 { font-size: 1.2em; }\n    .note-detail-text h6 { font-size: 1.1em; }\n    \n    .note-detail-text {\n        overflow: auto;\n        height: 100%;\n        font-family: var(--detail-text-font-family);\n        padding-left: 12px;\n    }\n    \n    .note-detail-text-editor {\n        padding-top: 10px;\n        border: 0 !important;\n        box-shadow: none !important;\n        /* This is because with empty content height of editor is 0 and it\'s impossible to click into it */\n        min-height: 500px;\n    }\n    \n    .note-detail-text p:first-child, .note-detail-text::before {\n        margin-top: 0;\n    }\n    </style>\n\n    <div class="note-detail-text-editor" tabindex="10000"></div>\n</div>\n'),this.$editor=this.$widget.find(".note-detail-text-editor"),this.initialized=this.initEditor(),f.default.setupActionsForElement("text-detail",this.$widget,this),super.doRender(),this.$widget}async initEditor(){await G.Z.requireLibrary(G.Z.CKEDITOR);const t=(await z.Z.getMimeTypes()).filter(t=>t.enabled).map(t=>({language:t.mime.toLowerCase().replace(/[\W_]+/g,"-"),label:t.title}));this.$widget.show(),this.textEditor=await BalloonEditor.create(this.$editor[0],{placeholder:"Type the content of your note here ...",mention:tt,codeBlock:{languages:t}}),this.textEditor.model.document.on("change:data",()=>this.spacedUpdate.scheduleUpdate()),glob.isDev}async doRefresh(t){const e=await S.Z.getNoteComplement(t.noteId);await this.spacedUpdate.allowUpdateWithoutChange(()=>{this.textEditor.setData(e.content)})}getContent(){const t=this.textEditor.getData();return e.Z.isHtmlEmpty(t)?"":t}focus(){this.$editor.trigger("focus")}show(){}getEditor(){return this.textEditor}cleanup(){this.textEditor&&this.spacedUpdate.allowUpdateWithoutChange(()=>{this.textEditor.setData("")})}insertDateTimeToTextCommand(){const t=new Date,n=e.Z.formatDateTime(t);this.addTextToEditor(n)}async addLinkToEditor(t,e){await this.initialized,this.textEditor.model.change(n=>{const o=this.textEditor.model.document.selection.getFirstPosition();n.insertText(e,{linkHref:t},o)})}async addTextToEditor(t){await this.initialized,this.textEditor.model.change(e=>{const n=this.textEditor.model.document.selection.getFirstPosition();e.insertText(t,n)})}addTextToActiveEditorEvent(t){this.isActive()&&this.addTextToEditor(t)}async addLink(t,e){await this.initialized,e?this.hasSelection()?this.textEditor.execute("link","#"+t):await this.addLinkToEditor("#"+t,e):this.textEditor.execute("referenceLink",{notePath:t}),this.textEditor.editing.view.focus()}hasSelection(){return!this.textEditor.model.document.selection.isCollapsed}async executeInActiveEditorEvent({callback:t}){this.isActive()&&(await this.initialized,t(this.textEditor))}addLinkToTextCommand(){__webpack_require__.e(741).then(__webpack_require__.bind(__webpack_require__,4741)).then(t=>t.showDialog(this))}addIncludeNoteToTextCommand(){__webpack_require__.e(908).then(__webpack_require__.bind(__webpack_require__,7908)).then(t=>t.showDialog(this))}addIncludeNote(t,e){this.textEditor.model.change(n=>{this.textEditor.model.insertContent(n.createElement("includeNote",{noteId:t,boxSize:e}))})}async addImage(t){const e=await S.Z.getNote(t);this.textEditor.model.change(t=>{const n=`api/images/${e.noteId}/${e.title}`,o=t.createElement("image",{src:n});this.textEditor.model.insertContent(o,this.textEditor.model.document.selection)})}async refreshIncludedNoteEvent({noteId:t}){this.refreshIncludedNote(this.$editor,t)}},"read-only-text":class extends X{static getType(){return"read-only-text"}doRender(){return this.$widget=$('\n<div class="note-detail-readonly-text note-detail-printable">\n    <style>\n    .note-detail-readonly-text h1 { font-size: 2.0em; }\n    .note-detail-readonly-text h2 { font-size: 1.8em; }\n    .note-detail-readonly-text h3 { font-size: 1.6em; }\n    .note-detail-readonly-text h4 { font-size: 1.4em; }\n    .note-detail-readonly-text h5 { font-size: 1.2em; }\n    .note-detail-readonly-text h6 { font-size: 1.1em; }\n    \n    .note-detail-readonly-text {\n        overflow: auto;\n        height: 100%;\n        padding: 10px;\n        font-family: var(--detail-text-font-family);\n    }\n        \n    .note-detail-readonly-text p:first-child, .note-detail-text::before {\n        margin-top: 0;\n    }\n    \n    .note-detail-readonly-text img {\n        max-width: 100%;\n    }\n    </style>\n\n    <div class="alert alert-warning no-print">\n        Read only text view is shown. <a href="#" class="edit-note">Click here</a> to edit the note.\n    </div>\n\n    <div class="note-detail-readonly-text-content ck-content"></div>\n</div>\n'),this.$content=this.$widget.find(".note-detail-readonly-text-content"),this.$widget.find("a.edit-note").on("click",()=>{this.tabContext.textPreviewDisabled=!0,this.triggerEvent("textPreviewDisabled",{tabContext:this.tabContext})}),super.doRender(),this.$widget}cleanup(){this.$content.html("")}scrollToTop(){this.$content.scrollTop(0)}async doRefresh(t){const e=await S.Z.getNoteComplement(t.noteId);this.$content.html(e.content),this.$content.find("a.reference-link").each(async(t,e)=>{const n=$(e).attr("href"),o=w.Z.getNoteIdFromNotePath(n);this.loadReferenceLinkTitle(o,$(e))}),this.$content.find("section").each(async(t,e)=>{const n=$(e).attr("data-note-id");this.loadIncludedNote(n,$(e))})}async refreshIncludedNoteEvent({noteId:t}){this.refreshIncludedNote(this.$content,t)}},"editable-code":class extends K{static getType(){return"editable-code"}doRender(){return this.$widget=$('\n<div class="note-detail-code note-detail-printable">\n    <style>\n    .note-detail-code {\n        overflow: auto;\n        height: 100%;\n    }\n    \n    .note-detail-code-editor {\n        min-height: 500px;\n    }\n    </style>\n\n    <div class="note-detail-code-editor"></div>\n</div>'),this.$editor=this.$widget.find(".note-detail-code-editor"),f.default.setupActionsForElement("code-detail",this.$widget,this),this.initialized=this.initEditor(),this.$widget}async initEditor(){await G.Z.requireLibrary(G.Z.CODE_MIRROR),CodeMirror.keyMap.default["Shift-Tab"]="indentLess",CodeMirror.keyMap.default.Tab="indentMore",delete CodeMirror.keyMap.default["Alt-Left"],delete CodeMirror.keyMap.default["Alt-Right"],CodeMirror.modeURL="libraries/codemirror/mode/%N/%N.js",this.codeEditor=CodeMirror(this.$editor[0],{value:"",viewportMargin:1/0,indentUnit:4,matchBrackets:!0,matchTags:{bothTags:!0},highlightSelectionMatches:{showToken:/\w/,annotateScrollbar:!1},lint:!0,gutters:["CodeMirror-lint-markers"],lineNumbers:!0,tabindex:100,lineWrapping:!0,dragDrop:!1}),this.codeEditor.on("change",()=>this.spacedUpdate.scheduleUpdate())}async doRefresh(t){const e=await this.tabContext.getNoteComplement();this.spacedUpdate.allowUpdateWithoutChange(()=>{this.codeEditor.setValue(e.content||""),this.codeEditor.clearHistory();const n=CodeMirror.findModeByMIME(t.mime);n&&(this.codeEditor.setOption("mode",n.mime),CodeMirror.autoLoadMode(this.codeEditor,n.mode))}),this.show()}show(){this.$widget.show(),this.codeEditor&&this.codeEditor.refresh()}getContent(){return this.codeEditor.getValue()}focus(){this.codeEditor.focus()}cleanup(){this.codeEditor&&this.spacedUpdate.allowUpdateWithoutChange(()=>{this.codeEditor.setValue("")})}},"read-only-code":class extends K{static getType(){return"read-only-code"}doRender(){return this.$widget=$('\n<div class="note-detail-read-only-code note-detail-printable">\n    <style>\n    .note-detail-read-only-code {\n        overflow: auto;\n        height: 100%;\n    }\n    \n    .note-detail-read-only-code-content {\n        padding: 10px;\n    }\n    </style>\n\n    <div class="alert alert-warning no-print" style="margin-bottom: 0;">\n        Read only code view is shown. <a href="#" class="edit-note">Click here</a> to edit the note.\n    </div>\n\n    <pre class="note-detail-read-only-code-content"></pre>\n</div>'),this.$content=this.$widget.find(".note-detail-read-only-code-content"),this.$widget.find("a.edit-note").on("click",()=>{this.tabContext.codePreviewDisabled=!0,this.triggerEvent("codePreviewDisabled",{tabContext:this.tabContext})}),this.$widget}async doRefresh(t){const e=await this.tabContext.getNoteComplement();this.$content.text(e.content)}},file:class extends K{static getType(){return"file"}doRender(){return this.$widget=$('\n<div class="note-detail-file note-detail-printable">\n    <style>\n        .file-table td {\n            overflow-wrap: anywhere;\n        }\n    </style>\n\n    <table class="file-table">\n        <tr>\n            <th>Note ID:</th>\n            <td class="file-note-id"></td>\n            <th>Original file name:</th>\n            <td class="file-filename"></td>\n        </tr>\n        <tr>\n            <th>File type:</th>\n            <td class="file-filetype"></td>\n            <th>File size:</th>\n            <td class="file-filesize"></td>\n        </tr>\n    </table>\n    \n    <pre class="file-preview-content"></pre>\n    \n    <iframe class="pdf-preview" style="width: 100%; height: 100%; flex-grow: 100;"></iframe>\n\n    <div style="padding: 10px; display: flex; justify-content: space-evenly;">\n        <button class="file-download btn btn-sm btn-primary" type="button">Download</button>\n        &nbsp;\n        <button class="file-open btn btn-sm btn-primary" type="button">Open</button>\n        &nbsp;\n        <button class="file-upload-new-revision btn btn-sm btn-primary">Upload new revision</button>\n    \n        <input type="file" class="file-upload-new-revision-input" style="display: none">\n    </div>\n</div>'),this.$fileNoteId=this.$widget.find(".file-note-id"),this.$fileName=this.$widget.find(".file-filename"),this.$fileType=this.$widget.find(".file-filetype"),this.$fileSize=this.$widget.find(".file-filesize"),this.$previewContent=this.$widget.find(".file-preview-content"),this.$pdfPreview=this.$widget.find(".pdf-preview"),this.$downloadButton=this.$widget.find(".file-download"),this.$openButton=this.$widget.find(".file-open"),this.$uploadNewRevisionButton=this.$widget.find(".file-upload-new-revision"),this.$uploadNewRevisionInput=this.$widget.find(".file-upload-new-revision-input"),this.$downloadButton.on("click",()=>e.Z.download(this.getFileUrl())),this.$openButton.on("click",()=>{if(e.Z.isElectron()){e.Z.dynamicRequire("open")(this.getFileUrl(),{url:!0})}else window.location.href=this.getFileUrl()}),this.$uploadNewRevisionButton.on("click",()=>{this.$uploadNewRevisionInput.trigger("click")}),this.$uploadNewRevisionInput.on("change",async()=>{const t=this.$uploadNewRevisionInput[0].files[0];this.$uploadNewRevisionInput.val("");const e=new FormData;e.append("upload",t),(await $.ajax({url:baseApiUrl+"notes/"+this.noteId+"/file",headers:l.Z.getHeaders(),data:e,type:"PUT",timeout:36e5,contentType:!1,processData:!1})).uploaded?(h.default.showMessage("New file revision has been uploaded."),this.refresh()):h.default.showError("Upload of a new file revision failed.")}),this.$widget}async doRefresh(t){const n=t.getAttributes(),o=e.Z.toObject(n,t=>[t.name,t.value]);this.$widget.show(),this.$fileNoteId.text(t.noteId),this.$fileName.text(o.originalFileName||"?"),this.$fileSize.text(t.contentLength+" bytes"),this.$fileType.text(t.mime);const i=await this.tabContext.getNoteComplement();this.$previewContent.empty().hide(),this.$pdfPreview.attr("src","").empty().hide(),i.content?(this.$previewContent.show(),this.$previewContent.text(i.content)):"application/pdf"===t.mime&&e.Z.isElectron()&&(this.$pdfPreview.show(),this.$pdfPreview.attr("src",e.Z.getUrlForDownload("api/notes/"+this.noteId+"/open"))),this.$openButton.toggle(!t.isProtected)}getFileUrl(){return e.Z.getUrlForDownload("api/notes/"+this.noteId+"/download")}},image:et,search:class extends K{static getType(){return"search"}doRender(){return this.$widget=$('\n<div class="note-detail-search note-detail-printable">\n    <div style="display: flex; align-items: center; margin-right: 20px; margin-top: 15px;">\n        <strong>Search string: &nbsp; &nbsp;</strong>\n        <textarea rows="4" style="width: auto !important; flex-grow: 4" class="search-string form-control"></textarea>\n    </div>\n\n    <br />\n\n    <div class="note-detail-search-help"></div>\n</div>'),this.$searchString=this.$widget.find(".search-string"),this.$component=this.$widget.find(".note-detail-search"),this.$help=this.$widget.find(".note-detail-search-help"),this.$widget}async doRefresh(t){this.$help.html(window.glob.SEARCH_HELP_TEXT),this.$component.show();try{const t=await this.tabContext.getNoteComplement(),e=JSON.parse(t.content);this.$searchString.val(e.searchString)}catch(t){console.log(t),this.$searchString.val("")}this.$searchString.on("input",()=>this.spacedUpdate.scheduleUpdate())}getContent(){return JSON.stringify({searchString:this.$searchString.val()})}},render:class extends K{static getType(){return"render"}doRender(){return this.$widget=$('\n<div class="note-detail-render note-detail-printable">\n    <style>\n        .note-detail-render {\n            height: 100%;\n        }\n    </style>\n\n    <div class="note-detail-render-help alert alert-warning" style="margin: 50px; padding: 20px;">\n        <p><strong>This help note is shown because this note of type Render HTML doesn\'t have required relation to function properly.</strong></p>\n\n        <p>Render HTML note type is used for <a href="https://github.com/zadam/trilium/wiki/Scripts">scripting</a>. In short, you have a HTML code note (optionally with some JavaScript) and this note will render it. To make it work, you need to define a relation (in <a class="show-attributes-button">Attributes dialog</a>) called "renderNote" pointing to the HTML note to render. Once that\'s defined you can click on the "play" button to render.</p>\n    </div>\n\n    <div class="note-detail-render-content" style="height: 100%; overflow: auto;"></div>\n</div>'),this.$noteDetailRenderHelp=this.$widget.find(".note-detail-render-help"),this.$noteDetailRenderContent=this.$widget.find(".note-detail-render-content"),this.$widget}async doRefresh(t){this.$widget.show(),this.$noteDetailRenderHelp.hide(),await Q.render(t,this.$noteDetailRenderContent)||this.$noteDetailRenderHelp.show()}cleanup(){this.$noteDetailRenderContent.empty()}renderActiveNoteEvent(){this.tabContext.isActive()&&this.refresh()}},"relation-map":class extends K{static getType(){return"relation-map"}doRender(){return this.$widget=$('\n<div class="note-detail-relation-map note-detail-printable">\n    <button class="relation-map-create-child-note btn btn-sm floating-button no-print" type="button"\n            title="Create new child note and add it into this relation map">\n        <span class="bx bx-folder-plus"></span>\n\n        Create child note\n    </button>\n\n    <button type="button"\n            class="relation-map-reset-pan-zoom btn icon-button floating-button bx bx-crop no-print"\n            title="Reset pan & zoom to initial coordinates and magnification"\n            style="right: 70px;"></button>\n\n    <div class="btn-group floating-button no-print" style="right: 10px;">\n        <button type="button"\n                class="relation-map-zoom-in btn icon-button bx bx-zoom-in"\n                title="Zoom In"></button>\n\n        <button type="button"\n                class="relation-map-zoom-out btn icon-button bx bx-zoom-out"\n                title="Zoom Out"></button>\n    </div>\n\n    <div class="relation-map-wrapper">\n       <div class="relation-map-container"></div>\n    </div>\n</div>'),this.$relationMapContainer=this.$widget.find(".relation-map-container"),this.$createChildNote=this.$widget.find(".relation-map-create-child-note"),this.$zoomInButton=this.$widget.find(".relation-map-zoom-in"),this.$zoomOutButton=this.$widget.find(".relation-map-zoom-out"),this.$resetPanZoomButton=this.$widget.find(".relation-map-reset-pan-zoom"),this.mapData=null,this.jsPlumbInstance=null,this.relations=null,this.pzInstance=null,this.$relationMapWrapper=this.$widget.find(".relation-map-wrapper"),this.$relationMapWrapper.on("click",t=>{if(this.clipboard){let{x:e,y:n}=this.getMousePosition(t);e-=80,n-=15,this.createNoteBox(this.clipboard.noteId,this.clipboard.title,e,n),this.mapData.notes.push({noteId:this.clipboard.noteId,x:e,y:n}),this.saveData(),this.clipboard=null}return!0}),this.$relationMapContainer.attr("id","relation-map-container-"+rt++),this.$relationMapContainer.on("contextmenu",".note-box",t=>(r.Z.show({x:t.pageX,y:t.pageY,items:[{title:"Open in new tab",command:"openInNewTab",uiIcon:"empty"},{title:"Remove note",command:"remove",uiIcon:"trash"},{title:"Edit title",command:"editTitle",uiIcon:"pencil"}],selectMenuItemHandler:({command:e})=>this.contextMenuHandler(e,t.target)}),!1)),this.clipboard=null,this.$createChildNote.on("click",async()=>{const t=await __webpack_require__.e(119).then(__webpack_require__.bind(__webpack_require__,1119)),e=await t.ask({message:"Enter title of new note",defaultValue:"new note"});if(!e.trim())return;const{note:n}=await l.Z.post(`notes/${this.noteId}/children?target=into`,{title:e,content:"",type:"text"});h.default.showMessage("Click on canvas to place new note"),this.clipboard={noteId:n.noteId,title:e}}),this.$resetPanZoomButton.on("click",()=>{this.pzInstance.zoomTo(0,0,1/this.getZoom()),this.pzInstance.moveTo(0,0)}),this.$widget.on("drop",t=>this.dropNoteOntoRelationMapHandler(t)),this.$widget.on("dragover",t=>t.preventDefault()),this.initialized=new Promise(async t=>{await G.Z.requireLibrary(G.Z.RELATION_MAP),jsPlumb.ready(t)}),this.$widget}async contextMenuHandler(n,o){const i=$(o).closest(".note-box"),s=i.find(".title a"),a=this.idToNoteId(i.prop("id"));if("openInNewTab"===n)t.default.tabManager.openTabWithNote(a);else if("remove"===n){const t=await __webpack_require__.e(590).then(__webpack_require__.bind(__webpack_require__,590));if(!await t.confirmDeleteNoteBoxWithNote(s.text()))return;if(this.jsPlumbInstance.remove(this.noteIdToId(a)),t.isDeleteNoteChecked()){const t=e.Z.randomString(10);await l.Z.remove(`notes/${a}?taskId=${t}&last=true`)}this.mapData.notes=this.mapData.notes.filter(t=>t.noteId!==a),this.relations=this.relations.filter(t=>t.sourceNoteId!==a&&t.targetNoteId!==a),this.saveData()}else if("editTitle"===n){const t=await __webpack_require__.e(119).then(__webpack_require__.bind(__webpack_require__,1119)),e=await t.ask({message:"Enter new note title:",defaultValue:s.text()});if(!e)return;await l.Z.put(`notes/${a}/change-title`,{title:e}),s.text(e)}}async loadMapData(){this.mapData={notes:[],transform:{x:0,y:0,scale:1}};const t=await this.tabContext.getNoteComplement();if(t.content)try{this.mapData=JSON.parse(t.content)}catch(t){console.log("Could not parse content: ",t)}}noteIdToId(t){return"rel-map-note-"+t}idToNoteId(t){return t.substr(13)}async doRefresh(t){await this.loadMapData(),this.initJsPlumbInstance(),this.initPanZoom(),this.loadNotesAndRelations()}clearMap(){this.jsPlumbInstance.deleteEveryEndpoint(),this.$relationMapContainer.empty()}async loadNotesAndRelations(){const t=this.mapData.notes.map(t=>t.noteId),e=await l.Z.post("notes/relation-map",{noteIds:t});this.relations=[];for(const t of e.relations){const n=this.relations.find(n=>n.name===e.inverseRelations[t.name]&&(n.sourceNoteId===t.sourceNoteId&&n.targetNoteId===t.targetNoteId||n.sourceNoteId===t.targetNoteId&&n.targetNoteId===t.sourceNoteId));n?(n.type=t.type=t.name===e.inverseRelations[t.name]?"biDirectional":"inverse",t.render=!1):(t.type="uniDirectional",t.render=!0),this.relations.push(t)}this.mapData.notes=this.mapData.notes.filter(t=>t.noteId in e.noteTitles),this.jsPlumbInstance.batch(async()=>{this.clearMap();for(const t of this.mapData.notes){const n=e.noteTitles[t.noteId];await this.createNoteBox(t.noteId,n,t.x,t.y)}for(const t of this.relations){if(!t.render)continue;const n=this.jsPlumbInstance.connect({source:this.noteIdToId(t.sourceNoteId),target:this.noteIdToId(t.targetNoteId),type:t.type});n.id=t.attributeId,"inverse"===t.type?(n.getOverlay("label-source").setLabel(t.name),n.getOverlay("label-target").setLabel(e.inverseRelations[t.name])):n.getOverlay("label").setLabel(t.name),n.canvas.setAttribute("data-connection-id",n.id)}})}initPanZoom(){this.pzInstance||(this.pzInstance=panzoom(this.$relationMapContainer[0],{maxZoom:2,minZoom:.3,smoothScroll:!1,filterKey:function(t,e,n,o){return t.altKey}}),this.pzInstance.on("transform",()=>{this.jsPlumbInstance.setZoom(this.getZoom()),this.saveCurrentTransform()}),this.mapData.transform?(this.pzInstance.zoomTo(0,0,this.mapData.transform.scale),this.pzInstance.moveTo(this.mapData.transform.x,this.mapData.transform.y)):this.pzInstance.moveTo(0,0),this.$zoomInButton.on("click",()=>this.pzInstance.zoomTo(0,0,1.2)),this.$zoomOutButton.on("click",()=>this.pzInstance.zoomTo(0,0,.8)))}saveCurrentTransform(){const t=this.pzInstance.getTransform();JSON.stringify(t)!==JSON.stringify(this.mapData.transform)&&(this.mapData.transform=JSON.parse(JSON.stringify(t)),this.saveData())}cleanup(){this.jsPlumbInstance&&this.clearMap(),this.pzInstance&&(this.pzInstance.dispose(),this.pzInstance=null)}initJsPlumbInstance(){this.jsPlumbInstance?this.cleanup():(this.jsPlumbInstance=jsPlumb.getInstance({Endpoint:["Dot",{radius:2}],Connector:"StateMachine",ConnectionOverlays:ot,HoverPaintStyle:{stroke:"#777",strokeWidth:1},Container:this.$relationMapContainer.attr("id")}),this.jsPlumbInstance.registerConnectionType("uniDirectional",{anchor:"Continuous",connector:"StateMachine",overlays:ot}),this.jsPlumbInstance.registerConnectionType("biDirectional",{anchor:"Continuous",connector:"StateMachine",overlays:it}),this.jsPlumbInstance.registerConnectionType("inverse",{anchor:"Continuous",connector:"StateMachine",overlays:st}),this.jsPlumbInstance.registerConnectionType("link",{anchor:"Continuous",connector:"StateMachine",overlays:at}),this.jsPlumbInstance.bind("connection",(t,e)=>this.connectionCreatedHandler(t,e)))}async connectionCreatedHandler(t,e){const n=t.connection;if(n.bind("contextmenu",(t,e)=>{n.getType().includes("link")?e.preventDefault():(e.preventDefault(),e.stopPropagation(),r.Z.show({x:e.pageX,y:e.pageY,items:[{title:"Remove relation",command:"remove",uiIcon:"trash"}],selectMenuItemHandler:async({command:t})=>{if("remove"===t){const t=await __webpack_require__.e(590).then(__webpack_require__.bind(__webpack_require__,590));if(!await t.confirm("Are you sure you want to remove the relation?"))return;const e=this.relations.find(t=>t.attributeId===n.id);await l.Z.remove(`notes/${e.sourceNoteId}/relations/${e.name}/to/${e.targetNoteId}`),this.jsPlumbInstance.deleteConnection(n),this.relations=this.relations.filter(t=>t.attributeId!==n.id)}}}))}),!e)return;const o=await __webpack_require__.e(119).then(__webpack_require__.bind(__webpack_require__,1119)),i=await o.ask({message:"Specify new relation name:",shown:({$answer:t})=>nt.Z.initAttributeNameAutocomplete({$el:t,attributeType:"relation",open:!0})});if(!i||!i.trim())return void this.jsPlumbInstance.deleteConnection(n);const s=this.idToNoteId(n.target.id),a=this.idToNoteId(n.source.id);if(this.relations.some(t=>t.targetNoteId===s&&t.sourceNoteId===a&&t.name===i)){const t=await __webpack_require__.e(57).then(__webpack_require__.bind(__webpack_require__,4057));return await t.info("Connection '"+i+"' between these notes already exists."),void this.jsPlumbInstance.deleteConnection(n)}await l.Z.put(`notes/${a}/relations/${i}/to/${s}`),this.loadNotesAndRelations()}saveData(){this.spacedUpdate.scheduleUpdate()}async createNoteBox(t,e,n,o){const i=await L.Z.createNoteLink(t,{title:e});i.mousedown(t=>{console.log(t),L.Z.goToLink(t)});const s=$("<div>").addClass("note-box").prop("id",this.noteIdToId(t)).append($("<span>").addClass("title").append(i)).append($("<div>").addClass("endpoint").attr("title","Start dragging relations from here and drop them on another note.")).css("left",n+"px").css("top",o+"px");this.jsPlumbInstance.getContainer().appendChild(s[0]),this.jsPlumbInstance.draggable(s[0],{start:t=>{},drag:t=>{},stop:t=>{const e=this.idToNoteId(t.el.id),n=this.mapData.notes.find(t=>t.noteId===e);n?([n.x,n.y]=t.finalPos,this.saveData()):console.error(`Note ${e} not found!`)}}),this.jsPlumbInstance.makeSource(s[0],{filter:".endpoint",anchor:"Continuous",connectorStyle:{stroke:"#000",strokeWidth:1},connectionType:"basic",extract:{action:"the-action"}}),this.jsPlumbInstance.makeTarget(s[0],{dropOptions:{hoverClass:"dragHover"},anchor:"Continuous",allowLoopback:!0})}getZoom(){const t=this.$relationMapContainer.css("transform");if("none"===t)return 1;const e=t.match(/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*-?\d*\.?\d+,\s*-?\d*\.?\d+,\s*-?\d*\.?\d+\)/);if(!e)throw new Error("Cannot match transform: "+t);return e[1]}async dropNoteOntoRelationMapHandler(t){t.preventDefault();const e=JSON.parse(t.originalEvent.dataTransfer.getData("text"));let{x:n,y:o}=this.getMousePosition(t);for(const t of e){this.mapData.notes.some(e=>e.noteId===t.noteId)?h.default.showError(`Note "${t.title}" is already in the diagram.`):(this.mapData.notes.push({noteId:t.noteId,x:n,y:o}),n>1e3?(o+=100,n=0):n+=200)}this.saveData(),this.loadNotesAndRelations()}getMousePosition(t){const e=this.$relationMapContainer[0].getBoundingClientRect(),n=this.getZoom();return{x:(t.clientX-e.left)/n,y:(t.clientY-e.top)/n}}getContent(){return JSON.stringify(this.mapData)}},"protected-session":class extends K{static getType(){return"protected-session"}doRender(){return this.$widget=$('\n<div class="protected-session-password-component note-detail-printable">\n    <style>\n    .protected-session-password-component {\n        width: 300px;\n        margin: 30px auto auto;\n    }\n    </style>\n\n    <form class="protected-session-password-form">\n        <div class="form-group">\n            <label for="protected-session-password-in-detail">Showing protected note requires entering your password:</label>\n            <input class="protected-session-password-in-detail form-control protected-session-password" type="password">\n        </div>\n\n        <button class="btn btn-primary">Start protected session <kbd>enter</kbd></button>\n    </form>\n</div>'),this.$passwordForm=this.$widget.find(".protected-session-password-form"),this.$passwordInput=this.$widget.find(".protected-session-password"),this.$passwordForm.on("submit",()=>{const t=this.$passwordInput.val();return this.$passwordInput.val(""),v.Z.setupProtectedSession(t),!1}),this.$widget}},book:class extends K{static getType(){return"book"}doRender(){return this.$widget=$('\n<div class="note-detail-book note-detail-printable">\n    <div class="btn-group floating-button" style="right: 20px; top: 20px;">\n        <button type="button"\n                class="expand-children-button btn icon-button bx bx-move-vertical"\n                title="Expand all children"></button>\n\n        <button type="button"\n                class="book-zoom-in-button btn icon-button bx bx-zoom-in"\n                title="Zoom In"></button>\n\n        <button type="button"\n                class="book-zoom-out-button btn icon-button bx bx-zoom-out"\n                title="Zoom Out"></button>\n    </div>\n\n    <div class="note-detail-book-help alert alert-warning" style="margin: 50px; padding: 20px;">\n        This note of type Book doesn\'t have any child notes so there\'s nothing to display. See <a href="https://github.com/zadam/trilium/wiki/Book-note">wiki</a> for details.\n    </div>\n\n    <div class="note-detail-book-content"></div>\n</div>'),this.$content=this.$widget.find(".note-detail-book-content"),this.$zoomInButton=this.$widget.find(".book-zoom-in-button"),this.$zoomOutButton=this.$widget.find(".book-zoom-out-button"),this.$expandChildrenButton=this.$widget.find(".expand-children-button"),this.$help=this.$widget.find(".note-detail-book-help"),this.$zoomInButton.on("click",()=>this.setZoom(this.zoomLevel-1)),this.$zoomOutButton.on("click",()=>this.setZoom(this.zoomLevel+1)),this.$expandChildrenButton.on("click",async()=>{for(let t=1;t<30;t++){const t=this.$content.find(".note-book-open-children-button:visible");if(0===t.length)break;for(const e of t){const t=$(e).closest(".note-book-card");await this.expandCard(t)}}}),this.$content.on("click",".note-book-open-children-button",async t=>{const e=$(t.target).closest(".note-book-card");await this.expandCard(e)}),this.$content.on("click",".note-book-hide-children-button",async t=>{const e=$(t.target).closest(".note-book-card");e.find(".note-book-open-children-button").show(),e.find(".note-book-hide-children-button").hide(),e.find(".note-book-children-content").empty()}),this.$widget}async expandCard(t){const e=t.attr("data-note-id"),n=await S.Z.getNote(e);t.find(".note-book-open-children-button").hide(),t.find(".note-book-hide-children-button").show(),await this.renderIntoElement(n,t.find(".note-book-children-content"))}setZoom(t){t in dt||(t=this.getDefaultZoomLevel()),this.zoomLevel=t,this.$zoomInButton.prop("disabled",1===t),this.$zoomOutButton.prop("disabled",6===t),this.$content.find(".note-book-card").css("flex-basis",dt[t].width),this.$content.find(".note-book-content").css("max-height",dt[t].height)}async doRefresh(t){if(this.$content.empty(),this.$help.hide(),this.isAutoBook()){const t=$('<a href="javascript:">here</a>').on("click",()=>{this.tabContext.autoBookDisabled=!0,this.triggerEvent("autoBookDisabled",{tabContext:this.tabContext})});this.$content.append($('<div class="note-book-auto-message"></div>').append("This note doesn't have any content so we display its children. <br> Click ").append(t).append(" if you want to add some text."))}const e=parseInt(t.getLabelValue("bookZoomLevel"))||this.getDefaultZoomLevel();this.setZoom(e),await this.renderIntoElement(t,this.$content)}async renderIntoElement(t,e){const n=await t.getChildNotes();0===n.length&&this.$help.show();const o=t.getRelations("imageLink");for(const t of n){if(o.find(e=>e.value===t.noteId))continue;const n=await this.renderNote(t);e.append(n)}}async renderNote(t){const e=this.notePath+"/"+t.noteId,n=$('<div class="note-book-content">').css("max-height",dt[this.zoomLevel].height),o=$('<div class="note-book-card">').attr("data-note-id",t.noteId).css("flex-basis",dt[this.zoomLevel].width).append($('<h5 class="note-book-title">').append(await L.Z.createNoteLink(e,{showTooltip:!1}))).append(n);try{const{type:e,renderedContent:i}=await Y.getRenderedContent(t);o.addClass("type-"+e),n.append(i)}catch(e){console.log(`Caught error while rendering note ${t.noteId} of type ${t.type}: ${e.message}, stack: ${e.stack}`),n.append("rendering error")}const i=t.getRelations("imageLink"),s=t.getChildNoteIds().filter(t=>!i.find(e=>e.value===t)).length;if(s>0){const t=`${s} child${s>1?"ren":""}`;o.append($('<div class="note-book-children">').append($(`<a class="note-book-open-children-button no-print" href="javascript:">+ Show ${t}</a>`)).append($(`<a class="note-book-hide-children-button no-print" href="javascript:">- Hide ${t}</a>`).hide()).append($('<div class="note-book-children-content">')))}return o}isAutoBook(){return"book"!==this.note.type}getDefaultZoomLevel(){if(this.isAutoBook()){const t=this.$widget.width();return t<=600?1:t<=900?2:t<=1300?3:4}return 1}cleanup(){this.$content.empty()}}};class lt extends A.Z{constructor(){super(),this.typeWidgets={},this.spacedUpdate=new W.Z(async()=>{const{note:t}=this.tabContext,{noteId:e}=t,n=t.dto;n.content=this.getTypeWidget().getContent(),q.Z.touchProtectedSessionIfNecessary(t),await l.Z.put("notes/"+e,n,this.componentId)})}isEnabled(){return!0}doRender(){return this.$widget=$('\n<div class="note-detail">\n    <style>\n    .note-detail {\n        height: 100%;\n        min-height: 0;\n        font-family: var(--detail-font-family);\n        font-size: var(--detail-font-size);\n    }\n    </style>\n</div>\n'),this.$widget.on("dragover",t=>t.preventDefault()),this.$widget.on("dragleave",t=>t.preventDefault()),this.$widget.on("drop",async e=>{const n=t.default.tabManager.getActiveTabNote();if(!n)return;const o=[...e.originalEvent.dataTransfer.files];(await __webpack_require__.e(274).then(__webpack_require__.bind(__webpack_require__,1274))).uploadFiles(n.noteId,o,{safeImport:!0,shrinkImages:!0,textImportedAsText:!0,codeImportedAsCode:!0,explodeArchives:!0})}),this.$widget}async refresh(){if(this.type=await this.getWidgetType(),this.mime=this.note?this.note.mime:null,!(this.type in this.typeWidgets)){const t=ct[this.type],e=this.typeWidgets[this.type]=new t;e.spacedUpdate=this.spacedUpdate,e.setParent(this);const n=e.render();f.default.updateDisplayedShortcuts(n),this.$widget.append(n),await e.handleEvent("setTabContext",{tabContext:this.tabContext}),await e.handleEvent("tabNoteSwitched",{tabContext:this.tabContext,notePath:this.tabContext.notePath}),this.child(e)}this.setupClasses()}setupClasses(){for(const t of Array.from(this.$widget[0].classList))"note-detail"===t||t.startsWith("hidden-")||this.$widget.removeClass(t);const t=this.note;t&&(this.$widget.addClass(t.getCssClass()),this.$widget.addClass(e.Z.getNoteTypeClass(t.type)),this.$widget.addClass(e.Z.getMimeTypeClass(t.mime)),this.$widget.toggleClass("protected",t.isProtected))}getTypeWidget(){if(!this.typeWidgets[this.type])throw new Error("Could not find typeWidget for type: "+this.type);return this.typeWidgets[this.type]}async getWidgetType(){const t=this.note;if(!t)return"empty";if(t.isDeleted)return"deleted";let n=t.type;if("text"===n&&!this.tabContext.autoBookDisabled&&t.hasChildren()&&e.Z.isDesktop()){const t=await this.tabContext.getNoteComplement();e.Z.isHtmlEmpty(t.content)&&(n="book")}if("text"===n&&!this.tabContext.textPreviewDisabled){const e=await this.tabContext.getNoteComplement();(t.hasLabel("readOnly")||e.content&&e.content.length>1e4&&!t.hasLabel("autoReadOnlyDisabled"))&&(n="read-only-text")}if("code"===n&&!this.tabContext.codePreviewDisabled){const e=await this.tabContext.getNoteComplement();(t.hasLabel("readOnly")||e.content&&e.content.length>3e4&&!t.hasLabel("autoReadOnlyDisabled"))&&(n="read-only-code")}return"text"===n&&(n="editable-text"),"code"===n&&(n="editable-code"),t.isProtected&&!q.Z.isProtectedSessionAvailable()&&(n="protected-session"),n}async focusOnDetailEvent({tabId:t}){if(this.tabContext.tabId===t){await this.refresh(),this.getTypeWidget().focus()}}async beforeNoteSwitchEvent({tabContext:t}){this.isTab(t.tabId)&&await this.spacedUpdate.updateNowIfNecessary()}async beforeTabRemoveEvent({tabId:t}){this.isTab(t)&&await this.spacedUpdate.updateNowIfNecessary()}async printActiveNoteEvent(){this.tabContext.isActive()&&(await G.Z.requireLibrary(G.Z.PRINT_THIS),this.$widget.find(".note-detail-printable:visible").printThis({header:$("<h2>").text(this.note&&this.note.title).prop("outerHTML"),footer:"<script>document.body.className += ' ck-content';<\/script>",importCSS:!1,loadCSS:["libraries/codemirror/codemirror.css","libraries/ckeditor/ckeditor-content.css","libraries/ckeditor/ckeditor-content.css","libraries/bootstrap/css/bootstrap.min.css","stylesheets/print.css","stylesheets/relation_map.css","stylesheets/themes.css","stylesheets/detail.css"],debug:!0}))}hoistedNoteChangedEvent(){this.refresh()}async entitiesReloadedEvent({loadResults:t}){if(t.isNoteContentReloaded(this.noteId,this.componentId)||t.isNoteReloaded(this.noteId,this.componentId)&&(this.type!==await this.getWidgetType()||this.mime!==this.note.mime))this.handleEvent("noteTypeMimeChanged",{noteId:this.noteId});else{const e=t.getAttributes(),n=e.find(t=>"label"===t.type&&["readOnly","autoReadOnlyDisabled","cssClass","bookZoomLevel"].includes(t.name)&&t.isAffecting(this.note)),o=e.find(t=>"relation"===t.type&&["template","renderNote"].includes(t.name)&&t.isAffecting(this.note));(n||o)&&this.handleEvent("noteTypeMimeChanged",{noteId:this.noteId})}}beforeUnloadEvent(){this.spacedUpdate.updateNowIfNecessary()}autoBookDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}textPreviewDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}codePreviewDisabledEvent({tabContext:t}){this.isTab(t.tabId)&&this.refresh()}async cutIntoNoteCommand(){const e=t.default.tabManager.getActiveTabNote();e&&N.Z.createNote(e.noteId,{isProtected:e.isProtected,saveSelection:!0})}}var ht=__webpack_require__(2078);class pt extends ht.Z{get widgetTitle(){return"Note info"}async doRenderBody(){this.$body.html('\n<table class="note-info-widget-table">\n    <style>\n        .note-info-widget-table {\n            width: 100%;\n        } \n   \n        .note-info-widget-table td, .note-info-widget-table th {\n            padding: 5px;\n        }\n        \n        .note-info-mime {\n            max-width: 13em;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n    </style>\n\n    <tr>\n        <th>Note ID:</th>\n        <td class="note-info-note-id"></td>\n    </tr>\n    <tr>\n        <th>Created:</th>\n        <td class="note-info-date-created"></td>\n    </tr>\n    <tr>\n        <th>Modified:</th>\n        <td class="note-info-date-modified"></td>\n    </tr>\n    <tr>\n        <th>Type:</th>\n        <td>\n            <span class="note-info-type"></span>\n            \n            <span class="note-info-mime"></span>\n        </td>\n    </tr>\n</table>\n'),this.$noteId=this.$body.find(".note-info-note-id"),this.$dateCreated=this.$body.find(".note-info-date-created"),this.$dateModified=this.$body.find(".note-info-date-modified"),this.$type=this.$body.find(".note-info-type"),this.$mime=this.$body.find(".note-info-mime")}async refreshWithNote(t){const e=await this.tabContext.getNoteComplement();this.$noteId.text(t.noteId),this.$dateCreated.text(e.dateCreated.substr(0,16)).attr("title",e.dateCreated),this.$dateModified.text(e.dateModified.substr(0,16)).attr("title",e.dateCreated),this.$type.text(t.type),t.mime?this.$mime.text("("+t.mime+")"):this.$mime.empty()}entitiesReloadedEvent({loadResults:t}){t.isNoteReloaded(this.noteId)&&this.refresh()}}var ut=__webpack_require__(383);class gt extends ht.Z{get widgetTitle(){return"Calendar"}isEnabled(){return super.isEnabled()&&this.note.hasOwnedLabel("dateNote")}async doRenderBody(){await G.Z.requireLibrary(G.Z.CALENDAR_WIDGET),this.$body.html('\n<div class="calendar-widget">\n  <div class="calendar-header">\n    <button class="calendar-btn bx bx-left-arrow-alt" data-calendar-toggle="previous"></button>\n\n    <div class="calendar-header-label" data-calendar-label="month">\n      March 2017\n    </div>\n\n    <button class="calendar-btn bx bx-right-arrow-alt" data-calendar-toggle="next"></button>\n  </div>\n\n  <div class="calendar-week">\n    <span>Mon</span> <span>Tue</span><span>Wed</span> <span>Thu</span> <span>Fri</span> <span>Sat</span> <span>Sun</span>\n  </div>\n  <div class="calendar-body" data-calendar-area="month"></div>\n</div>\n'),this.$month=this.$body.find('[data-calendar-area="month"]'),this.$next=this.$body.find('[data-calendar-toggle="next"]'),this.$previous=this.$body.find('[data-calendar-toggle="previous"]'),this.$label=this.$body.find('[data-calendar-label="month"]'),this.$next.on("click",()=>{this.date.setMonth(this.date.getMonth()+1),this.createMonth()}),this.$previous.on("click",()=>{this.date.setMonth(this.date.getMonth()-1),this.createMonth()}),this.$body.on("click",".calendar-date",async e=>{const n=$(e.target).closest(".calendar-date").attr("data-calendar-date"),o=await ut.Z.getDateNote(n);o?t.default.tabManager.getActiveTabContext().setNote(o.noteId):alert("Cannot find day note")})}async refreshWithNote(t){this.init(this.$body,t.getOwnedLabelValue("dateNote"))}init(t,e){this.activeDate=new Date(e+"T12:00:00"),this.todaysDate=new Date,this.date=new Date(this.activeDate.getTime()),this.date.setDate(1),this.createMonth()}createDay(t,n,o){const i=$("<a>").addClass("calendar-date").attr("data-calendar-date",e.Z.formatDateISO(this.date)),s=$("<span>").html(n);1===n&&(0===o?i.css("marginLeft",6*14.28+"%"):i.css("marginLeft",14.28*(o-1)+"%"));const a=t[e.Z.formatDateISO(this.date)];return a&&(i.addClass("calendar-date-exists"),i.attr("data-note-path",a)),this.isEqual(this.date,this.activeDate)&&i.addClass("calendar-date-active"),this.isEqual(this.date,this.todaysDate)&&i.addClass("calendar-date-today"),i.append(s),i}isEqual(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}async createMonth(){const t=e.Z.formatDateISO(this.date).substr(0,7),n=await l.Z.get("date-notes/notes-for-month/"+t);this.$month.empty();const o=this.date.getMonth();for(;this.date.getMonth()===o;){const t=this.createDay(n,this.date.getDate(),this.date.getDay(),this.date.getFullYear());this.$month.append(t),this.date.setDate(this.date.getDate()+1)}this.date.setDate(1),this.date.setMonth(this.date.getMonth()-1),this.$label.html(this.monthsAsString(this.date.getMonth())+" "+this.date.getFullYear())}monthsAsString(t){return["January","Febuary","March","April","May","June","July","August","September","October","November","December"][t]}}class bt extends ht.Z{get widgetTitle(){return"Attributes"}get help(){return{title:"Attributes are key-value records owned by assigned to this note.",url:"https://github.com/zadam/trilium/wiki/Attributes"}}get headerActions(){const t=$("<a>").append("show dialog").addClass("widget-header-action");return t.on("click",async()=>{(await __webpack_require__.e(31).then(__webpack_require__.bind(__webpack_require__,6031))).showDialog()}),[t]}async refreshWithNote(t){const e=t.getOwnedAttributes(),n=$("<div>");await this.renderAttributes(e,n);const o=$("<span>").append($("<strong>").text("Inherited: ")),i=$("<a>").attr("href","javascript:").text("+show inherited").on("click",async()=>{const e=t.getAttributes().filter(t=>t.noteId!==this.noteId);0===e.length?o.text("No inherited attributes yet..."):await this.renderAttributes(e,o),o.show(),i.hide(),s.show()}),s=$("<a>").attr("href","javascript:").text("-hide inherited").on("click",()=>{i.show(),s.hide(),o.empty().hide()});n.append(i,o,s),o.hide(),s.hide(),this.$body.empty().append(n)}async renderAttributes(t,n){for(const o of t)"label"===o.type?n.append(e.Z.formatLabel(o)+" "):"relation"===o.type?o.value?(n.append("@"+o.name+"="),n.append(await L.Z.createNoteLink(o.value)),n.append(" ")):P.Z.logError(`Relation ${o.attributeId} has empty target`):"label-definition"===o.type||"relation-definition"===o.type?n.append(o.name+" definition "):P.Z.logError("Unknown attr type: "+o.type)}entitiesReloadedEvent({loadResults:t}){t.getAttributes().find(t=>t.noteId===this.noteId)&&this.refresh()}}let mt=1;class ft extends ht.Z{get widgetTitle(){return"Link map"}get help(){return{title:"Link map shows incoming and outgoing links from/to the current note.",url:"https://github.com/zadam/trilium/wiki/Link-map"}}get headerActions(){const t=$("<a>").append("show full").addClass("widget-header-action");return t.on("click",async()=>{(await __webpack_require__.e(694).then(__webpack_require__.bind(__webpack_require__,1694))).showDialog()}),[t]}decorateWidget(){this.$body.css("max-height","400px")}async refreshWithNote(t){const e=this.noteId;let n=!1;setTimeout(()=>{if(this.noteId===e){new IntersectionObserver(e=>{!n&&e[0].isIntersecting&&(n=!0,this.displayLinkMap(t))},{rootMargin:"0px",threshold:.1}).observe(this.$body[0])}},1e3)}async displayLinkMap(t){this.$body.css("opacity",0),this.$body.html('\n<div class="link-map-widget">\n    <div class="link-map-container" style="height: 300px;"></div>\n</div>\n');const e=this.$body.find(".link-map-container");e.attr("id","link-map-container-"+mt++);const n=(await __webpack_require__.e(409).then(__webpack_require__.bind(__webpack_require__,6409))).default;this.linkMapService=new n(t,e,{maxDepth:1,zoom:.6,stopCheckerCallback:()=>this.noteId!==t.noteId}),await this.linkMapService.render(),this.$body.animate({opacity:1},300)}cleanup(){this.linkMapService&&this.linkMapService.cleanup()}entitiesReloadedEvent({loadResults:t}){t.getAttributes().find(t=>"relation"===t.type&&(t.noteId===this.noteId||t.value===this.noteId))&&this.noteSwitched()}}class wt extends ht.Z{get widgetTitle(){return"Note revisions"}get help(){return{title:"Note revisions track changes in the note across the time.",url:"https://github.com/zadam/trilium/wiki/Note-revisions"}}get headerActions(){const t=$("<a>").append("show dialog").addClass("widget-header-action");return t.on("click",async()=>{(await __webpack_require__.e(387).then(__webpack_require__.bind(__webpack_require__,7387))).showCurrentNoteRevisions(this.noteId)}),[t]}noteSwitched(){const t=this.noteId;setTimeout(()=>{this.noteId===t&&this.refresh()},1e3)}async refreshWithNote(t){const e=await l.Z.get(`notes/${t.noteId}/revisions`);if(0===e.length)return void this.$body.text("No revisions yet...");if(t.noteId!==this.noteId)return;this.$body.html('\n<ul class="note-revision-list" style="max-height: 150px; overflow: auto;">\n</ul>\n');const n=this.$body.find(".note-revision-list");for(const o of e){const e=$("<li>").append($("<a>",{"data-action":"note-revision","data-note-path":t.noteId,"data-note-revision-id":o.noteRevisionId,title:"This revision was last edited on "+o.dateLastEdited,href:"javascript:"}).text(o.dateLastEdited.substr(0,16)));null!==o.contentLength&&e.append($("<span>").text(` (${o.contentLength} bytes)`)),n.append(e)}}entitiesReloadedEvent({loadResults:t}){t.hasNoteRevisionForNote(this.noteId)&&this.refresh()}}const yt=wt;class vt extends ht.Z{get widgetTitle(){return"Similar notes"}get help(){return{title:"This list contains notes which might be similar to the current note based on textual similarity of note title."}}noteSwitched(){const t=this.noteId;this.$body.empty(),setTimeout(()=>{this.noteId===t&&this.refresh()},1e3)}async refreshWithNote(t){this.title=t.title;const e=await l.Z.get("similar-notes/"+this.noteId);if(0===e.length)return void this.$body.text("No similar notes found ...");const n=e.flatMap(t=>t.notePath);await S.Z.getNotes(n,!0);const o=$("<ul>");for(const t of e){if(!await S.Z.getNote(t.noteId,!0))continue;const e=$("<li>").append(await L.Z.createNoteLink(t.notePath.join("/"),{showNotePath:!0}));o.append(e)}this.$body.empty().append(o)}entitiesReloadedEvent({loadResults:t}){this.note&&this.title!==this.note.title&&(this.rendered=!1,this.refresh())}}class xt extends ht.Z{get widgetTitle(){return"What links here"}get help(){return{title:"This list contains all notes which link to this note through links and relations."}}get headerActions(){const t=$("<a>").append("show link map").addClass("widget-header-action");return t.on("click",async()=>{(await __webpack_require__.e(694).then(__webpack_require__.bind(__webpack_require__,1694))).showDialog()}),[t]}async refreshWithNote(t){const e=t.getTargetRelations();if(0===e.length)return void this.$body.text("Nothing links here yet ...");const n=$("<ul>");let o=0;for(;o<e.length&&o<50;o++){const t=e[o],i=$("<li>").append(await L.Z.createNoteLink(t.noteId)).append($("<span>").text(" ("+t.name+")"));n.append(i)}o<e.length&&n.append($("<li>").text(e.length-o+" more links ...")),this.$body.empty().append(n)}entitiesReloadedEvent({loadResults:t}){t.getAttributes().find(t=>"relation"===t.type&&t.value===this.noteId)&&this.refresh()}}let It;const _t={setupSplit:function(t,e){if(It&&(It.destroy(),It=null),!t&&!e)return void $("#center-pane").css("width","100%");const n=b.Z.getInt("leftPaneWidth"),o=b.Z.getInt("rightPaneWidth");t&&e?It=Split(["#left-pane","#center-pane","#right-pane"],{sizes:[n,100-n-o,o],gutterSize:5,onDragEnd:t=>{b.Z.save("leftPaneWidth",Math.round(t[0])),b.Z.save("rightPaneWidth",Math.round(t[2]))}}):t?It=Split(["#left-pane","#center-pane"],{sizes:[n,100-n],gutterSize:5,onDragEnd:t=>{b.Z.save("leftPaneWidth",Math.round(t[0]))}}):e&&(It=Split(["#center-pane","#right-pane"],{sizes:[100-o,o],gutterSize:5,onDragEnd:t=>{b.Z.save("rightPaneWidth",Math.round(t[1]))}}))}};class $t extends d.Z{constructor(){super(),this.paneVisible={}}doRender(){return this.$widget=$('\n<div class="hide-in-zen-mode">\n    <style>\n    .hide-right-pane-button, .show-right-pane-button {\n        position: fixed;\n        bottom: 10px;\n        right: 10px;\n        z-index: 1000;\n    }\n    \n    .hide-left-pane-button, .show-left-pane-button {\n        position: fixed;\n        bottom: 10px;\n        left: 10px;\n        z-index: 1000;\n    }\n    </style>\n    \n    <button class="hide-left-pane-button btn btn-sm icon-button bx bx-chevrons-left" title="Show sidebar"></button>\n    <button class="show-left-pane-button btn btn-sm icon-button bx bx-chevrons-right" title="Hide sidebar"></button>\n            \n    <button class="hide-right-pane-button btn btn-sm icon-button bx bx-chevrons-right" title="Hide sidebar"></button>\n    <button class="show-right-pane-button btn btn-sm icon-button bx bx-chevrons-left" title="Show sidebar"></button>\n</div>\n'),this.$widget.find(".show-right-pane-button").on("click",()=>this.toggleAndSave("right",!0)),this.$widget.find(".hide-right-pane-button").on("click",()=>this.toggleAndSave("right",!1)),this.$widget.find(".show-left-pane-button").on("click",()=>this.toggleAndSave("left",!0)),this.$widget.find(".hide-left-pane-button").on("click",()=>this.toggleAndSave("left",!1)),this.$widget}toggleSidebar(t,e){$(`#${t}-pane`).toggle(e),this.$widget.find(`.show-${t}-pane-button`).toggle(!e),this.$widget.find(`.hide-${t}-pane-button`).toggle(e),this.paneVisible[t]=e}async toggleAndSave(t,e){await b.Z.save(t+"PaneVisible",e.toString()),this.toggleSidebar(t,e),_t.setupSplit(this.paneVisible.left,this.paneVisible.right),this.triggerEvent("sidebarVisibilityChanged",{side:t,show:e})}initialRenderCompleteEvent(){this.toggleSidebar("left",b.Z.is("leftPaneVisible")),this.toggleSidebar("right",b.Z.is("rightPaneVisible")),_t.setupSplit(this.paneVisible.left,this.paneVisible.right)}}class Ct extends ht.Z{get widgetTitle(){return"Edited notes on this day"}get help(){return{title:"This contains a list of notes created or updated on this day."}}isEnabled(){return super.isEnabled()&&this.note.hasOwnedLabel("dateNote")}async refreshWithNote(t){this.title=t.title;let e=await l.Z.get("edited-notes/"+t.getLabelValue("dateNote"));if(e=e.filter(e=>e.noteId!==t.noteId),0===e.length)return void this.$body.text("No edited notes on this day yet ...");const n=e.flatMap(t=>t.noteId);await S.Z.getNotes(n,!0);const o=$("<ul>");for(const t of e){const e=$("<li>");t.isDeleted?e.append($("<i>").text(t.title+" (deleted)")):e.append(t.notePath?await L.Z.createNoteLink(t.notePath.join("/"),{showNotePath:!0}):t.title),o.append(e)}this.$body.empty().append(o)}}class Nt{constructor(t){this.customWidgets=t}getRootWidget(t){return t.mainTreeWidget=new R("main"),new c("column").setParent(t).id("root-widget").css("height","100vh").child(new c("row").child(new u).child(new g.default).child(new m)).child((new x).hideInZenMode()).child(new c("row").collapsible().filling().child(new I("left").hideInZenMode().child(new C).child(new k).child(new T).child(new B.Z(()=>new O)).child(t.mainTreeWidget).child(...this.customWidgets.get("left-pane"))).child(new c("column").id("center-pane").child(new c("row").class("title-row").cssBlock(".title-row > * { margin: 5px; }").child(new j).child((new F).hideInZenMode()).child((new H).hideInZenMode()).child((new V).hideInZenMode())).child(new B.Z(()=>new J)).child(new B.Z(()=>new lt)).child(...this.customWidgets.get("center-pane"))).child(new I("right").cssBlock("\n<style>\n#right-pane {\n    overflow: auto;\n}\n\n#right-pane .card {\n    border: 0;\n    display: flex;\n    flex-shrink: 0;\n    flex-direction: column;\n}\n\n#right-pane .card-header {\n    background: inherit;\n    padding: 3px 10px 3px 10px;\n    width: 99%; /* to give minimal right margin */\n    background-color: var(--button-background-color);\n    border-color: var(--button-border-color);\n    border-width: 1px;\n    border-radius: 4px;\n    border-style: solid;\n    display: flex;\n    justify-content: space-between;\n}\n\n#right-pane .widget-title {\n    border-radius: 0;\n    padding: 0;\n    border: 0;\n    background: inherit;\n    font-weight: bold;\n    text-transform: uppercase;\n    color: var(--muted-text-color) !important;\n}\n\n#right-pane .widget-header-action {\n    color: var(--link-color) !important;\n    cursor: pointer;\n}\n\n#right-pane .widget-help {\n    color: var(--muted-text-color);\n    position: relative;\n    top: 2px;\n}\n\n#right-pane .widget-help.no-link:hover {\n    cursor: default;\n    text-decoration: none;\n}\n\n#right-pane .body-wrapper {\n    overflow: auto;\n}\n\n#right-pane .card-body {\n    width: 100%;\n    padding: 8px;\n    border: 0;\n    height: 100%;\n    overflow: auto;\n    max-height: 300px;\n}\n\n#right-pane .card-body ul {\n    padding-left: 25px;\n    margin-bottom: 5px;\n}\n</style>").hideInZenMode().child(new pt).child(new B.Z(()=>new gt)).child(new B.Z(()=>new Ct)).child(new B.Z(()=>new bt)).child(new B.Z(()=>new ft)).child(new B.Z(()=>new yt)).child(new B.Z(()=>new vt)).child(new B.Z(()=>new xt)).child(...this.customWidgets.get("right-pane"))).child((new $t).hideInZenMode()))}}const kt={setupGlobs:function(){window.glob.PROFILING_LOG=!1,window.glob.isDesktop=e.Z.isDesktop,window.glob.isMobile=e.Z.isMobile,window.glob.getComponentByEl=e=>t.default.getComponentByEl(e),window.glob.getHeaders=l.Z.getHeaders,window.glob.getActiveTabNote=()=>t.default.tabManager.getActiveTabNote(),window.glob.requireLibrary=G.Z.requireLibrary,window.glob.ESLINT=G.Z.ESLINT,window.glob.appContext=t.default,window.glob.treeCache=S.Z,window.glob.importMarkdownInline=async()=>{(await __webpack_require__.e(665).then(__webpack_require__.bind(__webpack_require__,9665))).importMarkdownInline()},window.glob.SEARCH_HELP_TEXT='\n    <strong>Search tips</strong> - also see <button class="btn btn-sm" type="button" data-help-page="Search">complete help on search</button>\n    <p>\n    <ul>\n        <li>Just enter any text for full text search</li>\n        <li><code>@abc</code> - returns notes with label abc</li>\n        <li><code>@year=2019</code> - matches notes with label <code>year</code> having value <code>2019</code></li>\n        <li><code>@rock @pop</code> - matches notes which have both <code>rock</code> and <code>pop</code> labels</li>\n        <li><code>@rock or @pop</code> - only one of the labels must be present</li>\n        <li><code>@year&lt;=2000</code> - numerical comparison (also &gt;, &gt;=, &lt;).</li>\n        <li><code>@dateCreated>=MONTH-1</code> - notes created in the last month</li>\n        <li><code>=handler</code> - will execute script defined in <code>handler</code> relation to get results</li>\n    </ul>\n    </p>',window.onerror=function(t,e,n,o,i){let s="Uncaught error: ";return t.toLowerCase().includes("script error")?s+="No details available":s+=["Message: "+t,"URL: "+e,"Line: "+n,"Column: "+o,"Error object: "+JSON.stringify(i),i.stack].join(", "),P.Z.logError(s),!1},q.Z.setProtectedSessionId(null);for(const t of glob.appCssNoteIds||[])G.Z.requireCss("api/notes/download/"+t);$(document).on("click","button[data-help-page]",t=>{const e=$(t.target);window.open("https://github.com/zadam/trilium/wiki/"+e.attr("data-help-page"),"_blank")}),$("body").on("click","a.external",(function(){window.open($(this).attr("href"),"_blank")}))}};class Tt{constructor(t){this.customWidgets=t}getRootWidget(t){return t.mainTreeWidget=new R,new c("column").setParent(t).id("root-widget").css("height","100vh").child(new c("row").child(new u).child(new g.default).child(new m)).child(new c("row").collapsible().child(new c("column").id("center-pane").css("flex-grow","1").child(new c("row").class("title-row").cssBlock(".title-row > * { margin: 5px; }").child(new j).child((new F).hideInZenMode()).child((new H).hideInZenMode()).child((new V).hideInZenMode())).child(new B.Z(()=>new J)).child(new B.Z(()=>new lt)).child(...this.customWidgets.get("center-pane"))))}}var Zt=__webpack_require__(503);if(kt.setupGlobs(),e.Z.isElectron()&&e.Z.dynamicRequire("electron").ipcRenderer.on("globalShortcut",(async function(e,n){t.default.triggerCommand(n)})),$('[data-toggle="tooltip"]').tooltip({html:!0}),a.init(),o.Z.getWidgetBundlesByParent().then(e=>{const n=window.glob.isMainWindow?new Nt(e):new Tt(e);t.default.setLayout(n),t.default.start()}),n.Z.setupGlobalTooltip(),i.Z.init(),e.Z.isElectron()){const t=e.Z.dynamicRequire("electron"),{webContents:n}=t.remote.getCurrentWindow();n.on("context-menu",(e,o)=>{const{editFlags:i}=o,s=o.selectionText.trim().length>0,a="darwin"===process.platform?"Meta":"Ctrl",d=[];if(o.misspelledWord){for(const t of o.dictionarySuggestions)d.push({title:t,command:"replaceMisspelling",spellingSuggestion:t,uiIcon:"empty"});d.push({title:`Add "${o.misspelledWord}" to dictionary`,uiIcon:"plus",handler:()=>n.session.addWordToSpellCheckerDictionary(o.misspelledWord)}),d.push({title:"----"})}if(o.isEditable&&d.push({enabled:i.canCut&&s,title:`Cut <kbd>${a}+X`,uiIcon:"cut",handler:()=>n.cut()}),(o.isEditable||s)&&d.push({enabled:i.canCopy&&s,title:`Copy <kbd>${a}+C`,uiIcon:"copy",handler:()=>n.copy()}),["","javascript:","about:blank#blocked"].includes(o.linkURL)||"none"!==o.mediaType||d.push({title:"Copy link",uiIcon:"copy",handler:()=>{t.clipboard.write({bookmark:o.linkText,text:o.linkURL})}}),o.isEditable&&d.push({enabled:i.canPaste,title:`Paste <kbd>${a}+V`,uiIcon:"paste",handler:()=>n.paste()}),o.isEditable&&d.push({enabled:i.canPaste,title:`Paste as plain text <kbd>${a}+Shift+V`,uiIcon:"paste",handler:()=>n.pasteAndMatchStyle()}),s){const e=o.selectionText.length>15?o.selectionText.substr(0,13)+"":o.selectionText;d.push({enabled:i.canPaste,title:`Search for "${e}" with DuckDuckGo`,uiIcon:"search-alt",handler:()=>t.shell.openExternal("https://duckduckgo.com/?q="+encodeURIComponent(o.selectionText))})}if(0===d.length)return;const c=Zt.Z.getCurrentZoom();r.Z.show({x:o.x/c,y:o.y/c,items:d,selectMenuItemHandler:({command:t,spellingSuggestion:e})=>{"replaceMisspelling"===t&&n.insertText(e)}})})}})()})();
//# sourceMappingURL=desktop.js.map