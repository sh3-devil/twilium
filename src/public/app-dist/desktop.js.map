{"version":3,"sources":["webpack://trilium/./src/public/app/entities/attribute.js","webpack://trilium/./src/public/app/entities/branch.js","webpack://trilium/./src/public/app/services/dialog_command_executor.js","webpack://trilium/./src/public/app/services/entrypoints.js","webpack://trilium/./src/public/app/services/tab_context.js","webpack://trilium/./src/public/app/services/tab_manager.js","webpack://trilium/./src/public/app/widgets/mobile_widgets/mobile_screen_switcher.js","webpack://trilium/./src/public/app/services/main_tree_executors.js","webpack://trilium/./src/public/app/services/app_context.js","webpack://trilium/./src/public/app/services/attribute_autocomplete.js","webpack://trilium/./src/public/app/services/branches.js","webpack://trilium/./src/public/app/services/bundle.js","webpack://trilium/./src/public/app/services/clipboard.js","webpack://trilium/./src/public/app/services/context_menu.js","webpack://trilium/./src/public/app/services/date_notes.js","webpack://trilium/./src/public/app/services/hoisted_note.js","webpack://trilium/./src/public/app/services/keyboard_actions.js","webpack://trilium/./src/public/app/services/library_loader.js","webpack://trilium/./src/public/app/services/link.js","webpack://trilium/./src/public/app/services/mime_types.js","webpack://trilium/./src/public/app/services/note_attribute_cache.js","webpack://trilium/./src/public/app/services/note_autocomplete.js","webpack://trilium/./src/public/app/services/note_create.js","webpack://trilium/./src/public/app/services/note_tooltip.js","webpack://trilium/./src/public/app/services/options.js","webpack://trilium/./src/public/app/services/protected_session.js","webpack://trilium/./src/public/app/services/protected_session_holder.js","webpack://trilium/./src/public/app/services/frontend_script_api.js","webpack://trilium/./src/public/app/services/script_context.js","webpack://trilium/./src/public/app/services/server.js","webpack://trilium/./src/public/app/services/spaced_update.js","webpack://trilium/./src/public/app/services/toast.js","webpack://trilium/./src/public/app/services/tree.js","webpack://trilium/./src/public/app/entities/note_short.js","webpack://trilium/./src/public/app/entities/note_complement.js","webpack://trilium/./src/public/app/services/tree_cache.js","webpack://trilium/./src/public/app/services/utils.js","webpack://trilium/./src/public/app/services/load_results.js","webpack://trilium/./src/public/app/services/ws.js","webpack://trilium/./src/public/app/services/zoom.js","webpack://trilium/./src/public/app/services|sync","webpack://trilium/./src/public/app/widgets/basic_widget.js","webpack://trilium/./src/public/app/widgets/collapsible_widget.js","webpack://trilium/./src/public/app/widgets/component.js","webpack://trilium/./src/public/app/widgets/tab_aware_widget.js","webpack://trilium/./src/public/app/widgets/tab_caching_widget.js","webpack://trilium/./src/public/app/widgets/tab_row.js","webpack://trilium/webpack/bootstrap","webpack://trilium/webpack/runtime/amd options","webpack://trilium/webpack/runtime/define property getters","webpack://trilium/webpack/runtime/ensure chunk","webpack://trilium/webpack/runtime/get javascript chunk filename","webpack://trilium/webpack/runtime/harmony module decorator","webpack://trilium/webpack/runtime/hasOwnProperty shorthand","webpack://trilium/webpack/runtime/make namespace object","webpack://trilium/webpack/runtime/publicPath","webpack://trilium/webpack/runtime/jsonp chunk loading","webpack://trilium/./src/public/app/services/mac_init.js","webpack://trilium/./src/public/app/widgets/flex_container.js","webpack://trilium/./src/public/app/services/sync.js","webpack://trilium/./src/public/app/widgets/global_menu.js","webpack://trilium/./src/public/app/widgets/title_bar_buttons.js","webpack://trilium/./src/public/app/widgets/history_navigation.js","webpack://trilium/./src/public/app/widgets/standard_top_widget.js","webpack://trilium/./src/public/app/widgets/side_pane_container.js","webpack://trilium/./src/public/app/widgets/global_buttons.js","webpack://trilium/./src/public/app/widgets/search_box.js","webpack://trilium/./src/public/app/widgets/search_results.js","webpack://trilium/./src/public/app/widgets/note_tree.js","webpack://trilium/./src/public/app/widgets/note_paths.js","webpack://trilium/./src/public/app/widgets/note_title.js","webpack://trilium/./src/public/app/widgets/run_script_buttons.js","webpack://trilium/./src/public/app/widgets/note_type.js","webpack://trilium/./src/public/app/widgets/note_actions.js","webpack://trilium/./src/public/app/widgets/promoted_attributes.js","webpack://trilium/./src/public/app/widgets/type_widgets/type_widget.js","webpack://trilium/./src/public/app/services/render.js","webpack://trilium/./src/public/app/services/note_content_renderer.js","webpack://trilium/./src/public/app/widgets/type_widgets/abstract_text_type_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_text.js","webpack://trilium/./src/public/app/widgets/type_widgets/image.js","webpack://trilium/./src/public/app/widgets/type_widgets/relation_map.js","webpack://trilium/./src/public/app/widgets/type_widgets/book.js","webpack://trilium/./src/public/app/widgets/note_detail.js","webpack://trilium/./src/public/app/widgets/type_widgets/empty.js","webpack://trilium/./src/public/app/widgets/type_widgets/deleted.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_text.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/file.js","webpack://trilium/./src/public/app/widgets/type_widgets/search.js","webpack://trilium/./src/public/app/widgets/type_widgets/render.js","webpack://trilium/./src/public/app/widgets/type_widgets/protected_session.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/note_info.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/calendar.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/attributes.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/link_map.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/note_revisions.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/similar_notes.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/what_links_here.js","webpack://trilium/./src/public/app/services/split.js","webpack://trilium/./src/public/app/widgets/side_pane_toggles.js","webpack://trilium/./src/public/app/widgets/collapsible_widgets/edited_notes.js","webpack://trilium/./src/public/app/layouts/desktop_main_window_layout.js","webpack://trilium/./src/public/app/services/glob.js","webpack://trilium/./src/public/app/layouts/desktop_extra_window_layout.js","webpack://trilium/./src/public/app/desktop.js"],"names":["treeCache","row","this","update","attributeId","noteId","type","name","value","position","isInheritable","notes","undefined","JSON","parse","e","affectedNote","attrNote","getNote","owningNotes","getTemplateNotes","owningNote","hasAncestor","branchId","parentNoteId","notePosition","prefix","isExpanded","isDeleted","DialogCommandExecutor","then","d","showDialog","showCurrentNoteRevisions","importMarkdownInline","notePath","noteIds","branchIds","Entrypoints","super","jQuery","hotkeys","options","filterInputAcceptingElements","filterContentEditable","filterTextInputs","$","document","on","async","linkEl","event","target","attr","noteRevisionId","showNoteRevisionsDialog","utils","remote","getCurrentWindow","toggleDevTools","FindInPage","getCurrentWebContents","offsetTop","offsetRight","boxBgColor","boxShadowColor","inputColor","inputBgColor","inputFocusColor","textColor","textHoverBgColor","caseSelectedColor","openFindWindow","todayNote","note","server","title","content","isProtected","ws","hoistedNoteId","win","isFullScreenable","setFullScreen","isFullScreen","$widget","find","hide","zenModeActive","removeClass","addClass","$logoutForm","append","glob","csrfToken","trigger","webContents","activeIndex","parseInt","getActiveIndex","goToIndex","window","history","back","forward","searchText","response","encodeURIComponent","success","triggerEvent","results","toast","ipcRenderer","send","url","location","protocol","host","pathname","open","openInWindowCommand","mime","endsWith","bundle","TabContext","tabId","tabContext","inputNotePath","triggerSwitchEvent","tree","console","error","autoBookDisabled","textPreviewDisabled","codePreviewDisabled","setTimeout","active","isActive","loadResults","isNoteReloaded","TabManager","activeTabId","tabsUpdate","openTabs","tabContexts","map","tc","getTabState","filter","t","stringify","children","tabsToOpen","hash","substr","tab","foundTab","push","filteredTabs","openTab","length","isMainWindow","allowUpdateWithoutChange","openTabWithNote","setCurrentNotePathToHash","scheduleUpdate","activeTabContext","getActiveTabContext","pushState","getTabContextById","activeContext","activeNote","getActiveTabNote","openEmptyTab","activateTab","setNote","setEmpty","child","activate","getTabContexts","tabContextToRemove","autocomplete","openAndActivateEmptyTab","findIndex","activatePreviousTabCommand","activateNextTabCommand","tabIdsInOrder","order","i","sort","a","b","oldIdx","newActiveTabId","removeTab","updateNowIfNecessary","tabIdToRemove","triggerCommand","splice","split","includes","MobileScreenSwitcherExecutor","screen","activeScreen","setActiveScreenCommand","MainTreeExecutors","selectedOrActiveNoteIds","getSelectedOrActiveNodes","node","data","selectedOrActiveBranchIds","saveSelection","getActiveNode","targetBranchId","AppContext","executors","layout","Promise","all","showWidgets","tabManager","loadTabs","rootWidget","getRootWidget","$renderedWidget","render","commandName","closest","prop","$el","executor","zoom","handleEvent","fun","callMethod","debug","el","appContext","startsWith","isNotePathInAddress","log","switchToTab","initAttributeNameAutocomplete","attributeType","hasClass","appendTo","querySelector","hint","openOnFocus","minLength","tabAutocomplete","displayKey","cache","source","term","cb","initLabelValueAutocomplete","attributeName","parent","val","trim","attributeValues","attribute","toLowerCase","filterRootNote","branch","makeToast","id","message","icon","taskType","taskId","progressCount","closeAfter","moveBeforeBranch","branchIdsToMove","beforeBranchId","branchIdToMove","resp","alert","moveAfterBranch","afterBranchId","afterNote","reverse","moveToParentNote","newParentBranchId","branchToMove","getParentNote","deleteNotes","branchIdsToDelete","$deleteClonesCheckbox","text","$nodeTitles","$confirmText","confirmDialog","confirm","deleteClones","is","counter","branchIdToDelete","query","moveNodeUpInHierarchy","getParent","noteType","getChildren","folder","renderTitle","cloneNoteAfter","cloneNoteTo","childNoteId","parentBranchId","getAndExecuteBundle","originEntity","executeBundle","$container","apiContext","allNoteIds","eval","script","call","executeStartupBundles","scriptBundles","WidgetsByParent","byParent","widget","parentWidget","parentName","getWidgetBundlesByParent","widgetsByParent","add","clipboardBranchIds","clipboardMode","isClipboardEmpty","pasteAfter","clipboardBranches","clipboardBranch","clipboardNote","pasteInto","mode","cut","copy","dateContextMenuOpenedMs","empty","addItems","items","positionMenu","Date","now","clientHeight","documentElement","contextMenuHeight","outerHeight","top","y","css","display","left","x","$parent","item","$icon","uiIcon","$link","$item","stopPropagation","handler","selectMenuItemHandler","enabled","$subMenu","getDateNote","date","getTodayNote","dayjs","format","getMonthNote","month","getYearNote","year","getHoistedNoteId","setHoistedNoteId","unhoist","isRootNode","isTopLevelNode","checkNoteAccess","runNotePath","keyboardActionRepo","keyboardActionsLoaded","actions","actionName","action","effectiveShortcuts","shortcut","getActionsForScope","scope","getAction","silent","Error","shortcutForNotes","setElementActionHandler","updateDisplayedShortcuts","each","join","shortcuts","newTitle","setupActionsForElement","component","loadedScriptPromises","requireScript","ajax","dataType","requireCss","Array","from","querySelectorAll","href","some","l","requireLibrary","library","cssUrl","js","scriptUrl","CKEDITOR","CODE_MIRROR","ESLINT","COMMONMARK","RELATION_MAP","LINK_MAP","PRINT_THIS","KNOCKOUT","CALENDAR_WIDGET","getNotePathFromUrl","notePathMatch","exec","getNotePathFromLink","notePathAttr","goToLink","preventDefault","which","ctrlKey","address","linkContextMenu","pageX","pageY","command","createNoteLink","noteTitle","showTooltip","showNotePath","$noteLink","pop","parentNotePath","MIME_TYPES_DICT","default","mimeTypes","loadMimeTypes","enabledMimeTypes","mt","getMimeTypes","attributes","autocompleteSource","result","pathTitle","path","clearText","setSelectedPath","showRecentNotes","initNoteAutocomplete","$clearTextButton","$showRecentNotesButton","$goToSelectedNoteButton","$sideButtons","hideGoToSelectedNoteButton","after","autoselect","templates","suggestion","highlightedTitle","init","fn","getSelectedPath","toggleClass","createNote","Object","assign","selectedHtml","dom","parseHTML","tagName","match","replace","outerHTML","parseSelectedHtml","cutToNote","getSelectedHtml","newNoteName","removeSelection","createNewTopLevelNote","duplicateNote","origNote","mouseEnterHandler","noteComplement","html","getAttributes","promoted","json","jsonValue","isPromoted","$table","definitionAttr","definitionType","valueType","valueAttrs","valueAttr","$value","$row","renderTooltip","tooltip","delay","container","placement","boundary","template","sanitize","mouseLeaveHandler","setupGlobalTooltip","remove","setupElementTooltip","initializedPromise","load","arr","key","keys","parseFloat","set","payload","protectedSessionDeferred","enterProtectedSession","dfd","Deferred","resolve","dialog","show","promise","protectingLabel","protect","protectNote","includingSubtree","leaveProtectedSession","setupProtectedSession","password","enterProtectedSessionOnServer","protectedSessionId","reloadData","close","lastProtectedSessionOperationDate","setProtectedSessionId","resetProtectedSession","isProtectedSessionAvailable","touchProtectedSession","setInterval","protectedSessionTimeout","touchProtectedSessionIfNecessary","startNote","currentNote","$pluginButtons","prepareParams","params","p","toString","CollapsibleWidget","TabAwareWidget","TabCachingWidget","BasicWidget","activateNote","activateNewNote","addButtonToToolbar","opts","buttonId","button","replaceWith","runOnBackend","ret","startNoteId","currentNoteId","originEntityName","originEntityId","maxSyncId","executionResult","runOnServer","searchForNotes","api","searchString","searchForNote","getNotes","silentNotFoundError","reloadNotes","getInstanceName","instanceName","formatDateISO","parseDate","showMessage","showError","refreshTree","addTextToActiveTabEditor","getActiveTabTextEditor","callback","getActiveTabNotePath","protectActiveNote","protectSubTree","bindGlobalShortcut","waitUntilSynced","refreshIncludedNote","includedNoteId","modules","allNotes","apis","require","moduleNoteIds","moduleName","c","exports","getHeaders","headers","allHeaders","sourceId","headerName","cookie","reqResolves","maxKnownSyncId","method","start","ipc","requestId","reject","baseApiUrl","end","PROFILING_LOG","maxSyncIdStr","Math","max","body","res","rej","timeout","textStatus","jqXhr","respHeaders","getAllResponseHeaders","forEach","line","parts","header","shift","toastService","throwError","contentType","arg","get","post","put","getMaxKnownSyncId","SpacedUpdate","updater","updateInterval","lastUpdated","changed","changeForbidden","triggerUpdate","$toast","autohide","showAndLogError","showPersistent","closePersistent","getRunPath","logErrors","effectivePath","parents","getParentNotes","someNotePath","getSomeNotePath","pathToRoot","cur","getNoteTitle","parentToBranch","sortAlphabetically","resolveNotePath","runPath","getParentProtectedStatus","getNotePath","getNoteIdFromNotePath","getNoteIdAndParentIdFromNotePath","getNotePathTitle","titlePath","getHashValueFromAddress","parseNotePath","concat","LABEL","targetRelations","childToBranch","contentLength","branchIdPos","values","getBranch","getContent","getBranches","getNotesFromCache","attrs","Boolean","__filterAttrs","__getCachedAttributes","ownedAttributes","getOwnedAttributes","attrArrs","newPath","templateAttr","oa","templateNote","parentNote","__getInheritableAttributes","flat","getAttribute","getOwnedAttribute","hasOwnedAttribute","hasAttribute","getOwnedAttributeValue","getAttributeValue","targets","getRelationTargets","relations","getRelations","relation","rel","ancestorNote","__attributeCache","getNoteComplement","dto","getLabels","dateCreated","dateModified","utcDateCreated","utcDateModified","loadInitialTree","loadParents","branches","noteComplementPromises","addResp","additiveLoad","Set","missingNoteIds","existingNotes","has","newResp","noteRows","branchRows","attributeRows","noteRow","oldNote","childNote","branchRow","addParent","addChild","attributeRow","targetNote","searchResults","index","trace","padNum","num","formatTime","getHours","getMinutes","formatTimeWithSeconds","getSeconds","formatDate","getFullYear","getMonth","getDate","isElectron","process","entityMap","formatValueWithWhitespace","test","bindElShortcut","keyboardShortcut","isDesktop","normalizeShortcut","bind","device","navigator","userAgent","closeActiveDialog","activeDialog","modal","$lastFocusedElement","saveFocusedElement","focusSavedElement","editing","view","focus","dynamicRequire","reloadApp","reload","str","stack","formatDateTime","localNowDateTime","isMac","platform","indexOf","assertArguments","arguments","escapeHtml","s","stopWatch","what","func","tookMs","getTime","formatLabel","label","download","downloadURL","toObject","array","obj","randomString","len","possible","charAt","floor","random","isMobile","setCookie","expires","toUTCString","setSessionCookie","getCookie","valueMatch","getNoteTypeClass","getMimeTypeClass","semicolonIdx","openDialog","$dialog","isHtmlEmpty","clearBrowserCache","session","clearCache","getUrlForDownload","URL","hostname","port","getHost","copySelectionToClipboard","getSelection","clipboard","writeText","isCKEditorInitialized","timeLimit","limitMs","resolved","LoadResults","noteIdToSourceId","sourceIdToNoteIds","noteReorderings","noteRevisions","contentNoteIdToSourceId","nr","sourceIds","sId","$outstandingSyncsCount","messageHandlers","lastPingTs","lastAcceptedSyncId","maxSyncIdAtLoad","lastProcessedSyncId","syncDataQueue","logError","readyState","subscribeToMessages","messageHandler","consumeQueuePromise","processedSyncIds","handleMessage","syncRows","outstandingSyncs","filteredRows","entityName","entityId","logRows","sendPing","allSyncRows","nonProcessedSyncRows","sync","entity","addNote","addBranch","positions","addNoteReordering","sourceNote","addAttribute","addNoteContent","addNoteRevision","addOption","isEmpty","hasAttributeRelatedChanges","processSyncRows","syncRow","syncIdReachedListeners","desiredSyncId","resolvePromise","consumeSyncData","waitForSyncId","connectWebSocket","loc","webSocketUri","WebSocket","onopen","onmessage","OPEN","lastSyncId","CLOSED","CLOSING","waitForMaxKnownSyncId","ZoomService","setZoomFactor","zoomFactor","webFrame","getZoomFactor","setZoomFactorAndSave","getCurrentZoom","webpackEmptyContext","req","code","module","style","classes","className","class","block","cssEl","doRender","toggleInt","isEnabled","componentId","$bodyWrapper","widgetName","widgetTitle","collapse","saveCollapsed","$body","$title","$help","help","$headerActions","headerActions","initialized","doRenderBody","decorateWidget","Component","components","setParent","handleEventInChildren","promises","refreshWithNote","noteSwitched","refresh","activeTabChanged","isNote","widgetFactory","widgets","toggleExt","ch","isTab","hasBeenAlreadyShown","define","jQueryBridget","prototype","slice","n","o","u","option","isPlainObject","extend","r","apply","h","_init","bridget","m","isNaN","E","getComputedStyle","_","P","createElement","width","padding","borderStyle","borderWidth","boxSizing","appendChild","isBoxSizeOuter","removeChild","nodeType","height","innerWidth","innerHeight","outerWidth","offsetWidth","offsetHeight","isBorderBox","paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","f","borderTopWidth","borderBottomWidth","g","v","getSize","EvEmitter","_events","once","_onceEvents","off","emitEvent","allOff","Unipointer","create","bindStartEvent","_bindStartEvent","unbindStartEvent","PointerEvent","getTouch","identifier","pointerIdentifier","onmousedown","_pointerDown","ontouchstart","changedTouches","onpointerdown","isPointerDown","pointerId","pointerDown","_bindPostStartEvents","mousedown","touchstart","pointerdown","addEventListener","_boundPointerEvents","_unbindPostStartEvents","removeEventListener","onmousemove","_pointerMove","onpointermove","ontouchmove","pointerMove","onmouseup","_pointerUp","onpointerup","ontouchend","_pointerDone","pointerUp","_pointerReset","pointerDone","onpointercancel","_pointerCancel","ontouchcancel","pointerCancel","getPointerPoint","Unidragger","bindHandles","_bindHandles","unbindHandles","_touchActionValue","handles","touchAction","okayPointerDown","pointerDownPointer","pointerDownBlur","TEXTAREA","INPUT","SELECT","OPTION","radio","checkbox","submit","image","file","nodeName","activeElement","blur","_dragPointerMove","_dragMove","isDragging","hasDragStarted","_dragStart","abs","_dragPointerUp","_dragEnd","_staticClick","isPreventingClicks","dragStart","dragMove","dragEnd","onclick","isIgnoringMouseUp","staticClick","Draggabilly","element","$element","constructor","defaults","_create","relative","absolute","fixed","_getPosition","startPoint","dragPoint","startPosition","onPointerDown","onPointerMove","onPointerUp","enable","setHandles","handle","dispatchEvent","dispatchJQueryEvent","Event","_getPositionCoord","_addTransformPosition","parentNode","transform","classList","measureContainment","setLeftTop","animate","getContainer","getBoundingClientRect","relativeStartPosition","containSize","containment","HTMLElement","grid","containDrag","axis","min","positionDrag","requestAnimationFrame","setPosition","disable","destroy","removeData","TabRowWidget","draggabillies","eventListeners","setupStyle","setupEvents","setupDraggabilly","setupNewButton","setupFiller","layoutTabs","setVisibility","$style","resizeListener","cleanUpPreviouslyDraggedTabs","ResizeObserver","observe","tabEls","tabEl","setTabCloseEvent","numberOfTabs","tabsContainerWidth","$tabContainer","clientWidth","targetWidth","clampedTargetWidth","flooredClampedTargetWidth","widths","extraWidthRemaining","extraWidth","$filler","tabPositions","tabWidths","newTabPosition","fillerPosition","tabContainerWidths","removeAttribute","setAttribute","styleHTML","getTabPositions","$tab","$newTab","before","updateTitle","getTabById","activeTabEl","addTab","draggabillyDragging","originalIndex","originalTabPositionX","draggabilly","finalTranslateX","pointer","moveVector","currentIndex","currentTabPositionX","destinationIndexTarget","destinationIndex","animateTabMove","originIndex","insertBefore","beforeEl","getTabIdsInOrder","Infinity","closestIndex","activeTabChangedEvent","updateTabById","updateTab","clazz","getCssClass","__webpack_module_cache__","__webpack_require__","moduleId","loaded","__webpack_modules__","amdO","definition","defineProperty","enumerable","chunkId","reduce","hmd","hasOwnProperty","Symbol","toStringTag","installedChunks","8","j","installedChunkData","onScriptComplete","charset","nc","src","onerror","onload","clearTimeout","reportError","loadingEnded","errorType","realSrc","request","head","jsonpArray","oldJsonpFunction","chunkIds","moreModules","runtime","resolves","parentJsonpFunction","cmd","execCommand","FlexContainer","direction","positionCounter","syncNow","forceNoteSync","GlobalMenuWidget","toggle","TitleBarButtonsWidget","$minimizeBtn","$maximizeBtn","$closeBtn","BrowserWindow","getFocusedWindow","minimize","focusedWindow","isMaximized","unmaximize","maximize","HistoryNavigationWidget","contextMenuHandler","showContextMenu","$backInHistory","$forwardInHistory","electron","clearHistory","idx","notePathWithTab","canGoBack","canGoForward","StandardTopWidget","historyNavigationWidget","prepend","$enterProtectedSessionButton","$leaveProtectedSessionButton","SidePaneContainer","side","GlobalButtonsWidget","SearchBoxWidget","$searchBox","$closeSearchButton","$searchInput","$resetSearchButton","$doSearchButton","$saveSearchButton","ui","keyCode","ESCAPE","ENTER","doSearch","resetSearchEvent","saveSearch","hideSearch","slideDown","SEARCH_HELP_TEXT","slideUp","showSearchEvent","toggleSearchEvent","SearchResultsWidget","$searchResults","$searchResultsInner","link","$result","NOTE_TYPE_ICONS","NoteTreeWidget","treeName","$tree","refreshSearch","fancytree","getNode","$treeSettingsPopup","$hideArchivedNotesCheckbox","$hideIncludedImages","$treeSettingsButton","hideArchivedNotes","hideIncludedImages","offsetLeft","$saveTreeSettingsButton","setHideArchivedNotes","setHideIncludedImages","reloadTreeFromCache","initFancyTree","setupNoteTitleTooltip","currentTarget","$sub","conOffset","offset","conDistanceFromTop","conDistanceFromLeft","subOffset","subDistanceFromTop","subDistanceFromLeft","isEnclosing","innerText","treeData","prepareRootNode","titlesTabbable","autoScroll","keyboard","extensions","scrollParent","minExpandLevel","click","targetType","shiftKey","setSelected","isSelected","setFocus","reactivate","setActive","clearSelectedNodes","expand","setExpanded","keydown","getHotKeys","dnd5","autoExpandMS","dataTransfer","setData","dragEnter","dragOver","dragDrop","hitMode","infoDialog","info","files","uploadFiles","safeImport","shrinkImages","textImportedAsText","codeImportedAsCode","explodeArchives","jsonStr","getData","selectedBranchIds","lazyLoad","prepareChildren","clones","highlightActiveClones","enhanceTitle","$span","span","unhoistButton","refreshSearchButton","loadChildren","visit","subNode","isUndefined","TreeContextMenu","getTree","hoistedBranch","hoistedNote","prepareNode","prepareSearchNoteChildren","prepareNormalNoteChildren","isFolder","iconClass","getIconClass","extraClasses","getExtraClasses","getIcon","refKey","lazy","expanded","getChildBranches","noteList","hasLabel","childBranches","imageLinks","newNote","getParentNoteIds","cssClass","stopOnParents","getSelectedNodes","nodes","getNodesByNoteId","batchUpdate","noEvents","setExpandedStatusForSubtree","getFocusNode","selectedNode","expandToNote","makeVisible","scrollIntoView","isLoaded","updateNode","foundChildNode","findChildNode","childNode","getNodeFromPath","list","getNodesByRef","collapseTree","oldActiveNode","oldActiveNodeFocused","hasFocus","newActiveNode","isVisible","noFocus","activeNode","enableUpdate","activeNodeFocused","nextNode","getNextSibling","getPrevSibling","activeNotePath","nextNotePath","activeNoteId","noteIdsToUpdate","noteIdsToReload","getChildNoteIds","getNodesByBranchId","getNoteIds","getNoteReorderings","sortChildren","nodeA","nodeB","branchA","branchB","notesById","rootNode","hotKeyMap","navigate","LEFT","RIGHT","UP","DOWN","getSelectedOrActiveBranchIds","beforeNode","afterNode","toNode","getFocusedNode","prevSibling","nextSibling","expandTree","exportDialog","NotePathsWidget","$currentPath","$dropdown","$notePathList","renderDropdown","noteIdsPath","curPath","passedHoistedNote","addPath","pathSegments","activeNoteParentNoteId","isCurrent","cloneLink","noteLink","NoteTitleWidget","spacedUpdate","$noteTitle","setProtectedStatus","RunScriptButtonsWidget","$renderButton","$executeScriptButton","NOTE_TYPES","selectable","NoteTypeWidget","$noteTypeDropdown","$noteTypeButton","$noteTypeDesc","findTypeTitle","nt","$typeLink","save","mimeType","$mimeLink","found","confirmChangeIfContent","NoteActionsWidget","$showSourceButton","$exportNoteButton","$importNoteButton","$protectButton","$unprotectButton","removeAttr","PromotedAttributesWidget","hidePromotedAttributes","$tbody","multiplicityType","$tr","createPromotedAttributeRow","$labelCell","$input","promotedAttributeChanged","$inputCell","$actionCell","$multiplicityCell","labelType","step","numberPrecision","$openButton","dataset","addButton","$new","removeButton","$attr","selectedPath","isAffecting","TypeWidget","getType","getWidgetType","cleanup","doRefresh","scrollTop","renderNoteIds","renderNoteId","$scriptContainer","getRenderedContent","getRenderingType","$rendered","fullNote","getFileUrl","$downloadButton","$pdfPreview","ctx","$button","renderedContent","AbstractTextTypeWidget","isErased","loadIncludedNote","mentionSetup","feeds","marker","feed","queryText","rows","itemRenderer","itemElement","innerHTML","minimumCharacters","$imageWrapper","$imageView","$copyToClipboardButton","$uploadNewRevisionButton","$uploadNewRevisionInput","$fileName","$fileType","$fileSize","$imageDownloadButton","selectImage","removeAllRanges","fileToUpload","formData","FormData","processData","uploaded","attributeMap","originalFileName","imageHash","selection","range","createRange","selectNodeContents","addRange","uniDirectionalOverlays","foldback","biDirectionalOverlays","inverseRelationsOverlays","linkOverlays","containerCounter","ZOOMS","1","2","3","4","5","6","typeWidgetClasses","$autoComplete","$editor","initEditor","codeBlockLanguages","language","textEditor","BalloonEditor","placeholder","mention","codeBlock","languages","model","isDev","dateString","addTextToEditor","linkHref","linkTitle","change","writer","insertPosition","getFirstPosition","insertText","hasSelection","execute","addLinkToEditor","isCollapsed","boxSize","insertContent","imageElement","$content","loadReferenceLinkTitle","CodeMirror","keyMap","modeURL","codeEditor","viewportMargin","indentUnit","matchBrackets","matchTags","bothTags","highlightSelectionMatches","showToken","annotateScrollbar","lint","gutters","lineNumbers","tabindex","lineWrapping","setValue","findModeByMIME","setOption","autoLoadMode","getValue","$fileNoteId","$previewContent","$searchString","$component","$noteDetailRenderHelp","$noteDetailRenderContent","$relationMapContainer","$createChildNote","$zoomInButton","$zoomOutButton","$resetPanZoomButton","mapData","jsPlumbInstance","pzInstance","$relationMapWrapper","getMousePosition","createNoteBox","saveData","promptDialog","ask","defaultValue","zoomTo","getZoom","moveTo","ev","dropNoteOntoRelationMapHandler","jsPlumb","ready","originalTarget","$noteBox","idToNoteId","confirmDeleteNoteBoxWithNote","noteIdToId","isDeleteNoteChecked","sourceNoteId","targetNoteId","scale","loadMapData","initJsPlumbInstance","initPanZoom","loadNotesAndRelations","deleteEveryEndpoint","inverseRelations","noteTitles","batch","clearMap","connection","connect","getOverlay","setLabel","canvas","panzoom","maxZoom","minZoom","smoothScroll","filterKey","dx","dy","dz","altKey","setZoom","saveCurrentTransform","newTransform","getTransform","dispose","getInstance","Endpoint","radius","Connector","ConnectionOverlays","HoverPaintStyle","stroke","strokeWidth","Container","registerConnectionType","anchor","connector","overlays","originalEvent","connectionCreatedHandler","deleteConnection","shown","$answer","draggable","drag","stop","finalPos","makeSource","connectorStyle","connectionType","extract","makeTarget","dropOptions","hoverClass","allowLoopback","matches","evt","rect","clientX","clientY","$passwordForm","$passwordInput","$expandChildrenButton","zoomLevel","$unexpandedLinks","$card","expandCard","renderIntoElement","getDefaultZoomLevel","isAutoBook","$addTextLink","getLabelValue","childNotes","getChildNotes","renderNote","childCount","w","NoteDetailWidget","typeWidgets","getTypeWidget","typeWidget","setupClasses","hasChildren","printThis","footer","importCSS","loadCSS","isNoteContentReloaded","NoteInfoWidget","$noteId","$dateCreated","$dateModified","$type","$mime","CalendarWidget","hasOwnedLabel","$month","$next","$previous","$label","setMonth","createMonth","getOwnedLabelValue","activeDate","todaysDate","setDate","dateNotesForMonth","day","$newDay","$date","dateNoteId","isEqual","currentMonth","$day","createDay","getDay","monthsAsString","monthIndex","AttributesWidget","$showFullButton","$attributesContainer","renderAttributes","$inheritedAttrs","$showInheritedAttributes","inheritedAttributes","$hideInheritedAttributes","linkMapContainerIdCtr","LinkMapWidget","IntersectionObserver","entries","isIntersecting","displayLinkMap","rootMargin","threshold","$linkMapContainer","LinkMapServiceClass","linkMapService","maxDepth","stopCheckerCallback","opacity","NoteRevisionsWidget","revisionItems","$list","$listItem","dateLastEdited","hasNoteRevisionForNote","SimilarNotesWidget","similarNotes","flatMap","similarNote","rendered","WhatLinksHereWidget","getTargetRelations","instance","setupSplit","right","leftPaneWidth","rightPaneWidth","Split","sizes","gutterSize","onDragEnd","round","SidePaneToggles","paneVisible","toggleAndSave","toggleSidebar","EditedNotesWidget","editedNotes","editedNote","DesktopMainWindowLayout","customWidgets","mainTreeWidget","hideInZenMode","collapsible","filling","cssBlock","setupGlobs","getComponentByEl","msg","lineNo","columnNo","appCssNoteId","appCssNoteIds","DesktopExtraWindowLayout","widgetBundles","editFlags","hasText","selectionText","platformModifier","misspelledWord","dictionarySuggestions","spellingSuggestion","addWordToSpellCheckerDictionary","isEditable","canCut","canCopy","linkURL","mediaType","write","bookmark","linkText","canPaste","paste","pasteAndMatchStyle","shortenedSelection","shell","openExternal"],"mappings":"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","file":"desktop.js","sourcesContent":["class Attribute {\n    constructor(treeCache, row) {\n        this.treeCache = treeCache;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @param {string} attributeId */\n        this.attributeId = row.attributeId;\n        /** @param {string} noteId */\n        this.noteId = row.noteId;\n        /** @param {string} type */\n        this.type = row.type;\n        /** @param {string} name */\n        this.name = row.name;\n        /** @param {string} value */\n        this.value = row.value;\n        /** @param {int} position */\n        this.position = row.position;\n        /** @param {boolean} isInheritable */\n        this.isInheritable = row.isInheritable;\n    }\n\n    /** @returns {NoteShort} */\n    getNote() {\n        return this.treeCache.notes[this.noteId];\n    }\n\n    get targetNoteId() { // alias\n        return this.type === 'relation' ? this.value : undefined;\n    }\n\n    get jsonValue() {\n        try {\n            return JSON.parse(this.value);\n        }\n        catch (e) {\n            return null;\n        }\n    }\n\n    get toString() {\n        return `Attribute(attributeId=${this.attributeId}, type=${this.type}, name=${this.name}, value=${this.value})`;\n    }\n\n    /**\n     * @return {boolean} - returns true if this attribute has the potential to influence the note in the argument.\n     *         That can happen in multiple ways:\n     *         1. attribute is owned by the note\n     *         2. attribute is owned by the template of the note\n     *         3. attribute is owned by some note's ancestor and is inheritable\n     */\n    isAffecting(affectedNote) {\n        if (!affectedNote) {\n            return false;\n        }\n\n        const attrNote = this.getNote();\n\n        if (!attrNote) {\n            // the note (owner of the attribute) is not even loaded into the cache so it should not affect anything else\n            return false;\n        }\n\n        const owningNotes = [affectedNote, ...affectedNote.getTemplateNotes()];\n\n        for (const owningNote of owningNotes) {\n            if (owningNote.noteId === attrNote.noteId) {\n                return true;\n            }\n        }\n\n        if (this.isInheritable) {\n            for (const owningNote of owningNotes) {\n                if (owningNote.hasAncestor(attrNote)) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n}\n\nexport default Attribute;\n","/** Represents mapping between note and parent note */\nclass Branch {\n    constructor(treeCache, row) {\n        this.treeCache = treeCache;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @param {string} primary key */\n        this.branchId = row.branchId;\n        /** @param {string} */\n        this.noteId = row.noteId;\n        /** @param {string} */\n        this.parentNoteId = row.parentNoteId;\n        /** @param {int} */\n        this.notePosition = row.notePosition;\n        /** @param {string} */\n        this.prefix = row.prefix;\n        /** @param {boolean} */\n        this.isExpanded = !!row.isExpanded;\n        /** @param {boolean} */\n        this.isDeleted = !!row.isDeleted;\n    }\n\n    /** @returns {NoteShort} */\n    async getNote() {\n        return this.treeCache.getNote(this.noteId);\n    }\n\n    /** @returns {NoteShort} */\n    async getParentNote() {\n        return this.treeCache.getNote(this.parentNoteId);\n    }\n\n    /** @returns {boolean} true if it's top level, meaning its parent is root note */\n    isTopLevel() {\n        return this.parentNoteId === 'root';\n    }\n\n    get toString() {\n        return `Branch(branchId=${this.branchId})`;\n    }\n}\n\nexport default Branch;","import Component from \"../widgets/component.js\";\nimport appContext from \"./app_context.js\";\n\nexport default class DialogCommandExecutor extends Component {\n    jumpToNoteCommand() {\n        import(\"../dialogs/jump_to_note.js\").then(d => d.showDialog());\n    }\n\n    showRecentChangesCommand() {\n        import(\"../dialogs/recent_changes.js\").then(d => d.showDialog());\n    }\n\n    showAttributesCommand() {\n        import(\"../dialogs/attributes.js\").then(d => d.showDialog());\n    }\n\n    showNoteInfoCommand() {\n        import(\"../dialogs/note_info.js\").then(d => d.showDialog());\n    }\n\n    showNoteRevisionsCommand() {\n        import(\"../dialogs/note_revisions.js\").then(d => d.showCurrentNoteRevisions());\n    }\n\n    showNoteSourceCommand() {\n        import(\"../dialogs/note_source.js\").then(d => d.showDialog());\n    }\n\n    showLinkMapCommand() {\n        import(\"../dialogs/link_map.js\").then(d => d.showDialog());\n    }\n\n    pasteMarkdownIntoTextCommand() {\n        import(\"../dialogs/markdown_import.js\").then(d => d.importMarkdownInline());\n    }\n\n    async editBranchPrefixCommand() {\n        const notePath = appContext.tabManager.getActiveTabNotePath();\n\n        if (notePath) {\n            const editBranchPrefixDialog = await import(\"../dialogs/branch_prefix.js\");\n            editBranchPrefixDialog.showDialog(notePath);\n        }\n    }\n\n    async cloneNoteIdsToCommand({noteIds}) {\n        const d = await import(\"../dialogs/clone_to.js\");\n        d.showDialog(noteIds);\n    }\n\n    async moveBranchIdsToCommand({branchIds}) {\n        const d = await import(\"../dialogs/move_to.js\");\n        d.showDialog(branchIds);\n    }\n\n    showOptionsCommand() {\n        import(\"../dialogs/options.js\").then(d => d.showDialog())\n    }\n\n    showHelpCommand() {\n        import(\"../dialogs/help.js\").then(d => d.showDialog())\n    }\n\n    showSQLConsoleCommand() {\n        import(\"../dialogs/sql_console.js\").then(d => d.showDialog())\n    }\n\n    showBackendLogCommand() {\n        import(\"../dialogs/backend_log.js\").then(d => d.showDialog())\n    }\n}","import utils from \"./utils.js\";\nimport dateNoteService from \"./date_notes.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport server from \"./server.js\";\nimport appContext from \"./app_context.js\";\nimport Component from \"../widgets/component.js\";\nimport toastService from \"./toast.js\";\nimport noteCreateService from \"./note_create.js\";\nimport ws from \"./ws.js\";\nimport bundleService from \"./bundle.js\";\n\nexport default class Entrypoints extends Component {\n    constructor() {\n        super();\n\n        if (jQuery.hotkeys) {\n            // hot keys are active also inside inputs and content editables\n            jQuery.hotkeys.options.filterInputAcceptingElements = false;\n            jQuery.hotkeys.options.filterContentEditable = false;\n            jQuery.hotkeys.options.filterTextInputs = false;\n        }\n\n        $(document).on('click', \"a[data-action='note-revision']\", async event => {\n            const linkEl = $(event.target);\n            const noteId = linkEl.attr('data-note-path');\n            const noteRevisionId = linkEl.attr('data-note-revision-id');\n\n            const attributesDialog = await import(\"../dialogs/note_revisions.js\");\n\n            attributesDialog.showNoteRevisionsDialog(noteId, noteRevisionId);\n\n            return false;\n        });\n    }\n\n    openDevToolsCommand() {\n        if (utils.isElectron()) {\n            utils.dynamicRequire('electron').remote.getCurrentWindow().toggleDevTools();\n        }\n    }\n\n    findInTextCommand() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        const {remote} = utils.dynamicRequire('electron');\n        const {FindInPage} = utils.dynamicRequire('electron-find');\n        const findInPage = new FindInPage(remote.getCurrentWebContents(), {\n            offsetTop: 10,\n            offsetRight: 10,\n            boxBgColor: 'var(--main-background-color)',\n            boxShadowColor: '#000',\n            inputColor: 'var(--input-text-color)',\n            inputBgColor: 'var(--input-background-color)',\n            inputFocusColor: '#555',\n            textColor: 'var(--main-text-color)',\n            textHoverBgColor: '#555',\n            caseSelectedColor: 'var(--main-border-color)'\n        });\n\n        findInPage.openFindWindow();\n    }\n\n    async createNoteIntoDayNoteCommand() {\n        const todayNote = await dateNoteService.getTodayNote();\n\n        const {note} = await server.post(`notes/${todayNote.noteId}/children?target=into`, {\n            title: 'new note',\n            content: '',\n            type: 'text',\n            isProtected: todayNote.isProtected\n        });\n\n        await ws.waitForMaxKnownSyncId();\n\n        await appContext.tabManager.openTabWithNote(note.noteId, true);\n\n        appContext.triggerEvent('focusAndSelectTitle');\n    }\n\n    async toggleNoteHoistingCommand() {\n        const note = appContext.tabManager.getActiveTabNote();\n\n        const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n        if (note.noteId === hoistedNoteId) {\n            hoistedNoteService.unhoist();\n        }\n        else if (note.type !== 'search') {\n            hoistedNoteService.setHoistedNoteId(note.noteId);\n        }\n    }\n\n    copyWithoutFormattingCommand() {\n        utils.copySelectionToClipboard();\n    }\n\n    toggleFullscreenCommand() {\n        if (utils.isElectron()) {\n            const win = utils.dynamicRequire('electron').remote.getCurrentWindow();\n\n            if (win.isFullScreenable()) {\n                win.setFullScreen(!win.isFullScreen());\n            }\n        }\n        else {\n            // outside of electron this is handled by the browser\n            this.$widget.find(\".toggle-fullscreen-button\").hide();\n        }\n    }\n\n    toggleZenModeCommand() {\n        if (!this.zenModeActive) {\n            $(\".hide-in-zen-mode,.gutter\").addClass(\"hidden-by-zen-mode\");\n            $(\"#root-widget\").addClass(\"zen-mode\");\n            this.zenModeActive = true;\n        }\n        else {\n            // not hiding / showing explicitly since element might be hidden also for other reasons\n            $(\".hide-in-zen-mode,.gutter\").removeClass(\"hidden-by-zen-mode\");\n            $(\"#root-widget\").removeClass(\"zen-mode\");\n            this.zenModeActive = false;\n        }\n    }\n\n    reloadFrontendAppCommand() {\n        utils.reloadApp();\n    }\n\n    logoutCommand() {\n        const $logoutForm = $('<form action=\"logout\" method=\"POST\">')\n            .append($(`<input type=\"hidden\" name=\"_csrf\" value=\"${glob.csrfToken}\"/>`));\n\n        $(\"body\").append($logoutForm);\n        $logoutForm.trigger('submit');\n    }\n\n    backInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('electron').remote.getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex - 1);\n        }\n        else {\n            window.history.back();\n        }\n    }\n\n    forwardInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('electron').remote.getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex + 1);\n        }\n        else {\n            window.history.forward();\n        }\n    }\n\n    async searchForResultsCommand({searchText}) {\n        const response = await server.get('search/' + encodeURIComponent(searchText));\n\n        if (!response.success) {\n            toastService.showError(\"Search failed.\", 3000);\n            return;\n        }\n\n        this.triggerEvent('searchResults', {results: response.results});\n\n        // have at least some feedback which is good especially in situations\n        // when the result list does not change with a query\n        toastService.showMessage(\"Search finished successfully.\");\n    }\n\n    async switchToDesktopVersionCommand() {\n        utils.setCookie('trilium-device', 'desktop');\n\n        utils.reloadApp();\n    }\n\n    createTopLevelNoteCommand() { noteCreateService.createNewTopLevelNote(); }\n\n    async openInWindowCommand({notePath}) {\n        if (utils.isElectron()) {\n            const {ipcRenderer} = utils.dynamicRequire('electron');\n\n            ipcRenderer.send('create-extra-window', {notePath});\n        }\n        else {\n            const url = window.location.protocol + '//' + window.location.host + window.location.pathname + '?extra=1#' + notePath;\n\n            window.open(url, '', 'width=1000,height=800');\n        }\n    }\n\n    async openNewWindowCommand() {\n        this.openInWindowCommand({notePath: ''});\n    }\n\n    async runActiveNoteCommand() {\n        const note = appContext.tabManager.getActiveTabNote();\n\n        // ctrl+enter is also used elsewhere so make sure we're running only when appropriate\n        if (!note || note.type !== 'code') {\n            return;\n        }\n\n        if (note.mime.endsWith(\"env=frontend\")) {\n            await bundleService.getAndExecuteBundle(note.noteId);\n        }\n\n        if (note.mime.endsWith(\"env=backend\")) {\n            await server.post('script/run/' + note.noteId);\n        }\n\n        toastService.showMessage(\"Note executed\");\n    }\n}\n","import protectedSessionHolder from \"./protected_session_holder.js\";\nimport server from \"./server.js\";\nimport utils from \"./utils.js\";\nimport appContext from \"./app_context.js\";\nimport treeService from \"./tree.js\";\nimport Component from \"../widgets/component.js\";\nimport treeCache from \"./tree_cache.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\n\nclass TabContext extends Component {\n    /**\n     * @param {string|null} tabId\n     */\n    constructor(tabId = null) {\n        super();\n\n        this.tabId = tabId || utils.randomString(4);\n    }\n\n    setEmpty() {\n        this.triggerEvent('tabNoteSwitched', {\n            tabContext: this,\n            notePath: this.notePath\n        });\n    }\n\n    async setNote(inputNotePath, triggerSwitchEvent = true) {\n        const noteId = treeService.getNoteIdFromNotePath(inputNotePath);\n        let notePath;\n\n        if ((await treeCache.getNote(noteId)).isDeleted) {\n            // no point in trying to resolve canonical notePath\n            notePath = inputNotePath;\n        }\n        else {\n            notePath = await treeService.resolveNotePath(inputNotePath);\n\n            if (!notePath) {\n                console.error(`Cannot resolve note path ${inputNotePath}`);\n                return;\n            }\n\n            if (notePath === this.notePath) {\n                return;\n            }\n\n            if (await hoistedNoteService.checkNoteAccess(notePath) === false) {\n                return; // note is outside of hoisted subtree and user chose not to unhoist\n            }\n        }\n\n        await this.triggerEvent('beforeNoteSwitch', {tabContext: this});\n\n        utils.closeActiveDialog();\n\n        this.notePath = notePath;\n        this.noteId = noteId;\n\n        this.autoBookDisabled = false;\n        this.textPreviewDisabled = false;\n        this.codePreviewDisabled = false;\n\n        setTimeout(async () => {\n            // we include the note into recent list only if the user stayed on the note at least 5 seconds\n            if (notePath && notePath === this.notePath) {\n                await server.post('recent-notes', {\n                    noteId: this.note.noteId,\n                    notePath: this.notePath\n                });\n            }\n        }, 5000);\n\n        protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n        if (triggerSwitchEvent) {\n            await this.triggerEvent('tabNoteSwitched', {\n                tabContext: this,\n                notePath: this.notePath\n            });\n        }\n    }\n\n    /** @property {NoteShort} */\n    get note() {\n        return treeCache.notes[this.noteId];\n    }\n\n    /** @return {NoteComplement} */\n    async getNoteComplement() {\n        if (!this.noteId) {\n            return null;\n        }\n\n        return await treeCache.getNoteComplement(this.noteId);\n    }\n\n    isActive() {\n        return appContext.tabManager.activeTabId === this.tabId;\n    }\n\n    getTabState() {\n        if (!this.notePath) {\n            return null;\n        }\n\n        return {\n            tabId: this.tabId,\n            notePath: this.notePath,\n            active: this.isActive()\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            const note = await treeCache.getNote(this.noteId);\n\n            if (note.isDeleted) {\n                this.noteId = null;\n                this.notePath = null;\n\n                this.triggerEvent('tabNoteSwitched', {\n                    tabContext: this,\n                    notePath: this.notePath\n                });\n            }\n        }\n    }\n}\n\nexport default TabContext;\n","import Component from \"../widgets/component.js\";\nimport SpacedUpdate from \"./spaced_update.js\";\nimport server from \"./server.js\";\nimport options from \"./options.js\";\nimport treeCache from \"./tree_cache.js\";\nimport treeService from \"./tree.js\";\nimport utils from \"./utils.js\";\nimport TabContext from \"./tab_context.js\";\nimport appContext from \"./app_context.js\";\n\nexport default class TabManager extends Component {\n    constructor() {\n        super();\n\n        this.activeTabId = null;\n\n        this.tabsUpdate = new SpacedUpdate(async () => {\n            if (!appContext.isMainWindow) {\n                return;\n            }\n\n            const openTabs = this.tabContexts\n                .map(tc => tc.getTabState())\n                .filter(t => !!t);\n\n            await server.put('options', {\n                openTabs: JSON.stringify(openTabs)\n            });\n        });\n    }\n\n    /** @type {TabContext[]} */\n    get tabContexts() {\n        return this.children;\n    }\n\n    async loadTabs() {\n        const tabsToOpen = appContext.isMainWindow\n            ? (options.getJson('openTabs') || [])\n            : [];\n\n        // if there's notePath in the URL, make sure it's open and active\n        // (useful, among others, for opening clipped notes from clipper)\n        if (window.location.hash) {\n            const notePath = window.location.hash.substr(1);\n            const noteId = treeService.getNoteIdFromNotePath(notePath);\n\n            if (noteId && await treeCache.noteExists(noteId)) {\n                for (const tab of tabsToOpen) {\n                    tab.active = false;\n                }\n\n                const foundTab = tabsToOpen.find(tab => noteId === treeService.getNoteIdFromNotePath(tab.notePath));\n\n                if (foundTab) {\n                    foundTab.active = true;\n                }\n                else {\n                    tabsToOpen.push({\n                        notePath: notePath,\n                        active: true\n                    });\n                }\n            }\n        }\n\n        let filteredTabs = [];\n\n        for (const openTab of tabsToOpen) {\n            const noteId = treeService.getNoteIdFromNotePath(openTab.notePath);\n\n            if (await treeCache.noteExists(noteId)) {\n                // note doesn't exist so don't try to open tab for it\n                filteredTabs.push(openTab);\n            }\n        }\n\n        if (utils.isMobile()) {\n            // mobile frontend doesn't have tabs so show only the active tab\n            filteredTabs = filteredTabs.filter(tab => tab.active);\n        }\n\n        if (filteredTabs.length === 0) {\n            filteredTabs.push({\n                notePath: this.isMainWindow ? 'root' : '',\n                active: true\n            });\n        }\n\n        if (!filteredTabs.find(tab => tab.active)) {\n            filteredTabs[0].active = true;\n        }\n\n        await this.tabsUpdate.allowUpdateWithoutChange(async () => {\n            for (const tab of filteredTabs) {\n                await this.openTabWithNote(tab.notePath, tab.active, tab.tabId);\n            }\n        });\n    }\n\n    tabNoteSwitchedEvent({tabContext}) {\n        if (tabContext.isActive()) {\n            this.setCurrentNotePathToHash();\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    setCurrentNotePathToHash() {\n        const activeTabContext = this.getActiveTabContext();\n\n        if (window.history.length === 0 // first history entry\n            || (activeTabContext && activeTabContext.notePath !== treeService.getHashValueFromAddress()[0])) {\n            const url = '#' + (activeTabContext.notePath || \"\") + \"-\" + activeTabContext.tabId;\n\n            // using pushState instead of directly modifying document.location because it does not trigger hashchange\n            window.history.pushState(null, \"\", url);\n\n            document.title = \"Trilium Notes\";\n\n            if (activeTabContext.note) {\n                // it helps navigating in history if note title is included in the title\n                document.title += \" - \" + activeTabContext.note.title;\n            }\n        }\n\n        this.triggerEvent('activeNoteChanged'); // trigger this even in on popstate event\n    }\n\n    /** @return {TabContext[]} */\n    getTabContexts() {\n        return this.tabContexts;\n    }\n\n    /** @returns {TabContext} */\n    getTabContextById(tabId) {\n        return this.tabContexts.find(tc => tc.tabId === tabId);\n    }\n\n    /** @returns {TabContext} */\n    getActiveTabContext() {\n        return this.getTabContextById(this.activeTabId);\n    }\n\n    /** @returns {string|null} */\n    getActiveTabNotePath() {\n        const activeContext = this.getActiveTabContext();\n        return activeContext ? activeContext.notePath : null;\n    }\n\n    /** @return {NoteShort} */\n    getActiveTabNote() {\n        const activeContext = this.getActiveTabContext();\n        return activeContext ? activeContext.note : null;\n    }\n\n    /** @return {string|null} */\n    getActiveTabNoteId() {\n        const activeNote = this.getActiveTabNote();\n\n        return activeNote ? activeNote.noteId : null;\n    }\n\n    /** @return {string|null} */\n    getActiveTabNoteType() {\n        const activeNote = this.getActiveTabNote();\n\n        return activeNote ? activeNote.type : null;\n    }\n\n    async switchToTab(tabId, notePath) {\n        const tabContext = this.tabContexts.find(tc => tc.tabId === tabId)\n            || await this.openEmptyTab();\n\n        this.activateTab(tabContext.tabId);\n        await tabContext.setNote(notePath);\n    }\n\n    async openAndActivateEmptyTab() {\n        const tabContext = await this.openEmptyTab();\n\n        await this.activateTab(tabContext.tabId);\n\n        await tabContext.setEmpty();\n    }\n\n    async openEmptyTab(tabId) {\n        const tabContext = new TabContext(tabId);\n        this.child(tabContext);\n\n        await this.triggerEvent('newTabOpened', {tabContext});\n\n        return tabContext;\n    }\n\n    async openTabWithNote(notePath, activate, tabId = null) {\n        const tabContext = await this.openEmptyTab(tabId);\n\n        if (notePath) {\n            await tabContext.setNote(notePath, !activate); // if activate is false then send normal noteSwitched event\n        }\n\n        if (activate) {\n            this.activateTab(tabContext.tabId, false);\n\n            await this.triggerEvent('tabNoteSwitchedAndActivated', {\n                tabContext,\n                notePath: tabContext.notePath // resolved note path\n            });\n        }\n    }\n\n    async activateOrOpenNote(noteId) {\n        for (const tabContext of this.getTabContexts()) {\n            if (tabContext.note && tabContext.note.noteId === noteId) {\n                this.activateTab(tabContext.tabId);\n\n                return;\n            }\n        }\n\n        // if no tab with this note has been found we'll create new tab\n\n        await this.openTabWithNote(noteId, true);\n    }\n\n    activateTab(tabId, triggerEvent = true) {\n        if (tabId === this.activeTabId) {\n            return;\n        }\n\n        this.activeTabId = tabId;\n\n        if (triggerEvent) {\n            this.triggerEvent('activeTabChanged', {\n                tabContext: this.getTabContextById(tabId)\n            });\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n\n        this.setCurrentNotePathToHash();\n    }\n\n    async removeTab(tabId) {\n        const tabContextToRemove = this.getTabContextById(tabId);\n\n        if (!tabContextToRemove) {\n            return;\n        }\n\n        // close dangling autocompletes after closing the tab\n        $(\".aa-input\").autocomplete(\"close\");\n\n        await this.triggerEvent('beforeTabRemove', {tabId});\n\n        if (this.tabContexts.length <= 1) {\n            this.openAndActivateEmptyTab();\n        }\n        else if (tabContextToRemove.isActive()) {\n            const idx = this.tabContexts.findIndex(tc => tc.tabId === tabId);\n\n            if (idx === this.tabContexts.length - 1) {\n                this.activatePreviousTabCommand();\n            }\n            else {\n                this.activateNextTabCommand();\n            }\n        }\n\n        this.children = this.children.filter(tc => tc.tabId !== tabId);\n\n        this.triggerEvent('tabRemoved', {tabId});\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    tabReorderEvent({tabIdsInOrder}) {\n        const order = {};\n\n        for (const i in tabIdsInOrder) {\n            order[tabIdsInOrder[i]] = i;\n        }\n\n        this.children.sort((a, b) => order[a.tabId] < order[b.tabId] ? -1 : 1);\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    activateNextTabCommand() {\n        const oldIdx = this.tabContexts.findIndex(tc => tc.tabId === this.activeTabId);\n        const newActiveTabId = this.tabContexts[oldIdx === this.tabContexts.length - 1 ? 0 : oldIdx + 1].tabId;\n\n        this.activateTab(newActiveTabId);\n    }\n\n    activatePreviousTabCommand() {\n        const oldIdx = this.tabContexts.findIndex(tc => tc.tabId === this.activeTabId);\n        const newActiveTabId = this.tabContexts[oldIdx === 0 ? this.tabContexts.length - 1 : oldIdx - 1].tabId;\n\n        this.activateTab(newActiveTabId);\n    }\n\n    closeActiveTabCommand() {\n        this.removeTab(this.activeTabId);\n    }\n\n    beforeUnloadEvent() {\n        this.tabsUpdate.updateNowIfNecessary();\n    }\n\n    openNewTabCommand() {\n        this.openAndActivateEmptyTab();\n    }\n\n    async removeAllTabsCommand() {\n        for (const tabIdToRemove of this.tabContexts.map(tc => tc.tabId)) {\n            await this.removeTab(tabIdToRemove);\n        }\n    }\n\n    async removeAllTabsExceptForThisCommand({tabId}) {\n        for (const tabIdToRemove of this.tabContexts.map(tc => tc.tabId)) {\n            if (tabIdToRemove !== tabId) {\n                await this.removeTab(tabIdToRemove);\n            }\n        }\n    }\n\n    moveTabToNewWindowCommand({tabId}) {\n        const notePath = this.getTabContextById(tabId).notePath;\n\n        this.removeTab(tabId);\n\n        this.triggerCommand('openInWindow', {notePath});\n    }\n\n    async hoistedNoteChangedEvent({hoistedNoteId}) {\n        if (hoistedNoteId === 'root') {\n            return;\n        }\n\n        for (const tc of this.tabContexts.splice()) {\n            if (tc.notePath && !tc.notePath.split(\"/\").includes(hoistedNoteId)) {\n                await this.removeTab(tc.tabId);\n            }\n        }\n    }\n}\n","import Component from \"../component.js\";\n\nexport default class MobileScreenSwitcherExecutor extends Component {\n    setActiveScreenCommand({screen}) {\n        if (screen !== this.activeScreen) {\n            this.activeScreen = screen;\n\n            this.triggerEvent('activeScreenChanged', {activeScreen: screen});\n        }\n    }\n\n    initialRenderCompleteEvent() {\n        this.setActiveScreenCommand({screen: 'tree'});\n    }\n}","import appContext from \"./app_context.js\";\nimport noteCreateService from \"./note_create.js\";\nimport treeService from \"./tree.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport Component from \"../widgets/component.js\";\nimport ws from \"./ws.js\";\n\n/**\n * This class contains command executors which logically belong to the NoteTree widget, but for better user experience\n * the keyboard shortcuts must be active on the whole screen and not just on the widget itself, so the executors\n * must be at the root of the component tree.\n */\nexport default class MainTreeExecutors extends Component {\n    get tree() {\n        return appContext.mainTreeWidget;\n    }\n\n    async cloneNotesToCommand() {\n        const selectedOrActiveNoteIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.noteId);\n\n        this.triggerCommand('cloneNoteIdsTo', {noteIds: selectedOrActiveNoteIds});\n    }\n\n    async moveNotesToCommand() {\n        const selectedOrActiveBranchIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.branchId);\n\n        this.triggerCommand('moveBranchIdsTo', {branchIds: selectedOrActiveBranchIds});\n    }\n\n    async createNoteIntoCommand() {\n        const activeNote = appContext.tabManager.getActiveTabNote();\n\n        if (!activeNote) {\n            return;\n        }\n\n        await noteCreateService.createNote(activeNote.noteId, {\n            isProtected: activeNote.isProtected,\n            saveSelection: false\n        });\n    }\n\n    async createNoteAfterCommand() {\n        const node = this.tree.getActiveNode();\n        const parentNoteId = node.data.parentNoteId;\n        const isProtected = await treeService.getParentProtectedStatus(node);\n\n        if (node.data.noteId === 'root' || node.data.noteId === hoistedNoteService.getHoistedNoteId()) {\n            return;\n        }\n\n        await noteCreateService.createNote(parentNoteId, {\n            target: 'after',\n            targetBranchId: node.data.branchId,\n            isProtected: isProtected,\n            saveSelection: false\n        });\n    }\n}\n","import treeCache from \"./tree_cache.js\";\nimport bundleService from \"./bundle.js\";\nimport DialogCommandExecutor from \"./dialog_command_executor.js\";\nimport Entrypoints from \"./entrypoints.js\";\nimport options from \"./options.js\";\nimport utils from \"./utils.js\";\nimport zoomService from \"./zoom.js\";\nimport TabManager from \"./tab_manager.js\";\nimport treeService from \"./tree.js\";\nimport Component from \"../widgets/component.js\";\nimport keyboardActionsService from \"./keyboard_actions.js\";\nimport MobileScreenSwitcherExecutor from \"../widgets/mobile_widgets/mobile_screen_switcher.js\";\nimport MainTreeExecutors from \"./main_tree_executors.js\";\n\nclass AppContext extends Component {\n    constructor(isMainWindow) {\n        super();\n\n        this.isMainWindow = isMainWindow;\n        this.executors = [];\n    }\n\n    setLayout(layout) {\n        this.layout = layout;\n    }\n\n    async start() {\n        await Promise.all([treeCache.initializedPromise, options.initializedPromise]);\n\n        $(\"#loading-indicator\").hide();\n\n        this.showWidgets();\n\n        this.tabManager.loadTabs();\n\n        if (utils.isDesktop()) {\n            setTimeout(() => bundleService.executeStartupBundles(), 2000);\n        }\n    }\n\n    showWidgets() {\n        const rootWidget = this.layout.getRootWidget(this);\n        const $renderedWidget = rootWidget.render();\n\n        keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n        $(\"body\").append($renderedWidget);\n\n        $renderedWidget.on('click', \"[data-trigger-command]\", function() {\n            const commandName = $(this).attr('data-trigger-command');\n            const $component = $(this).closest(\".component\");\n            const component = $component.prop(\"component\");\n\n            component.triggerCommand(commandName, {$el: $(this)});\n        });\n\n        this.tabManager = new TabManager();\n\n        this.executors = [\n            this.tabManager,\n            new DialogCommandExecutor(),\n            new Entrypoints(),\n            new MainTreeExecutors()\n        ];\n\n        if (utils.isMobile()) {\n            this.executors.push(new MobileScreenSwitcherExecutor());\n        }\n\n        this.child(rootWidget);\n\n        for (const executor of this.executors) {\n            this.child(executor);\n        }\n\n        if (utils.isElectron()) {\n            this.child(zoomService);\n        }\n\n        this.triggerEvent('initialRenderComplete');\n    }\n\n    /** @return {Promise} */\n    triggerEvent(name, data) {\n        return this.handleEvent(name, data);\n    }\n\n    /** @return {Promise} */\n    triggerCommand(name, data = {}) {\n        for (const executor of this.executors) {\n            const fun = executor[name + \"Command\"];\n\n            if (fun) {\n                return executor.callMethod(fun, data);\n            }\n        }\n\n        // this might hint at error but sometimes this is used by components which are at different places\n        // in the component tree to communicate with each other\n        console.debug(`Unhandled command ${name}, converting to event.`);\n\n        return this.triggerEvent(name, data);\n    }\n\n    getComponentByEl(el) {\n        return $(el).closest(\".component\").prop('component');\n    }\n}\n\nconst appContext = new AppContext(window.glob.isMainWindow);\n\n// we should save all outstanding changes before the page/app is closed\n$(window).on('beforeunload', () => {\n    appContext.triggerEvent('beforeUnload');\n});\n\nfunction isNotePathInAddress() {\n    const [notePath, tabId] = treeService.getHashValueFromAddress();\n\n    return notePath.startsWith(\"root\")\n        // empty string is for empty/uninitialized tab\n        || (notePath === '' && !!tabId);\n}\n\n$(window).on('hashchange', function() {\n    if (isNotePathInAddress()) {\n        const [notePath, tabId] = treeService.getHashValueFromAddress();\n\n        if (!notePath) {\n            console.log(`Invalid hash value \"${document.location.hash}\", ignoring.`);\n            return;\n        }\n\n        appContext.tabManager.switchToTab(tabId, notePath);\n    }\n});\n\nexport default appContext;\n","import server from \"./server.js\";\n\n/**\n * @param $el - element on which to init autocomplete\n * @param attributeType - \"relation\" or \"label\" or callback providing one of those values as a type of autocompleted attributes\n * @param open - should the autocomplete be opened after init?\n */\nfunction initAttributeNameAutocomplete({ $el, attributeType, open }) {\n    if (!$el.hasClass(\"aa-input\")) {\n        $el.autocomplete({\n            appendTo: document.querySelector('body'),\n            hint: false,\n            openOnFocus: true,\n            minLength: 0,\n            tabAutocomplete: false\n        }, [{\n            displayKey: 'name',\n            // disabling cache is important here because otherwise cache can stay intact when switching between attribute type which will lead to autocomplete displaying attribute names for incorrect attribute type\n            cache: false,\n            source: async (term, cb) => {\n                const type = typeof attributeType === \"function\" ? attributeType() : attributeType;\n\n                const names = await server.get(`attributes/names/?type=${type}&query=${encodeURIComponent(term)}`);\n                const result = names.map(name => ({name}));\n\n                cb(result);\n            }\n        }]);\n    }\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nasync function initLabelValueAutocomplete({ $el, open }) {\n    if (!$el.hasClass(\"aa-input\")) {\n        const attributeName = $el.parent().parent().find('.attribute-name').val();\n\n        if (attributeName.trim() === \"\") {\n            return;\n        }\n\n        const attributeValues = (await server.get('attributes/values/' + encodeURIComponent(attributeName)))\n            .map(attribute => ({ value: attribute }));\n\n        if (attributeValues.length === 0) {\n            return;\n        }\n\n        $el.autocomplete({\n            appendTo: document.querySelector('body'),\n            hint: false,\n            openOnFocus: true,\n            minLength: 0,\n            tabAutocomplete: false\n        }, [{\n            displayKey: 'value',\n            source: function (term, cb) {\n                term = term.toLowerCase();\n\n                const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n                cb(filtered);\n            }\n        }]);\n    }\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nexport default {\n    initAttributeNameAutocomplete,\n    initLabelValueAutocomplete\n}","import utils from './utils.js';\nimport server from './server.js';\nimport toastService from \"./toast.js\";\nimport treeCache from \"./tree_cache.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport ws from \"./ws.js\";\n\nasync function moveBeforeBranch(branchIdsToMove, beforeBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n\n    if (beforeBranchId === 'root') {\n        alert('Cannot move notes before root note.');\n        return;\n    }\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-before/${beforeBranchId}`);\n\n        if (!resp.success) {\n            alert(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveAfterBranch(branchIdsToMove, afterBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n\n    const afterNote = await treeCache.getBranch(afterBranchId).getNote();\n\n    if (afterNote.noteId === 'root' || afterNote.noteId === hoistedNoteService.getHoistedNoteId()) {\n        alert('Cannot move notes after root note.');\n        return;\n    }\n\n    branchIdsToMove.reverse(); // need to reverse to keep the note order\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-after/${afterBranchId}`);\n\n        if (!resp.success) {\n            alert(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveToParentNote(branchIdsToMove, newParentBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const branchToMove = treeCache.getBranch(branchIdToMove);\n\n        if (branchToMove.noteId === hoistedNoteService.getHoistedNoteId()\n            || (await branchToMove.getParentNote()).type === 'search') {\n            continue;\n        }\n\n        const resp = await server.put(`branches/${branchIdToMove}/move-to/${newParentBranchId}`);\n\n        if (!resp.success) {\n            alert(resp.message);\n            return;\n        }\n    }\n}\n\nasync function deleteNotes(branchIdsToDelete) {\n    branchIdsToDelete = filterRootNote(branchIdsToDelete);\n\n    if (branchIdsToDelete.length === 0) {\n        return false;\n    }\n\n    const $deleteClonesCheckbox = $('<div class=\"form-check\">')\n        .append($('<input type=\"checkbox\" class=\"form-check-input\" id=\"delete-clones-checkbox\">'))\n        .append($('<label for=\"delete-clones-checkbox\">')\n                    .text(\"delete also all note clones\")\n                    .attr(\"title\", \"all clones of selected notes will be deleted and as such the whole note will be deleted.\"));\n\n    const $nodeTitles = $(\"<ul>\");\n\n    for (const branchId of branchIdsToDelete) {\n        const note = await treeCache.getBranch(branchId).getNote();\n\n        $nodeTitles.append($(\"<li>\").text(note.title));\n    }\n\n    const $confirmText = $(\"<div>\")\n        .append($(\"<p>\").text('This will delete the following notes and their sub-notes: '))\n        .append($nodeTitles)\n        .append($deleteClonesCheckbox);\n\n    const confirmDialog = await import('../dialogs/confirm.js');\n\n    if (!await confirmDialog.confirm($confirmText)) {\n        return false;\n    }\n\n    const deleteClones = $deleteClonesCheckbox.find(\"input\").is(\":checked\");\n\n    const taskId = utils.randomString(10);\n\n    let counter = 0;\n\n    for (const branchIdToDelete of branchIdsToDelete) {\n        counter++;\n\n        const last = counter === branchIdsToDelete.length;\n        const query = `?taskId=${taskId}&last=${last ? 'true' : 'false'}`;\n\n        const branch = treeCache.getBranch(branchIdToDelete);\n\n        if (deleteClones) {\n            await server.remove(`notes/${branch.noteId}` + query);\n        }\n        else {\n            await server.remove(`branches/${branchIdToDelete}` + query);\n        }\n    }\n\n    return true;\n}\n\nasync function moveNodeUpInHierarchy(node) {\n    if (hoistedNoteService.isRootNode(node)\n        || hoistedNoteService.isTopLevelNode(node)\n        || node.getParent().data.noteType === 'search') {\n        return;\n    }\n\n    const resp = await server.put('branches/' + node.data.branchId + '/move-after/' + node.getParent().data.branchId);\n\n    if (!resp.success) {\n        alert(resp.message);\n        return;\n    }\n\n    if (!hoistedNoteService.isTopLevelNode(node) && node.getParent().getChildren().length <= 1) {\n        node.getParent().folder = false;\n        node.getParent().renderTitle();\n    }\n}\n\nfunction filterRootNote(branchIds) {\n    const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n    return branchIds.filter(branchId => {\n       const branch = treeCache.getBranch(branchId);\n\n        return branch.noteId !== 'root'\n            && branch.noteId !== hoistedNoteId;\n    });\n}\n\nfunction makeToast(id, message) {\n    return {\n        id: id,\n        title: \"Delete status\",\n        message: message,\n        icon: \"trash\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'delete-notes') {\n        return;\n    }\n\n    if (message.type === 'task-error') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'task-progress-count') {\n        toastService.showPersistent(makeToast(message.taskId, \"Delete notes in progress: \" + message.progressCount));\n    } else if (message.type === 'task-succeeded') {\n        const toast = makeToast(message.taskId, \"Delete finished successfully.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'undelete-notes') {\n        return;\n    }\n\n    if (message.type === 'task-error') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'task-progress-count') {\n        toastService.showPersistent(makeToast(message.taskId, \"Undeleting notes in progress: \" + message.progressCount));\n    } else if (message.type === 'task-succeeded') {\n        const toast = makeToast(message.taskId, \"Undeleting notes finished successfully.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nasync function cloneNoteTo(childNoteId, parentBranchId, prefix) {\n    const resp = await server.put(`notes/${childNoteId}/clone-to/${parentBranchId}`, {\n        prefix: prefix\n    });\n\n    if (!resp.success) {\n        alert(resp.message);\n    }\n}\n\n// beware that first arg is noteId and second is branchId!\nasync function cloneNoteAfter(noteId, afterBranchId) {\n    const resp = await server.put('notes/' + noteId + '/clone-after/' + afterBranchId);\n\n    if (!resp.success) {\n        alert(resp.message);\n    }\n}\n\nexport default {\n    moveBeforeBranch,\n    moveAfterBranch,\n    moveToParentNote,\n    deleteNotes,\n    moveNodeUpInHierarchy,\n    cloneNoteAfter,\n    cloneNoteTo\n};\n","import ScriptContext from \"./script_context.js\";\nimport server from \"./server.js\";\nimport toastService from \"./toast.js\";\n\nasync function getAndExecuteBundle(noteId, originEntity = null) {\n    const bundle = await server.get('script/bundle/' + noteId);\n\n    return await executeBundle(bundle, originEntity);\n}\n\nasync function executeBundle(bundle, originEntity, $container) {\n    const apiContext = await ScriptContext(bundle.noteId, bundle.allNoteIds, originEntity, $container);\n\n    try {\n        return await (function () {\n            return eval(`const apiContext = this; (async function() { ${bundle.script}\\r\\n})()`);\n        }.call(apiContext));\n    }\n    catch (e) {\n        toastService.showAndLogError(`Execution of ${bundle.noteId} failed with error: ${e.message}`);\n    }\n}\n\nasync function executeStartupBundles() {\n    const scriptBundles = await server.get(\"script/startup\");\n\n    for (const bundle of scriptBundles) {\n        await executeBundle(bundle);\n    }\n}\n\nclass WidgetsByParent {\n    constructor() {\n        this.byParent = {};\n    }\n\n    add(widget) {\n        if (!widget.parentWidget) {\n            console.log(`Custom widget does not have mandatory 'getParent()' method defined`);\n            return;\n        }\n\n        this.byParent[widget.parentWidget] = this.byParent[widget.parentWidget] || [];\n        this.byParent[widget.parentWidget].push(widget);\n    }\n\n    get(parentName) {\n        return this.byParent[parentName] || [];\n    }\n}\n\nasync function getWidgetBundlesByParent() {\n    const scriptBundles = await server.get(\"script/widgets\");\n\n    const widgetsByParent = new WidgetsByParent();\n\n    for (const bundle of scriptBundles) {\n        let widget;\n\n        try {\n            widget = await executeBundle(bundle);\n        }\n        catch (e) {\n            console.error(\"Widget initialization failed: \", e);\n            continue;\n        }\n\n        widgetsByParent.add(widget);\n    }\n\n    return widgetsByParent;\n}\n\nexport default {\n    executeBundle,\n    getAndExecuteBundle,\n    executeStartupBundles,\n    getWidgetBundlesByParent\n}\n","import branchService from \"./branches.js\";\nimport toastService from \"./toast.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport treeCache from \"./tree_cache.js\";\n\nlet clipboardBranchIds = [];\nlet clipboardMode = null;\n\nasync function pasteAfter(afterBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveAfterBranch(clipboardBranchIds, afterBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => treeCache.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteAfter(clipboardNote.noteId, afterBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(\"Unrecognized clipboard mode=\" + clipboardMode);\n    }\n}\n\nasync function pasteInto(parentBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveToParentNote(clipboardBranchIds, parentBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => treeCache.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteTo(clipboardNote.noteId, parentBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(\"Unrecognized clipboard mode=\" + mode);\n    }\n}\n\nfunction copy(branchIds) {\n    clipboardBranchIds = branchIds;\n    clipboardMode = 'copy';\n\n    toastService.showMessage(\"Note(s) have been copied into clipboard.\");\n}\n\nfunction cut(branchIds) {\n    clipboardBranchIds = branchIds;\n\n    if (clipboardBranchIds.length > 0) {\n        clipboardMode = 'cut';\n\n        toastService.showMessage(\"Note(s) have been cut into clipboard.\");\n    }\n}\n\nfunction isClipboardEmpty() {\n    clipboardBranchIds = clipboardBranchIds.filter(branchId => !!treeCache.getBranch(branchId));\n\n    return clipboardBranchIds.length === 0;\n}\n\nexport default {\n    pasteAfter,\n    pasteInto,\n    cut,\n    copy,\n    isClipboardEmpty\n}\n","import keyboardActionService from './keyboard_actions.js';\n\nclass ContextMenu {\n    constructor() {\n        this.$widget = $(\"#context-menu-container\");\n        this.dateContextMenuOpenedMs = 0;\n\n        $(document).on('click', () => this.hide());\n    }\n    \n    async show(options) {\n        this.options = options;\n        \n        this.$widget.empty();\n\n        this.addItems(this.$widget, options.items);\n\n        keyboardActionService.updateDisplayedShortcuts(this.$widget);\n\n        this.positionMenu();\n\n        this.dateContextMenuOpenedMs = Date.now();\n    }\n\n    positionMenu() {\n        // code below tries to detect when dropdown would overflow from page\n        // in such case we'll position it above click coordinates so it will fit into client\n        const clientHeight = document.documentElement.clientHeight;\n        const contextMenuHeight = this.$widget.outerHeight() + 30;\n        let top;\n\n        if (this.options.y + contextMenuHeight > clientHeight) {\n            top = clientHeight - contextMenuHeight - 10;\n        } else {\n            top = this.options.y - 10;\n        }\n\n        this.$widget.css({\n            display: \"block\",\n            top: top,\n            left: this.options.x - 20\n        }).addClass(\"show\");\n    }\n\n    addItems($parent, items) {\n        for (const item of items) {\n            if (item.title === '----') {\n                $parent.append($(\"<div>\").addClass(\"dropdown-divider\"));\n            } else {\n                const $icon = $(\"<span>\");\n\n                if (item.uiIcon) {\n                    $icon.addClass(\"bx bx-\" + item.uiIcon);\n                } else {\n                    $icon.append(\"&nbsp;\");\n                }\n\n                const $link = $(\"<span>\")\n                    .append($icon)\n                    .append(\" &nbsp; \") // some space between icon and text\n                    .append(item.title);\n\n                const $item = $(\"<li>\")\n                    .addClass(\"dropdown-item\")\n                    .append($link)\n                    // important to use mousedown instead of click since the former does not change focus\n                    // (especially important for focused text for spell check)\n                    .on('mousedown', (e) => {\n                        e.stopPropagation();\n\n                        this.hide();\n\n                        if (item.handler) {\n                            item.handler(item, e);\n                        }\n\n                        this.options.selectMenuItemHandler(item, e);\n\n                        // it's important to stop the propagation especially for sub-menus, otherwise the event\n                        // might be handled again by top-level menu\n                        return false;\n                    });\n\n                if (item.enabled !== undefined && !item.enabled) {\n                    $item.addClass(\"disabled\");\n                }\n\n                if (item.items) {\n                    $item.addClass(\"dropdown-submenu\");\n                    $link.addClass(\"dropdown-toggle\");\n\n                    const $subMenu = $(\"<ul>\").addClass(\"dropdown-menu\");\n\n                    this.addItems($subMenu, item.items);\n\n                    $item.append($subMenu);\n                }\n\n                $parent.append($item);\n            }\n        }\n    }\n\n    hide() {\n        // this date checking comes from change in FF66 - https://github.com/zadam/trilium/issues/468\n        // \"contextmenu\" event also triggers \"click\" event which depending on the timing can close just opened context menu\n        // we might filter out right clicks, but then it's better if even right clicks close the context menu\n        if (Date.now() - this.dateContextMenuOpenedMs > 300) {\n            this.$widget.hide();\n        }\n    }\n}\n\nconst contextMenu = new ContextMenu();\n\nexport default contextMenu;","import treeCache from \"./tree_cache.js\";\nimport server from \"./server.js\";\n\n/** @return {NoteShort} */\nasync function getTodayNote() {\n    return await getDateNote(dayjs().format(\"YYYY-MM-DD\"));\n}\n\n/** @return {NoteShort} */\nasync function getDateNote(date) {\n    const note = await server.get('date-notes/date/' + date, \"date-note\");\n\n    return await treeCache.getNote(note.noteId);\n}\n\n/** @return {NoteShort} */\nasync function getMonthNote(month) {\n    const note = await server.get('date-notes/month/' + month, \"date-note\");\n\n    return await treeCache.getNote(note.noteId);\n}\n\n/** @return {NoteShort} */\nasync function getYearNote(year) {\n    const note = await server.get('date-notes/year/' + year, \"date-note\");\n\n    return await treeCache.getNote(note.noteId);\n}\n\nexport default {\n    getTodayNote,\n    getDateNote,\n    getMonthNote,\n    getYearNote\n}","import options from './options.js';\nimport appContext from \"./app_context.js\";\nimport treeService from \"./tree.js\";\n\nfunction getHoistedNoteId() {\n    return options.get('hoistedNoteId');\n}\n\nasync function setHoistedNoteId(noteId) {\n    await options.save('hoistedNoteId', noteId);\n\n    // FIXME - just use option load event\n    appContext.triggerEvent('hoistedNoteChanged', {noteId});\n}\n\nasync function unhoist() {\n    await setHoistedNoteId('root');\n}\n\nfunction isTopLevelNode(node) {\n    return isRootNode(node.getParent());\n}\n\nfunction isRootNode(node) {\n    // even though check for 'root' should not be necessary, we keep it just in case\n    return node.data.noteId === \"root\"\n        || node.data.noteId === getHoistedNoteId();\n}\n\nasync function checkNoteAccess(notePath) {\n    // notePath argument can contain only noteId which is not good when hoisted since\n    // then we need to check the whole note path\n    const runNotePath = await treeService.getRunPath(notePath);\n\n    if (!runNotePath) {\n        console.log(\"Cannot activate \" + notePath);\n        return false;\n    }\n\n    const hoistedNoteId = getHoistedNoteId();\n\n    if (hoistedNoteId !== 'root' && !runNotePath.includes(hoistedNoteId)) {\n        const confirmDialog = await import('../dialogs/confirm.js');\n\n        if (!await confirmDialog.confirm(\"Requested note is outside of hoisted note subtree and you must unhoist to access the note. Do you want to proceed with unhoisting?\")) {\n            return false;\n        }\n\n        // unhoist so we can activate the note\n        await unhoist();\n    }\n\n    return true;\n}\n\nexport default {\n    getHoistedNoteId,\n    setHoistedNoteId,\n    unhoist,\n    isTopLevelNode,\n    isRootNode,\n    checkNoteAccess\n}","import server from \"./server.js\";\nimport utils from \"./utils.js\";\nimport appContext from \"./app_context.js\";\n\nconst keyboardActionRepo = {};\n\nconst keyboardActionsLoaded = server.get('keyboard-actions').then(actions => {\n\tactions = actions.filter(a => !!a.actionName); // filter out separators\n\n\tfor (const action of actions) {\n\t\taction.effectiveShortcuts = action.effectiveShortcuts.filter(shortcut => !shortcut.startsWith(\"global:\"));\n\n\t\tkeyboardActionRepo[action.actionName] = action;\n\t}\n\n\treturn actions;\n});\n\nasync function getActionsForScope(scope) {\n\tconst actions = await keyboardActionsLoaded;\n\n\treturn actions.filter(action => action.scope === scope);\n}\n\nasync function setupActionsForElement(scope, $el, component) {\n\tconst actions = await getActionsForScope(scope);\n\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tutils.bindElShortcut($el, shortcut, () => component.triggerCommand(action.actionName));\n\t\t}\n\t}\n}\n\ngetActionsForScope(\"window\").then(actions => {\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tutils.bindGlobalShortcut(shortcut, () => appContext.triggerCommand(action.actionName));\n\t\t}\n\t}\n});\n\nserver.get('keyboard-shortcuts-for-notes').then(shortcutForNotes => {\n\tfor (const shortcut in shortcutForNotes) {\n\t\tutils.bindGlobalShortcut(shortcut, async () => {\n\t\t\tappContext.tabManager.getActiveTabContext().setNote(shortcutForNotes[shortcut]);\n\t\t});\n\t}\n});\n\nfunction setElementActionHandler($el, actionName, handler) {\n\tkeyboardActionsLoaded.then(() => {\n\t\tconst action = keyboardActionRepo[actionName];\n\n\t\tif (!action) {\n\t\t\tthrow new Error(`Cannot find keyboard action '${actionName}'`);\n\t\t}\n\n\t\t// not setting action.handler since this is not global\n\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tif (shortcut) {\n\t\t\t\tutils.bindElShortcut($el, shortcut, handler);\n\t\t\t}\n\t\t}\n\t});\n}\n\nasync function getAction(actionName, silent = false) {\n\tawait keyboardActionsLoaded;\n\n\tconst action = keyboardActionRepo[actionName];\n\n\tif (!action) {\n\t\tif (silent) {\n\t\t\tconsole.log(`Cannot find action ${actionName}`);\n\t\t}\n\t\telse {\n\t\t\tthrow new Error(`Cannot find action ${actionName}`);\n\t\t}\n\t}\n\n\treturn action;\n}\n\nfunction updateDisplayedShortcuts($container) {\n\t$container.find('kbd[data-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\t$(el).text(action.effectiveShortcuts.join(', '));\n\t\t}\n\t});\n\n\t$container.find('[data-trigger-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-trigger-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\tconst title = $(el).attr('title');\n\t\t\tconst shortcuts = action.effectiveShortcuts.join(', ');\n\t\t\tconst newTitle = !title || !title.trim() ? shortcuts : `${title} (${shortcuts})`;\n\n\t\t\t$(el).attr('title', newTitle);\n\t\t}\n\t});\n}\n\nexport default {\n\tsetElementActionHandler,\n\tupdateDisplayedShortcuts,\n\tsetupActionsForElement,\n\tgetActionsForScope\n};","const CKEDITOR = {\"js\": [\"libraries/ckeditor/ckeditor.js\"]};\n\nconst CODE_MIRROR = {\n    js: [\n        \"libraries/codemirror/codemirror.js\",\n        \"libraries/codemirror/addon/mode/loadmode.js\",\n        \"libraries/codemirror/addon/fold/xml-fold.js\",\n        \"libraries/codemirror/addon/edit/matchbrackets.js\",\n        \"libraries/codemirror/addon/edit/matchtags.js\",\n        \"libraries/codemirror/addon/search/match-highlighter.js\",\n        \"libraries/codemirror/mode/meta.js\",\n        \"libraries/codemirror/addon/lint/lint.js\",\n        \"libraries/codemirror/addon/lint/eslint.js\"\n    ],\n    css: [\n        \"libraries/codemirror/codemirror.css\",\n        \"libraries/codemirror/addon/lint/lint.css\"\n    ]\n};\n\nconst ESLINT = {js: [\"libraries/eslint.js\"]};\n\nconst COMMONMARK = {js: [\"libraries/commonmark.min.js\"]};\n\nconst RELATION_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\"\n    ],\n    css: [\n        \"stylesheets/relation_map.css\"\n    ]\n};\n\nconst LINK_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\",\n        \"libraries/springy.js\"\n    ],\n    css: [\n        \"stylesheets/link_map.css\"\n    ]\n};\n\nconst PRINT_THIS = {js: [\"libraries/printThis.js\"]};\n\nconst KNOCKOUT = {js: [\"libraries/knockout.min.js\"]};\n\nconst CALENDAR_WIDGET = {css: [\"stylesheets/calendar.css\"]};\n\nasync function requireLibrary(library) {\n    if (library.css) {\n        library.css.map(cssUrl => requireCss(cssUrl));\n    }\n\n    if (library.js) {\n        for (const scriptUrl of library.js) {\n            await requireScript(scriptUrl);\n        }\n    }\n}\n\n// we save the promises in case of the same script being required concurrently multiple times\nconst loadedScriptPromises = {};\n\nasync function requireScript(url) {\n    if (!loadedScriptPromises[url]) {\n        loadedScriptPromises[url] = $.ajax({\n            url: url,\n            dataType: \"script\",\n            cache: true\n        });\n    }\n\n    await loadedScriptPromises[url];\n}\n\nasync function requireCss(url) {\n    const cssLinks = Array\n        .from(document.querySelectorAll('link'))\n        .map(el => el.href);\n\n    if (!cssLinks.some(l => l.endsWith(url))) {\n        $('head').append($('<link rel=\"stylesheet\" type=\"text/css\" />').attr('href', url));\n    }\n}\n\nexport default {\n    requireCss,\n    requireLibrary,\n    CKEDITOR,\n    CODE_MIRROR,\n    ESLINT,\n    COMMONMARK,\n    RELATION_MAP,\n    LINK_MAP,\n    PRINT_THIS,\n    KNOCKOUT,\n    CALENDAR_WIDGET\n}","import treeService from './tree.js';\nimport contextMenu from \"./context_menu.js\";\nimport appContext from \"./app_context.js\";\n\nfunction getNotePathFromUrl(url) {\n    const notePathMatch = /#(root[A-Za-z0-9/]*)$/.exec(url);\n\n    return notePathMatch === null ? null : notePathMatch[1];\n}\n\nasync function createNoteLink(notePath, options = {}) {\n    if (!notePath || !notePath.trim()) {\n        console.error(\"Missing note path\");\n\n        return $(\"<span>\").text(\"[missing note]\");\n    }\n\n    let noteTitle = options.title;\n    const showTooltip = options.showTooltip === undefined ? true : options.showTooltip;\n    const showNotePath = options.showNotePath === undefined ? false : options.showNotePath;\n\n    if (!noteTitle) {\n        const {noteId, parentNoteId} = treeService.getNoteIdAndParentIdFromNotePath(notePath);\n\n        noteTitle = await treeService.getNoteTitle(noteId, parentNoteId);\n    }\n\n    const $noteLink = $(\"<a>\", {\n        href: 'javascript:',\n        text: noteTitle\n    }).attr('data-action', 'note')\n        .attr('data-note-path', notePath);\n\n    if (!showTooltip) {\n        $noteLink.addClass(\"no-tooltip-preview\");\n    }\n\n    const $container = $(\"<span>\").append($noteLink);\n\n    if (showNotePath) {\n        notePath = await treeService.resolveNotePath(notePath);\n\n        if (notePath) {\n            const noteIds = notePath.split(\"/\");\n            noteIds.pop(); // remove last element\n\n            const parentNotePath = noteIds.join(\"/\").trim();\n\n            if (parentNotePath) {\n                $container.append($(\"<small>\").text(\" (\" + await treeService.getNotePathTitle(parentNotePath) + \")\"));\n            }\n        }\n    }\n\n    return $container;\n}\n\nfunction getNotePathFromLink($link) {\n    const notePathAttr = $link.attr(\"data-note-path\");\n\n    if (notePathAttr) {\n        return notePathAttr;\n    }\n\n    const url = $link.attr('href');\n\n    return url ? getNotePathFromUrl(url) : null;\n}\n\nfunction goToLink(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const $link = $(e.target).closest(\"a\");\n\n    const notePath = getNotePathFromLink($link);\n\n    if (notePath) {\n        if ((e.which === 1 && e.ctrlKey) || e.which === 2) {\n            appContext.tabManager.openTabWithNote(notePath);\n        }\n        else if (e.which === 1) {\n            const activeTabContext = appContext.tabManager.getActiveTabContext();\n            activeTabContext.setNote(notePath);\n        }\n        else {\n            return false;\n        }\n    }\n    else {\n        if (e.which === 1) {\n            const address = $link.attr('href');\n\n            if (address && address.startsWith('http')) {\n                window.open(address, '_blank');\n            }\n        }\n        else {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nfunction linkContextMenu(e) {\n    const $link = $(e.target).closest(\"a\");\n\n    const notePath = getNotePathFromLink($link);\n\n    if (!notePath) {\n        return;\n    }\n\n    e.preventDefault();\n\n    contextMenu.show({\n        x: e.pageX,\n        y: e.pageY,\n        items: [\n            {title: \"Open note in new tab\", command: \"openNoteInNewTab\", uiIcon: \"empty\"},\n            {title: \"Open note in new window\", command: \"openNoteInNewWindow\", uiIcon: \"window-open\"}\n        ],\n        selectMenuItemHandler: ({command}) => {\n            if (command === 'openNoteInNewTab') {\n                appContext.tabManager.openTabWithNote(notePath);\n            }\n            else if (command === 'openNoteInNewWindow') {\n                appContext.openInNewWindow(notePath);\n            }\n        }\n    });\n}\n\n// when click on link popup, in case of internal link, just go the the referenced note instead of default behavior\n// of opening the link in new window/tab\n$(document).on('mousedown', \"a[data-action='note']\", goToLink);\n$(document).on('mousedown', 'div.popover-content a, div.ui-tooltip-content a', goToLink);\n$(document).on('dblclick', '.note-detail-text a', goToLink);\n$(document).on('mousedown', '.note-detail-text a:not(.reference-link)', function (e) {\n    const $link = $(e.target).closest(\"a\");\n    const notePath = getNotePathFromLink($link);\n\n    if ((e.which === 1 && e.ctrlKey) || e.which === 2) {\n        // if it's a ctrl-click, then we open on new tab, otherwise normal flow (CKEditor opens link-editing dialog)\n        e.preventDefault();\n\n        if (notePath) {\n            appContext.tabManager.openTabWithNote(notePath, false);\n        }\n        else {\n            const address = $link.attr('href');\n\n            window.open(address, '_blank');\n        }\n\n        return true;\n    }\n});\n\n$(document).on('mousedown', '.note-detail-book a', goToLink);\n$(document).on('mousedown', '.note-detail-render a', goToLink);\n$(document).on('mousedown', '.note-detail-text a.reference-link', goToLink);\n$(document).on('mousedown', '.note-detail-readonly-text a.reference-link', goToLink);\n$(document).on('mousedown', '.note-detail-readonly-text a', goToLink);\n$(document).on('mousedown', 'a.ck-link-actions__preview', goToLink);\n$(document).on('click', 'section.include-note a', goToLink);\n$(document).on('click', 'a.ck-link-actions__preview', e => {\n    e.preventDefault();\n    e.stopPropagation();\n});\n\n$(document).on('contextmenu', 'a.ck-link-actions__preview', linkContextMenu);\n$(document).on('contextmenu', '.note-detail-text a', linkContextMenu);\n$(document).on('contextmenu', '.note-detail-readonly-text a', linkContextMenu);\n$(document).on('contextmenu', \"a[data-action='note']\", linkContextMenu);\n$(document).on('contextmenu', \".note-detail-render a\", linkContextMenu);\n$(document).on('contextmenu', \".note-paths-widget a\", linkContextMenu);\n$(document).on('contextmenu', \"section.include-note a\", linkContextMenu);\n\nexport default {\n    getNotePathFromUrl,\n    createNoteLink,\n    goToLink\n};\n","import options from \"./options.js\";\n\nconst MIME_TYPES_DICT = [\n    { default: true, title: \"Plain text\", mime: \"text/plain\" },\n    { title: \"APL\", mime: \"text/apl\" },\n    { title: \"PGP\", mime: \"application/pgp\" },\n    { title: \"ASN.1\", mime: \"text/x-ttcn-asn\" },\n    { title: \"Asterisk\", mime: \"text/x-asterisk\" },\n    { title: \"Brainfuck\", mime: \"text/x-brainfuck\" },\n    { default: true, title: \"C\", mime: \"text/x-csrc\" },\n    { default: true, title: \"C++\", mime: \"text/x-c++src\" },\n    { title: \"Cobol\", mime: \"text/x-cobol\" },\n    { default: true, title: \"C#\", mime: \"text/x-csharp\" },\n    { title: \"Clojure\", mime: \"text/x-clojure\" },\n    { title: \"ClojureScript\", mime: \"text/x-clojurescript\" },\n    { title: \"Closure Stylesheets (GSS)\", mime: \"text/x-gss\" },\n    { title: \"CMake\", mime: \"text/x-cmake\" },\n    { title: \"CoffeeScript\", mime: \"text/coffeescript\" },\n    { title: \"Common Lisp\", mime: \"text/x-common-lisp\" },\n    { title: \"Cypher\", mime: \"application/x-cypher-query\" },\n    { title: \"Cython\", mime: \"text/x-cython\" },\n    { title: \"Crystal\", mime: \"text/x-crystal\" },\n    { default: true, title: \"CSS\", mime: \"text/css\" },\n    { title: \"CQL\", mime: \"text/x-cassandra\" },\n    { title: \"D\", mime: \"text/x-d\" },\n    { title: \"Dart\", mime: \"application/dart\" },\n    { title: \"diff\", mime: \"text/x-diff\" },\n    { title: \"Django\", mime: \"text/x-django\" },\n    { title: \"Dockerfile\", mime: \"text/x-dockerfile\" },\n    { title: \"DTD\", mime: \"application/xml-dtd\" },\n    { title: \"Dylan\", mime: \"text/x-dylan\" },\n    { title: \"EBNF\", mime: \"text/x-ebnf\" },\n    { title: \"ECL\", mime: \"text/x-ecl\" },\n    { title: \"edn\", mime: \"application/edn\" },\n    { title: \"Eiffel\", mime: \"text/x-eiffel\" },\n    { title: \"Elm\", mime: \"text/x-elm\" },\n    { title: \"Embedded Javascript\", mime: \"application/x-ejs\" },\n    { title: \"Embedded Ruby\", mime: \"application/x-erb\" },\n    { title: \"Erlang\", mime: \"text/x-erlang\" },\n    { title: \"Esper\", mime: \"text/x-esper\" },\n    { title: \"Factor\", mime: \"text/x-factor\" },\n    { title: \"FCL\", mime: \"text/x-fcl\" },\n    { title: \"Forth\", mime: \"text/x-forth\" },\n    { title: \"Fortran\", mime: \"text/x-fortran\" },\n    { title: \"F#\", mime: \"text/x-fsharp\" },\n    { title: \"Gas\", mime: \"text/x-gas\" },\n    { title: \"Gherkin\", mime: \"text/x-feature\" },\n    { title: \"GitHub Flavored Markdown\", mime: \"text/x-gfm\" },\n    { default: true, title: \"Go\", mime: \"text/x-go\" },\n    { default: true, title: \"Groovy\", mime: \"text/x-groovy\" },\n    { title: \"HAML\", mime: \"text/x-haml\" },\n    { default: true, title: \"Haskell\", mime: \"text/x-haskell\" },\n    { title: \"Haskell (Literate)\", mime: \"text/x-literate-haskell\" },\n    { title: \"Haxe\", mime: \"text/x-haxe\" },\n    { title: \"HXML\", mime: \"text/x-hxml\" },\n    { title: \"ASP.NET\", mime: \"application/x-aspx\" },\n    { default: true, title: \"HTML\", mime: \"text/html\" },\n    { default: true, title: \"HTTP\", mime: \"message/http\" },\n    { title: \"IDL\", mime: \"text/x-idl\" },\n    { title: \"Pug\", mime: \"text/x-pug\" },\n    { default: true, title: \"Java\", mime: \"text/x-java\" },\n    { title: \"Java Server Pages\", mime: \"application/x-jsp\" },\n    { default: true, title: 'JS frontend', mime: 'application/javascript;env=frontend' },\n    { default: true, title: 'JS backend', mime: 'application/javascript;env=backend' },\n    { default: true, title: \"JSON\", mime: \"application/json\" },\n    { title: \"JSON-LD\", mime: \"application/ld+json\" },\n    { title: \"JSX\", mime: \"text/jsx\" },\n    { title: \"Jinja2\", mime: \"text/jinja2\" },\n    { title: \"Julia\", mime: \"text/x-julia\" },\n    { default: true, title: \"Kotlin\", mime: \"text/x-kotlin\" },\n    { title: \"LESS\", mime: \"text/x-less\" },\n    { title: \"LiveScript\", mime: \"text/x-livescript\" },\n    { title: \"Lua\", mime: \"text/x-lua\" },\n    { default: true, title: \"Markdown\", mime: \"text/x-markdown\" },\n    { title: \"mIRC\", mime: \"text/mirc\" },\n    { title: \"MariaDB SQL\", mime: \"text/x-mariadb\" },\n    { title: \"Mathematica\", mime: \"text/x-mathematica\" },\n    { title: \"Modelica\", mime: \"text/x-modelica\" },\n    { title: \"MUMPS\", mime: \"text/x-mumps\" },\n    { title: \"MS SQL\", mime: \"text/x-mssql\" },\n    { title: \"mbox\", mime: \"application/mbox\" },\n    { title: \"MySQL\", mime: \"text/x-mysql\" },\n    { title: \"Nginx\", mime: \"text/x-nginx-conf\" },\n    { title: \"NSIS\", mime: \"text/x-nsis\" },\n    { title: \"NTriples\", mime: \"application/n-triples\" },\n    { title: \"Objective-C\", mime: \"text/x-objectivec\" },\n    { title: \"OCaml\", mime: \"text/x-ocaml\" },\n    { title: \"Octave\", mime: \"text/x-octave\" },\n    { title: \"Oz\", mime: \"text/x-oz\" },\n    { title: \"Pascal\", mime: \"text/x-pascal\" },\n    { title: \"PEG.js\", mime: \"null\" },\n    { default: true, title: \"Perl\", mime: \"text/x-perl\" },\n    { default: true, title: \"PHP\", mime: \"text/x-php\" },\n    { title: \"Pig\", mime: \"text/x-pig\" },\n    { title: \"PLSQL\", mime: \"text/x-plsql\" },\n    { title: \"PostgreSQL\", mime: \"text/x-pgsql\" },\n    { title: \"PowerShell\", mime: \"application/x-powershell\" },\n    { title: \"Properties files\", mime: \"text/x-properties\" },\n    { title: \"ProtoBuf\", mime: \"text/x-protobuf\" },\n    { default: true, title: \"Python\", mime: \"text/x-python\" },\n    { title: \"Puppet\", mime: \"text/x-puppet\" },\n    { title: \"Q\", mime: \"text/x-q\" },\n    { title: \"R\", mime: \"text/x-rsrc\" },\n    { title: \"reStructuredText\", mime: \"text/x-rst\" },\n    { title: \"RPM Changes\", mime: \"text/x-rpm-changes\" },\n    { title: \"RPM Spec\", mime: \"text/x-rpm-spec\" },\n    { default: true, title: \"Ruby\", mime: \"text/x-ruby\" },\n    { title: \"Rust\", mime: \"text/x-rustsrc\" },\n    { title: \"SAS\", mime: \"text/x-sas\" },\n    { title: \"Sass\", mime: \"text/x-sass\" },\n    { title: \"Scala\", mime: \"text/x-scala\" },\n    { title: \"Scheme\", mime: \"text/x-scheme\" },\n    { title: \"SCSS\", mime: \"text/x-scss\" },\n    { default: true, title: \"Shell\", mime: \"text/x-sh\" },\n    { title: \"Sieve\", mime: \"application/sieve\" },\n    { title: \"Slim\", mime: \"text/x-slim\" },\n    { title: \"Smalltalk\", mime: \"text/x-stsrc\" },\n    { title: \"Smarty\", mime: \"text/x-smarty\" },\n    { title: \"Solr\", mime: \"text/x-solr\" },\n    { title: \"SML\", mime: \"text/x-sml\" },\n    { title: \"Soy\", mime: \"text/x-soy\" },\n    { title: \"SPARQL\", mime: \"application/sparql-query\" },\n    { title: \"Spreadsheet\", mime: \"text/x-spreadsheet\" },\n    { default: true, title: \"SQL\", mime: \"text/x-sql\" },\n    { title: \"SQLite\", mime: \"text/x-sqlite\" },\n    { title: \"Squirrel\", mime: \"text/x-squirrel\" },\n    { title: \"Stylus\", mime: \"text/x-styl\" },\n    { default: true, title: \"Swift\", mime: \"text/x-swift\" },\n    { title: \"sTeX\", mime: \"text/x-stex\" },\n    { title: \"LaTeX\", mime: \"text/x-latex\" },\n    { title: \"SystemVerilog\", mime: \"text/x-systemverilog\" },\n    { title: \"Tcl\", mime: \"text/x-tcl\" },\n    { title: \"Textile\", mime: \"text/x-textile\" },\n    { title: \"TiddlyWiki \", mime: \"text/x-tiddlywiki\" },\n    { title: \"Tiki wiki\", mime: \"text/tiki\" },\n    { title: \"TOML\", mime: \"text/x-toml\" },\n    { title: \"Tornado\", mime: \"text/x-tornado\" },\n    { title: \"troff\", mime: \"text/troff\" },\n    { title: \"TTCN\", mime: \"text/x-ttcn\" },\n    { title: \"TTCN_CFG\", mime: \"text/x-ttcn-cfg\" },\n    { title: \"Turtle\", mime: \"text/turtle\" },\n    { title: \"TypeScript\", mime: \"application/typescript\" },\n    { title: \"TypeScript-JSX\", mime: \"text/typescript-jsx\" },\n    { title: \"Twig\", mime: \"text/x-twig\" },\n    { title: \"Web IDL\", mime: \"text/x-webidl\" },\n    { title: \"VB.NET\", mime: \"text/x-vb\" },\n    { title: \"VBScript\", mime: \"text/vbscript\" },\n    { title: \"Velocity\", mime: \"text/velocity\" },\n    { title: \"Verilog\", mime: \"text/x-verilog\" },\n    { title: \"VHDL\", mime: \"text/x-vhdl\" },\n    { title: \"Vue.js Component\", mime: \"text/x-vue\" },\n    { default: true, title: \"XML\", mime: \"text/xml\" },\n    { title: \"XQuery\", mime: \"application/xquery\" },\n    { title: \"Yacas\", mime: \"text/x-yacas\" },\n    { default: true, title: \"YAML\", mime: \"text/x-yaml\" },\n    { title: \"Z80\", mime: \"text/x-z80\" },\n    { title: \"mscgen\", mime: \"text/x-mscgen\" },\n    { title: \"xu\", mime: \"text/x-xu\" },\n    { title: \"msgenny\", mime: \"text/x-msgenny\" }\n];\n\nlet mimeTypes = null;\n\nfunction loadMimeTypes() {\n    mimeTypes = JSON.parse(JSON.stringify(MIME_TYPES_DICT)); // clone\n\n    const enabledMimeTypes = options.getJson('codeNotesMimeTypes')\n        || MIME_TYPES_DICT.filter(mt => mt.default).map(mt => mt.mime);\n\n    for (const mt of mimeTypes) {\n        mt.enabled = enabledMimeTypes.includes(mt.mime) || mt.mime === 'text/plain'; // text/plain is always enabled\n    }\n}\n\nasync function getMimeTypes() {\n    if (mimeTypes === null) {\n        loadMimeTypes();\n    }\n\n    return mimeTypes;\n}\n\nexport default {\n    getMimeTypes,\n    loadMimeTypes\n}","/**\n * Purpose of this class is to cache list of attributes for notes.\n *\n * Cache invalidation granularity is global - whenever a write operation is detected to notes, branches or attributes\n * we invalidate the whole cache. That's OK, since the purpose for this is to speed up batch read-only operations, such\n * as loading the tree which uses attributes heavily.\n */\nclass NoteAttributeCache {\n    constructor() {\n        this.attributes = {};\n    }\n\n    invalidate() {\n        this.attributes = {};\n    }\n}\n\nconst noteAttributeCache = new NoteAttributeCache();\n\nexport default noteAttributeCache;","import server from \"./server.js\";\nimport appContext from \"./app_context.js\";\nimport utils from './utils.js';\n\n// this key needs to have this value so it's hit by the tooltip\nconst SELECTED_PATH_KEY = \"data-note-path\";\n\nasync function autocompleteSource(term, cb) {\n    const result = await server.get('autocomplete'\n        + '?query=' + encodeURIComponent(term)\n        + '&activeNoteId=' + appContext.tabManager.getActiveTabNoteId());\n\n    if (result.length === 0) {\n        result.push({\n            pathTitle: \"No results\",\n            path: \"\"\n        });\n    }\n\n    cb(result);\n}\n\nfunction clearText($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedPath(\"\");\n    $el.autocomplete(\"val\", \"\").trigger('change');\n}\n\nfunction showRecentNotes($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedPath(\"\");\n    $el.autocomplete(\"val\", \"\");\n    $el.trigger('focus');\n}\n\nfunction initNoteAutocomplete($el, options) {\n    if ($el.hasClass(\"note-autocomplete-input\") || utils.isMobile()) {\n        return $el;\n    }\n\n    options = options || {};\n\n    $el.addClass(\"note-autocomplete-input\");\n\n    const $clearTextButton = $(\"<a>\")\n            .addClass(\"input-group-text input-clearer-button bx bx-x\")\n            .prop(\"title\", \"Clear text field\");\n\n    const $showRecentNotesButton = $(\"<a>\")\n            .addClass(\"input-group-text show-recent-notes-button bx bx-time\")\n            .prop(\"title\", \"Show recent notes\");\n\n    const $goToSelectedNoteButton = $(\"<a>\")\n        .addClass(\"input-group-text go-to-selected-note-button bx bx-arrow-to-right\")\n        .attr(\"data-action\", \"note\");\n\n    const $sideButtons = $(\"<div>\")\n        .addClass(\"input-group-append\")\n        .append($clearTextButton)\n        .append($showRecentNotesButton);\n\n    if (!options.hideGoToSelectedNoteButton) {\n        $sideButtons.append($goToSelectedNoteButton);\n    }\n\n    $el.after($sideButtons);\n\n    $clearTextButton.on('click', () => clearText($el));\n\n    $showRecentNotesButton.on('click', e => {\n        showRecentNotes($el);\n\n        // this will cause the click not give focus to the \"show recent notes\" button\n        // this is important because otherwise input will lose focus immediatelly and not show the results\n        return false;\n    });\n\n    $el.autocomplete({\n        appendTo: document.querySelector('body'),\n        hint: false,\n        autoselect: true,\n        openOnFocus: true,\n        minLength: 0,\n        tabAutocomplete: false\n    }, [\n        {\n            source: autocompleteSource,\n            displayKey: 'pathTitle',\n            templates: {\n                suggestion: function(suggestion) {\n                    return suggestion.highlightedTitle;\n                }\n            },\n            // we can't cache identical searches because notes can be created / renamed, new recent notes can be added\n            cache: false\n        }\n    ]);\n\n    $el.on('autocomplete:selected', (event, suggestion) => $el.setSelectedPath(suggestion.path));\n    $el.on('autocomplete:closed', () => {\n        if (!$el.val().trim()) {\n            clearText($el);\n        }\n    });\n\n    return $el;\n}\n\nfunction init() {\n    $.fn.getSelectedPath = function () {\n        if (!$(this).val().trim()) {\n            return \"\";\n        } else {\n            return $(this).attr(SELECTED_PATH_KEY);\n        }\n    };\n\n    $.fn.setSelectedPath = function (path) {\n        path = path || \"\";\n\n        $(this).attr(SELECTED_PATH_KEY, path);\n\n        $(this)\n            .closest(\".input-group\")\n            .find(\".go-to-selected-note-button\")\n            .toggleClass(\"disabled\", !path.trim())\n            .attr(SELECTED_PATH_KEY, path); // we also set attr here so tooltip can be displayed\n    };\n}\n\nexport default {\n    autocompleteSource,\n    initNoteAutocomplete,\n    showRecentNotes,\n    init\n}","import hoistedNoteService from \"./hoisted_note.js\";\nimport appContext from \"./app_context.js\";\nimport utils from \"./utils.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\nimport treeCache from \"./tree_cache.js\";\nimport toastService from \"./toast.js\";\n\nasync function createNewTopLevelNote() {\n    const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n    await createNote(hoistedNoteId);\n}\n\nasync function createNote(parentNoteId, options = {}) {\n    options = Object.assign({\n        activate: true,\n        target: 'into'\n    }, options);\n\n    // if isProtected isn't available (user didn't enter password yet), then note is created as unencrypted\n    // but this is quite weird since user doesn't see WHERE the note is being created so it shouldn't occur often\n    if (!options.isProtected || !protectedSessionHolder.isProtectedSessionAvailable()) {\n        options.isProtected = false;\n    }\n\n    if (appContext.tabManager.getActiveTabNoteType() !== 'text') {\n        options.saveSelection = false;\n    }\n\n    if (options.saveSelection && utils.isCKEditorInitialized()) {\n        [options.title, options.content] = parseSelectedHtml(window.cutToNote.getSelectedHtml());\n    }\n\n    const newNoteName = options.title || \"new note\";\n\n    const {note, branch} = await server.post(`notes/${parentNoteId}/children?target=${options.target}&targetBranchId=${options.targetBranchId}`, {\n        title: newNoteName,\n        content: options.content || \"\",\n        isProtected: options.isProtected,\n        type: options.type\n    });\n\n    if (options.saveSelection && utils.isCKEditorInitialized()) {\n        // we remove the selection only after it was saved to server to make sure we don't lose anything\n        window.cutToNote.removeSelection();\n    }\n\n    if (options.activate) {\n        await ws.waitForMaxKnownSyncId();\n\n        const activeTabContext = appContext.tabManager.getActiveTabContext();\n        await activeTabContext.setNote(note.noteId);\n\n        appContext.triggerCommand('focusAndSelectTitle');\n    }\n\n    return {note, branch};\n}\n\n/* If first element is heading, parse it out and use it as a new heading. */\nfunction parseSelectedHtml(selectedHtml) {\n    const dom = $.parseHTML(selectedHtml);\n\n    if (dom.length > 0 && dom[0].tagName && dom[0].tagName.match(/h[1-6]/i)) {\n        const title = $(dom[0]).text();\n        // remove the title from content (only first occurence)\n        const content = selectedHtml.replace(dom[0].outerHTML, \"\");\n\n        return [title, content];\n    }\n    else {\n        return [null, selectedHtml];\n    }\n}\n\nasync function duplicateNote(noteId, parentNoteId) {\n    const {note} = await server.post(`notes/${noteId}/duplicate/${parentNoteId}`);\n\n    await ws.waitForMaxKnownSyncId();\n\n    await appContext.tabManager.activateOrOpenNote(note.noteId);\n\n    const origNote = await treeCache.getNote(noteId);\n    toastService.showMessage(`Note \"${origNote.title}\" has been duplicated`);\n}\n\nexport default {\n    createNote,\n    createNewTopLevelNote,\n    duplicateNote\n};","import treeService from \"./tree.js\";\nimport linkService from \"./link.js\";\nimport treeCache from \"./tree_cache.js\";\nimport utils from \"./utils.js\";\n\nfunction setupGlobalTooltip() {\n    $(document).on(\"mouseenter\", \"a\", mouseEnterHandler);\n    $(document).on(\"mouseleave\", \"a\", mouseLeaveHandler);\n\n    // close any note tooltip after click, this fixes the problem that sometimes tooltips remained on the screen\n    $(document).on(\"click\", () => $('.note-tooltip').remove());\n}\n\nfunction setupElementTooltip($el) {\n    $el.on('mouseenter', mouseEnterHandler);\n    $el.on('mouseleave', mouseLeaveHandler);\n}\n\nasync function mouseEnterHandler() {\n    const $link = $(this);\n\n    if ($link.hasClass(\"no-tooltip-preview\")\n        || $link.hasClass(\"disabled\")\n        || $link.attr(\"data-action\") === 'note-revision') {\n        return;\n    }\n\n    // this is to avoid showing tooltip from inside CKEditor link editor dialog\n    if ($link.closest(\".ck-link-actions\").length) {\n        return;\n    }\n\n    let notePath = linkService.getNotePathFromUrl($link.attr(\"href\"));\n\n    if (!notePath) {\n        notePath = $link.attr(\"data-note-path\");\n    }\n\n    if (!notePath) {\n        return;\n    }\n\n    const noteId = treeService.getNoteIdFromNotePath(notePath);\n\n    const note = await treeCache.getNote(noteId);\n    const noteComplement = await treeCache.getNoteComplement(noteId);\n\n    const html = await renderTooltip(note, noteComplement);\n\n    // we need to check if we're still hovering over the element\n    // since the operation to get tooltip content was async, it is possible that\n    // we now create tooltip which won't close because it won't receive mouseleave event\n    if ($(this).is(\":hover\")) {\n        $(this).tooltip({\n            delay: {\"show\": 300, \"hide\": 100},\n            container: 'body',\n            placement: 'auto',\n            trigger: 'manual',\n            boundary: 'window',\n            title: html,\n            html: true,\n            template: '<div class=\"tooltip note-tooltip\" role=\"tooltip\"><div class=\"arrow\"></div><div class=\"tooltip-inner\"></div></div>',\n            sanitize: false\n        });\n\n        $(this).tooltip('show');\n    }\n}\n\nfunction mouseLeaveHandler() {\n    $(this).tooltip('dispose');\n}\n\nasync function renderTooltip(note, noteComplement) {\n    if (note.isDeleted) {\n        return '<div>Note has been deleted.</div>';\n    }\n\n    const attributes = note.getAttributes();\n\n    let content = '';\n\n    const promoted = attributes\n        .filter(attr => attr.type === 'label-definition' || attr.type === 'relation-definition')\n        .filter(attr => !attr.name.startsWith(\"child:\"))\n        .filter(attr => {\n            const json = attr.jsonValue;\n\n            return json && json.isPromoted;\n        });\n\n    if (promoted.length > 0) {\n        const $table = $(\"<table>\").addClass(\"promoted-attributes-in-tooltip\");\n\n        for (const definitionAttr of promoted) {\n            const definitionType = definitionAttr.type;\n            const valueType = definitionType.substr(0, definitionType.length - 11);\n\n            let valueAttrs = attributes.filter(el => el.name === definitionAttr.name && el.type === valueType);\n\n            for (const valueAttr of valueAttrs) {\n                if (!valueAttr.value) {\n                    continue;\n                }\n\n                let $value = \"\";\n\n                if (valueType === 'label') {\n                    $value = $(\"<td>\").text(valueAttr.value);\n                }\n                else if (valueType === 'relation' && valueAttr.value) {\n                    $value = $(\"<td>\").append(await linkService.createNoteLink(valueAttr.value));\n                }\n\n                const $row = $(\"<tr>\")\n                    .append($(\"<th>\").text(definitionAttr.name))\n                    .append($value);\n\n                $table.append($row);\n            }\n        }\n\n        content += $table.prop('outerHTML');\n    }\n\n    if (note.type === 'text' && !utils.isHtmlEmpty(noteComplement.content)) {\n        content += '<div class=\"ck-content\">' + noteComplement.content + '</div>';\n    }\n    else if (note.type === 'code' && noteComplement.content && noteComplement.content.trim()) {\n        content += $(\"<pre>\")\n            .text(noteComplement.content)\n            .prop('outerHTML');\n    }\n    else if (note.type === 'image') {\n        content += $(\"<img>\")\n            .prop(\"src\", `api/images/${note.noteId}/${note.title}`)\n            .prop('outerHTML');\n    }\n    // other types of notes don't have tooltip preview\n\n    return content;\n}\n\nexport default {\n    setupGlobalTooltip,\n    setupElementTooltip\n}","import server from \"./server.js\";\n\nclass Options {\n    constructor() {\n        this.initializedPromise = server.get('options').then(data => this.load(data));\n    }\n\n    load(arr) {\n        this.arr = arr;\n    }\n\n    get(key) {\n        return this.arr[key];\n    }\n\n    getNames() {\n        return Object.keys(this.arr);\n    }\n\n    getJson(key) {\n        try {\n            return JSON.parse(this.arr[key]);\n        }\n        catch (e) {\n            return null;\n        }\n    }\n\n    getInt(key) {\n        return parseInt(this.arr[key]);\n    }\n\n    getFloat(key) {\n        return parseFloat(this.arr[key]);\n    }\n\n    is(key) {\n        return this.arr[key] === 'true';\n    }\n\n    set(key, value) {\n        this.arr[key] = value;\n    }\n\n    async save(key, value) {\n        this.set(key, value);\n\n        const payload = {};\n        payload[key] = value;\n\n        await server.put(`options`, payload);\n    }\n}\n\nconst options = new Options();\n\nexport default options;","import utils from './utils.js';\nimport server from './server.js';\nimport protectedSessionHolder from './protected_session_holder.js';\nimport toastService from \"./toast.js\";\nimport ws from \"./ws.js\";\nimport appContext from \"./app_context.js\";\nimport treeCache from \"./tree_cache.js\";\n\nlet protectedSessionDeferred = null;\n\nasync function leaveProtectedSession() {\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        protectedSessionHolder.resetProtectedSession();\n    }\n}\n\n/** returned promise resolves with true if new protected session was established, false if no action was necessary */\nfunction enterProtectedSession() {\n    const dfd = $.Deferred();\n\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        dfd.resolve(false);\n    }\n    else {\n        // using deferred instead of promise because it allows resolving from outside\n        protectedSessionDeferred = dfd;\n\n        import(\"../dialogs/protected_session.js\").then(dialog => dialog.show());\n    }\n\n    return dfd.promise();\n}\n\nasync function reloadData() {\n    const allNoteIds = Object.keys(treeCache.notes);\n\n    await treeCache.loadInitialTree();\n\n    // make sure that all notes used in the application are loaded, including the ones not shown in the tree\n    await treeCache.reloadNotes(allNoteIds, true);\n}\n\nasync function setupProtectedSession(password) {\n    const response = await enterProtectedSessionOnServer(password);\n\n    if (!response.success) {\n        toastService.showError(\"Wrong password.\", 3000);\n        return;\n    }\n\n    protectedSessionHolder.setProtectedSessionId(response.protectedSessionId);\n    protectedSessionHolder.touchProtectedSession();\n\n    await reloadData();\n\n    await appContext.triggerEvent('treeCacheReloaded');\n\n    appContext.triggerEvent('protectedSessionStarted');\n\n    if (protectedSessionDeferred !== null) {\n        import(\"../dialogs/protected_session.js\").then(dialog => dialog.close());\n\n        protectedSessionDeferred.resolve(true);\n        protectedSessionDeferred = null;\n    }\n\n    toastService.showMessage(\"Protected session has been started.\");\n}\n\nasync function enterProtectedSessionOnServer(password) {\n    return await server.post('login/protected', {\n        password: password\n    });\n}\n\nasync function protectNote(noteId, protect, includingSubtree) {\n    await enterProtectedSession();\n\n    await server.put(`notes/${noteId}/protect/${protect ? 1 : 0}?subtree=${includingSubtree ? 1 : 0}`);\n}\n\nfunction makeToast(message, protectingLabel, text) {\n    return {\n        id: message.taskId,\n        title: protectingLabel + \" status\",\n        message: text,\n        icon: message.data.protect ? \"check-shield\" : \"shield\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'protect-notes') {\n        return;\n    }\n\n    const protectingLabel = message.data.protect ? \"Protecting\" : \"Unprotecting\";\n\n    if (message.type === 'task-error') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'task-progress-count') {\n        toastService.showPersistent(makeToast(message, protectingLabel,protectingLabel + \" in progress: \" + message.progressCount));\n    } else if (message.type === 'task-succeeded') {\n        const toast = makeToast(message, protectingLabel, protectingLabel + \" finished successfully.\");\n        toast.closeAfter = 3000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nexport default {\n    protectNote,\n    enterProtectedSession,\n    leaveProtectedSession,\n    setupProtectedSession\n};\n","import utils from \"./utils.js\";\nimport options from './options.js';\n\nconst PROTECTED_SESSION_ID_KEY = 'protectedSessionId';\n\nlet lastProtectedSessionOperationDate = 0;\n\nsetInterval(() => {\n    const protectedSessionTimeout = options.getInt('protectedSessionTimeout');\n    if (lastProtectedSessionOperationDate\n        && Date.now() - lastProtectedSessionOperationDate > protectedSessionTimeout * 1000) {\n\n        resetProtectedSession();\n    }\n}, 5000);\n\nfunction setProtectedSessionId(id) {\n    // using session cookie so that it disappears after browser/tab is closed\n    utils.setSessionCookie(PROTECTED_SESSION_ID_KEY, id);\n}\n\nfunction resetProtectedSession() {\n    utils.setSessionCookie(PROTECTED_SESSION_ID_KEY, null);\n\n    // most secure solution - guarantees nothing remained in memory\n    // since this expires because user doesn't use the app, it shouldn't be disruptive\n    utils.reloadApp();\n}\n\nfunction isProtectedSessionAvailable() {\n    return !!utils.getCookie(PROTECTED_SESSION_ID_KEY);\n}\n\nfunction touchProtectedSession() {\n    if (isProtectedSessionAvailable()) {\n        lastProtectedSessionOperationDate = Date.now();\n\n        setProtectedSessionId(utils.getCookie(PROTECTED_SESSION_ID_KEY));\n    }\n}\n\nfunction touchProtectedSessionIfNecessary(note) {\n    if (note && note.isProtected && isProtectedSessionAvailable()) {\n        touchProtectedSession();\n    }\n}\n\nexport default {\n    setProtectedSessionId,\n    resetProtectedSession,\n    isProtectedSessionAvailable,\n    touchProtectedSession,\n    touchProtectedSessionIfNecessary\n};","import treeService from './tree.js';\nimport server from './server.js';\nimport utils from './utils.js';\nimport toastService from './toast.js';\nimport linkService from './link.js';\nimport treeCache from './tree_cache.js';\nimport noteTooltipService from './note_tooltip.js';\nimport protectedSessionService from './protected_session.js';\nimport dateNotesService from './date_notes.js';\nimport CollapsibleWidget from '../widgets/collapsible_widget.js';\nimport ws from \"./ws.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport appContext from \"./app_context.js\";\nimport TabAwareWidget from \"../widgets/tab_aware_widget.js\";\nimport TabCachingWidget from \"../widgets/tab_caching_widget.js\";\nimport BasicWidget from \"../widgets/basic_widget.js\";\n\n/**\n * This is the main frontend API interface for scripts. It's published in the local \"api\" object.\n *\n * @constructor\n * @hideconstructor\n */\nfunction FrontendScriptApi(startNote, currentNote, originEntity = null, $container = null) {\n    const $pluginButtons = $(\"#plugin-buttons\");\n\n    /** @property {jQuery} container of all the rendered script content */\n    this.$container = $container;\n\n    /** @property {object} note where script started executing */\n    this.startNote = startNote;\n    /** @property {object} note where script is currently executing */\n    this.currentNote = currentNote;\n    /** @property {object|null} entity whose event triggered this execution */\n    this.originEntity = originEntity;\n\n    // to keep consistency with backend API\n    this.dayjs = dayjs;\n\n    /** @property {CollapsibleWidget} */\n    this.CollapsibleWidget = CollapsibleWidget;\n\n    /** @property {TabAwareWidget} */\n    this.TabAwareWidget = TabAwareWidget;\n\n    /** @property {TabCachingWidget} */\n    this.TabCachingWidget = TabCachingWidget;\n\n    /** @property {BasicWidget} */\n    this.BasicWidget = BasicWidget;\n\n    /**\n     * Activates note in the tree and in the note detail.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @returns {Promise<void>}\n     */\n    this.activateNote = async notePath => {\n        await appContext.tabManager.getActiveTabContext().setNote(notePath);\n    };\n\n    /**\n     * Activates newly created note. Compared to this.activateNote() also makes sure that frontend has been fully synced.\n     *\n     * @param {string} notePath (or noteId)\n     * @return {Promise<void>}\n     */\n    this.activateNewNote = async notePath => {\n        await ws.waitForMaxKnownSyncId();\n\n        await appContext.tabManager.getActiveTabContext().setNote(notePath);\n        appContext.triggerEvent('focusAndSelectTitle');\n    };\n\n    /**\n     * @typedef {Object} ToolbarButtonOptions\n     * @property {string} title\n     * @property {string} [icon] - name of the boxicon to be used (e.g. \"time\" for \"bx-time\" icon)\n     * @property {function} action - callback handling the click on the button\n     * @property {string} [shortcut] - keyboard shortcut for the button, e.g. \"alt+t\"\n     */\n\n    /**\n     * Adds new button the the plugin area.\n     *\n     * @param {ToolbarButtonOptions} opts\n     */\n    this.addButtonToToolbar = opts => {\n        const buttonId = \"toolbar-button-\" + opts.title.replace(/[^a-zA-Z0-9]/g, \"-\");\n\n        const button = $('<button>')\n            .addClass(\"btn btn-sm\")\n            .on('click', opts.action);\n\n        if (opts.icon) {\n            button.append($(\"<span>\").addClass(\"bx bx-\" + opts.icon))\n                  .append(\"&nbsp;\");\n        }\n\n        button.append($(\"<span>\").text(opts.title));\n\n        button.attr('id', buttonId);\n\n        if ($(\"#\" + buttonId).replaceWith(button).length === 0) {\n            $pluginButtons.append(button);\n        }\n\n        if (opts.shortcut) {\n            utils.bindGlobalShortcut(opts.shortcut, opts.action);\n\n            button.attr(\"title\", \"Shortcut \" + opts.shortcut);\n        }\n    };\n\n    function prepareParams(params) {\n        if (!params) {\n            return params;\n        }\n\n        return params.map(p => {\n            if (typeof p === \"function\") {\n                return \"!@#Function: \" + p.toString();\n            }\n            else {\n                return p;\n            }\n        });\n    }\n\n    /**\n     * Executes given anonymous function on the backend.\n     * Internally this serializes the anonymous function into string and sends it to backend via AJAX.\n     *\n     * @param {string} script - script to be executed on the backend\n     * @param {Array.<?>} params - list of parameters to the anonymous function to be send to backend\n     * @return {Promise<*>} return value of the executed function on the backend\n     */\n    this.runOnBackend = async (script, params = []) => {\n        if (typeof script === \"function\") {\n            script = script.toString();\n        }\n\n        const ret = await server.post('script/exec', {\n            script: script,\n            params: prepareParams(params),\n            startNoteId: startNote.noteId,\n            currentNoteId: currentNote.noteId,\n            originEntityName: \"notes\", // currently there's no other entity on frontend which can trigger event\n            originEntityId: originEntity ? originEntity.noteId : null\n        }, \"script\");\n\n        if (ret.success) {\n            // wait until all the changes done in the script has been synced to frontend before continuing\n            await ws.waitForSyncId(ret.maxSyncId);\n\n            return ret.executionResult;\n        }\n        else {\n            throw new Error(\"server error: \" + ret.error);\n        }\n    };\n\n    /**\n     * @deprecated new name of this API call is runOnBackend so use that\n     * @method\n     */\n    this.runOnServer = this.runOnBackend;\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"@dateModified =* MONTH AND @log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<NoteShort[]>}\n     */\n    this.searchForNotes = async searchString => {\n        const noteIds = await this.runOnServer(async searchString => {\n            const notes = await api.searchForNotes(searchString);\n\n            return notes.map(note => note.noteId);\n        }, [searchString]);\n\n        return await treeCache.getNotes(noteIds);\n    };\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"@dateModified =* MONTH AND @log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<NoteShort|null>}\n     */\n    this.searchForNote = async searchString => {\n        const notes = await this.searchForNotes(searchString);\n\n        return notes.length > 0 ? notes[0] : null;\n    };\n\n    /**\n     * Returns note by given noteId. If note is missing from cache, it's loaded.\n     **\n     * @param {string} noteId\n     * @return {Promise<NoteShort>}\n     */\n    this.getNote = async noteId => await treeCache.getNote(noteId);\n\n    /**\n     * Returns list of notes. If note is missing from cache, it's loaded.\n     *\n     * This is often used to bulk-fill the cache with notes which would have to be picked one by one\n     * otherwise (by e.g. createNoteLink())\n     *\n     * @param {string[]} noteIds\n     * @param {boolean} [silentNotFoundError] - don't report error if the note is not found\n     * @return {Promise<NoteShort[]>}\n     */\n    this.getNotes = async (noteIds, silentNotFoundError = false) => await treeCache.getNotes(noteIds, silentNotFoundError);\n\n    /**\n     * Update frontend tree (note) cache from the backend.\n     *\n     * @param {string[]} noteIds\n     * @method\n     */\n    this.reloadNotes = async noteIds => await treeCache.reloadNotes(noteIds);\n\n    /**\n     * Instance name identifies particular Trilium instance. It can be useful for scripts\n     * if some action needs to happen on only one specific instance.\n     *\n     * @return {string}\n     */\n    this.getInstanceName = () => window.glob.instanceName;\n\n    /**\n     * @method\n     * @param {Date} date\n     * @returns {string} date in YYYY-MM-DD format\n     */\n    this.formatDateISO = utils.formatDateISO;\n\n    /**\n     * @method\n     * @param {string} str\n     * @returns {Date} parsed object\n     */\n    this.parseDate = utils.parseDate;\n\n    /**\n     * Show info message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showMessage = toastService.showMessage;\n\n    /**\n     * Show error message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showError = toastService.showError;\n\n    /**\n     * @method\n     * @deprecated - this is now no-op since all the changes should be gracefully handled per widget\n     */\n    this.refreshTree = () => {};\n\n    /**\n     * Create note link (jQuery object) for given note.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {string} [noteTitle] - if not present we'll use note title\n     */\n    this.createNoteLink = linkService.createNoteLink;\n\n    /**\n     * Adds given text to the editor cursor\n     *\n     * @param {string} text - this must be clear text, HTML is not supported.\n     * @method\n     */\n    this.addTextToActiveTabEditor = text => appContext.triggerCommand('addTextToActiveEditor', {text});\n\n    /**\n     * @method\n     * @returns {NoteShort} active note (loaded into right pane)\n     */\n    this.getActiveTabNote = () => appContext.tabManager.getActiveTabNote();\n\n    /**\n     * See https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editor-Editor.html for a documentation on the returned instance.\n     *\n     * @method\n     * @param callback - method receiving \"textEditor\" instance\n     */\n    this.getActiveTabTextEditor = callback => appContext.triggerCommand('executeInActiveEditor', {callback});\n\n    /**\n     * @method\n     * @returns {Promise<string|null>} returns note path of active note or null if there isn't active note\n     */\n    this.getActiveTabNotePath = () => appContext.tabManager.getActiveTabNotePath();\n\n    /**\n     * @method\n     * @param {object} $el - jquery object on which to setup the tooltip\n     */\n    this.setupElementTooltip = noteTooltipService.setupElementTooltip;\n\n    /**\n     * @deprecated use protectNote and protectSubtree instead\n     * @method\n     */\n    this.protectActiveNote = async () => {\n        const activeNote = appContext.tabManager.getActiveTabNote();\n\n        await protectedSessionService.protectNote(activeNote.noteId, true, false);\n    };\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect note, false to unprotect\n     */\n    this.protectNote = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, false);\n    };\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect subtree, false to unprotect\n     */\n    this.protectSubTree = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, true);\n    };\n\n    /**\n     * Returns date-note for today. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @return {Promise<NoteShort>}\n     */\n    this.getTodayNote = dateNotesService.getTodayNote;\n\n    /**\n     * Returns date-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} date - e.g. \"2019-04-29\"\n     * @return {Promise<NoteShort>}\n     */\n    this.getDateNote = dateNotesService.getDateNote;\n\n    /**\n     * Returns month-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} month - e.g. \"2019-04\"\n     * @return {Promise<NoteShort>}\n     */\n    this.getMonthNote = dateNotesService.getMonthNote;\n\n    /**\n     * Returns year-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} year - e.g. \"2019\"\n     * @return {Promise<NoteShort>}\n     */\n    this.getYearNote = dateNotesService.getYearNote;\n\n    /**\n     * Hoist note. See https://github.com/zadam/trilium/wiki/Note-hoisting\n     *\n     * @method\n     * @param {string} noteId - set hoisted note. 'root' will effectively unhoist\n     * @return {Promise}\n     */\n    this.setHoistedNoteId = hoistedNoteService.setHoistedNoteId;\n\n    /**\n     * @method\n     * @param {string} keyboardShortcut - e.g. \"ctrl+shift+a\"\n     * @param {function} handler\n     */\n    this.bindGlobalShortcut = utils.bindGlobalShortcut;\n\n    /**\n     * Trilium runs in backend and frontend process, when something is changed on the backend from script,\n     * frontend will get asynchronously synchronized.\n     *\n     * This method returns a promise which resolves once all the backend -> frontend synchronization is finished.\n     * Typical use case is when new note has been created, we should wait until it is synced into frontend and only then activate it.\n     *\n     * @method\n     */\n    this.waitUntilSynced = ws.waitForMaxKnownSyncId;\n\n    /**\n     * This will refresh all currently opened notes which have included note specified in the parameter\n     *\n     * @param includedNoteId - noteId of the included note\n     */\n    this.refreshIncludedNote = includedNoteId => appContext.triggerEvent('refreshIncludedNote', {noteId: includedNoteId});\n}\n\nexport default FrontendScriptApi;\n","import FrontendScriptApi from './frontend_script_api.js';\nimport utils from './utils.js';\nimport treeCache from './tree_cache.js';\n\nasync function ScriptContext(startNoteId, allNoteIds, originEntity = null, $container = null) {\n    const modules = {};\n\n    await treeCache.initializedPromise;\n\n    const startNote = await treeCache.getNote(startNoteId);\n    const allNotes = await treeCache.getNotes(allNoteIds);\n\n    return {\n        modules: modules,\n        notes: utils.toObject(allNotes, note => [note.noteId, note]),\n        apis: utils.toObject(allNotes, note => [note.noteId, new FrontendScriptApi(startNote, note, originEntity, $container)]),\n        require: moduleNoteIds => {\n            return moduleName => {\n                const candidates = allNotes.filter(note => moduleNoteIds.includes(note.noteId));\n                const note = candidates.find(c => c.title === moduleName);\n\n                if (!note) {\n                    throw new Error(\"Could not find module note \" + moduleName);\n                }\n\n                return modules[note.noteId].exports;\n            }\n        }\n    };\n}\n\nexport default ScriptContext;","import utils from './utils.js';\n\nconst REQUEST_LOGGING_ENABLED = false;\n\nfunction getHeaders(headers) {\n    // headers need to be lowercase because node.js automatically converts them to lower case\n    // so hypothetical protectedSessionId becomes protectedsessionid on the backend\n    // also avoiding using underscores instead of dashes since nginx filters them out by default\n    const allHeaders = {\n        'trilium-source-id': glob.sourceId,\n        'trilium-local-now-datetime': utils.localNowDateTime(),\n        'x-csrf-token': glob.csrfToken\n    };\n\n    for (const headerName in headers) {\n        if (headers[headerName]) {\n            allHeaders[headerName] = headers[headerName];\n        }\n    }\n\n    if (utils.isElectron()) {\n        // passing it explicitely here because of the electron HTTP bypass\n        allHeaders.cookie = document.cookie;\n    }\n\n    return allHeaders;\n}\n\nasync function get(url, sourceId) {\n    return await call('GET', url, null, {'trilium-source-id': sourceId});\n}\n\nasync function post(url, data, sourceId) {\n    return await call('POST', url, data, {'trilium-source-id': sourceId});\n}\n\nasync function put(url, data, sourceId) {\n    return await call('PUT', url, data, {'trilium-source-id': sourceId});\n}\n\nasync function remove(url, sourceId) {\n    return await call('DELETE', url, null, {'trilium-source-id': sourceId});\n}\n\nlet i = 1;\nconst reqResolves = {};\n\nlet maxKnownSyncId = 0;\n\nasync function call(method, url, data, headers = {}) {\n    let resp;\n\n    const start = Date.now();\n\n    if (utils.isElectron()) {\n        const ipc = utils.dynamicRequire('electron').ipcRenderer;\n        const requestId = i++;\n\n        resp = await new Promise((resolve, reject) => {\n            reqResolves[requestId] = resolve;\n\n            if (REQUEST_LOGGING_ENABLED) {\n                console.log(utils.now(), \"Request #\" + requestId + \" to \" + method + \" \" + url);\n            }\n\n            ipc.send('server-request', {\n                requestId: requestId,\n                headers: getHeaders(headers),\n                method: method,\n                url: \"/\" + baseApiUrl + url,\n                data: data\n            });\n        });\n    }\n    else {\n        resp = await ajax(url, method, data, headers);\n    }\n\n    const end = Date.now();\n\n    if (glob.PROFILING_LOG) {\n        console.log(`${method} ${url} took ${end - start}ms`);\n    }\n\n    const maxSyncIdStr = resp.headers['trilium-max-sync-id'];\n\n    if (maxSyncIdStr && maxSyncIdStr.trim()) {\n        maxKnownSyncId = Math.max(maxKnownSyncId, parseInt(maxSyncIdStr));\n    }\n\n    return resp.body;\n}\n\nfunction ajax(url, method, data, headers) {\n    return new Promise((res, rej) => {\n        const options = {\n            url: baseApiUrl + url,\n            type: method,\n            headers: getHeaders(headers),\n            timeout: 60000,\n            success: (body, textStatus, jqXhr) => {\n                const respHeaders = {};\n\n                jqXhr.getAllResponseHeaders().trim().split(/[\\r\\n]+/).forEach(line => {\n                    const parts = line.split(': ');\n                    const header = parts.shift();\n                    respHeaders[header] = parts.join(': ');\n                });\n\n                res({\n                    body,\n                    headers: respHeaders\n                });\n            },\n            error: async (jqXhr, textStatus, error) => {\n                const message = \"Error when calling \" + method + \" \" + url + \": \" + textStatus + \" - \" + error;\n                const toastService = (await import(\"./toast.js\")).default;\n                toastService.showError(message);\n                toastService.throwError(message);\n\n                rej(error);\n            }\n        };\n\n        if (data) {\n            try {\n                options.data = JSON.stringify(data);\n            } catch (e) {\n                console.log(\"Can't stringify data: \", data, \" because of error: \", e)\n            }\n            options.contentType = \"application/json\";\n        }\n\n        $.ajax(options);\n    });\n}\n\nif (utils.isElectron()) {\n    const ipc = utils.dynamicRequire('electron').ipcRenderer;\n\n    ipc.on('server-response', (event, arg) => {\n        if (REQUEST_LOGGING_ENABLED) {\n            console.log(utils.now(), \"Response #\" + arg.requestId + \": \" + arg.statusCode);\n        }\n\n        reqResolves[arg.requestId]({\n            body: arg.body,\n            headers: arg.headers\n        });\n\n        delete reqResolves[arg.requestId];\n    });\n}\n\nexport default {\n    get,\n    post,\n    put,\n    remove,\n    ajax,\n    // don't remove, used from CKEditor image upload!\n    getHeaders,\n    getMaxKnownSyncId: () => maxKnownSyncId\n};","export default class SpacedUpdate {\n    constructor(updater, updateInterval = 1000) {\n        this.updater = updater;\n        this.lastUpdated = Date.now();\n        this.changed = false;\n        this.updateInterval = updateInterval;\n    }\n\n    scheduleUpdate() {\n        if (!this.changeForbidden) {\n            this.changed = true;\n            setTimeout(() => this.triggerUpdate());\n        }\n    }\n\n    async updateNowIfNecessary() {\n        if (this.changed) {\n            this.changed = false;\n            await this.updater();\n        }\n    }\n\n    triggerUpdate() {\n        if (!this.changed) {\n            return;\n        }\n\n        if (Date.now() - this.lastUpdated > this.updateInterval) {\n            this.updater();\n            this.lastUpdated = Date.now();\n            this.changed = false;\n        }\n        else {\n            // update not triggered but changes are still pending so we need to schedule another check\n            this.scheduleUpdate();\n        }\n    }\n\n    async allowUpdateWithoutChange(callback) {\n        this.changeForbidden = true;\n\n        try {\n            await callback();\n        }\n        finally {\n            this.changeForbidden = false;\n        }\n    }\n}\n","import ws from \"./ws.js\";\nimport utils from \"./utils.js\";\n\nfunction toast(options) {\n    const $toast = $(`<div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n    <div class=\"toast-header\">\n        <strong class=\"mr-auto\"><span class=\"bx bx-${options.icon}\"></span> ${options.title}</strong>\n        <button type=\"button\" class=\"ml-2 mb-1 close\" data-dismiss=\"toast\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n        </button>\n    </div>\n    <div class=\"toast-body\">\n        ${options.message}\n    </div>\n</div>`);\n\n    if (options.id) {\n        $toast.attr(\"id\", \"toast-\" + options.id);\n    }\n\n    $(\"#toast-container\").append($toast);\n\n    $toast.toast({\n        delay: options.delay || 3000,\n        autohide: !!options.autohide\n    });\n\n    $toast.on('hidden.bs.toast', e => e.target.remove());\n\n    $toast.toast(\"show\");\n\n    return $toast;\n}\n\nfunction showPersistent(options) {\n    let $toast = $(\"#toast-\" + options.id);\n\n    if ($toast.length > 0) {\n        $toast.find('.toast-body').html(options.message);\n    }\n    else {\n        options.autohide = false;\n\n        $toast = toast(options);\n    }\n\n    if (options.closeAfter) {\n        setTimeout(() => $toast.remove(), options.closeAfter);\n    }\n}\n\nfunction closePersistent(id) {\n    $(\"#toast-\" + id).remove();\n}\n\nfunction showMessage(message, delay = 2000) {\n    console.debug(utils.now(), \"message: \", message);\n\n    toast({\n        title: \"Info\",\n        icon: \"check\",\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction showAndLogError(message, delay = 10000) {\n    showError(message, delay);\n\n    ws.logError(message);\n}\n\nfunction showError(message, delay = 10000) {\n    console.log(utils.now(), \"error: \", message);\n\n    toast({\n        title: \"Error\",\n        icon: 'alert',\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction throwError(message) {\n    ws.logError(message);\n\n    throw new Error(message);\n}\n\nexport default {\n    showMessage,\n    showError,\n    showAndLogError,\n    throwError,\n    showPersistent,\n    closePersistent\n}","import ws from './ws.js';\nimport utils from './utils.js';\nimport server from './server.js';\nimport treeCache from './tree_cache.js';\nimport hoistedNoteService from '../services/hoisted_note.js';\nimport appContext from \"./app_context.js\";\n\n/**\n * Accepts notePath which might or might not be valid and returns an existing path as close to the original\n * notePath as possible.\n * @return {string|null}\n */\nasync function resolveNotePath(notePath) {\n    const runPath = await getRunPath(notePath);\n\n    return runPath ? runPath.join(\"/\") : null;\n}\n\n/**\n * Accepts notePath and tries to resolve it. Part of the path might not be valid because of note moving (which causes\n * path change) or other corruption, in that case this will try to get some other valid path to the correct note.\n *\n * @return {string[]}\n */\nasync function getRunPath(notePath, logErrors = true) {\n    utils.assertArguments(notePath);\n\n    notePath = notePath.split(\"-\")[0].trim();\n\n    if (notePath.length === 0) {\n        return;\n    }\n\n    const path = notePath.split(\"/\").reverse();\n\n    if (!path.includes(\"root\")) {\n        path.push('root');\n    }\n\n    const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n    const effectivePath = [];\n    let childNoteId = null;\n    let i = 0;\n\n    while (true) {\n        if (i >= path.length) {\n            break;\n        }\n\n        const parentNoteId = path[i++];\n\n        if (childNoteId !== null) {\n            const child = await treeCache.getNote(childNoteId);\n\n            if (!child) {\n                console.log(\"Can't find note \" + childNoteId);\n                return;\n            }\n\n            const parents = child.getParentNotes();\n\n            if (!parents) {\n                ws.logError(\"No parents found for \" + childNoteId);\n                return;\n            }\n\n            if (!parents.some(p => p.noteId === parentNoteId)) {\n                if (logErrors) {\n                    console.log(utils.now(), \"Did not find parent \" + parentNoteId + \" for child \" + childNoteId);\n                }\n\n                if (parents.length > 0) {\n                    if (logErrors) {\n                        console.log(utils.now(), \"Available parents:\", parents);\n                    }\n\n                    const someNotePath = await getSomeNotePath(parents[0]);\n\n                    if (someNotePath) { // in case it's root the path may be empty\n                        const pathToRoot = someNotePath.split(\"/\").reverse();\n\n                        for (const noteId of pathToRoot) {\n                            effectivePath.push(noteId);\n                        }\n\n                        effectivePath.push('root');\n                    }\n\n                    break;\n                }\n                else {\n                    if (logErrors) {\n                        console.log(\"No parents so no run path.\");\n                    }\n\n                    return;\n                }\n            }\n        }\n\n        effectivePath.push(parentNoteId);\n        childNoteId = parentNoteId;\n\n        if (parentNoteId === hoistedNoteId) {\n            break;\n        }\n    }\n\n    return effectivePath.reverse();\n}\n\nasync function getSomeNotePath(note) {\n    utils.assertArguments(note);\n\n    const path = [];\n\n    let cur = note;\n\n    while (cur.noteId !== 'root') {\n        path.push(cur.noteId);\n\n        const parents = cur.getParentNotes();\n\n        if (!parents.length) {\n            console.error(`Can't find parents for note ${cur.noteId}`);\n            return;\n        }\n\n        cur = parents[0];\n    }\n\n    path.push('root');\n\n    return path.reverse().join('/');\n}\n\nasync function sortAlphabetically(noteId) {\n    await server.put('notes/' + noteId + '/sort');\n}\n\nws.subscribeToMessages(message => {\n   if (message.type === 'open-note') {\n       appContext.tabManager.activateOrOpenNote(message.noteId);\n\n       if (utils.isElectron()) {\n           const currentWindow = utils.dynamicRequire(\"electron\").remote.getCurrentWindow();\n\n           currentWindow.show();\n       }\n   }\n});\n\nfunction getParentProtectedStatus(node) {\n    return hoistedNoteService.isRootNode(node) ? 0 : node.getParent().data.isProtected;\n}\n\nfunction getNoteIdFromNotePath(notePath) {\n    if (!notePath) {\n        return null;\n    }\n\n    const path = notePath.split(\"/\");\n\n    const lastSegment = path[path.length - 1];\n\n    // path could have also tabId suffix\n    return lastSegment.split(\"-\")[0];\n}\n\nfunction getNoteIdAndParentIdFromNotePath(notePath) {\n    if (notePath === 'root') {\n        return {\n            noteId: 'root',\n            parentNoteId: 'none'\n        };\n    }\n\n    let parentNoteId = 'root';\n    let noteId = '';\n\n    if (notePath) {\n        const path = notePath.split(\"/\");\n\n        const lastSegment = path[path.length - 1];\n\n        // path could have also tabId suffix\n        noteId = lastSegment.split(\"-\")[0];\n\n        if (path.length > 1) {\n            parentNoteId = path[path.length - 2];\n        }\n    }\n\n    return {\n        parentNoteId,\n        noteId\n    }\n}\n\nfunction getNotePath(node) {\n    if (!node) {\n        console.error(\"Node is null\");\n        return \"\";\n    }\n\n    const path = [];\n\n    while (node && !hoistedNoteService.isRootNode(node)) {\n        if (node.data.noteId) {\n            path.push(node.data.noteId);\n        }\n\n        node = node.getParent();\n    }\n\n    if (node) { // null node can happen directly after unhoisting when tree is still hoisted but option has been changed already\n        path.push(node.data.noteId); // root or hoisted noteId\n    }\n\n    return path.reverse().join(\"/\");\n}\n\nasync function getNoteTitle(noteId, parentNoteId = null) {\n    utils.assertArguments(noteId);\n\n    const note = await treeCache.getNote(noteId);\n    if (!note) {\n        return \"[not found]\";\n    }\n\n    let {title} = note;\n\n    if (parentNoteId !== null) {\n        const branchId = note.parentToBranch[parentNoteId];\n\n        if (branchId) {\n            const branch = treeCache.getBranch(branchId);\n\n            if (branch && branch.prefix) {\n                title = branch.prefix + ' - ' + title;\n            }\n        }\n    }\n\n    return title;\n}\n\nasync function getNotePathTitle(notePath) {\n    utils.assertArguments(notePath);\n\n    const titlePath = [];\n\n    if (notePath.startsWith('root/')) {\n        notePath = notePath.substr(5);\n    }\n\n    // special case when we want just root's title\n    if (notePath === 'root') {\n        return await getNoteTitle(notePath);\n    }\n\n    let parentNoteId = 'root';\n\n    for (const noteId of notePath.split('/')) {\n        titlePath.push(await getNoteTitle(noteId, parentNoteId));\n\n        parentNoteId = noteId;\n    }\n\n    return titlePath.join(' / ');\n}\n\nfunction getHashValueFromAddress() {\n    const str = document.location.hash ? document.location.hash.substr(1) : \"\"; // strip initial #\n\n    return str.split(\"-\");\n}\n\nfunction parseNotePath(notePath) {\n    let noteIds = notePath.split('/');\n\n    if (noteIds[0] !== 'root') {\n        noteIds = ['root'].concat(noteIds);\n    }\n\n    return noteIds;\n}\n\nexport default {\n    sortAlphabetically,\n    resolveNotePath,\n    getSomeNotePath,\n    getRunPath,\n    getParentProtectedStatus,\n    getNotePath,\n    getNoteIdFromNotePath,\n    getNoteIdAndParentIdFromNotePath,\n    getNoteTitle,\n    getNotePathTitle,\n    getHashValueFromAddress,\n    parseNotePath\n};\n","import server from '../services/server.js';\nimport Attribute from './attribute.js';\nimport noteAttributeCache from \"../services/note_attribute_cache.js\";\n\nconst LABEL = 'label';\nconst LABEL_DEFINITION = 'label-definition';\nconst RELATION = 'relation';\nconst RELATION_DEFINITION = 'relation-definition';\n\n/**\n * FIXME: since there's no \"full note\" anymore we can rename this to Note\n *\n * This note's representation is used in note tree and is kept in TreeCache.\n */\nclass NoteShort {\n    /**\n     * @param {TreeCache} treeCache\n     * @param {Object.<string, Object>} row\n     */\n    constructor(treeCache, row) {\n        this.treeCache = treeCache;\n\n        /** @type {string[]} */\n        this.attributes = [];\n\n        /** @type {string[]} */\n        this.targetRelations = [];\n\n        /** @type {string[]} */\n        this.parents = [];\n        /** @type {string[]} */\n        this.children = [];\n\n        /** @type {Object.<string, string>} */\n        this.parentToBranch = {};\n\n        /** @type {Object.<string, string>} */\n        this.childToBranch = {};\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @param {string} */\n        this.noteId = row.noteId;\n        /** @param {string} */\n        this.title = row.title;\n        /** @param {int} */\n        this.contentLength = row.contentLength;\n        /** @param {boolean} */\n        this.isProtected = !!row.isProtected;\n        /** @param {string} one of 'text', 'code', 'file' or 'render' */\n        this.type = row.type;\n        /** @param {string} content-type, e.g. \"application/json\" */\n        this.mime = row.mime;\n        /** @param {boolean} */\n        this.isDeleted = row.isDeleted;\n    }\n\n    addParent(parentNoteId, branchId) {\n        if (!this.parents.includes(parentNoteId)) {\n            this.parents.push(parentNoteId);\n        }\n\n        this.parentToBranch[parentNoteId] = branchId;\n    }\n\n    addChild(childNoteId, branchId) {\n        if (!this.children.includes(childNoteId)) {\n            this.children.push(childNoteId);\n        }\n\n        this.childToBranch[childNoteId] = branchId;\n\n        const branchIdPos = {};\n\n        for (const branchId of Object.values(this.childToBranch)) {\n            branchIdPos[branchId] = this.treeCache.getBranch(branchId).notePosition;\n        }\n\n        this.children.sort((a, b) => branchIdPos[this.childToBranch[a]] < branchIdPos[this.childToBranch[b]] ? -1 : 1);\n    }\n\n    /** @returns {boolean} */\n    isJson() {\n        return this.mime === \"application/json\";\n    }\n\n    async getContent() {\n        // we're not caching content since these objects are in treeCache and as such pretty long lived\n        const note = await server.get(\"notes/\" + this.noteId);\n\n        return note.content;\n    }\n\n    async getJsonContent() {\n        const content = await this.getContent();\n\n        try {\n            return JSON.parse(content);\n        }\n        catch (e) {\n            console.log(`Cannot parse content of note ${this.noteId}: `, e.message);\n\n            return null;\n        }\n    }\n\n    /** @returns {string[]} */\n    getBranchIds() {\n        return Object.values(this.parentToBranch);\n    }\n\n    /** @returns {Branch[]} */\n    getBranches() {\n        const branchIds = Object.values(this.parentToBranch);\n\n        return this.treeCache.getBranches(branchIds);\n    }\n\n    /** @returns {boolean} */\n    hasChildren() {\n        return this.children.length > 0;\n    }\n\n    /** @returns {Branch[]} */\n    getChildBranches() {\n        // don't use Object.values() to guarantee order\n        const branchIds = this.children.map(childNoteId => this.childToBranch[childNoteId]);\n\n        return this.treeCache.getBranches(branchIds);\n    }\n\n    /** @returns {string[]} */\n    getParentNoteIds() {\n        return this.parents;\n    }\n\n    /** @returns {NoteShort[]} */\n    getParentNotes() {\n        return this.treeCache.getNotesFromCache(this.parents);\n    }\n\n    /** @returns {string[]} */\n    getChildNoteIds() {\n        return this.children;\n    }\n\n    /** @returns {Promise<NoteShort[]>} */\n    async getChildNotes() {\n        return await this.treeCache.getNotes(this.children);\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {Attribute[]} all note's attributes, including inherited ones\n     */\n    getOwnedAttributes(type, name) {\n        const attrs = this.attributes\n            .map(attributeId => this.treeCache.attributes[attributeId])\n            .filter(Boolean); // filter out nulls;\n\n        return this.__filterAttrs(attrs, type, name);\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {Attribute[]} all note's attributes, including inherited ones\n     */\n    getAttributes(type, name) {\n        return this.__filterAttrs(this.__getCachedAttributes([]), type, name);\n    }\n\n    __getCachedAttributes(path) {\n        // notes/clones cannot form tree cycles, it is possible to create attribute inheritance cycle via templates\n        // when template instance is a parent of template itself\n        if (path.includes(this.noteId)) {\n            return [];\n        }\n\n        if (!(this.noteId in noteAttributeCache)) {\n            const ownedAttributes = this.getOwnedAttributes();\n\n            const attrArrs = [\n                ownedAttributes\n            ];\n\n            const newPath = [...path, this.noteId];\n\n            for (const templateAttr of ownedAttributes.filter(oa => oa.type === 'relation' && oa.name === 'template')) {\n                const templateNote = this.treeCache.notes[templateAttr.value];\n\n                if (templateNote && templateNote.noteId !== this.noteId) {\n                    attrArrs.push(templateNote.__getCachedAttributes(newPath));\n                }\n            }\n\n            if (this.noteId !== 'root') {\n                for (const parentNote of this.getParentNotes()) {\n                    // these virtual parent-child relationships are also loaded into frontend tree cache\n                    if (parentNote.type !== 'search') {\n                        attrArrs.push(parentNote.__getInheritableAttributes(newPath));\n                    }\n                }\n            }\n\n            noteAttributeCache.attributes[this.noteId] = attrArrs.flat();\n        }\n\n        return noteAttributeCache.attributes[this.noteId];\n    }\n\n    __filterAttrs(attributes, type, name) {\n        if (!type && !name) {\n            return attributes;\n        } else if (type && name) {\n            return attributes.filter(attr => attr.type === type && attr.name === name);\n        } else if (type) {\n            return attributes.filter(attr => attr.type === type);\n        } else if (name) {\n            return attributes.filter(attr => attr.name === name);\n        }\n    }\n\n    __getInheritableAttributes(path) {\n        const attrs = this.__getCachedAttributes(path);\n\n        return attrs.filter(attr => attr.isInheritable);\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {Attribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getOwnedLabels(name) {\n        return this.getOwnedAttributes(LABEL, name);\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {Attribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getLabels(name) {\n        return this.getAttributes(LABEL, name);\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {Attribute[]} all note's label definitions, including inherited ones\n     */\n    getLabelDefinitions(name) {\n        return this.getAttributes(LABEL_DEFINITION, name);\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Attribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getOwnedRelations(name) {\n        return this.getOwnedAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Attribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getRelations(name) {\n        return this.getAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Attribute[]} all note's relation definitions including inherited ones\n     */\n    getRelationDefinitions(name) {\n        return this.getAttributes(RELATION_DEFINITION, name);\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasAttribute(type, name) {\n        return !!this.getAttribute(type, name);\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasOwnedAttribute(type, name) {\n        return !!this.getOwnedAttribute(type, name);\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {Attribute} attribute of given type and name. If there's more such attributes, first is  returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getOwnedAttribute(type, name) {\n        const attributes = this.getOwnedAttributes(type, name);\n\n        return attributes.length > 0 ? attributes[0] : 0;\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {Attribute} attribute of given type and name. If there's more such attributes, first is  returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getAttribute(type, name) {\n        const attributes = this.getAttributes(type, name);\n\n        return attributes.length > 0 ? attributes[0] : 0;\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of given type and name or null if no such attribute exists.\n     */\n    getOwnedAttributeValue(type, name) {\n        const attr = this.getOwnedAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {string} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of given type and name or null if no such attribute exists.\n     */\n    getAttributeValue(type, name) {\n        const attr = this.getAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (excluding inherited)\n     */\n    hasOwnedLabel(name) { return this.hasOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (including inherited)\n     */\n    hasLabel(name) { return this.hasAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (excluding inherited)\n     */\n    hasOwnedRelation(name) { return this.hasOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (including inherited)\n     */\n    hasRelation(name) { return this.hasAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {Attribute} label if it exists, null otherwise\n     */\n    getOwnedLabel(name) { return this.getOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {Attribute} label if it exists, null otherwise\n     */\n    getLabel(name) { return this.getAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {Attribute} relation if it exists, null otherwise\n     */\n    getOwnedRelation(name) { return this.getOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {Attribute} relation if it exists, null otherwise\n     */\n    getRelation(name) { return this.getAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getOwnedLabelValue(name) { return this.getOwnedAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getLabelValue(name) { return this.getAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getOwnedRelationValue(name) { return this.getOwnedAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getRelationValue(name) { return this.getAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name\n     * @returns {Promise<NoteShort>|null} target note of the relation or null (if target is empty or note was not found)\n     */\n    async getRelationTarget(name) {\n        const targets = await this.getRelationTargets(name);\n\n        return targets.length > 0 ? targets[0] : null;\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Promise<NoteShort[]>}\n     */\n    async getRelationTargets(name) {\n        const relations = this.getRelations(name);\n        const targets = [];\n\n        for (const relation of relations) {\n            targets.push(await this.treeCache.getNote(relation.value));\n        }\n\n        return targets;\n    }\n\n    /**\n     * @returns {NoteShort[]}\n     */\n    getTemplateNotes() {\n        const relations = this.getRelations('template');\n\n        return relations.map(rel => this.treeCache.notes[rel.value]);\n    }\n\n    hasAncestor(ancestorNote) {\n        if (this.noteId === ancestorNote.noteId) {\n            return true;\n        }\n\n        for (const templateNote of this.getTemplateNotes()) {\n            if (templateNote.hasAncestor(ancestorNote)) {\n                return true;\n            }\n        }\n\n        for (const parentNote of this.getParentNotes()) {\n            if (parentNote.hasAncestor(ancestorNote)) {console.log(parentNote);\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Clear note's attributes cache to force fresh reload for next attribute request.\n     * Cache is note instance scoped.\n     */\n    invalidateAttributeCache() {\n        this.__attributeCache = null;\n    }\n\n    /**\n     * Get relations which target this note\n     *\n     * @returns {Attribute[]}\n     */\n    getTargetRelations() {\n        return this.targetRelations\n            .map(attributeId => this.treeCache.attributes[attributeId]);\n    }\n\n    /**\n     * Return note complement which is most importantly note's content\n     *\n     * @return {Promise<NoteComplement>}\n     */\n    async getNoteComplement() {\n        return await this.treeCache.getNoteComplement(this.noteId);\n    }\n\n    get toString() {\n        return `Note(noteId=${this.noteId}, title=${this.title})`;\n    }\n\n    get dto() {\n        const dto = Object.assign({}, this);\n        delete dto.treeCache;\n\n        return dto;\n    }\n\n    getCssClass() {\n        const labels = this.getLabels('cssClass');\n        return labels.map(l => l.value).join(' ');\n    }\n}\n\nexport default NoteShort;\n","/**\n * Complements the NoteShort with the main note content and other extra attributes\n */\nclass NoteComplement {\n    constructor(row) {\n        /** @param {string} */\n        this.noteId = row.noteId;\n\n        /** @param {string} */\n        this.content = row.content;\n\n        /** @param {string} */\n        this.dateCreated = row.dateCreated;\n\n        /** @param {string} */\n        this.dateModified = row.dateModified;\n\n        /** @param {string} */\n        this.utcDateCreated = row.utcDateCreated;\n\n        /** @param {string} */\n        this.utcDateModified = row.utcDateModified;\n    }\n}\n\nexport default NoteComplement;","import Branch from \"../entities/branch.js\";\nimport NoteShort from \"../entities/note_short.js\";\nimport Attribute from \"../entities/attribute.js\";\nimport server from \"./server.js\";\nimport NoteComplement from \"../entities/note_complement.js\";\n\n/**\n * TreeCache keeps a read only cache of note tree structure in frontend's memory.\n * - notes are loaded lazily when unknown noteId is requested\n * - when note is loaded, all its parent and child branches are loaded as well. For a branch to be used, it's not must be loaded before\n * - deleted notes are present in the cache as well, but they don't have any branches. As a result check for deleted branch is done by presence check - if the branch is not there even though the corresponding note has been loaded, we can infer it is deleted.\n *\n * Note and branch deletions are corner cases and usually not needed.\n */\nclass TreeCache {\n    constructor() {\n        this.initializedPromise = this.loadInitialTree();\n    }\n\n    async loadInitialTree() {\n        const resp = await server.get('tree');\n\n        await this.loadParents(resp, false);\n\n        // clear the cache only directly before adding new content which is important for e.g. switching to protected session\n\n        /** @type {Object.<string, NoteShort>} */\n        this.notes = {};\n\n        /** @type {Object.<string, Branch>} */\n        this.branches = {};\n\n        /** @type {Object.<string, Attribute>} */\n        this.attributes = {};\n\n        /** @type {Object.<string, Promise<NoteComplement>>} */\n        this.noteComplementPromises = {};\n\n        this.addResp(resp);\n    }\n\n    async loadParents(resp, additiveLoad) {\n        const noteIds = new Set(resp.notes.map(note => note.noteId));\n        const missingNoteIds = [];\n        const existingNotes = additiveLoad ? this.notes : {};\n\n        for (const branch of resp.branches) {\n            if (!(branch.parentNoteId in existingNotes) && !noteIds.has(branch.parentNoteId) && branch.parentNoteId !== 'none') {\n                missingNoteIds.push(branch.parentNoteId);\n            }\n        }\n\n        for (const attr of resp.attributes) {\n            if (attr.type === 'relation' && attr.name === 'template' && !(attr.value in existingNotes) && !noteIds.has(attr.value)) {\n                missingNoteIds.push(attr.value);\n            }\n\n            if (!(attr.noteId in existingNotes) && !noteIds.has(attr.noteId)) {\n                missingNoteIds.push(attr.noteId);\n            }\n        }\n\n        if (missingNoteIds.length > 0) {\n            const newResp = await server.post('tree/load', { noteIds: missingNoteIds });\n\n            resp.notes = resp.notes.concat(newResp.notes);\n            resp.branches = resp.branches.concat(newResp.branches);\n            resp.attributes = resp.attributes.concat(newResp.attributes);\n\n            await this.loadParents(resp, additiveLoad);\n        }\n    }\n\n    addResp(resp) {\n        const noteRows = resp.notes;\n        const branchRows = resp.branches;\n        const attributeRows = resp.attributes;\n\n        for (const noteRow of noteRows) {\n            const {noteId} = noteRow;\n\n            const oldNote = this.notes[noteId];\n\n            if (oldNote) {\n                for (const childNoteId of oldNote.children) {\n                    const childNote = this.notes[childNoteId];\n\n                    if (childNote) {\n                        childNote.parents = childNote.parents.filter(p => p !== noteId);\n\n                        delete this.branches[childNote.parentToBranch[noteId]];\n                        delete childNote.parentToBranch[noteId];\n                    }\n                }\n\n                for (const parentNoteId of oldNote.parents) {\n                    const parentNote = this.notes[parentNoteId];\n\n                    if (parentNote) {\n                        parentNote.children = parentNote.children.filter(p => p !== noteId);\n\n                        delete this.branches[parentNote.childToBranch[noteId]];\n                        delete parentNote.childToBranch[noteId];\n                    }\n                }\n            }\n\n            const note = new NoteShort(this, noteRow);\n\n            this.notes[note.noteId] = note;\n        }\n\n        for (const branchRow of branchRows) {\n            const branch = new Branch(this, branchRow);\n\n            this.branches[branch.branchId] = branch;\n\n            const childNote = this.notes[branch.noteId];\n\n            if (childNote) {\n                childNote.addParent(branch.parentNoteId, branch.branchId);\n            }\n\n            const parentNote = this.notes[branch.parentNoteId];\n\n            if (parentNote) {\n                parentNote.addChild(branch.noteId, branch.branchId);\n            }\n        }\n\n        for (const attributeRow of attributeRows) {\n            const {attributeId} = attributeRow;\n\n            this.attributes[attributeId] = new Attribute(this, attributeRow);\n\n            const note = this.notes[attributeRow.noteId];\n\n            if (!note.attributes.includes(attributeId)) {\n                note.attributes.push(attributeId);\n            }\n\n            if (attributeRow.type === 'relation') {\n                const targetNote = this.notes[attributeRow.value];\n\n                if (targetNote) {\n                    if (!targetNote.targetRelations.includes(attributeId)) {\n                        targetNote.targetRelations.push(attributeId);\n                    }\n                }\n            }\n        }\n    }\n\n    async reloadNotes(noteIds) {\n        if (noteIds.length === 0) {\n            return;\n        }\n\n        noteIds = Array.from(new Set(noteIds)); // make noteIds unique\n\n        const resp = await server.post('tree/load', { noteIds });\n\n        await this.loadParents(resp, true);\n        this.addResp(resp);\n\n        for (const note of resp.notes) {\n            if (note.type === 'search') {\n                const searchResults = await server.get('search-note/' + note.noteId);\n\n                if (!searchResults) {\n                    throw new Error(`Search note ${note.noteId} failed.`);\n                }\n\n                // force to load all the notes at once instead of one by one\n                await this.getNotes(searchResults.map(res => res.noteId));\n\n                const branches = resp.branches.filter(b => b.noteId === note.noteId || b.parentNoteId === note.noteId);\n\n                searchResults.forEach((result, index) => branches.push({\n                    // branchId should be repeatable since sometimes we reload some notes without rerendering the tree\n                    branchId: \"virt\" + result.noteId + '-' + note.noteId,\n                    noteId: result.noteId,\n                    parentNoteId: note.noteId,\n                    prefix: this.getBranch(result.branchId).prefix,\n                    notePosition: (index + 1) * 10\n                }));\n\n                // update this note with standard (parent) branches + virtual (children) branches\n                this.addResp({\n                    notes: [note],\n                    branches,\n                    attributes: []\n                });\n            }\n        }\n    }\n\n    /** @return {NoteShort[]} */\n    getNotesFromCache(noteIds, silentNotFoundError = false) {\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.log(`Can't find note \"${noteId}\"`);\n\n                return null;\n            }\n            else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @return {Promise<NoteShort[]>} */\n    async getNotes(noteIds, silentNotFoundError = false) {\n        const missingNoteIds = noteIds.filter(noteId => !this.notes[noteId]);\n\n        await this.reloadNotes(missingNoteIds);\n\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.log(`Can't find note \"${noteId}\"`);\n\n                return null;\n            }\n            else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @return {Promise<boolean>} */\n    async noteExists(noteId) {\n        const notes = await this.getNotes([noteId], true);\n\n        return notes.length === 1;\n    }\n\n    /** @return {Promise<NoteShort>} */\n    async getNote(noteId, silentNotFoundError = false) {\n        if (noteId === 'none') {\n            console.trace(`No 'none' note.`);\n            return null;\n        }\n        else if (!noteId) {\n            console.log(`Falsy noteId ${noteId}, returning null.`);\n            return null;\n        }\n\n        return (await this.getNotes([noteId], silentNotFoundError))[0];\n    }\n\n    getNoteFromCache(noteId) {\n        return this.notes[noteId];\n    }\n\n    getBranches(branchIds, silentNotFoundError = false) {\n        return branchIds\n            .map(branchId => this.getBranch(branchId, silentNotFoundError))\n            .filter(b => !!b);\n    }\n\n    /** @return {Branch} */\n    getBranch(branchId, silentNotFoundError = false) {\n        if (!(branchId in this.branches)) {\n            if (!silentNotFoundError) {\n                console.error(`Not existing branch ${branchId}`);\n            }\n        }\n        else {\n            return this.branches[branchId];\n        }\n    }\n\n    async getBranchId(parentNoteId, childNoteId) {\n        const child = await this.getNote(childNoteId);\n\n        if (!child) {\n            console.error(`Could not find branchId for parent=${parentNoteId}, child=${childNoteId} since child does not exist`);\n\n            return null;\n        }\n\n        return child.parentToBranch[parentNoteId];\n    }\n\n    /**\n     * @return {Promise<NoteComplement>}\n     */\n    async getNoteComplement(noteId) {\n        if (!this.noteComplementPromises[noteId]) {\n            this.noteComplementPromises[noteId] = server.get('notes/' + noteId).then(row => new NoteComplement(row));\n        }\n\n        return await this.noteComplementPromises[noteId];\n    }\n}\n\nconst treeCache = new TreeCache();\n\nexport default treeCache;\n","function reloadApp() {\n    window.location.reload(true);\n}\n\nfunction parseDate(str) {\n    try {\n        return new Date(Date.parse(str));\n    }\n    catch (e) {\n        throw new Error(\"Can't parse date from \" + str + \": \" + e.stack);\n    }\n}\n\nfunction padNum(num) {\n    return (num <= 9 ? \"0\" : \"\") + num;\n}\n\nfunction formatTime(date) {\n    return padNum(date.getHours()) + \":\" + padNum(date.getMinutes());\n}\n\nfunction formatTimeWithSeconds(date) {\n    return padNum(date.getHours()) + \":\" + padNum(date.getMinutes()) + \":\" + padNum(date.getSeconds());\n}\n\n// this is producing local time!\nfunction formatDate(date) {\n//    return padNum(date.getDate()) + \". \" + padNum(date.getMonth() + 1) + \". \" + date.getFullYear();\n    // instead of european format we'll just use ISO as that's pretty unambiguous\n\n    return formatDateISO(date);\n}\n\n// this is producing local time!\nfunction formatDateISO(date) {\n    return date.getFullYear() + \"-\" + padNum(date.getMonth() + 1) + \"-\" + padNum(date.getDate());\n}\n\nfunction formatDateTime(date) {\n    return formatDate(date) + \" \" + formatTime(date);\n}\n\nfunction localNowDateTime() {\n    return dayjs().format('YYYY-MM-DD HH:mm:ss.SSSZZ')\n}\n\nfunction now() {\n    return formatTimeWithSeconds(new Date());\n}\n\nfunction isElectron() {\n    return !!(window && window.process && window.process.type);\n}\n\nfunction isMac() {\n    return navigator.platform.indexOf('Mac') > -1;\n}\n\nfunction assertArguments() {\n    for (const i in arguments) {\n        if (!arguments[i]) {\n            console.trace(`Argument idx#${i} should not be falsy: ${arguments[i]}`);\n        }\n    }\n}\n\nconst entityMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '/': '&#x2F;',\n    '`': '&#x60;',\n    '=': '&#x3D;'\n};\n\nfunction escapeHtml(str) {\n    return str.replace(/[&<>\"'`=\\/]/g, s => entityMap[s]);\n}\n\nasync function stopWatch(what, func) {\n    const start = new Date();\n\n    const ret = await func();\n\n    const tookMs = Date.now() - start.getTime();\n\n    console.log(`${what} took ${tookMs}ms`);\n\n    return ret;\n}\n\nfunction formatValueWithWhitespace(val) {\n    return /[^\\w_-]/.test(val) ? '\"' + val + '\"' : val;\n}\n\nfunction formatLabel(label) {\n    let str = \"@\" + formatValueWithWhitespace(label.name);\n\n    if (label.value !== \"\") {\n        str += \"=\" + formatValueWithWhitespace(label.value);\n    }\n\n    return str;\n}\n\nfunction getHost() {\n    const url = new URL(window.location.href);\n    return url.protocol + \"//\" + url.hostname + \":\" + url.port;\n}\n\nfunction download(url) {\n    url += '?' + Date.now(); // don't use cache\n\n    if (isElectron()) {\n        const remote = dynamicRequire('electron').remote;\n\n        remote.getCurrentWebContents().downloadURL(url);\n    }\n    else {\n        window.location.href = url;\n    }\n}\n\nfunction toObject(array, fn) {\n    const obj = {};\n\n    for (const item of array) {\n        const [key, value] = fn(item);\n\n        obj[key] = value;\n    }\n\n    return obj;\n}\n\nfunction randomString(len) {\n    let text = \"\";\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (let i = 0; i < len; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\nfunction bindGlobalShortcut(keyboardShortcut, handler) {\n    bindElShortcut($(document), keyboardShortcut, handler);\n}\n\nfunction bindElShortcut($el, keyboardShortcut, handler) {\n    if (isDesktop()) {\n        keyboardShortcut = normalizeShortcut(keyboardShortcut);\n\n        $el.bind('keydown', keyboardShortcut, e => {\n            handler(e);\n\n            e.preventDefault();\n            e.stopPropagation();\n        });\n    }\n}\n\n/**\n * Normalize to the form expected by the jquery.hotkeys.js\n */\nfunction normalizeShortcut(shortcut) {\n    return shortcut\n        .toLowerCase()\n        .replace(\"enter\", \"return\")\n        .replace(\"delete\", \"del\")\n        .replace(\"ctrl+alt\", \"alt+ctrl\")\n        .replace(\"meta+alt\", \"alt+meta\"); // alt needs to be first;\n}\n\nfunction isMobile() {\n    return window.device === \"mobile\"\n        // window.device is not available in setup\n        || (!window.device && /Mobi/.test(navigator.userAgent));\n}\n\nfunction isDesktop() {\n    return window.device === \"desktop\"\n        // window.device is not available in setup\n        || (!window.device && !/Mobi/.test(navigator.userAgent));\n}\n\n// cookie code below works for simple use cases only - ASCII only\n// not setting path so that cookies do not leak into other websites if multiplexed with reverse proxy\n\nfunction setCookie(name, value) {\n    const date = new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000);\n    const expires = \"; expires=\" + date.toUTCString();\n\n    document.cookie = name + \"=\" + (value || \"\")  + expires + \";\";\n}\n\nfunction setSessionCookie(name, value) {\n    document.cookie = name + \"=\" + (value || \"\") + \";\";\n}\n\nfunction getCookie(name) {\n    const valueMatch = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');\n    return valueMatch ? valueMatch[2] : null;\n}\n\nfunction getNoteTypeClass(type) {\n    return \"type-\" + type;\n}\n\nfunction getMimeTypeClass(mime) {\n    const semicolonIdx = mime.indexOf(';');\n\n    if (semicolonIdx !== -1) {\n        // stripping everything following the semicolon\n        mime = mime.substr(0, semicolonIdx);\n    }\n\n    return 'mime-' + mime.toLowerCase().replace(/[\\W_]+/g,\"-\");\n}\n\nfunction closeActiveDialog() {\n    if (glob.activeDialog) {\n        glob.activeDialog.modal('hide');\n        glob.activeDialog = null;\n    }\n}\n\nlet $lastFocusedElement = null;\n\nfunction saveFocusedElement() {\n    $lastFocusedElement = $(\":focus\");\n}\n\nfunction focusSavedElement() {\n    if (!$lastFocusedElement) {\n        return;\n    }\n\n    if ($lastFocusedElement.hasClass(\"ck\")) {\n        // must handle CKEditor separately because of this bug: https://github.com/ckeditor/ckeditor5/issues/607\n\n        const editor = $lastFocusedElement\n            .closest('.ck-editor__editable')\n            .prop('ckeditorInstance');\n\n        editor.editing.view.focus();\n    } else {\n        $lastFocusedElement.focus();\n    }\n\n    $lastFocusedElement = null;\n}\n\nasync function openDialog($dialog) {\n    closeActiveDialog();\n\n    glob.activeDialog = $dialog;\n\n    saveFocusedElement();\n\n    $dialog.modal();\n\n    $dialog.on('hidden.bs.modal', () => {\n        if (!glob.activeDialog || glob.activeDialog === $dialog) {\n            focusSavedElement();\n        }\n    });\n\n    const keyboardActionsService = (await import(\"./keyboard_actions.js\")).default;\n    keyboardActionsService.updateDisplayedShortcuts($dialog);\n}\n\nfunction isHtmlEmpty(html) {\n    if (!html) {\n        return true;\n    }\n\n    html = html.toLowerCase();\n\n    return !html.includes('<img')\n        && !html.includes('<section')\n        // line below will actually attempt to load images so better to check for images first\n        && $(\"<div>\").html(html).text().trim().length === 0;\n}\n\nasync function clearBrowserCache() {\n    if (isElectron()) {\n        const win = dynamicRequire('electron').remote.getCurrentWindow();\n        await win.webContents.session.clearCache();\n    }\n}\n\n/**\n * @param url - should be without initial slash!!!\n */\nfunction getUrlForDownload(url) {\n    if (isElectron()) {\n        // electron needs absolute URL so we extract current host, port, protocol\n        return getHost() + '/' + url;\n    }\n    else {\n        // web server can be deployed on subdomain so we need to use relative path\n        return url;\n    }\n}\n\nfunction copySelectionToClipboard() {\n    const text = window.getSelection().toString();\n    if (navigator.clipboard) {\n        navigator.clipboard.writeText(text);\n    }\n}\n\nfunction isCKEditorInitialized() {\n    return !!(window && window.cutToNote);\n}\n\nfunction dynamicRequire(moduleName) {\n    if (typeof __non_webpack_require__ !== 'undefined') {\n        return __non_webpack_require__(moduleName);\n    }\n    else {\n        return require(moduleName);\n    }\n}\n\nfunction timeLimit(promise, limitMs) {\n    // better stack trace if created outside of promise\n    const error = new Error('Process exceeded time limit ' + limitMs);\n\n    return new Promise((res, rej) => {\n        let resolved = false;\n\n        promise.then(result => {\n            resolved = true;\n\n            res(result);\n        });\n\n        setTimeout(() => {\n            if (!resolved) {\n                rej(error);\n            }\n        }, limitMs);\n    });\n}\n\nexport default {\n    reloadApp,\n    parseDate,\n    padNum,\n    formatTime,\n    formatTimeWithSeconds,\n    formatDate,\n    formatDateISO,\n    formatDateTime,\n    localNowDateTime,\n    now,\n    isElectron,\n    isMac,\n    assertArguments,\n    escapeHtml,\n    stopWatch,\n    formatLabel,\n    download,\n    toObject,\n    randomString,\n    bindGlobalShortcut,\n    bindElShortcut,\n    isMobile,\n    isDesktop,\n    setCookie,\n    setSessionCookie,\n    getCookie,\n    getNoteTypeClass,\n    getMimeTypeClass,\n    closeActiveDialog,\n    openDialog,\n    saveFocusedElement,\n    focusSavedElement,\n    isHtmlEmpty,\n    clearBrowserCache,\n    getUrlForDownload,\n    normalizeShortcut,\n    copySelectionToClipboard,\n    isCKEditorInitialized,\n    dynamicRequire,\n    timeLimit\n};\n","export default class LoadResults {\n    constructor(treeCache) {\n        this.treeCache = treeCache;\n\n        this.noteIdToSourceId = {};\n        this.sourceIdToNoteIds = {};\n\n        this.branches = [];\n\n        this.attributes = [];\n\n        this.noteReorderings = [];\n\n        this.noteRevisions = [];\n\n        this.contentNoteIdToSourceId = [];\n\n        this.options = [];\n    }\n\n    addNote(noteId, sourceId) {\n        this.noteIdToSourceId[noteId] = this.noteIdToSourceId[noteId] || [];\n\n        if (!this.noteIdToSourceId[noteId].includes(sourceId)) {\n            this.noteIdToSourceId[noteId].push(sourceId);\n        }\n\n        this.sourceIdToNoteIds[sourceId] = this.sourceIdToNoteIds[sourceId] || [];\n\n        if (!this.sourceIdToNoteIds[sourceId]) {\n            this.sourceIdToNoteIds[sourceId].push(noteId);\n        }\n    }\n\n    addBranch(branchId, sourceId) {\n        this.branches.push({branchId, sourceId});\n    }\n\n    getBranches() {\n        return this.branches\n            .map(row => this.treeCache.branches[row.branchId])\n            .filter(branch => !!branch);\n    }\n\n    addNoteReordering(parentNoteId, sourceId) {\n        this.noteReorderings.push(parentNoteId);\n    }\n\n    getNoteReorderings() {\n        return this.noteReorderings;\n    }\n\n    addAttribute(attributeId, sourceId) {\n        this.attributes.push({attributeId, sourceId});\n    }\n\n    getAttributes(sourceId = 'none') {\n        return this.attributes\n            .filter(row => row.sourceId !== sourceId)\n            .map(row => this.treeCache.attributes[row.attributeId])\n            .filter(attr => !!attr);\n    }\n\n    addNoteRevision(noteRevisionId, noteId, sourceId) {\n        this.noteRevisions.push({noteRevisionId, noteId, sourceId});\n    }\n\n    hasNoteRevisionForNote(noteId) {\n        return !!this.noteRevisions.find(nr => nr.noteId === noteId);\n    }\n\n    getNoteIds() {\n        return Object.keys(this.noteIdToSourceId);\n    }\n\n    isNoteReloaded(noteId, sourceId = null) {\n        if (!noteId) {\n            return false;\n        }\n\n        const sourceIds = this.noteIdToSourceId[noteId];\n        return sourceIds && !!sourceIds.find(sId => sId !== sourceId);\n    }\n\n    addNoteContent(noteId, sourceId) {\n        this.contentNoteIdToSourceId.push({noteId, sourceId});\n    }\n\n    isNoteContentReloaded(noteId, sourceId) {\n        if (!noteId) {\n            return false;\n        }\n\n        return this.contentNoteIdToSourceId.find(l => l.noteId === noteId && l.sourceId !== sourceId);\n    }\n\n    addOption(name) {\n        this.options.push(name);\n    }\n\n    isOptionReloaded(name) {\n        this.options.includes(name);\n    }\n\n    /**\n     * @return {boolean} true if there are changes which could affect the attributes (including inherited ones)\n     *          notably changes in note itself should not have any effect on attributes\n     */\n    hasAttributeRelatedChanges() {\n        return this.branches.length === 0\n            && this.attributes.length === 0;\n    }\n\n    isEmpty() {\n        return Object.keys(this.noteIdToSourceId).length === 0\n            && this.branches.length === 0\n            && this.attributes.length === 0\n            && this.noteReorderings.length === 0\n            && this.noteRevisions.length === 0\n            && this.contentNoteIdToSourceId.length === 0\n            && this.options.length === 0;\n    }\n}\n","import utils from './utils.js';\nimport toastService from \"./toast.js\";\nimport server from \"./server.js\";\nimport LoadResults from \"./load_results.js\";\nimport Branch from \"../entities/branch.js\";\nimport Attribute from \"../entities/attribute.js\";\nimport options from \"./options.js\";\nimport treeCache from \"./tree_cache.js\";\nimport noteAttributeCache from \"./note_attribute_cache.js\";\n\nconst $outstandingSyncsCount = $(\"#outstanding-syncs-count\");\n\nconst messageHandlers = [];\n\nlet ws;\nlet lastAcceptedSyncId = window.glob.maxSyncIdAtLoad;\nlet lastProcessedSyncId = window.glob.maxSyncIdAtLoad;\nlet lastPingTs;\nlet syncDataQueue = [];\n\nfunction logError(message) {\n    console.log(utils.now(), message); // needs to be separate from .trace()\n    console.trace();\n\n    if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n            type: 'log-error',\n            error: message,\n            stack: new Error().stack\n        }));\n    }\n}\n\nfunction subscribeToMessages(messageHandler) {\n    messageHandlers.push(messageHandler);\n}\n\n// used to serialize sync operations\nlet consumeQueuePromise = null;\n\n// most sync events are sent twice - once immediatelly after finishing the transaction and once during the scheduled ping\n// but we want to process only once\nconst processedSyncIds = new Set();\n\nfunction logRows(syncRows) {\n    const filteredRows = syncRows.filter(row =>\n        !processedSyncIds.has(row.id)\n        && row.entityName !== 'recent_notes'\n        && (row.entityName !== 'options' || row.entityId !== 'openTabs'));\n\n    if (filteredRows.length > 0) {\n        console.debug(utils.now(), \"Sync data: \", filteredRows);\n    }\n}\n\nasync function handleMessage(event) {\n    const message = JSON.parse(event.data);\n\n    for (const messageHandler of messageHandlers) {\n        messageHandler(message);\n    }\n\n    if (message.type === 'sync') {\n        let syncRows = message.data;\n        lastPingTs = Date.now();\n\n        $outstandingSyncsCount.html(message.outstandingSyncs);\n\n        if (syncRows.length > 0) {\n            logRows(syncRows);\n\n            syncDataQueue.push(...syncRows);\n\n            // we set lastAcceptedSyncId even before sync processing and send ping so that backend can start sending more updates\n            lastAcceptedSyncId = Math.max(lastAcceptedSyncId, syncRows[syncRows.length - 1].id);\n            sendPing();\n\n            // first wait for all the preceding consumers to finish\n            while (consumeQueuePromise) {\n                await consumeQueuePromise;\n            }\n\n            try {\n                // it's my turn so start it up\n                consumeQueuePromise = consumeSyncData();\n\n                await consumeQueuePromise;\n            }\n            finally {\n                // finish and set to null to signal somebody else can pick it up\n                consumeQueuePromise = null;\n            }\n        }\n    }\n    else if (message.type === 'sync-hash-check-failed') {\n        toastService.showError(\"Sync check failed!\", 60000);\n    }\n    else if (message.type === 'consistency-checks-failed') {\n        toastService.showError(\"Consistency checks failed! See logs for details.\", 50 * 60000);\n    }\n}\n\nlet syncIdReachedListeners = [];\n\nfunction waitForSyncId(desiredSyncId) {\n    if (desiredSyncId <= lastProcessedSyncId) {\n        return Promise.resolve();\n    }\n\n    console.debug(\"Waiting for\", desiredSyncId, 'current is', lastProcessedSyncId);\n\n    return new Promise((res, rej) => {\n        syncIdReachedListeners.push({\n            desiredSyncId,\n            resolvePromise: res,\n            start: Date.now()\n        })\n    });\n}\n\nfunction waitForMaxKnownSyncId() {\n    return waitForSyncId(server.getMaxKnownSyncId());\n}\n\nfunction checkSyncIdListeners() {\n    syncIdReachedListeners\n        .filter(l => l.desiredSyncId <= lastProcessedSyncId)\n        .forEach(l => l.resolvePromise());\n\n    syncIdReachedListeners = syncIdReachedListeners\n        .filter(l => l.desiredSyncId > lastProcessedSyncId);\n\n    syncIdReachedListeners.filter(l => Date.now() > l.start - 60000)\n        .forEach(l => console.log(`Waiting for syncId ${l.desiredSyncId} while current is ${lastProcessedSyncId} for ${Math.floor((Date.now() - l.start) / 1000)}s`));\n}\n\nasync function runSafely(syncHandler, syncData) {\n    try {\n        return await syncHandler(syncData);\n    }\n    catch (e) {\n        console.log(`Sync handler failed with ${e.message}: ${e.stack}`);\n    }\n}\n\n/**\n * TODO: we should rethink the fact that each sync row is sent twice (once at the end of transaction, once periodically)\n *       and we keep both lastProcessedSyncId and processedSyncIds\n *       it even seems incorrect that when transaction sync rows are received, we incorrectly increase lastProcessedSyncId\n *       and then some syncs might lost (or are *all* sync rows sent from transactions?)\n */\nasync function consumeSyncData() {\n    if (syncDataQueue.length > 0) {\n        const allSyncRows = syncDataQueue;\n        syncDataQueue = [];\n\n        const nonProcessedSyncRows = allSyncRows.filter(sync => !processedSyncIds.has(sync.id));\n\n        try {\n            await utils.timeLimit(processSyncRows(nonProcessedSyncRows), 5000);\n        }\n        catch (e) {\n            logError(`Encountered error ${e.message}: ${e.stack}, reloading frontend.`);\n\n            // if there's an error in updating the frontend then the easy option to recover is to reload the frontend completely\n            utils.reloadApp();\n        }\n\n        for (const syncRow of nonProcessedSyncRows) {\n            processedSyncIds.add(syncRow.id);\n        }\n\n        lastProcessedSyncId = Math.max(lastProcessedSyncId, allSyncRows[allSyncRows.length - 1].id);\n    }\n\n    checkSyncIdListeners();\n}\n\nfunction connectWebSocket() {\n    const loc = window.location;\n    const webSocketUri = (loc.protocol === \"https:\" ? \"wss:\" : \"ws:\")\n                       + \"//\" + loc.host + loc.pathname;\n\n    // use wss for secure messaging\n    const ws = new WebSocket(webSocketUri);\n    ws.onopen = () => console.debug(utils.now(), `Connected to server ${webSocketUri} with WebSocket`);\n    ws.onmessage = handleMessage;\n    // we're not handling ws.onclose here because reconnection is done in sendPing()\n\n    return ws;\n}\n\nasync function sendPing() {\n    if (Date.now() - lastPingTs > 30000) {\n        console.log(utils.now(), \"Lost websocket connection to the backend. If you keep having this issue repeatedly, you might want to check your reverse proxy (nginx, apache) configuration and allow/unblock WebSocket.\");\n    }\n\n    if (ws.readyState === ws.OPEN) {\n        ws.send(JSON.stringify({\n            type: 'ping',\n            lastSyncId: lastAcceptedSyncId\n        }));\n    }\n    else if (ws.readyState === ws.CLOSED || ws.readyState === ws.CLOSING) {\n        console.log(utils.now(), \"WS closed or closing, trying to reconnect\");\n\n        ws = connectWebSocket();\n    }\n}\n\nsetTimeout(() => {\n    ws = connectWebSocket();\n\n    lastPingTs = Date.now();\n\n    setInterval(sendPing, 1000);\n}, 0);\n\nsubscribeToMessages(message => {\n    if (message.type === 'sync-pull-in-progress') {\n        toastService.showPersistent({\n            id: 'sync',\n            title: \"Sync status\",\n            message: \"Sync update in progress\",\n            icon: \"refresh\"\n        });\n    }\n    else if (message.type === 'sync-pull-finished') {\n        // this gives user a chance to see the toast in case of fast sync finish\n        setTimeout(() => toastService.closePersistent('sync'), 1000);\n    }\n});\n\nasync function processSyncRows(syncRows) {\n    const missingNoteIds = [];\n\n    for (const {entityName, entity} of syncRows) {\n        if (entityName === 'branches' && !(entity.parentNoteId in treeCache.notes)) {\n            missingNoteIds.push(entity.parentNoteId);\n        }\n        else if (entityName === 'attributes'\n              && entity.type === 'relation'\n              && entity.name === 'template'\n              && !(entity.noteId in treeCache.notes)) {\n\n            missingNoteIds.push(entity.value);\n        }\n    }\n\n    if (missingNoteIds.length > 0) {\n        await treeCache.reloadNotes(missingNoteIds);\n    }\n\n    const loadResults = new LoadResults(treeCache);\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'notes')) {\n        const note = treeCache.notes[sync.entityId];\n\n        if (note) {\n            note.update(sync.entity);\n            loadResults.addNote(sync.entityId, sync.sourceId);\n        }\n    }\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'branches')) {\n        let branch = treeCache.branches[sync.entityId];\n        const childNote = treeCache.notes[sync.entity.noteId];\n        const parentNote = treeCache.notes[sync.entity.parentNoteId];\n\n        if (branch) {\n            branch.update(sync.entity);\n            loadResults.addBranch(sync.entityId, sync.sourceId);\n\n            if (sync.entity.isDeleted) {\n                if (childNote) {\n                    childNote.parents = childNote.parents.filter(parentNoteId => parentNoteId !== sync.entity.parentNoteId);\n                    delete childNote.parentToBranch[sync.entity.parentNoteId];\n                }\n\n                if (parentNote) {\n                    parentNote.children = parentNote.children.filter(childNoteId => childNoteId !== sync.entity.noteId);\n                    delete parentNote.childToBranch[sync.entity.noteId];\n                }\n            }\n            else {\n                if (childNote) {\n                    childNote.addParent(branch.parentNoteId, branch.branchId);\n                }\n\n                if (parentNote) {\n                    parentNote.addChild(branch.noteId, branch.branchId);\n                }\n            }\n        }\n        else if (!sync.entity.isDeleted) {\n            if (childNote || parentNote) {\n                branch = new Branch(treeCache, sync.entity);\n                treeCache.branches[branch.branchId] = branch;\n\n                loadResults.addBranch(sync.entityId, sync.sourceId);\n\n                if (childNote) {\n                    childNote.addParent(branch.parentNoteId, branch.branchId);\n                }\n\n                if (parentNote) {\n                    parentNote.addChild(branch.noteId, branch.branchId);\n                }\n            }\n        }\n    }\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'note_reordering')) {\n        for (const branchId in sync.positions) {\n            const branch = treeCache.branches[branchId];\n\n            if (branch) {\n                branch.notePosition = sync.positions[branchId];\n            }\n        }\n\n        loadResults.addNoteReordering(sync.entityId, sync.sourceId);\n    }\n\n    // missing reloading the relation target note\n    for (const sync of syncRows.filter(sync => sync.entityName === 'attributes')) {\n        let attribute = treeCache.attributes[sync.entityId];\n        const sourceNote = treeCache.notes[sync.entity.noteId];\n        const targetNote = sync.entity.type === 'relation' && treeCache.notes[sync.entity.value];\n\n        if (attribute) {\n            attribute.update(sync.entity);\n            loadResults.addAttribute(sync.entityId, sync.sourceId);\n\n            if (sync.entity.isDeleted) {\n                if (sourceNote) {\n                    sourceNote.attributes = sourceNote.attributes.filter(attributeId => attributeId !== attribute.attributeId);\n                }\n\n                if (targetNote) {\n                    targetNote.targetRelations = targetNote.targetRelations.filter(attributeId => attributeId !== attribute.attributeId);\n                }\n            }\n        }\n        else if (!sync.entity.isDeleted) {\n            if (sourceNote || targetNote) {\n                attribute = new Attribute(treeCache, sync.entity);\n\n                treeCache.attributes[attribute.attributeId] = attribute;\n\n                loadResults.addAttribute(sync.entityId, sync.sourceId);\n\n                if (sourceNote && !sourceNote.attributes.includes(attribute.attributeId)) {\n                    sourceNote.attributes.push(attribute.attributeId);\n                }\n\n                if (targetNote && !targetNote.targetRelations.includes(attribute.attributeId)) {\n                    targetNote.targetRelations.push(attribute.attributeId);\n                }\n            }\n        }\n    }\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'note_contents')) {\n        delete treeCache.noteComplementPromises[sync.entityId];\n\n        loadResults.addNoteContent(sync.entityId, sync.sourceId);\n    }\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'note_revisions')) {\n        loadResults.addNoteRevision(sync.entityId, sync.noteId, sync.sourceId);\n    }\n\n    for (const sync of syncRows.filter(sync => sync.entityName === 'options')) {\n        if (sync.entity.name === 'openTabs') {\n            continue; // only noise\n        }\n\n        options.set(sync.entity.name, sync.entity.value);\n\n        loadResults.addOption(sync.entity.name);\n    }\n\n    if (!loadResults.isEmpty()) {\n        if (loadResults.hasAttributeRelatedChanges()) {\n            noteAttributeCache.invalidate();\n        }\n\n        const appContext = (await import(\"./app_context.js\")).default;\n        await appContext.triggerEvent('entitiesReloaded', {loadResults});\n    }\n}\n\nexport default {\n    logError,\n    subscribeToMessages,\n    waitForSyncId,\n    waitForMaxKnownSyncId\n};\n","import options from \"./options.js\";\nimport Component from \"../widgets/component.js\";\nimport utils from \"../services/utils.js\";\n\nconst MIN_ZOOM = 0.5;\nconst MAX_ZOOM = 2.0;\n\nclass ZoomService extends Component {\n    constructor() {\n        super();\n\n        if (utils.isElectron()) {\n            options.initializedPromise.then(() => {\n                this.setZoomFactor(options.getFloat('zoomFactor'));\n            });\n        }\n    }\n\n    setZoomFactor(zoomFactor) {\n        zoomFactor = parseFloat(zoomFactor);\n\n        const webFrame = utils.dynamicRequire('electron').webFrame;\n        webFrame.setZoomFactor(zoomFactor);\n    }\n\n    async setZoomFactorAndSave(zoomFactor) {\n        if (zoomFactor >= MIN_ZOOM && zoomFactor <= MAX_ZOOM) {\n            this.setZoomFactor(zoomFactor);\n\n            await options.save('zoomFactor', zoomFactor);\n        }\n        else {\n            console.log(`Zoom factor ${zoomFactor} outside of the range, ignored.`);\n        }\n    }\n\n    getCurrentZoom() {\n        return utils.dynamicRequire('electron').webFrame.getZoomFactor();\n    }\n\n    zoomOutEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() - 0.1);\n    }\n\n    zoomInEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() + 0.1);\n    }\n\n    setZoomFactorAndSaveEvent({zoomFactor}) {\n        this.setZoomFactorAndSave(zoomFactor);\n    }\n}\n\nconst zoomService = new ZoomService();\n\nexport default zoomService;\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => [];\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 3676;\nmodule.exports = webpackEmptyContext;","import Component from \"./component.js\";\n\nclass BasicWidget extends Component {\n    constructor() {\n        super();\n\n        this.attrs = {\n            style: ''\n        };\n        this.classes = [];\n    }\n\n    id(id) {\n        this.attrs.id = id;\n        return this;\n    }\n\n    class(className) {\n        this.classes.push(className);\n        return this;\n    }\n\n    css(name, value) {\n        this.attrs.style += `${name}: ${value};`;\n        return this;\n    }\n\n    collapsible() {\n        this.css('min-height', '0');\n        return this;\n    }\n\n    filling() {\n        this.css('flex-grow', '1');\n        return this;\n    }\n\n    hideInZenMode() {\n        this.class('hide-in-zen-mode');\n        return this;\n    }\n\n    cssBlock(block) {\n        this.cssEl = block;\n        return this;\n    }\n\n    render() {\n        const $widget = this.doRender();\n\n        $widget.addClass('component')\n            .prop('component', this);\n\n        this.toggleInt(this.isEnabled());\n\n        if (this.cssEl) {\n            const css = this.cssEl.trim().startsWith('<style>') ? this.cssEl : `<style>${this.cssEl}</style>`;\n\n            $widget.append(css);\n        }\n\n        for (const key in this.attrs) {\n            if (key === 'style') {\n                if (this.attrs[key]) {\n                    let style = $widget.attr('style');\n                    style = style ? `${style}; ${this.attrs[key]}` : this.attrs[key];\n\n                    $widget.attr(key, style);\n                }\n            }\n            else {\n                $widget.attr(key, this.attrs[key]);\n            }\n        }\n\n        for (const className of this.classes) {\n            $widget.addClass(className);\n        }\n\n        return $widget;\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * for overriding\n     */\n    doRender() {}\n\n    toggleInt(show) {\n        this.$widget.toggleClass('hidden-int', !show);\n    }\n\n    toggleExt(show) {\n        this.$widget.toggleClass('hidden-ext', !show);\n    }\n\n    isVisible() {\n        return this.$widget.is(\":visible\");\n    }\n\n    getPosition() {\n        return this.position;\n    }\n\n    remove() {\n        if (this.$widget) {\n            this.$widget.remove();\n        }\n    }\n\n    cleanup() {}\n}\n\nexport default BasicWidget;\n","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport options from \"../services/options.js\";\n\nconst WIDGET_TPL = `\n<div class=\"card widget\">\n    <div class=\"card-header\">\n        <div>           \n            <button class=\"btn btn-sm widget-title\" data-toggle=\"collapse\" data-target=\"#[to be set]\">\n                Collapsible Group Item\n            </button>\n            \n            <a class=\"widget-help external no-arrow bx bx-info-circle\"></a>\n        </div>\n        \n        <div class=\"widget-header-actions\"></div>\n    </div>\n\n    <div id=\"[to be set]\" class=\"collapse body-wrapper\" style=\"transition: none; \">\n        <div class=\"card-body\"></div>\n    </div>\n</div>`;\n\nexport default class CollapsibleWidget extends TabAwareWidget {\n    get widgetTitle() { return \"Untitled widget\"; }\n\n    get headerActions() { return []; }\n\n    get help() { return {}; }\n\n    doRender() {\n        this.$widget = $(WIDGET_TPL);\n        this.$widget.find('[data-target]').attr('data-target', \"#\" + this.componentId);\n\n        this.$bodyWrapper = this.$widget.find('.body-wrapper');\n        this.$bodyWrapper.attr('id', this.componentId); // for toggle to work we need id\n\n        // not using constructor name because of webpack mangling class names ...\n        this.widgetName = this.widgetTitle.replace(/[^[a-zA-Z0-9]/g, \"_\");\n\n        if (!options.is(this.widgetName + 'Collapsed')) {\n            this.$bodyWrapper.collapse(\"show\");\n        }\n\n        // using immediate variants of the event so that the previous collapse is not caught\n        this.$bodyWrapper.on('hide.bs.collapse', () => this.saveCollapsed(true));\n        this.$bodyWrapper.on('show.bs.collapse', () => this.saveCollapsed(false));\n\n        this.$body = this.$bodyWrapper.find('.card-body');\n\n        this.$title = this.$widget.find('.widget-title');\n        this.$title.text(this.widgetTitle);\n\n        this.$help = this.$widget.find('.widget-help');\n\n        if (this.help.title) {\n            this.$help.attr(\"title\", this.help.title);\n            this.$help.attr(\"href\", this.help.url || \"javascript:\");\n\n            if (!this.help.url) {\n                this.$help.addClass('no-link');\n            }\n        }\n        else {\n            this.$help.hide();\n        }\n\n        this.$headerActions = this.$widget.find('.widget-header-actions');\n        this.$headerActions.append(...this.headerActions);\n\n        this.initialized = this.doRenderBody();\n\n        this.decorateWidget();\n\n        return this.$widget;\n    }\n\n    saveCollapsed(collapse) {\n        options.save(this.widgetName + 'Collapsed', collapse.toString());\n\n        this.triggerEvent(`widgetCollapsedStateChanged`, {widgetName: this.widgetName, collapse});\n    }\n\n    /**\n     * This event is used to synchronize collapsed state of all the tab-cached widgets since they are all rendered\n     * separately but should behave uniformly for the user.\n     */\n    widgetCollapsedStateChangedEvent({widgetName, collapse}) {\n        if (widgetName === this.widgetName) {\n            this.$bodyWrapper.toggleClass('show', !collapse);\n        }\n    }\n\n    /** for overriding */\n    decorateWidget() {}\n\n    /** for overriding */\n    async doRenderBody() {}\n\n    isExpanded() {\n        return this.$bodyWrapper.hasClass(\"show\");\n    }\n}","import utils from '../services/utils.js';\n\n/**\n * Abstract class for all components in the Trilium's frontend.\n *\n * Contains also event implementation with following properties:\n * - event / command distribution is synchronous which among others mean that events are well ordered - event\n *   which was sent out first will also be processed first by the component\n * - execution of the event / command is asynchronous - each component executes the event on its own without regard for\n *   other components.\n * - although the execution is async, we are collecting all the promises and therefore it is possible to wait until the\n *   event / command is executed in all components - by simply awaiting the `triggerEvent()`.\n */\nexport default class Component {\n    constructor() {\n        this.componentId = `comp-` + utils.randomString(8);\n        /** @type Component[] */\n        this.children = [];\n        this.initialized = Promise.resolve();\n    }\n\n    setParent(parent) {\n        /** @type Component */\n        this.parent = parent;\n        return this;\n    }\n\n    child(...components) {\n        for (const component of components) {\n            component.setParent(this);\n\n            this.children.push(component);\n        }\n\n        return this;\n    }\n\n    /** @return {Promise} */\n    handleEvent(name, data) {\n        return Promise.all([\n            this.initialized.then(() => this.callMethod(this[name + 'Event'], data)),\n            this.handleEventInChildren(name, data)\n        ]);\n    }\n\n    /** @return {Promise} */\n    triggerEvent(name, data) {\n        return this.parent.triggerEvent(name, data);\n    }\n\n    /** @return {Promise} */\n    handleEventInChildren(name, data) {\n        const promises = [];\n\n        for (const child of this.children) {\n            promises.push(child.handleEvent(name, data));\n        }\n\n        return Promise.all(promises);\n    }\n\n    /** @return {Promise} */\n    triggerCommand(name, data = {}) {\n        const fun = this[name + 'Command'];\n\n        if (fun) {\n            return this.callMethod(fun, data);\n        }\n        else {\n            return this.parent.triggerCommand(name, data);\n        }\n    }\n\n    async callMethod(fun, data) {\n        if (typeof fun !== 'function') {\n            return false;\n        }\n\n        await fun.call(this, data);\n\n        return true;\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport appContext from \"../services/app_context.js\";\n\nexport default class TabAwareWidget extends BasicWidget {\n    isTab(tabId) {\n        return this.tabContext && this.tabContext.tabId === tabId;\n    }\n\n    isNote(noteId) {\n        return this.noteId === noteId;\n    }\n\n    get note() {\n        return this.tabContext && this.tabContext.note;\n    }\n\n    get noteId() {\n        return this.note && this.note.noteId;\n    }\n\n    get notePath() {\n        return this.tabContext && this.tabContext.notePath;\n    }\n\n    isEnabled() {\n        return !!this.note;\n    }\n\n    async refresh() {\n        if (this.isEnabled()) {\n            const start = Date.now();\n\n            this.toggleInt(true);\n            await this.refreshWithNote(this.note, this.notePath);\n\n            const end = Date.now();\n\n            if (glob.PROFILING_LOG && end - start > 10) {\n                console.log(`Refresh of ${this.componentId} took ${end-start}ms`);\n            }\n        }\n        else {\n            this.toggleInt(false);\n        }\n    }\n\n    async refreshWithNote(note, notePath) {}\n\n    async tabNoteSwitchedEvent({tabContext, notePath}) {\n        // if notePath does not match then the tabContext has been switched to another note in the mean time\n        if (tabContext.notePath === notePath) {\n            await this.noteSwitched();\n        }\n    }\n\n    async noteSwitched() {\n        await this.refresh();\n    }\n\n    async activeTabChangedEvent({tabContext}) {\n        this.tabContext = tabContext;\n\n        await this.activeTabChanged();\n    }\n\n    async activeTabChanged() {\n        await this.refresh();\n    }\n\n    // when note is both switched and activated, this should not produce double refresh\n    async tabNoteSwitchedAndActivatedEvent({tabContext, notePath}) {\n        this.tabContext = tabContext;\n\n        // if notePath does not match then the tabContext has been switched to another note in the mean time\n        if (this.notePath === notePath) {\n            await this.refresh();\n        }\n    }\n\n    setTabContextEvent({tabContext}) {\n        /** @var {TabContext} */\n        this.tabContext = tabContext;\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n\n    async treeCacheReloadedEvent() {\n        await this.refresh();\n    }\n\n    async lazyLoadedEvent() {\n        if (!this.tabContext) { // has not been loaded yet\n            this.tabContext = appContext.tabManager.getActiveTabContext();\n        }\n\n        await this.refresh();\n    }\n}","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\n\nexport default class TabCachingWidget extends TabAwareWidget {\n    constructor(widgetFactory) {\n        super();\n\n        this.widgetFactory = widgetFactory;\n        this.widgets = {};\n    }\n\n    doRender() {\n        return this.$widget = $(`<div class=\"marker\" style=\"display: none;\">`);\n    }\n\n    async newTabOpenedEvent({tabContext}) {\n        const {tabId} = tabContext;\n\n        if (this.widgets[tabId]) {\n            return;\n        }\n\n        this.widgets[tabId] = this.widgetFactory();\n\n        const $renderedWidget = this.widgets[tabId].render();\n        this.widgets[tabId].toggleExt(false); // new tab is always not active, can be activated after creation\n\n        this.$widget.after($renderedWidget);\n\n        keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n        await this.widgets[tabId].handleEvent('setTabContext', {tabContext});\n\n        this.child(this.widgets[tabId]); // add as child only once it is ready (rendered with tabContext)\n    }\n\n    tabRemovedEvent({tabId}) {\n        const widget = this.widgets[tabId];\n\n        if (widget) {\n            widget.remove();\n            delete this.widgets[tabId];\n\n            this.children = this.children.filter(ch => ch !== widget);\n        }\n    }\n\n    async refresh() {\n        this.toggleExt(true);\n    }\n\n    toggleInt(show) {} // not needed\n\n    toggleExt(show) {\n        for (const tabId in this.widgets) {\n            this.widgets[tabId].toggleExt(show && this.isTab(tabId));\n        }\n    }\n\n    /**\n     * widget.hasBeenAlreadyShown is intended for lazy loading of cached tabs - initial note switches of new tabs\n     * are not executed, we're waiting for the first tab activation and then we update the tab. After this initial\n     * activation further note switches are always propagated to the tabs.\n     */\n    handleEventInChildren(name, data) {\n        if (['tabNoteSwitched', 'tabNoteSwitchedAndActivated'].includes(name)) {\n            // this event is propagated only to the widgets of a particular tab\n            const widget = this.widgets[data.tabContext.tabId];\n\n            if (widget && (widget.hasBeenAlreadyShown || name === 'tabNoteSwitchedAndActivated')) {\n                widget.hasBeenAlreadyShown = true;\n\n                return widget.handleEvent('tabNoteSwitched', data);\n            }\n            else {\n                return Promise.resolve();\n            }\n        }\n\n        if (name === 'activeTabChanged') {\n            const widget = this.widgets[data.tabContext.tabId];\n\n            if (widget.hasBeenAlreadyShown) {\n                return Promise.resolve();\n            }\n            else {\n                widget.hasBeenAlreadyShown = true;\n\n                return widget.handleEvent(name, data);\n            }\n        } else {\n            return super.handleEventInChildren(name, data);\n        }\n    }\n}","/*!\n * Draggabilly PACKAGED v2.2.0\n * Make that shiz draggable\n * https://draggabilly.desandro.com\n * MIT license\n */\n\nimport BasicWidget from \"./basic_widget.js\";\nimport contextMenu from \"../services/context_menu.js\";\nimport utils from \"../services/utils.js\";\nimport keyboardActionService from \"../services/keyboard_actions.js\";\nimport appContext from \"../services/app_context.js\";\n\n!function(i, e){\"function\"==typeof define&&define.amd?define(\"jquery-bridget/jquery-bridget\",[\"jquery\"],function(t){return e(i,t)}):\"object\"==typeof module&&module.exports?module.exports=e(i,utils.dynamicRequire(\"jquery\")):i.jQueryBridget=e(i,i.jQuery)}(window,function(t, i){\"use strict\";var c=Array.prototype.slice,e=t.console,p=void 0===e?function(){}:function(t){e.error(t)};function n(d, o, u){(u=u||i||t.jQuery)&&(o.prototype.option||(o.prototype.option=function(t){u.isPlainObject(t)&&(this.options=u.extend(!0,this.options,t))}),u.fn[d]=function(t){if(\"string\"==typeof t){var i=c.call(arguments,1);return s=i,a=\"$().\"+d+'(\"'+(r=t)+'\")',(e=this).each(function(t, i){var e=u.data(i,d);if(e){var n=e[r];if(n&&\"_\"!=r.charAt(0)){var o=n.apply(e,s);h=void 0===h?o:h}else p(a+\" is not a valid method\")}else p(d+\" not initialized. Cannot call methods, i.e. \"+a)}),void 0!==h?h:e}var e,r,s,h,a,n;return n=t,this.each(function(t, i){var e=u.data(i,d);e?(e.option(n),e._init()):(e=new o(i,n),u.data(i,d,e))}),this},r(u))}function r(t){!t||t&&t.bridget||(t.bridget=n)}return r(i||t.jQuery),n}),function(t, i){\"use strict\";\"function\"==typeof define&&define.amd?define(\"get-size/get-size\",[],function(){return i()}):\"object\"==typeof module&&module.exports?module.exports=i():t.getSize=i()}(window,function(){\"use strict\";function m(t){var i=parseFloat(t);return-1==t.indexOf(\"%\")&&!isNaN(i)&&i}var e=\"undefined\"==typeof console?function(){}:function(t){console.error(t)},y=[\"paddingLeft\",\"paddingRight\",\"paddingTop\",\"paddingBottom\",\"marginLeft\",\"marginRight\",\"marginTop\",\"marginBottom\",\"borderLeftWidth\",\"borderRightWidth\",\"borderTopWidth\",\"borderBottomWidth\"],b=y.length;function E(t){var i=getComputedStyle(t);return i||e(\"Style returned \"+i+\". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1\"),i}var _,x=!1;function P(t){if(function(){if(!x){x=!0;var t=document.createElement(\"div\");t.style.width=\"200px\",t.style.padding=\"1px 2px 3px 4px\",t.style.borderStyle=\"solid\",t.style.borderWidth=\"1px 2px 3px 4px\",t.style.boxSizing=\"border-box\";var i=document.body||document.documentElement;i.appendChild(t);var e=E(t);P.isBoxSizeOuter=_=200==m(e.width),i.removeChild(t)}}(),\"string\"==typeof t&&(t=document.querySelector(t)),t&&\"object\"==typeof t&&t.nodeType){var i=E(t);if(\"none\"==i.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},i=0; i<b; i++)t[y[i]]=0;return t}();var e={};e.width=t.offsetWidth,e.height=t.offsetHeight;for(var n=e.isBorderBox=\"border-box\"==i.boxSizing,o=0; o<b; o++){var r=y[o],s=i[r],h=parseFloat(s);e[r]=isNaN(h)?0:h}var a=e.paddingLeft+e.paddingRight,d=e.paddingTop+e.paddingBottom,u=e.marginLeft+e.marginRight,c=e.marginTop+e.marginBottom,p=e.borderLeftWidth+e.borderRightWidth,f=e.borderTopWidth+e.borderBottomWidth,g=n&&_,l=m(i.width);!1!==l&&(e.width=l+(g?0:a+p));var v=m(i.height);return!1!==v&&(e.height=v+(g?0:d+f)),e.innerWidth=e.width-(a+p),e.innerHeight=e.height-(d+f),e.outerWidth=e.width+u,e.outerHeight=e.height+c,e}}return P}),function(t, i){\"function\"==typeof define&&define.amd?define(\"ev-emitter/ev-emitter\",i):\"object\"==typeof module&&module.exports?module.exports=i():t.EvEmitter=i()}(\"undefined\"!=typeof window?window:this,function(){function t(){}var i=t.prototype;return i.on=function(t, i){if(t&&i){var e=this._events=this._events||{},n=e[t]=e[t]||[];return-1==n.indexOf(i)&&n.push(i),this}},i.once=function(t, i){if(t&&i){this.on(t,i);var e=this._onceEvents=this._onceEvents||{};return(e[t]=e[t]||{})[i]=!0,this}},i.off=function(t, i){var e=this._events&&this._events[t];if(e&&e.length){var n=e.indexOf(i);return-1!=n&&e.splice(n,1),this}},i.emitEvent=function(t, i){var e=this._events&&this._events[t];if(e&&e.length){e=e.slice(0),i=i||[];for(var n=this._onceEvents&&this._onceEvents[t],o=0; o<e.length; o++){var r=e[o];n&&n[r]&&(this.off(t,r),delete n[r]),r.apply(this,i)}return this}},i.allOff=function(){delete this._events,delete this._onceEvents},t}),function(i, e){\"function\"==typeof define&&define.amd?define(\"unipointer/unipointer\",[\"ev-emitter/ev-emitter\"],function(t){return e(i,t)}):\"object\"==typeof module&&module.exports?module.exports=e(i,utils.dynamicRequire(\"ev-emitter\")):i.Unipointer=e(i,i.EvEmitter)}(window,function(o, t){function i(){}var e=i.prototype=Object.create(t.prototype);e.bindStartEvent=function(t){this._bindStartEvent(t,!0)},e.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},e._bindStartEvent=function(t, i){var e=(i=void 0===i||i)?\"addEventListener\":\"removeEventListener\",n=\"mousedown\";o.PointerEvent?n=\"pointerdown\":\"ontouchstart\"in o&&(n=\"touchstart\"),t[e](n,this)},e.handleEvent=function(t){var i=\"on\"+t.type;this[i]&&this[i](t)},e.getTouch=function(t){for(var i=0; i<t.length; i++){var e=t[i];if(e.identifier==this.pointerIdentifier)return e}},e.onmousedown=function(t){var i=t.button;i&&0!==i&&1!==i||this._pointerDown(t,t)},e.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},e.onpointerdown=function(t){this._pointerDown(t,t)},e._pointerDown=function(t, i){t.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==i.pointerId?i.pointerId:i.identifier,this.pointerDown(t,i))},e.pointerDown=function(t, i){this._bindPostStartEvents(t),this.emitEvent(\"pointerDown\",[t,i])};var n={mousedown:[\"mousemove\",\"mouseup\"],touchstart:[\"touchmove\",\"touchend\",\"touchcancel\"],pointerdown:[\"pointermove\",\"pointerup\",\"pointercancel\"]};return e._bindPostStartEvents=function(t){if(t){var i=n[t.type];i.forEach(function(t){o.addEventListener(t,this)},this),this._boundPointerEvents=i}},e._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){o.removeEventListener(t,this)},this),delete this._boundPointerEvents)},e.onmousemove=function(t){this._pointerMove(t,t)},e.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},e.ontouchmove=function(t){var i=this.getTouch(t.changedTouches);i&&this._pointerMove(t,i)},e._pointerMove=function(t, i){this.pointerMove(t,i)},e.pointerMove=function(t, i){this.emitEvent(\"pointerMove\",[t,i])},e.onmouseup=function(t){this._pointerUp(t,t)},e.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},e.ontouchend=function(t){var i=this.getTouch(t.changedTouches);i&&this._pointerUp(t,i)},e._pointerUp=function(t, i){this._pointerDone(),this.pointerUp(t,i)},e.pointerUp=function(t, i){this.emitEvent(\"pointerUp\",[t,i])},e._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},e._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},e.pointerDone=function(){},e.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},e.ontouchcancel=function(t){var i=this.getTouch(t.changedTouches);i&&this._pointerCancel(t,i)},e._pointerCancel=function(t, i){this._pointerDone(),this.pointerCancel(t,i)},e.pointerCancel=function(t, i){this.emitEvent(\"pointerCancel\",[t,i])},i.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},i}),function(i, e){\"function\"==typeof define&&define.amd?define(\"unidragger/unidragger\",[\"unipointer/unipointer\"],function(t){return e(i,t)}):\"object\"==typeof module&&module.exports?module.exports=e(i,utils.dynamicRequire(\"unipointer\")):i.Unidragger=e(i,i.Unipointer)}(window,function(r, t){function i(){}var e=i.prototype=Object.create(t.prototype);e.bindHandles=function(){this._bindHandles(!0)},e.unbindHandles=function(){this._bindHandles(!1)},e._bindHandles=function(t){for(var i=(t=void 0===t||t)?\"addEventListener\":\"removeEventListener\",e=t?this._touchActionValue:\"\",n=0; n<this.handles.length; n++){var o=this.handles[n];this._bindStartEvent(o,t),o[i](\"click\",this),r.PointerEvent&&(o.style.touchAction=e)}},e._touchActionValue=\"none\",e.pointerDown=function(t, i){this.okayPointerDown(t)&&(this.pointerDownPointer=i,t.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(t),this.emitEvent(\"pointerDown\",[t,i]))};var o={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},s={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return e.okayPointerDown=function(t){var i=o[t.target.nodeName],e=s[t.target.type],n=!i||e;return n||this._pointerReset(),n},e.pointerDownBlur=function(){var t=document.activeElement;t&&t.blur&&t!=document.body&&t.blur()},e.pointerMove=function(t, i){var e=this._dragPointerMove(t,i);this.emitEvent(\"pointerMove\",[t,i,e]),this._dragMove(t,i,e)},e._dragPointerMove=function(t, i){var e={x:i.pageX-this.pointerDownPointer.pageX,y:i.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(e)&&this._dragStart(t,i),e},e.hasDragStarted=function(t){return 3<Math.abs(t.x)||3<Math.abs(t.y)},e.pointerUp=function(t, i){this.emitEvent(\"pointerUp\",[t,i]),this._dragPointerUp(t,i)},e._dragPointerUp=function(t, i){this.isDragging?this._dragEnd(t,i):this._staticClick(t,i)},e._dragStart=function(t, i){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(t,i)},e.dragStart=function(t, i){this.emitEvent(\"dragStart\",[t,i])},e._dragMove=function(t, i, e){this.isDragging&&this.dragMove(t,i,e)},e.dragMove=function(t, i, e){t.preventDefault(),this.emitEvent(\"dragMove\",[t,i,e])},e._dragEnd=function(t, i){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(t,i)},e.dragEnd=function(t, i){this.emitEvent(\"dragEnd\",[t,i])},e.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},e._staticClick=function(t, i){this.isIgnoringMouseUp&&\"mouseup\"==t.type||(this.staticClick(t,i),\"mouseup\"!=t.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},e.staticClick=function(t, i){this.emitEvent(\"staticClick\",[t,i])},i.getPointerPoint=t.getPointerPoint,i}),function(e, n){\"function\"==typeof define&&define.amd?define([\"get-size/get-size\",\"unidragger/unidragger\"],function(t, i){return n(e,t,i)}):\"object\"==typeof module&&module.exports?module.exports=n(e,utils.dynamicRequire(\"get-size\"),utils.dynamicRequire(\"unidragger\")):e.Draggabilly=n(e,e.getSize,e.Unidragger)}(window,function(r, a, t){function e(t, i){for(var e in i)t[e]=i[e];return t}var n=r.jQuery;function i(t, i){this.element=\"string\"==typeof t?document.querySelector(t):t,n&&(this.$element=n(this.element)),this.options=e({},this.constructor.defaults),this.option(i),this._create()}var o=i.prototype=Object.create(t.prototype);i.defaults={},o.option=function(t){e(this.options,t)};var s={relative:!0,absolute:!0,fixed:!0};function d(t, i, e){return e=e||\"round\",i?Math[e](t/i)*i:t}return o._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=e({},this.position);var t=getComputedStyle(this.element);s[t.position]||(this.element.style.position=\"relative\"),this.on(\"pointerDown\",this.onPointerDown),this.on(\"pointerMove\",this.onPointerMove),this.on(\"pointerUp\",this.onPointerUp),this.enable(),this.setHandles()},o.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},o.dispatchEvent=function(t, i, e){var n=[i].concat(e);this.emitEvent(t,n),this.dispatchJQueryEvent(t,i,e)},o.dispatchJQueryEvent=function(t, i, e){var n=r.jQuery;if(n&&this.$element){var o=n.Event(i);o.type=t,this.$element.trigger(o,e)}},o._getPosition=function(){var t=getComputedStyle(this.element),i=this._getPositionCoord(t.left,\"width\"),e=this._getPositionCoord(t.top,\"height\");this.position.x=isNaN(i)?0:i,this.position.y=isNaN(e)?0:e,this._addTransformPosition(t)},o._getPositionCoord=function(t, i){if(-1!=t.indexOf(\"%\")){var e=a(this.element.parentNode);return e?parseFloat(t)/100*e[i]:0}return parseInt(t,10)},o._addTransformPosition=function(t){var i=t.transform;if(0===i.indexOf(\"matrix\")){var e=i.split(\",\"),n=0===i.indexOf(\"matrix3d\")?12:4,o=parseInt(e[n],10),r=parseInt(e[n+1],10);this.position.x+=o,this.position.y+=r}},o.onPointerDown=function(t, i){this.element.classList.add(\"is-pointer-down\"),this.dispatchJQueryEvent(\"pointerDown\",t,[i])},o.dragStart=function(t, i){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add(\"is-dragging\"),this.dispatchEvent(\"dragStart\",t,[i]),this.animate())},o.measureContainment=function(){var t=this.getContainer();if(t){var i=a(this.element),e=a(t),n=this.element.getBoundingClientRect(),o=t.getBoundingClientRect(),r=e.borderLeftWidth+e.borderRightWidth,s=e.borderTopWidth+e.borderBottomWidth,h=this.relativeStartPosition={x:n.left-(o.left+e.borderLeftWidth),y:n.top-(o.top+e.borderTopWidth)};this.containSize={width:e.width-r-h.x-i.width,height:e.height-s-h.y-i.height}}},o.getContainer=function(){var t=this.options.containment;if(t)return t instanceof HTMLElement?t:\"string\"==typeof t?document.querySelector(t):this.element.parentNode},o.onPointerMove=function(t, i, e){this.dispatchJQueryEvent(\"pointerMove\",t,[i,e])},o.dragMove=function(t, i, e){if(this.isEnabled){var n=e.x,o=e.y,r=this.options.grid,s=r&&r[0],h=r&&r[1];n=d(n,s),o=d(o,h),n=this.containDrag(\"x\",n,s),o=this.containDrag(\"y\",o,h),n=\"y\"==this.options.axis?0:n,o=\"x\"==this.options.axis?0:o,this.position.x=this.startPosition.x+n,this.position.y=this.startPosition.y+o,this.dragPoint.x=n,this.dragPoint.y=o,this.dispatchEvent(\"dragMove\",t,[i,e])}},o.containDrag=function(t, i, e){if(!this.options.containment)return i;var n=\"x\"==t?\"width\":\"height\",o=d(-this.relativeStartPosition[t],e,\"ceil\"),r=this.containSize[n];return r=d(r,e,\"floor\"),Math.max(o,Math.min(r,i))},o.onPointerUp=function(t, i){this.element.classList.remove(\"is-pointer-down\"),this.dispatchJQueryEvent(\"pointerUp\",t,[i])},o.dragEnd=function(t, i){this.isEnabled&&(this.element.style.transform=\"\",this.setLeftTop(),this.element.classList.remove(\"is-dragging\"),this.dispatchEvent(\"dragEnd\",t,[i]))},o.animate=function(){if(this.isDragging){this.positionDrag();var t=this;requestAnimationFrame(function(){t.animate()})}},o.setLeftTop=function(){this.element.style.left=this.position.x+\"px\",this.element.style.top=this.position.y+\"px\"},o.positionDrag=function(){this.element.style.transform=\"translate3d( \"+this.dragPoint.x+\"px, \"+this.dragPoint.y+\"px, 0)\"},o.staticClick=function(t, i){this.dispatchEvent(\"staticClick\",t,[i])},o.setPosition=function(t, i){this.position.x=t,this.position.y=i,this.setLeftTop()},o.enable=function(){this.isEnabled=!0},o.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},o.destroy=function(){this.disable(),this.element.style.transform=\"\",this.element.style.left=\"\",this.element.style.top=\"\",this.element.style.position=\"\",this.unbindHandles(),this.$element&&this.$element.removeData(\"draggabilly\")},o._init=function(){},n&&n.bridget&&n.bridget(\"draggabilly\",i),i});\n\nconst Draggabilly = window.Draggabilly;\n\nconst TAB_CONTAINER_MIN_WIDTH = 24;\nconst TAB_CONTAINER_MAX_WIDTH = 240;\nconst NEW_TAB_WIDTH = 32;\nconst MIN_FILLER_WIDTH = 50;\n\nconst TAB_SIZE_SMALL = 84;\nconst TAB_SIZE_SMALLER = 60;\nconst TAB_SIZE_MINI = 48;\n\nconst TAB_TPL = `\n<div class=\"note-tab\">\n  <div class=\"note-tab-wrapper\">\n    <div class=\"note-tab-title\"></div>\n    <div class=\"note-tab-drag-handle\"></div>\n    <div class=\"note-tab-close\" title=\"Close tab\" data-trigger-command=\"closeActiveTab\"><span>×</span></div>\n  </div>\n</div>`;\n\nconst NEW_TAB_BUTTON_TPL = `<div class=\"note-new-tab\" data-trigger-command=\"openNewTab\" title=\"Add new tab\">+</div>`;\nconst FILLER_TPL = `<div class=\"tab-row-filler\">\n    <div class=\"tab-row-border\"></div>\n</div>`;\n\nconst TAB_ROW_TPL = `\n<div class=\"note-tab-row\">\n    <style>\n    .note-tab-row {\n        box-sizing: border-box;\n        position: relative;\n        height: 34px;\n        min-height: 34px;\n        width: 100%;\n        background: var(--main-background-color);\n        border-radius: 5px 5px 0 0;\n        overflow: hidden;\n        margin-top: 2px;\n    }\n    .note-tab-row * {\n        box-sizing: inherit;\n        font: inherit;\n    }\n    .note-tab-row .note-tab-row-container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    .note-tab-row .note-tab {\n        position: absolute;\n        left: 0;\n        height: 33px;\n        width: 240px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        pointer-events: none;\n    }\n    \n    .note-new-tab {\n        position: absolute;\n        left: 0;\n        height: 33px;\n        width: 32px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        text-align: center;\n        font-size: 24px;\n        cursor: pointer;\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .note-new-tab:hover {\n        background-color: var(--accented-background-color);\n        border-radius: 5px;\n    }\n    \n    .tab-row-filler {\n        -webkit-app-region: drag;\n        position: absolute;\n        left: 0;\n        height: 33px;\n    }\n    \n    .tab-row-filler .tab-row-border {\n        position: relative;\n        background: linear-gradient(to right, var(--main-border-color), transparent);\n        height: 1px;\n        margin-top: 32px;\n    }\n    \n    .note-tab-row .note-tab[active] {\n        z-index: 5;\n    }\n    \n    .note-tab-row .note-tab,\n    .note-tab-row .note-tab * {\n        user-select: none;\n        cursor: default;\n    }\n    \n    .note-tab-row .note-tab.note-tab-was-just-added {\n        top: 10px;\n        animation: note-tab-was-just-added 120ms forwards ease-in-out;\n    }\n    \n    .note-tab-row .note-tab .note-tab-wrapper {\n        position: absolute;\n        display: flex;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        padding: 5px 8px;\n        border-top-left-radius: 8px;\n        border-top-right-radius: 8px;\n        overflow: hidden;\n        pointer-events: all;\n        background-color: var(--accented-background-color);\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .note-tab-row .note-tab[active] .note-tab-wrapper {\n        background-color: var(--main-background-color);\n        border: 1px solid var(--main-border-color);\n        border-bottom: 0;\n        font-weight: bold;\n    }\n    \n    .note-tab-row .note-tab[is-mini] .note-tab-wrapper {\n        padding-left: 2px;\n        padding-right: 2px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-title {\n        flex: 1;\n        vertical-align: top;\n        overflow: hidden;\n        white-space: nowrap;\n        color: var(--muted-text-color);\n    }\n    \n    .note-tab-row .note-tab[is-small] .note-tab-title {\n        margin-left: 0;\n    }\n    \n    .note-tab-row .note-tab[active] .note-tab-title {\n        color: var(--main-text-color);\n    }\n    \n    .note-tab-row .note-tab .note-tab-drag-handle {\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        border-top-left-radius: 8px;\n        border-top-right-radius: 8px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close {\n        flex-grow: 0;\n        flex-shrink: 0;\n        border-radius: 50%;\n        z-index: 100;\n        width: 24px;\n        height: 24px;\n        text-align: center;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close span {\n        font-size: 24px;\n        position: relative;\n        top: -6px;\n    }\n    \n    .note-tab-row .note-tab .note-tab-close:hover {\n        background-color: var(--hover-item-background-color);\n        color: var(--hover-item-text-color);\n    }\n    \n    .note-tab-row .note-tab[is-smaller] .note-tab-close {\n        margin-left: auto;\n    }\n    .note-tab-row .note-tab[is-mini]:not([active]) .note-tab-close {\n        display: none;\n    }\n    .note-tab-row .note-tab[is-mini][active] .note-tab-close {\n        margin-left: auto;\n        margin-right: auto;\n    }\n    @-moz-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-webkit-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-o-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    .note-tab-row.note-tab-row-is-sorting .note-tab:not(.note-tab-is-dragging),\n    .note-tab-row:not(.note-tab-row-is-sorting) .note-tab.note-tab-was-just-dragged {\n        transition: transform 120ms ease-in-out;\n    }\n    </style>\n\n    <div class=\"note-tab-row-container\"></div>\n</div>`;\n\nexport default class TabRowWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TAB_ROW_TPL);\n\n        this.draggabillies = [];\n        this.eventListeners = {};\n\n        this.setupStyle();\n        this.setupEvents();\n        this.setupDraggabilly();\n        this.setupNewButton();\n        this.setupFiller();\n        this.layoutTabs();\n        this.setVisibility();\n\n        this.$widget.on('contextmenu', '.note-tab', e => {\n            e.preventDefault();\n\n            const tabId = $(e.target).closest(\".note-tab\").attr('data-tab-id');\n\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"Move this tab to a new window\", command: \"moveTabToNewWindow\", uiIcon: \"window-open\"},\n                    {title: \"Close all tabs\", command: \"removeAllTabs\", uiIcon: \"x\"},\n                    {title: \"Close all tabs except for this\", command: \"removeAllTabsExceptForThis\", uiIcon: \"x\"},\n                ],\n                selectMenuItemHandler: ({command}) => {\n                    this.triggerCommand(command, {tabId});\n                }\n            });\n        });\n\n        return this.$widget;\n    }\n\n    setupStyle() {\n        this.$style = $(\"<style>\");\n        this.$widget.append(this.$style);\n    }\n\n    setupEvents() {\n        const resizeListener = _ => {\n            this.cleanUpPreviouslyDraggedTabs();\n            this.layoutTabs();\n        };\n\n        // ResizeObserver exists only in FF69\n        if (typeof ResizeObserver !== \"undefined\") {\n            new ResizeObserver(resizeListener).observe(this.$widget[0]);\n        }\n        else {\n            // for older firefox\n            window.addEventListener('resize', resizeListener);\n        }\n\n        this.tabEls.forEach((tabEl) => this.setTabCloseEvent(tabEl));\n    }\n\n    setVisibility() {\n        this.$widget.show();\n    }\n\n    get tabEls() {\n        return Array.prototype.slice.call(this.$widget.find('.note-tab'));\n    }\n\n    get $tabContainer() {\n        return this.$widget.find('.note-tab-row-container');\n    }\n\n    get tabWidths() {\n        const numberOfTabs = this.tabEls.length;\n        const tabsContainerWidth = this.$tabContainer[0].clientWidth - NEW_TAB_WIDTH - MIN_FILLER_WIDTH;\n        const targetWidth = tabsContainerWidth / numberOfTabs;\n        const clampedTargetWidth = Math.max(TAB_CONTAINER_MIN_WIDTH, Math.min(TAB_CONTAINER_MAX_WIDTH, targetWidth));\n        const flooredClampedTargetWidth = Math.floor(clampedTargetWidth);\n        const totalTabsWidthUsingTarget = flooredClampedTargetWidth * numberOfTabs;\n        const totalExtraWidthDueToFlooring = tabsContainerWidth - totalTabsWidthUsingTarget;\n\n        const widths = [];\n        let extraWidthRemaining = totalExtraWidthDueToFlooring;\n\n        for (let i = 0; i < numberOfTabs; i += 1) {\n            const extraWidth = flooredClampedTargetWidth < TAB_CONTAINER_MAX_WIDTH && extraWidthRemaining > 0 ? 1 : 0;\n            widths.push(flooredClampedTargetWidth + extraWidth);\n            if (extraWidthRemaining > 0) extraWidthRemaining -= 1;\n        }\n\n        if (this.$filler) {\n            this.$filler.css(\"width\", (extraWidthRemaining + MIN_FILLER_WIDTH) + \"px\");\n        }\n\n        return widths;\n    }\n\n    getTabPositions() {\n        const tabPositions = [];\n\n        let position = 0;\n        this.tabWidths.forEach(width => {\n            tabPositions.push(position);\n            position += width;\n        });\n\n        const newTabPosition = position;\n        const fillerPosition = position + 32;\n\n        return {tabPositions, newTabPosition, fillerPosition};\n    }\n\n    layoutTabs() {\n        const tabContainerWidths = this.tabWidths;\n\n        this.tabEls.forEach((tabEl, i) => {\n            const width = tabContainerWidths[i];\n\n            tabEl.style.width = width + 'px';\n            tabEl.removeAttribute('is-small');\n            tabEl.removeAttribute('is-smaller');\n            tabEl.removeAttribute('is-mini');\n\n            if (width < TAB_SIZE_SMALL) tabEl.setAttribute('is-small', '');\n            if (width < TAB_SIZE_SMALLER) tabEl.setAttribute('is-smaller', '');\n            if (width < TAB_SIZE_MINI) tabEl.setAttribute('is-mini', '');\n        });\n\n        let styleHTML = '';\n\n        const {tabPositions, newTabPosition, fillerPosition} = this.getTabPositions();\n\n        tabPositions.forEach((position, i) => {\n            styleHTML += `.note-tab:nth-child(${ i + 1 }) { transform: translate3d(${ position }px, 0, 0)} `;\n        });\n\n        styleHTML += `.note-new-tab { transform: translate3d(${ newTabPosition }px, 0, 0) } `;\n        styleHTML += `.tab-row-filler { transform: translate3d(${ fillerPosition }px, 0, 0) } `;\n\n        this.$style.html(styleHTML);\n    }\n\n    addTab(tabId) {\n        const $tab = $(TAB_TPL).attr('data-tab-id', tabId);\n\n        keyboardActionService.updateDisplayedShortcuts($tab);\n\n        $tab.addClass('note-tab-was-just-added');\n\n        setTimeout(() => $tab.removeClass('note-tab-was-just-added'), 500);\n\n        this.$newTab.before($tab);\n        this.setVisibility();\n        this.setTabCloseEvent($tab);\n        this.updateTitle($tab, 'New tab');\n        this.cleanUpPreviouslyDraggedTabs();\n        this.layoutTabs();\n        this.setupDraggabilly();\n    }\n\n    closeActiveTabCommand({$el}) {\n        const tabId = $el.closest(\".note-tab\").attr('data-tab-id');\n\n        appContext.tabManager.removeTab(tabId);\n    }\n\n    setTabCloseEvent($tab) {\n        $tab.on('mousedown', e => {\n            if (e.which === 2) {\n                appContext.tabManager.removeTab($tab.attr('data-tab-id'));\n\n                return true; // event has been handled\n            }\n        });\n    }\n\n    get activeTabEl() {\n        return this.$widget.find('.note-tab[active]')[0];\n    }\n\n    activeTabChangedEvent() {\n        const activeTabContext = appContext.tabManager.getActiveTabContext();\n\n        if (!activeTabContext) {\n            return;\n        }\n\n        const tabEl = this.getTabById(activeTabContext.tabId)[0];\n        const activeTabEl = this.activeTabEl;\n        if (activeTabEl === tabEl) return;\n        if (activeTabEl) activeTabEl.removeAttribute('active');\n        if (tabEl) tabEl.setAttribute('active', '');\n    }\n\n    newTabOpenedEvent({tabContext}) {\n        this.addTab(tabContext.tabId);\n    }\n\n    removeTab(tabId) {\n        const tabEl = this.getTabById(tabId)[0];\n\n        if (tabEl) {\n            tabEl.parentNode.removeChild(tabEl);\n            this.cleanUpPreviouslyDraggedTabs();\n            this.layoutTabs();\n            this.setupDraggabilly();\n            this.setVisibility();\n        }\n    }\n\n    getTabIdsInOrder() {\n        return this.tabEls.map(el => el.getAttribute('data-tab-id'));\n    }\n\n    updateTitle($tab, title) {\n        $tab.find('.note-tab-title').text(title);\n    }\n\n    getTabById(tabId) {\n        return this.$widget.find(`[data-tab-id='${tabId}']`);\n    }\n\n    tabRemovedEvent({tabId}) {\n        this.removeTab(tabId);\n    }\n\n    cleanUpPreviouslyDraggedTabs() {\n        this.tabEls.forEach((tabEl) => tabEl.classList.remove('note-tab-was-just-dragged'));\n    }\n\n    setupDraggabilly() {\n        const tabEls = this.tabEls;\n        const {tabPositions} = this.getTabPositions();\n\n        if (this.isDragging) {\n            this.isDragging = false;\n            this.$widget.removeClass('note-tab-row-is-sorting');\n            this.draggabillyDragging.element.classList.remove('note-tab-is-dragging');\n            this.draggabillyDragging.element.style.transform = '';\n            this.draggabillyDragging.dragEnd();\n            this.draggabillyDragging.isDragging = false;\n            this.draggabillyDragging.positionDrag = _ => {}; // Prevent Draggabilly from updating tabEl.style.transform in later frames\n            this.draggabillyDragging.destroy();\n            this.draggabillyDragging = null;\n        }\n\n        this.draggabillies.forEach(d => d.destroy());\n\n        tabEls.forEach((tabEl, originalIndex) => {\n            const originalTabPositionX = tabPositions[originalIndex];\n            const draggabilly = new Draggabilly(tabEl, {\n                axis: 'x',\n                handle: '.note-tab-drag-handle',\n                containment: this.$tabContainer[0]\n            });\n\n            this.draggabillies.push(draggabilly);\n\n            draggabilly.on('pointerDown', _ => {\n                appContext.tabManager.activateTab(tabEl.getAttribute('data-tab-id'));\n            });\n\n            draggabilly.on('dragStart', _ => {\n                this.isDragging = true;\n                this.draggabillyDragging = draggabilly;\n                tabEl.classList.add('note-tab-is-dragging');\n                this.$widget.addClass('note-tab-row-is-sorting');\n            });\n\n            draggabilly.on('dragEnd', _ => {\n                this.isDragging = false;\n                const finalTranslateX = parseFloat(tabEl.style.left, 10);\n                tabEl.style.transform = `translate3d(0, 0, 0)`;\n\n                // Animate dragged tab back into its place\n                requestAnimationFrame(_ => {\n                    tabEl.style.left = '0';\n                    tabEl.style.transform = `translate3d(${ finalTranslateX }px, 0, 0)`;\n\n                    requestAnimationFrame(_ => {\n                        tabEl.classList.remove('note-tab-is-dragging');\n                        this.$widget.removeClass('note-tab-row-is-sorting');\n\n                        tabEl.classList.add('note-tab-was-just-dragged');\n\n                        requestAnimationFrame(_ => {\n                            tabEl.style.transform = '';\n\n                            this.layoutTabs();\n                            this.setupDraggabilly();\n                        })\n                    })\n                })\n            });\n\n            draggabilly.on('dragMove', (event, pointer, moveVector) => {\n                // Current index be computed within the event since it can change during the dragMove\n                const tabEls = this.tabEls;\n                const currentIndex = tabEls.indexOf(tabEl);\n\n                const currentTabPositionX = originalTabPositionX + moveVector.x;\n                const destinationIndexTarget = this.closest(currentTabPositionX, tabPositions);\n                const destinationIndex = Math.max(0, Math.min(tabEls.length, destinationIndexTarget));\n\n                if (currentIndex !== destinationIndex) {\n                    this.animateTabMove(tabEl, currentIndex, destinationIndex);\n                }\n            });\n        });\n    }\n\n    animateTabMove(tabEl, originIndex, destinationIndex) {\n        if (destinationIndex < originIndex) {\n            tabEl.parentNode.insertBefore(tabEl, this.tabEls[destinationIndex]);\n        } else {\n            const beforeEl = this.tabEls[destinationIndex + 1] || this.$newTab[0];\n\n            tabEl.parentNode.insertBefore(tabEl, beforeEl);\n        }\n        this.triggerEvent('tabReorder', {tabIdsInOrder: this.getTabIdsInOrder()});\n        this.layoutTabs();\n    }\n\n    setupNewButton() {\n        this.$newTab = $(NEW_TAB_BUTTON_TPL);\n\n        this.$tabContainer.append(this.$newTab);\n    }\n\n    setupFiller() {\n        this.$filler = $(FILLER_TPL);\n\n        this.$tabContainer.append(this.$filler);\n    }\n\n    closest(value, array) {\n        let closest = Infinity;\n        let closestIndex = -1;\n\n        array.forEach((v, i) => {\n            if (Math.abs(value - v) < closest) {\n                closest = Math.abs(value - v);\n                closestIndex = i;\n            }\n        });\n\n        return closestIndex;\n    };\n\n    tabNoteSwitchedAndActivatedEvent({tabContext}) {\n        this.activeTabChangedEvent();\n\n        this.updateTabById(tabContext.tabId);\n    }\n\n    tabNoteSwitchedEvent({tabContext}) {\n        this.updateTabById(tabContext.tabId);\n    }\n\n    updateTabById(tabId) {\n        const $tab = this.getTabById(tabId);\n\n        const {note} = appContext.tabManager.getTabContextById(tabId);\n\n        this.updateTab($tab, note);\n    }\n\n    updateTab($tab, note) {\n        if (!$tab.length) {\n            return;\n        }\n\n        for (const clazz of Array.from($tab[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz !== 'note-tab') {\n                $tab.removeClass(clazz);\n            }\n        }\n\n        if (!note) {\n            this.updateTitle($tab, 'New tab');\n            return;\n        }\n\n        this.updateTitle($tab, note.title);\n\n        $tab.addClass(note.getCssClass());\n        $tab.addClass(utils.getNoteTypeClass(note.type));\n        $tab.addClass(utils.getMimeTypeClass(note.mime));\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        for (const tabContext of appContext.tabManager.tabContexts) {\n            if (loadResults.isNoteReloaded(tabContext.noteId)) {\n                const $tab = this.getTabById(tabContext.tabId);\n\n                this.updateTab($tab, tabContext.note);\n            }\n        }\n    }\n\n    treeCacheReloadedEvent() {\n        for (const tabContext of appContext.tabManager.tabContexts) {\n            const $tab = this.getTabById(tabContext.tabId);\n\n            this.updateTab($tab, tabContext.note);\n        }\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.amdO = {};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".desktop.js\";\n};","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"app-dist/\";","// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8: 0\n};\n\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n\t\t\t\t\t});\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\tvar loadingEnded = () => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) return installedChunkData[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tvar script = document.createElement('script');\n\t\t\t\t\tvar onScriptComplete;\n\n\t\t\t\t\tscript.charset = 'utf-8';\n\t\t\t\t\tscript.timeout = 120;\n\t\t\t\t\tif (__webpack_require__.nc) {\n\t\t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t\t\t\t}\n\t\t\t\t\tscript.src = url;\n\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tonScriptComplete = (event) => {\n\t\t\t\t\t\tonScriptComplete = () => {\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// avoid mem leaks in IE.\n\t\t\t\t\t\tscript.onerror = script.onload = null;\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\tvar reportError = loadingEnded();\n\t\t\t\t\t\tif(reportError) {\n\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\treportError(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t;\n\t\t\t\t\tvar timeout = setTimeout(() => {\n\t\t\t\t\t\tonScriptComplete({ type: 'timeout', target: script })\n\t\t\t\t\t}, 120000);\n\t\t\t\t\tscript.onerror = script.onload = onScriptComplete;\n\t\t\t\t\tdocument.head.appendChild(script);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no deferred startup\n\n// install a JSONP callback for chunk loading\nfunction webpackJsonpCallback(data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\n\tvar runtime = data[3];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentJsonpFunction) parentJsonpFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n};\n\nvar jsonpArray = window[\"webpackJsonptrilium\"] = window[\"webpackJsonptrilium\"] || [];\nvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\njsonpArray.push = webpackJsonpCallback;\nvar parentJsonpFunction = oldJsonpFunction;","/**\n * Mac specific initialization\n */\nimport utils from \"./utils.js\";\n\nfunction init() {\n    if (utils.isElectron() && utils.isMac()) {\n        utils.bindGlobalShortcut('meta+c', () => exec(\"copy\"));\n        utils.bindGlobalShortcut('meta+v', () => exec('paste'));\n        utils.bindGlobalShortcut('meta+x', () => exec('cut'));\n        utils.bindGlobalShortcut('meta+a', () => exec('selectAll'));\n        utils.bindGlobalShortcut('meta+z', () => exec('undo'));\n        utils.bindGlobalShortcut('meta+y', () => exec('redo'));\n    }\n}\n\nfunction exec(cmd) {\n    document.execCommand(cmd);\n\n    return false;\n}\n\nexport default {\n    init\n}","import BasicWidget from \"./basic_widget.js\";\n\nexport default class FlexContainer extends BasicWidget {\n    constructor(direction) {\n        super();\n\n        if (!direction || !['row', 'column'].includes(direction)) {\n            throw new Error(`Direction argument given as \"${direction}\", use either 'row' or 'column'`);\n        }\n\n        this.attrs.style = `display: flex; flex-direction: ${direction};`;\n\n        this.children = [];\n\n        this.positionCounter = 10;\n    }\n\n    child(...components) {\n        if (!components) {\n            return this;\n        }\n\n        super.child(...components);\n\n        for (const component of components) {\n            if (!component.position) {\n                component.position = this.positionCounter;\n                this.positionCounter += 10;\n            }\n        }\n\n        this.children.sort((a, b) => a.position - b.position < 0 ? -1 : 1);\n\n        return this;\n    }\n\n    doRender() {\n        this.$widget = $(`<div>`);\n\n        for (const widget of this.children) {\n            this.$widget.append(widget.render());\n        }\n\n        return this.$widget;\n    }\n}","import server from './server.js';\nimport toastService from \"./toast.js\";\n\nasync function syncNow() {\n    const result = await server.post('sync/now');\n\n    if (result.success) {\n        toastService.showMessage(\"Sync finished successfully.\");\n    }\n    else {\n        if (result.message.length > 100) {\n            result.message = result.message.substr(0, 100);\n        }\n\n        toastService.showError(\"Sync failed: \" + result.message);\n    }\n}\n\nasync function forceNoteSync(noteId) {\n    await server.post('sync/force-note-sync/' + noteId);\n\n    toastService.showMessage(\"Note added to sync queue.\");\n}\n\nexport default {\n    syncNow,\n    forceNoteSync\n};\n","import BasicWidget from \"./basic_widget.js\";\nimport utils from \"../services/utils.js\";\nimport syncService from \"../services/sync.js\";\n\nconst TPL = `\n<div class=\"global-menu-wrapper\">\n    <style>\n    .global-menu-wrapper {\n        height: 35px;\n        border-bottom: 1px solid var(--main-border-color);\n    }\n    \n    .global-menu button {\n        margin-right: 10px;\n        height: 33px;\n        border: none;\n    }\n    \n    .global-menu .dropdown-menu {\n        width: 20em;\n    }\n    </style>\n\n    <div class=\"dropdown global-menu\">\n        <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"btn btn-sm dropdown-toggle\">\n            <span class=\"bx bx-menu\"></span>\n            Menu\n            <span class=\"caret\"></span>\n        </button>\n        <div class=\"dropdown-menu dropdown-menu-right\">\n            <a class=\"dropdown-item options-button\" data-trigger-command=\"showOptions\">\n                <span class=\"bx bx-slider\"></span>\n                Options\n            </a>\n\n            <a class=\"dropdown-item sync-now-button\" title=\"Trigger sync\">\n                <span class=\"bx bx-refresh\"></span>\n                Sync now (<span id=\"outstanding-syncs-count\">0</span>)\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"openNewWindow\">\n                <span class=\"bx bx-window-open\"></span>\n                Open new window\n                <kbd data-command=\"openNewWindow\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item open-dev-tools-button\" data-trigger-command=\"openDevTools\">\n                <span class=\"bx bx-terminal\"></span>\n                Open Dev Tools\n                <kbd data-command=\"openDevTools\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"showSQLConsole\">\n                <span class=\"bx bx-data\"></span>\n                Open SQL Console\n                <kbd data-command=\"showSQLConsole\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"showBackendLog\">\n                <span class=\"bx bx-empty\"></span>\n                Show backend log\n                <kbd data-command=\"showBackendLog\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"reloadFrontendApp\" \n                title=\"Reload can help with some visual glitches without restarting the whole app.\">\n                <span class=\"bx bx-empty\"></span>\n                Reload frontend\n                <kbd data-command=\"reloadFrontendApp\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"toggleZenMode\">\n                <span class=\"bx bx-empty\"></span>\n                Toggle Zen mode\n                <kbd data-command=\"toggleZenMode\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"toggleFullscreen\">\n                <span class=\"bx bx-empty\"></span>\n                Toggle fullscreen\n                <kbd data-command=\"toggleFullscreen\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item\" data-trigger-command=\"showHelp\">\n                <span class=\"bx bx-info-circle\"></span>\n                Show Help\n                <kbd data-command=\"showHelp\"></kbd>\n            </a>\n\n            <a class=\"dropdown-item show-about-dialog-button\">\n                <span class=\"bx bx-empty\"></span>\n                About Trilium Notes\n            </a>\n\n            <a class=\"dropdown-item logout-button\" data-trigger-command=\"logout\">\n                <span class=\"bx bx-log-out\"></span>\n                Logout\n            </a>\n        </div>\n    </div>\n</div>\n`;\n\nexport default class GlobalMenuWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".show-about-dialog-button\").on('click',\n            () => import(\"../dialogs/about.js\").then(d => d.showDialog()));\n\n        this.$widget.find(\".sync-now-button\").on('click', () => syncService.syncNow());\n\n        this.$widget.find(\".logout-button\").toggle(!utils.isElectron());\n\n        this.$widget.find(\".open-dev-tools-button\").toggle(utils.isElectron());\n\n        return this.$widget;\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport options from \"../services/options.js\";\nimport utils from \"../services/utils.js\";\n\nconst TPL = `\n<div class=\"title-bar-buttons\">\n    <style>\n    .title-bar-buttons {\n        margin-top: 4px;\n        flex-shrink: 0;\n    }\n    \n    .title-bar-buttons button {\n        border: none !important;\n        background: none !important;\n        font-size: 150%;\n        padding-left: 10px;\n        padding-right: 10px;\n    }\n    </style>\n\n    <button class=\"btn icon-action bx bx-minus minimize-btn\"></button>\n    <button class=\"btn icon-action bx bx-checkbox maximize-btn\"></button>\n    <button class=\"btn icon-action bx bx-x close-btn\"></button>\n</div>`;\n\nexport default class TitleBarButtonsWidget extends BasicWidget {\n    doRender() {\n        if (!utils.isElectron() || options.is('nativeTitleBarVisible')) {\n            return this.$widget = $('<div>');\n        }\n\n        this.$widget = $(TPL);\n\n        const $minimizeBtn = this.$widget.find(\".minimize-btn\");\n        const $maximizeBtn = this.$widget.find(\".maximize-btn\");\n        const $closeBtn = this.$widget.find(\".close-btn\");\n\n        $minimizeBtn.on('click', () => {\n            $minimizeBtn.trigger('blur');\n            const {remote} = utils.dynamicRequire('electron');\n            remote.BrowserWindow.getFocusedWindow().minimize();\n        });\n\n        $maximizeBtn.on('click', () => {\n            $maximizeBtn.trigger('blur');\n            const {remote} = utils.dynamicRequire('electron');\n            const focusedWindow = remote.BrowserWindow.getFocusedWindow();\n\n            if (focusedWindow.isMaximized()) {\n                focusedWindow.unmaximize();\n            } else {\n                focusedWindow.maximize();\n            }\n        });\n\n        $closeBtn.on('click', () => {\n            $closeBtn.trigger('blur');\n            const {remote} = utils.dynamicRequire('electron');\n            remote.BrowserWindow.getFocusedWindow().close();\n        });\n\n        return this.$widget;\n    }\n}","import BasicWidget from \"./basic_widget.js\";\nimport utils from \"../services/utils.js\";\nimport keyboardActionService from \"../services/keyboard_actions.js\";\nimport contextMenu from \"../services/context_menu.js\";\nimport treeService from \"../services/tree.js\";\nimport appContext from \"../services/app_context.js\";\n\nconst TPL = `\n<div class=\"history-navigation\">\n    <style>\n    .history-navigation {\n        margin: 0 15px 0 5px;\n    }\n    </style>\n\n    <a title=\"Go to previous note.\" data-trigger-command=\"backInNoteHistory\" class=\"icon-action bx bx-left-arrow-circle\"></a>\n\n    <a title=\"Go to next note.\" data-trigger-command=\"forwardInNoteHistory\" class=\"icon-action bx bx-right-arrow-circle\"></a>\n</div>\n`;\n\nexport default class HistoryNavigationWidget extends BasicWidget {\n    doRender() {\n        if (utils.isElectron()) {\n            this.$widget = $(TPL);\n\n            const contextMenuHandler = e => {\n                e.preventDefault();\n\n                if (this.webContents.history.length < 2) {\n                    return;\n                }\n\n                this.showContextMenu(e);\n            };\n\n            this.$backInHistory = this.$widget.find(\"[data-trigger-command='backInNoteHistory']\");\n            this.$backInHistory.on('contextmenu', contextMenuHandler);\n\n            this.$forwardInHistory = this.$widget.find(\"[data-trigger-command='forwardInNoteHistory']\");\n            this.$forwardInHistory.on('contextmenu', contextMenuHandler);\n\n            const electron = utils.dynamicRequire('electron');\n            this.webContents = electron.remote.getCurrentWindow().webContents;\n\n            // without this the history is preserved across frontend reloads\n            this.webContents.clearHistory();\n\n            this.refresh();\n        }\n        else {\n            this.$widget = $(\"<div>\");\n        }\n\n        return this.$widget;\n    }\n\n    async showContextMenu(e) {\n        let items = [];\n\n        const activeIndex = this.webContents.getActiveIndex();\n\n        for (const idx in this.webContents.history) {\n            const url = this.webContents.history[idx];\n            const [_, notePathWithTab] = url.split('#');\n            const [notePath, tabId] = notePathWithTab.split('-');\n\n            const title = await treeService.getNotePathTitle(notePath);\n\n            items.push({\n                title,\n                idx,\n                uiIcon: idx == activeIndex ? \"radio-circle-marked\" : // compare with type coercion!\n                    (idx < activeIndex ? \"left-arrow-alt\" : \"right-arrow-alt\")\n            });\n        }\n\n        items.reverse();\n\n        if (items.length > 20) {\n            items = items.slice(0, 50);\n        }\n\n        contextMenu.show({\n            x: e.pageX,\n            y: e.pageY,\n            items,\n            selectMenuItemHandler: ({idx}) => this.webContents.goToIndex(idx)\n        });\n    }\n\n    refresh() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        this.$backInHistory.toggleClass('disabled', !this.webContents.canGoBack());\n        this.$forwardInHistory.toggleClass('disabled', !this.webContents.canGoForward());\n    }\n\n    activeNoteChangedEvent() {\n        this.refresh();\n    }\n}","import BasicWidget from \"./basic_widget.js\";\nimport HistoryNavigationWidget from \"./history_navigation.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\n\nconst TPL = `\n<div class=\"standard-top-widget\">\n    <style>\n    .standard-top-widget {\n        background-color: var(--header-background-color);\n        display: flex;\n        align-items: center;\n        padding-top: 4px;\n    }\n    \n    .standard-top-widget button {\n        padding: 1px 5px 1px 5px;\n        font-size: smaller;\n        margin-bottom: 2px;\n        margin-top: 2px;\n        margin-right: 8px;\n        border-color: transparent !important;\n    }\n    \n    .standard-top-widget button.btn-sm .bx {\n        position: relative;\n        top: 1px;\n    }\n    \n    .standard-top-widget button:hover {\n        border-color: var(--button-border-color) !important;\n    }\n    </style>\n\n    <div style=\"flex-grow: 100; display: flex;\">\n        <button class=\"btn btn-sm jump-to-note-dialog-button\" data-command=\"jumpToNote\">\n            <span class=\"bx bx-crosshair\"></span>\n            Jump to note\n        </button>\n    \n        <button class=\"btn btn-sm recent-changes-button\" data-command=\"showRecentChanges\">\n            <span class=\"bx bx-history\"></span>\n    \n            Recent changes\n        </button>\n    \n        <button class=\"btn btn-sm enter-protected-session-button\"\n                title=\"Enter protected session to be able to find and view protected notes\">\n            <span class=\"bx bx-log-in\"></span>\n    \n            Enter protected session\n        </button>\n    \n        <button class=\"btn btn-sm leave-protected-session-button\"\n                title=\"Leave protected session so that protected notes are not accessible any more.\"\n                style=\"display: none;\">\n            <span class=\"bx bx-log-out\"></span>\n    \n            Leave protected session\n        </button>\n    </div>\n    \n    <div id=\"plugin-buttons\"></div>\n</div>`;\n\nexport default class StandardTopWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        const historyNavigationWidget = new HistoryNavigationWidget();\n        this.child(historyNavigationWidget);\n\n        this.$widget.prepend(historyNavigationWidget.render());\n\n        this.$widget.find(\".jump-to-note-dialog-button\").on('click', () => this.triggerCommand('jumpToNote'));\n        this.$widget.find(\".recent-changes-button\").on('click', () => this.triggerCommand('showRecentChanges'));\n\n        this.$enterProtectedSessionButton = this.$widget.find(\".enter-protected-session-button\");\n        this.$enterProtectedSessionButton.on('click', protectedSessionService.enterProtectedSession);\n\n        this.$leaveProtectedSessionButton = this.$widget.find(\".leave-protected-session-button\");\n        this.$leaveProtectedSessionButton.on('click', protectedSessionService.leaveProtectedSession);\n\n        return this.$widget\n    }\n\n    protectedSessionStartedEvent() {\n        this.$enterProtectedSessionButton.hide();\n        this.$leaveProtectedSessionButton.show();\n    }\n}","import options from \"../services/options.js\";\nimport FlexContainer from \"./flex_container.js\";\n\nexport default class SidePaneContainer extends FlexContainer {\n    constructor(side) {\n        super('column');\n\n        this.side = side;\n\n        this.id(side + '-pane');\n        this.css('height', '100%');\n    }\n\n    isEnabled() {\n        return super.isEnabled() && options.is(this.side + 'PaneVisible');\n    }\n\n    sidebarVisibilityChangedEvent({side, show}) {\n        this.toggleInt(this.isEnabled());\n\n        if (this.side === side && show) {\n            this.handleEvent('lazyLoaded');\n        }\n    }\n}","import BasicWidget from \"./basic_widget.js\";\n\nconst WIDGET_TPL = `\n<div class=\"global-buttons\">\n    <style>\n    .global-buttons {\n        display: flex;\n        justify-content: space-around;\n        border: 1px solid var(--main-border-color);\n        border-radius: 7px;\n        margin: 3px 5px 5px 5px;\n    }\n    </style>\n\n    <a data-trigger-command=\"createTopLevelNote\"\n       title=\"Create new top level note\" \n       class=\"icon-action bx bx-folder-plus\"></a>\n\n    <a data-trigger-command=\"collapseTree\"\n       title=\"Collapse note tree\" \n       class=\"icon-action bx bx-layer-minus\"></a>\n\n    <a data-trigger-command=\"scrollToActiveNote\"\n       title=\"Scroll to active note\"  \n       class=\"icon-action bx bx-crosshair\"></a>\n\n    <a data-trigger-command=\"searchNotes\"\n       title=\"Search in notes\"\n       class=\"icon-action bx bx-search\"></a>\n</div>\n`;\n\nclass GlobalButtonsWidget extends BasicWidget {\n    doRender() {\n        return this.$widget = $(WIDGET_TPL);\n    }\n}\n\nexport default GlobalButtonsWidget;","import BasicWidget from \"./basic_widget.js\";\nimport toastService from \"../services/toast.js\";\nimport appContext from \"../services/app_context.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport utils from \"../services/utils.js\";\n\nconst TPL = `\n<div class=\"search-box\">\n    <style>\n    .search-box {\n        display: none;\n        padding: 10px;\n        margin-top: 10px;\n    }\n    \n    .search-text {\n        border: 1px solid var(--main-border-color);\n    }\n    </style>\n\n    <div class=\"form-group\">\n        <div class=\"input-group\">\n            <input name=\"search-text\" class=\"search-text form-control\"\n                   placeholder=\"Search text, labels\" autocomplete=\"off\">\n\n            <div class=\"input-group-append\">\n                <button class=\"do-search-button btn btn-sm icon-button bx bx-search\" title=\"Search (enter)\"></button>\n            </div>\n        </div>\n    </div>\n\n    <div style=\"display: flex; align-items: center; justify-content: space-evenly; flex-wrap: wrap;\">\n        <button class=\"save-search-button btn btn-sm\"\n            title=\"This will create new saved search note under active note.\">\n            <span class=\"bx bx-save\"></span> Save search\n        </button>\n\n        <button class=\"close-search-button btn btn-sm\">\n            <span class=\"bx bx-x\"></span> Close search\n        </button>\n    </div>\n</div>`;\n\nexport default class SearchBoxWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$searchBox = this.$widget;\n        this.$closeSearchButton = this.$widget.find(\".close-search-button\");\n        this.$searchInput = this.$widget.find(\"input[name='search-text']\");\n        this.$resetSearchButton = this.$widget.find(\".reset-search-button\");\n        this.$doSearchButton = this.$widget.find(\".do-search-button\");\n        this.$saveSearchButton = this.$widget.find(\".save-search-button\");\n\n        this.$searchInput.on('keyup',e => {\n            const searchText = this.$searchInput.val();\n\n            if (e && e.which === $.ui.keyCode.ESCAPE || $.trim(searchText) === \"\") {\n                this.$resetSearchButton.trigger('click');\n                return;\n            }\n\n            if (e && e.which === $.ui.keyCode.ENTER) {\n                this.doSearch();\n            }\n        });\n\n        this.$doSearchButton.on('click', () => this.doSearch()); // keep long form because of argument\n        this.$resetSearchButton.on('click', () => this.resetSearchEvent());\n\n        this.$saveSearchButton.on('click', () => this.saveSearch());\n\n        this.$closeSearchButton.on('click', () => this.hideSearch());\n\n        return this.$widget;\n    }\n\n    doSearch(searchText) {\n        if (searchText) {\n            this.$searchInput.val(searchText);\n        }\n        else {\n            searchText = this.$searchInput.val();\n        }\n\n        if (searchText.trim().length === 0) {\n            toastService.showMessage(\"Please enter search criteria first.\");\n\n            this.$searchInput.trigger('focus');\n\n            return;\n        }\n\n        this.triggerCommand('searchForResults', {\n            searchText: this.$searchInput.val()\n        });\n\n        this.$searchBox.tooltip(\"hide\");\n    }\n\n    async saveSearch() {\n        const searchString = this.$searchInput.val().trim();\n\n        if (searchString.length === 0) {\n            alert(\"Write some search criteria first so there is something to save.\");\n            return;\n        }\n\n        // FIXME\n        let activeNote = appContext.tabManager.getActiveTabNote();\n\n        if (activeNote.type === 'search') {\n            activeNote = activeNote.getParentNotes()[0];\n        }\n\n        await noteCreateService.createNote(activeNote.noteId, {\n            type: \"search\",\n            mime: \"application/json\",\n            title: searchString,\n            content: JSON.stringify({ searchString: searchString })\n        });\n\n        this.resetSearchEvent();\n    }\n\n    showSearchEvent() {\n        utils.saveFocusedElement();\n\n        this.$searchBox.slideDown();\n\n        this.$searchBox.tooltip({\n            trigger: 'focus',\n            html: true,\n            title: window.glob.SEARCH_HELP_TEXT,\n            placement: 'right',\n            delay: {\n                show: 500, // necessary because sliding out may cause wrong position\n                hide: 200\n            }\n        });\n\n        this.$searchInput.trigger('focus');\n    }\n\n    hideSearch() {\n        this.resetSearchEvent();\n\n        this.$searchBox.slideUp();\n\n        this.triggerCommand('searchFlowEnded');\n    }\n\n    toggleSearchEvent() {\n        if (this.$searchBox.is(\":hidden\")) {\n            this.showSearchEvent();\n        }\n        else {\n            this.hideSearch();\n        }\n    }\n\n    searchNotesEvent() {\n        this.toggleSearchEvent();\n    }\n\n    resetSearchEvent() {\n        this.$searchInput.val(\"\");\n    }\n\n    searchInSubtreeEvent({node}) {\n        const noteId = node.data.noteId;\n\n        this.showSearchEvent();\n\n        this.$searchInput.val(`@in=${noteId} @text*=*`);\n    }\n}","import BasicWidget from \"./basic_widget.js\";\nimport toastService from \"../services/toast.js\";\nimport server from \"../services/server.js\";\n\nconst TPL = `\n<div class=\"search-results\">\n    <style>\n    .search-results {\n        padding: 0 5px 5px 15px;\n        flex-basis: 40%;\n        flex-grow: 1;\n        flex-shrink: 1;\n        margin-top: 10px;\n        display: none;\n        overflow: auto;\n        border-bottom: 2px solid var(--main-border-color);\n    }\n    \n    .search-results-list {\n        padding: 5px 5px 5px 15px;\n    }\n    </style>\n\n    <strong>Search results:</strong>\n\n    <ul class=\"search-results-list\"></ul>\n</div>\n`;\n\nexport default class SearchResultsWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$searchResults = this.$widget;\n        this.$searchResultsInner = this.$widget.find(\".search-results-list\");\n\n        this.toggleInt(false);\n\n        return this.$widget;\n    }\n\n    searchResultsEvent({results}) {\n        this.toggleInt(true);\n\n        this.$searchResultsInner.empty();\n        this.$searchResults.show();\n\n        for (const result of results) {\n            const link = $('<a>', {\n                href: 'javascript:',\n                text: result.title\n            }).attr('data-action', 'note').attr('data-note-path', result.path);\n\n            const $result = $('<li>').append(link);\n\n            this.$searchResultsInner.append($result);\n        }\n    }\n\n    searchFlowEndedEvent() {\n        this.$searchResults.hide();\n    }\n}","import hoistedNoteService from \"../services/hoisted_note.js\";\nimport treeService from \"../services/tree.js\";\nimport utils from \"../services/utils.js\";\nimport contextMenu from \"../services/context_menu.js\";\nimport treeCache from \"../services/tree_cache.js\";\nimport branchService from \"../services/branches.js\";\nimport ws from \"../services/ws.js\";\nimport TabAwareWidget from \"./tab_aware_widget.js\";\nimport server from \"../services/server.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport toastService from \"../services/toast.js\";\nimport appContext from \"../services/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport clipboard from \"../services/clipboard.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\nimport syncService from \"../services/sync.js\";\nimport options from \"../services/options.js\";\n\nconst TPL = `\n<div class=\"tree-wrapper\">\n    <style>\n    .tree-wrapper {\n        flex-grow: 1;\n        flex-shrink: 1;\n        flex-basis: 60%;\n        font-family: var(--tree-font-family);\n        font-size: var(--tree-font-size);\n        position: relative;\n        min-height: 0;\n    }\n    \n    .tree {\n        height: 100%;\n        overflow: auto;\n    }\n    \n    .refresh-search-button {\n        cursor: pointer;\n        position: relative;\n        top: -1px;\n        border: 1px solid transparent;\n        padding: 2px;\n        border-radius: 2px;\n    }\n    \n    .refresh-search-button:hover {\n        border-color: var(--button-border-color);\n    }\n    \n    .tree-settings-button {\n        position: absolute;\n        top: 10px;\n        right: 20px;\n        z-index: 100;\n    }\n    \n    .tree-settings-popup {\n        display: none; \n        position: absolute; \n        background-color: var(--accented-background-color); \n        border: 1px solid var(--main-border-color); \n        padding: 20px; \n        z-index: 1000;\n        width: 320px; \n        border-radius: 10px 0 10px 10px;\n    }\n    \n    ul.fancytree-container {\n        outline: none !important;\n        background-color: inherit !important;\n    }\n    \n    .fancytree-custom-icon {\n        font-size: 1.3em;\n    }\n    \n    span.fancytree-title {\n        color: inherit !important;\n        background: inherit !important;\n        outline: none !important;\n    }\n    \n    span.fancytree-node.protected > span.fancytree-custom-icon {\n        filter: drop-shadow(2px 2px 2px var(--main-text-color));\n    }\n    \n    span.fancytree-node.multiple-parents .fancytree-title::after {\n        content: \" *\"\n    }\n    \n    span.fancytree-node.fancytree-active-clone:not(.fancytree-active) .fancytree-title {\n        font-weight: bold;\n    }\n    \n    /* first nesting level has lower left padding to avoid extra left padding. Other levels are not affected */\n    .ui-fancytree > li > ul {\n        padding-left: 5px;\n    }\n    \n    span.fancytree-active .fancytree-title {\n        font-weight: bold;\n        border-color: var(--main-border-color) !important;\n        border-radius: 5px;\n    }\n    \n    span.fancytree-active:not(.fancytree-focused) .fancytree-title {\n        border-style: dashed !important;\n    }\n    \n    span.fancytree-focused .fancytree-title, span.fancytree-focused.fancytree-selected .fancytree-title {\n        color: var(--active-item-text-color) !important;\n        background-color: var(--active-item-background-color) !important;\n        border-color: var(--main-background-color) !important; /* invisible border */\n        border-radius: 5px;\n    }\n    \n    span.fancytree-selected .fancytree-title {\n        color: var(--hover-item-text-color) !important;\n        background-color: var(--hover-item-background-color) !important;\n        border-color: var(--main-background-color) !important; /* invisible border */\n        border-radius: 5px;\n        font-style: italic;\n    }\n    \n    span.fancytree-node:hover span.fancytree-title {\n        border-color: var(--main-border-color) !important;\n        border-radius: 5px;\n    }\n    \n    span.fancytree-node.archived {\n        opacity: 0.6;\n    }\n    </style>\n    \n    <button class=\"btn btn-sm icon-button bx bx-cog tree-settings-button\" title=\"Tree settings\"></button>\n    \n    <div class=\"tree-settings-popup\">\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input hide-archived-notes\" type=\"checkbox\" value=\"\">\n            \n                Hide archived notes\n            </label>\n        </div>\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input hide-included-images\" type=\"checkbox\" value=\"\">\n                \n                Hide images included in a note\n                <span class=\"bx bx-info-circle\" \n                      title=\"Images which are shown in the parent text note will not be displayed in the tree\"></span>\n            </label>\n        </div>\n    \n        <br/>\n    \n        <button class=\"btn btn-sm btn-primary save-tree-settings-button\" type=\"submit\">Save & apply changes</button>\n    </div>\n    \n    <div class=\"tree\"></div>\n</div>\n`;\n\nconst NOTE_TYPE_ICONS = {\n    \"file\": \"bx bx-file\",\n    \"image\": \"bx bx-image\",\n    \"code\": \"bx bx-code\",\n    \"render\": \"bx bx-extension\",\n    \"search\": \"bx bx-file-find\",\n    \"relation-map\": \"bx bx-map-alt\",\n    \"book\": \"bx bx-book\"\n};\n\nexport default class NoteTreeWidget extends TabAwareWidget {\n    constructor(treeName) {\n        super();\n\n        this.treeName = treeName;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$tree = this.$widget.find('.tree');\n\n        this.$tree.on(\"click\", \".unhoist-button\", hoistedNoteService.unhoist);\n        this.$tree.on(\"click\", \".refresh-search-button\", () => this.refreshSearch());\n\n        // fancytree doesn't support middle click so this is a way to support it\n        this.$tree.on('mousedown', '.fancytree-title', e => {\n            if (e.which === 2) {\n                const node = $.ui.fancytree.getNode(e);\n\n                const notePath = treeService.getNotePath(node);\n\n                if (notePath) {\n                    appContext.tabManager.openTabWithNote(notePath);\n                }\n\n                e.stopPropagation();\n                e.preventDefault();\n            }\n        });\n\n        this.$treeSettingsPopup = this.$widget.find('.tree-settings-popup');\n        this.$hideArchivedNotesCheckbox = this.$treeSettingsPopup.find('.hide-archived-notes');\n        this.$hideIncludedImages = this.$treeSettingsPopup.find('.hide-included-images');\n\n        this.$treeSettingsButton = this.$widget.find('.tree-settings-button');\n        this.$treeSettingsButton.on(\"click\", e => {\n            if (this.$treeSettingsPopup.is(\":visible\")) {\n                this.$treeSettingsPopup.hide();\n                return;\n            }\n\n            this.$hideArchivedNotesCheckbox.prop(\"checked\", this.hideArchivedNotes);\n            this.$hideIncludedImages.prop(\"checked\", this.hideIncludedImages);\n\n            let top = this.$treeSettingsButton[0].offsetTop;\n            let left = this.$treeSettingsButton[0].offsetLeft;\n            top += this.$treeSettingsButton.outerHeight();\n            left += this.$treeSettingsButton.outerWidth() - this.$treeSettingsPopup.outerWidth();\n\n            if (left < 0) {\n                left = 0;\n            }\n\n            this.$treeSettingsPopup.css({\n                display: \"block\",\n                top: top,\n                left: left\n            }).addClass(\"show\");\n\n            return false;\n        });\n\n        this.$treeSettingsPopup.on(\"click\", e => { e.stopPropagation(); });\n\n        $(document).on('click', () => this.$treeSettingsPopup.hide());\n\n        this.$saveTreeSettingsButton = this.$treeSettingsPopup.find('.save-tree-settings-button');\n        this.$saveTreeSettingsButton.on('click', async () => {\n            await this.setHideArchivedNotes(this.$hideArchivedNotesCheckbox.prop(\"checked\"));\n            await this.setHideIncludedImages(this.$hideIncludedImages.prop(\"checked\"));\n\n            this.$treeSettingsPopup.hide();\n\n            this.reloadTreeFromCache();\n        });\n\n        this.initialized = this.initFancyTree();\n\n        this.setupNoteTitleTooltip();\n\n        return this.$widget;\n    }\n\n    setupNoteTitleTooltip() {\n        // the following will dynamically set tree item's tooltip if the whole item's text is not currently visible\n        // if the whole text is visible then no tooltip is show since that's unnecessarily distracting\n        // see https://github.com/zadam/trilium/pull/1120 for discussion\n\n        // code inspired by https://gist.github.com/jtsternberg/c272d7de5b967cec2d3d\n        const isEnclosing = ($container, $sub) => {\n            const conOffset           = $container.offset();\n            const conDistanceFromTop  = conOffset.top + $container.outerHeight(true);\n            const conDistanceFromLeft = conOffset.left + $container.outerWidth(true);\n\n            const subOffset           = $sub.offset();\n            const subDistanceFromTop  = subOffset.top + $sub.outerHeight(true);\n            const subDistanceFromLeft = subOffset.left + $sub.outerWidth(true);\n\n            return conDistanceFromTop > subDistanceFromTop\n                && conOffset.top < subOffset.top\n                && conDistanceFromLeft > subDistanceFromLeft\n                && conOffset.left < subOffset.left;\n        };\n\n        this.$tree.on(\"mouseenter\", \"span.fancytree-title\", e => {\n            e.currentTarget.title = isEnclosing(this.$tree, $(e.currentTarget))\n                ? \"\"\n                : e.currentTarget.innerText;\n        });\n    }\n\n    get hideArchivedNotes() {\n        return options.is(\"hideArchivedNotes_\" + this.treeName);\n    }\n\n    async setHideArchivedNotes(val) {\n        await options.save(\"hideArchivedNotes_\" + this.treeName, val.toString());\n    }\n\n    get hideIncludedImages() {\n        return options.is(\"hideIncludedImages_\" + this.treeName);\n    }\n\n    async setHideIncludedImages(val) {\n        await options.save(\"hideIncludedImages_\" + this.treeName, val.toString());\n    }\n\n    async initFancyTree() {\n        const treeData = [await this.prepareRootNode()];\n\n        this.$tree.fancytree({\n            titlesTabbable: true,\n            autoScroll: true,\n            keyboard: false, // we takover keyboard handling in the hotkeys plugin\n            extensions: utils.isMobile() ? [\"dnd5\", \"clones\"] : [\"hotkeys\", \"dnd5\", \"clones\"],\n            source: treeData,\n            scrollParent: this.$tree,\n            minExpandLevel: 2, // root can't be collapsed\n            click: (event, data) => {\n                const targetType = data.targetType;\n                const node = data.node;\n\n                if (targetType === 'title' || targetType === 'icon') {\n                    if (event.shiftKey) {\n                        node.setSelected(!node.isSelected());\n                        node.setFocus(true);\n                    }\n                    else if (event.ctrlKey) {\n                        const notePath = treeService.getNotePath(node);\n                        appContext.tabManager.openTabWithNote(notePath);\n                    }\n                    else if (data.node.isActive()) {\n                        // this is important for single column mobile view, otherwise it's not possible to see again previously displayed note\n                        this.tree.reactivate(true);\n                    }\n                    else {\n                        node.setActive();\n\n                        this.clearSelectedNodes();\n                    }\n\n                    return false;\n                }\n            },\n            activate: async (event, data) => {\n                // click event won't propagate so let's close context menu manually\n                contextMenu.hide();\n\n                const notePath = treeService.getNotePath(data.node);\n\n                const activeTabContext = appContext.tabManager.getActiveTabContext();\n                await activeTabContext.setNote(notePath);\n\n                if (utils.isMobile()) {\n                    this.triggerCommand('setActiveScreen', {screen:'detail'});\n                }\n            },\n            expand: (event, data) => this.setExpanded(data.node.data.branchId, true),\n            collapse: (event, data) => this.setExpanded(data.node.data.branchId, false),\n            hotkeys: utils.isMobile() ? undefined : { keydown: await this.getHotKeys() },\n            dnd5: {\n                autoExpandMS: 600,\n                dragStart: (node, data) => {\n                    // don't allow dragging root node\n                    if (node.data.noteId === hoistedNoteService.getHoistedNoteId()\n                        || node.getParent().data.noteType === 'search') {\n                        return false;\n                    }\n\n                    const notes = this.getSelectedOrActiveNodes(node).map(node => ({\n                        noteId: node.data.noteId,\n                        branchId: node.data.branchId,\n                        title: node.title\n                    }));\n\n                    data.dataTransfer.setData(\"text\", JSON.stringify(notes));\n\n                    // This function MUST be defined to enable dragging for the tree.\n                    // Return false to cancel dragging of node.\n                    return true;\n                },\n                dragEnter: (node, data) => true, // allow drop on any node\n                dragOver: (node, data) => true,\n                dragDrop: async (node, data) => {\n                    if ((data.hitMode === 'over' && node.data.noteType === 'search') ||\n                        (['after', 'before'].includes(data.hitMode)\n                            && (node.data.noteId === hoistedNoteService.getHoistedNoteId() || node.getParent().data.noteType === 'search'))) {\n\n                        const infoDialog = await import('../dialogs/info.js');\n\n                        await infoDialog.info(\"Dropping notes into this location is not allowed.\");\n\n                        return;\n                    }\n\n                    const dataTransfer = data.dataTransfer;\n\n                    if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n                        const files = [...dataTransfer.files]; // chrome has issue that dataTransfer.files empties after async operation\n\n                        const importService = await import('../services/import.js');\n\n                        importService.uploadFiles(node.data.noteId, files, {\n                            safeImport: true,\n                            shrinkImages: true,\n                            textImportedAsText: true,\n                            codeImportedAsCode: true,\n                            explodeArchives: true\n                        });\n                    }\n                    else {\n                        const jsonStr = dataTransfer.getData(\"text\");\n                        let notes = null;\n\n                        try {\n                            notes = JSON.parse(jsonStr);\n                        }\n                        catch (e) {\n                            console.error(`Cannot parse ${jsonStr} into notes for drop`);\n                            return;\n                        }\n\n                        // This function MUST be defined to enable dropping of items on the tree.\n                        // data.hitMode is 'before', 'after', or 'over'.\n\n                        const selectedBranchIds = notes.map(note => note.branchId);\n\n                        if (data.hitMode === \"before\") {\n                            branchService.moveBeforeBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"after\") {\n                            branchService.moveAfterBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"over\") {\n                            branchService.moveToParentNote(selectedBranchIds, node.data.branchId);\n                        } else {\n                            throw new Error(\"Unknown hitMode=\" + data.hitMode);\n                        }\n                    }\n                }\n            },\n            lazyLoad: (event, data) => {\n                const {noteId, noteType} = data.node.data;\n\n                if (noteType === 'search') {\n                    const notePath = treeService.getNotePath(data.node.getParent());\n\n                    // this is a search cycle (search note is a descendant of its own search result)\n                    if (notePath.includes(noteId)) {\n                        data.result = [];\n                        return;\n                    }\n                }\n\n                data.result = treeCache.getNote(noteId).then(note => this.prepareChildren(note));\n            },\n            clones: {\n                highlightActiveClones: true\n            },\n            enhanceTitle: async function (event, data) {\n                const node = data.node;\n                const $span = $(node.span);\n\n                if (node.data.noteId !== 'root'\n                    && node.data.noteId === hoistedNoteService.getHoistedNoteId()\n                    && $span.find('.unhoist-button').length === 0) {\n\n                    const unhoistButton = $('<span>&nbsp; (<a class=\"unhoist-button\">unhoist</a>)</span>');\n\n                    $span.append(unhoistButton);\n                }\n\n                const note = await treeCache.getNote(node.data.noteId);\n\n                if (note.type === 'search' && $span.find('.refresh-search-button').length === 0) {\n                    const refreshSearchButton = $('<span>&nbsp; <span class=\"refresh-search-button bx bx-refresh\" title=\"Refresh saved search results\"></span></span>');\n\n                    $span.append(refreshSearchButton);\n                }\n            },\n            // this is done to automatically lazy load all expanded notes after tree load\n            loadChildren: (event, data) => {\n                data.node.visit((subNode) => {\n                    // Load all lazy/unloaded child nodes\n                    // (which will trigger `loadChildren` recursively)\n                    if (subNode.isUndefined() && subNode.isExpanded()) {\n                        subNode.load();\n                    }\n                });\n            }\n        });\n\n        this.$tree.on('contextmenu', '.fancytree-node', e => {\n            const node = $.ui.fancytree.getNode(e);\n\n            import(\"../services/tree_context_menu.js\").then(({default: TreeContextMenu}) => {\n                const treeContextMenu = new TreeContextMenu(this, node);\n                treeContextMenu.show(e);\n            });\n\n            return false; // blocks default browser right click menu\n        });\n\n        this.tree = $.ui.fancytree.getTree(this.$tree);\n    }\n\n    async prepareRootNode() {\n        await treeCache.initializedPromise;\n\n        const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n        let hoistedBranch;\n\n        if (hoistedNoteId === 'root') {\n            hoistedBranch = treeCache.getBranch('root');\n        }\n        else {\n            const hoistedNote = await treeCache.getNote(hoistedNoteId);\n            hoistedBranch = (await hoistedNote.getBranches())[0];\n        }\n\n        return await this.prepareNode(hoistedBranch);\n    }\n\n    async prepareChildren(note) {\n        if (note.type === 'search') {\n            return await this.prepareSearchNoteChildren(note);\n        }\n        else {\n            return await this.prepareNormalNoteChildren(note);\n        }\n    }\n\n    getIconClass(note) {\n        const labels = note.getLabels('iconClass');\n\n        return labels.map(l => l.value).join(' ');\n    }\n\n    getIcon(note, isFolder) {\n        const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n        const iconClass = this.getIconClass(note);\n\n        if (iconClass) {\n            return iconClass;\n        }\n        else if (note.noteId === 'root') {\n            return \"bx bx-chevrons-right\";\n        }\n        else if (note.noteId === hoistedNoteId) {\n            return \"bx bxs-arrow-from-bottom\";\n        }\n        else if (note.type === 'text') {\n            if (isFolder) {\n                return \"bx bx-folder\";\n            }\n            else {\n                return \"bx bx-note\";\n            }\n        }\n        else {\n            return NOTE_TYPE_ICONS[note.type];\n        }\n    }\n\n    async prepareNode(branch) {\n        const note = await branch.getNote();\n\n        if (!note) {\n            throw new Error(`Branch has no note ` + branch.noteId);\n        }\n\n        const title = (branch.prefix ? (branch.prefix + \" - \") : \"\") + note.title;\n        const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n        const isFolder = this.isFolder(note);\n\n        const node = {\n            noteId: note.noteId,\n            parentNoteId: branch.parentNoteId,\n            branchId: branch.branchId,\n            isProtected: note.isProtected,\n            noteType: note.type,\n            title: utils.escapeHtml(title),\n            extraClasses: this.getExtraClasses(note),\n            icon: this.getIcon(note, isFolder),\n            refKey: note.noteId,\n            lazy: true,\n            folder: isFolder,\n            expanded: branch.isExpanded || hoistedNoteId === note.noteId,\n            key: utils.randomString(12) // this should prevent some \"duplicate key\" errors\n        };\n\n        if (node.folder && node.expanded) {\n            node.children = await this.prepareChildren(note);\n        }\n\n        return node;\n    }\n\n    isFolder(note) {\n        if (note.type === 'search') {\n            return true;\n        }\n        else {\n            const childBranches = this.getChildBranches(note);\n\n            return childBranches.length > 0;\n        }\n    }\n\n    async prepareNormalNoteChildren(parentNote) {\n        utils.assertArguments(parentNote);\n\n        const noteList = [];\n\n        const hideArchivedNotes = this.hideArchivedNotes;\n\n        for (const branch of this.getChildBranches(parentNote)) {\n            if (hideArchivedNotes) {\n                const note = await branch.getNote();\n\n                if (note.hasLabel('archived')) {\n                    continue;\n                }\n            }\n\n            const node = await this.prepareNode(branch);\n\n            noteList.push(node);\n        }\n\n        return noteList;\n    }\n\n    getChildBranches(parentNote) {\n        let childBranches = parentNote.getChildBranches();\n\n        if (!childBranches) {\n            ws.logError(`No children for ${parentNote}. This shouldn't happen.`);\n            return;\n        }\n\n        if (this.hideIncludedImages) {\n            const imageLinks = parentNote.getRelations('imageLink');\n\n            // image is already visible in the parent note so no need to display it separately in the book\n            childBranches = childBranches.filter(branch => !imageLinks.find(rel => rel.value === branch.noteId));\n        }\n\n        // we're not checking hideArchivedNotes since that would mean we need to lazy load the child notes\n        // which would seriously slow down everything.\n        // we check this flag only once user chooses to expand the parent. This has the negative consequence that\n        // note may appear as folder but not contain any children when all of them are archived\n\n        return childBranches;\n    }\n\n    async prepareSearchNoteChildren(note) {\n        await treeCache.reloadNotes([note.noteId]);\n\n        const newNote = await treeCache.getNote(note.noteId);\n\n        return await this.prepareNormalNoteChildren(newNote);\n    }\n\n    getExtraClasses(note) {\n        utils.assertArguments(note);\n\n        const extraClasses = [];\n\n        if (note.isProtected) {\n            extraClasses.push(\"protected\");\n        }\n\n        if (note.getParentNoteIds().length > 1) {\n            extraClasses.push(\"multiple-parents\");\n        }\n\n        const cssClass = note.getCssClass();\n\n        if (cssClass) {\n            extraClasses.push(cssClass);\n        }\n\n        extraClasses.push(utils.getNoteTypeClass(note.type));\n\n        if (note.mime) { // some notes should not have mime type (e.g. render)\n            extraClasses.push(utils.getMimeTypeClass(note.mime));\n        }\n\n        if (note.hasLabel('archived')) {\n            extraClasses.push(\"archived\");\n        }\n\n        return extraClasses.join(\" \");\n    }\n\n    /** @return {FancytreeNode[]} */\n    getSelectedNodes(stopOnParents = false) {\n        return this.tree.getSelectedNodes(stopOnParents);\n    }\n\n    /** @return {FancytreeNode[]} */\n    getSelectedOrActiveNodes(node = null) {\n        const nodes = this.getSelectedNodes(true);\n\n        // the node you start dragging should be included even if not selected\n        if (node && !nodes.find(n => n.key === node.key)) {\n            nodes.push(node);\n        }\n\n        if (nodes.length === 0) {\n            nodes.push(this.getActiveNode());\n        }\n\n        return nodes;\n    }\n\n    async setExpandedStatusForSubtree(node, isExpanded) {\n        if (!node) {\n            const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n            node = this.getNodesByNoteId(hoistedNoteId)[0];\n        }\n\n        const {branchIds} = await server.put(`branches/${node.data.branchId}/expanded-subtree/${isExpanded ? 1 : 0}`);\n\n        treeCache.getBranches(branchIds, true).forEach(branch => branch.isExpanded = isExpanded);\n\n        await this.batchUpdate(async () => {\n            await node.load(true);\n\n            if (node.data.noteId !== 'root') { // root is always expanded\n                await node.setExpanded(isExpanded, {noEvents: true});\n            }\n        });\n    }\n\n    async expandTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, true);\n    }\n\n    async collapseTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, false);\n    }\n\n    /**\n     * @return {FancytreeNode|null}\n     */\n    getActiveNode() {\n        return this.tree.getActiveNode();\n    }\n\n    /**\n     * focused & not active node can happen during multiselection where the node is selected\n     * but not activated (its content is not displayed in the detail)\n     * @return {FancytreeNode|null}\n     */\n    getFocusedNode() {\n        return this.tree.getFocusNode();\n    }\n\n    clearSelectedNodes() {\n        for (const selectedNode of this.getSelectedNodes()) {\n            selectedNode.setSelected(false);\n        }\n    }\n\n    async scrollToActiveNoteEvent() {\n        const activeContext = appContext.tabManager.getActiveTabContext();\n\n        if (activeContext && activeContext.notePath) {\n            this.tree.setFocus(true);\n\n            const node = await this.expandToNote(activeContext.notePath);\n\n            await node.makeVisible({scrollIntoView: true});\n            node.setFocus(true);\n        }\n    }\n\n    /** @return {FancytreeNode} */\n    async getNodeFromPath(notePath, expand = false, logErrors = true) {\n        utils.assertArguments(notePath);\n\n        const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n        /** @const {FancytreeNode} */\n        let parentNode = null;\n\n        const runPath = await treeService.getRunPath(notePath, logErrors);\n\n        if (!runPath) {\n            if (logErrors) {\n                console.error(\"Could not find run path for notePath:\", notePath);\n            }\n\n            return;\n        }\n\n        for (const childNoteId of runPath) {\n            if (childNoteId === hoistedNoteId) {\n                // there must be exactly one node with given hoistedNoteId\n                parentNode = this.getNodesByNoteId(childNoteId)[0];\n\n                continue;\n            }\n\n            // we expand only after hoisted note since before then nodes are not actually present in the tree\n            if (parentNode) {\n                if (!parentNode.isLoaded()) {\n                    await parentNode.load();\n                }\n\n                if (expand) {\n                    await parentNode.setExpanded(true);\n\n                    // although previous line should set the expanded status, it seems to happen asynchronously\n                    // so we need to make sure it is set properly before calling updateNode which uses this flag\n                    const branch = treeCache.getBranch(parentNode.data.branchId);\n                    branch.isExpanded = true;\n                }\n\n                this.updateNode(parentNode);\n\n                let foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                if (!foundChildNode) { // note might be recently created so we'll force reload and try again\n                    await parentNode.load(true);\n\n                    foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                    if (!foundChildNode) {\n                        if (logErrors) {\n                            ws.logError(`Can't find node for child node of noteId=${childNoteId} for parent of noteId=${parentNode.data.noteId} and hoistedNoteId=${hoistedNoteId}, requested path is ${notePath}`);\n                        }\n\n                        return;\n                    }\n                }\n\n                parentNode = foundChildNode;\n            }\n        }\n\n        return parentNode;\n    }\n\n    /** @return {FancytreeNode} */\n    findChildNode(parentNode, childNoteId) {\n        let foundChildNode = null;\n\n        for (const childNode of parentNode.getChildren()) {\n            if (childNode.data.noteId === childNoteId) {\n                foundChildNode = childNode;\n                break;\n            }\n        }\n\n        return foundChildNode;\n    }\n\n    /** @return {FancytreeNode} */\n    async expandToNote(notePath, logErrors = true) {\n        return this.getNodeFromPath(notePath, true, logErrors);\n    }\n\n    updateNode(node) {\n        const note = treeCache.getNoteFromCache(node.data.noteId);\n        const branch = treeCache.getBranch(node.data.branchId);\n\n        const isFolder = this.isFolder(note);\n        const title = (branch.prefix ? (branch.prefix + \" - \") : \"\") + note.title;\n\n        node.data.isProtected = note.isProtected;\n        node.data.noteType = note.type;\n        node.folder = isFolder;\n        node.icon = this.getIcon(note, isFolder);\n        node.extraClasses = this.getExtraClasses(note);\n        node.title = utils.escapeHtml(title);\n\n        if (node.isExpanded() !== branch.isExpanded) {\n            node.setExpanded(branch.isExpanded, {noEvents: true});\n        }\n\n        node.renderTitle();\n    }\n\n    /** @return {FancytreeNode[]} */\n    getNodesByBranchId(branchId) {\n        utils.assertArguments(branchId);\n\n        const branch = treeCache.getBranch(branchId);\n\n        return this.getNodesByNoteId(branch.noteId).filter(node => node.data.branchId === branchId);\n    }\n\n    /** @return {FancytreeNode[]} */\n    getNodesByNoteId(noteId) {\n        utils.assertArguments(noteId);\n\n        const list = this.tree.getNodesByRef(noteId);\n        return list ? list : []; // if no nodes with this refKey are found, fancy tree returns null\n    }\n\n    // must be event since it's triggered from outside the tree\n    collapseTreeEvent() { this.collapseTree(); }\n\n    isEnabled() {\n        return !!this.tabContext;\n    }\n\n    async refresh() {\n        this.toggleInt(this.isEnabled());\n\n        const oldActiveNode = this.getActiveNode();\n        let oldActiveNodeFocused = false;\n\n        if (oldActiveNode) {\n            oldActiveNodeFocused = oldActiveNode.hasFocus();\n\n            oldActiveNode.setActive(false);\n            oldActiveNode.setFocus(false);\n        }\n\n        if (this.tabContext && this.tabContext.notePath && !this.tabContext.note.isDeleted) {\n            const newActiveNode = await this.getNodeFromPath(this.tabContext.notePath);\n\n            if (newActiveNode) {\n                if (!newActiveNode.isVisible()) {\n                    await this.expandToNote(this.tabContext.notePath);\n                }\n\n                newActiveNode.setActive(true, {noEvents: true, noFocus: !oldActiveNodeFocused});\n                newActiveNode.makeVisible({scrollIntoView: true});\n            }\n        }\n    }\n\n    async refreshSearch() {\n        const activeNode = this.getActiveNode();\n\n        activeNode.load(true);\n        activeNode.setExpanded(true);\n\n        toastService.showMessage(\"Saved search note refreshed.\");\n    }\n\n    async batchUpdate(cb) {\n        try {\n            // disable rendering during update for increased performance\n            this.tree.enableUpdate(false);\n\n            await cb();\n        }\n        finally {\n            this.tree.enableUpdate(true);\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const activeNode = this.getActiveNode();\n        const activeNodeFocused = activeNode && activeNode.hasFocus();\n        const nextNode = activeNode ? (activeNode.getNextSibling() || activeNode.getPrevSibling() || activeNode.getParent()) : null;\n        const activeNotePath = activeNode ? treeService.getNotePath(activeNode) : null;\n        const nextNotePath = nextNode ? treeService.getNotePath(nextNode) : null;\n        const activeNoteId = activeNode ? activeNode.data.noteId : null;\n\n        const noteIdsToUpdate = new Set();\n        const noteIdsToReload = new Set();\n\n        for (const attr of loadResults.getAttributes()) {\n            if (attr.type === 'label' && ['iconClass', 'cssClass'].includes(attr.name)) {\n                if (attr.isInheritable) {\n                    noteIdsToReload.add(attr.noteId);\n                }\n                else {\n                    noteIdsToUpdate.add(attr.noteId);\n                }\n            }\n            else if (attr.type === 'relation' && attr.name === 'template') {\n                // missing handling of things inherited from template\n                noteIdsToReload.add(attr.noteId);\n            }\n            else if (attr.type === 'relation' && attr.name === 'imageLink') {\n                const note = treeCache.getNoteFromCache(attr.noteId);\n\n                if (note && note.getChildNoteIds().includes(attr.value)) {\n                    // there's new/deleted imageLink betwen note and its image child - which can show/hide\n                    // the image (if there is a imageLink relation between parent and child then it is assumed to be \"contained\" in the note and thus does not have to be displayed in the tree)\n                    noteIdsToReload.add(attr.noteId);\n                }\n            }\n        }\n\n        for (const branch of loadResults.getBranches()) {\n            for (const node of this.getNodesByBranchId(branch.branchId)) {\n                if (branch.isDeleted) {\n                    if (node.isActive()) {\n                        const newActiveNode = node.getNextSibling()\n                            || node.getPrevSibling()\n                            || node.getParent();\n\n                        if (newActiveNode) {\n                            newActiveNode.setActive(true, {noEvents: true, noFocus: true});\n                        }\n                    }\n\n                    if (node.getParent()) {\n                        node.remove();\n                    }\n\n                    noteIdsToUpdate.add(branch.parentNoteId);\n                }\n                else {\n                    noteIdsToUpdate.add(branch.noteId);\n                }\n            }\n\n            if (!branch.isDeleted) {\n                for (const parentNode of this.getNodesByNoteId(branch.parentNoteId)) {\n                    if (parentNode.isFolder() && !parentNode.isLoaded()) {\n                        continue;\n                    }\n\n                    const found = (parentNode.getChildren() || []).find(child => child.data.noteId === branch.noteId);\n\n                    if (!found) {\n                        noteIdsToReload.add(branch.parentNoteId);\n                    }\n                }\n            }\n        }\n\n        for (const noteId of loadResults.getNoteIds()) {\n            noteIdsToUpdate.add(noteId);\n        }\n\n        await this.batchUpdate(async () => {\n            for (const noteId of noteIdsToReload) {\n                for (const node of this.getNodesByNoteId(noteId)) {\n                    await node.load(true);\n\n                    noteIdsToUpdate.add(noteId);\n                }\n            }\n\n            for (const parentNoteId of loadResults.getNoteReorderings()) {\n                for (const node of this.getNodesByNoteId(parentNoteId)) {\n                    if (node.isLoaded()) {\n                        node.sortChildren((nodeA, nodeB) => {\n                            const branchA = treeCache.branches[nodeA.data.branchId];\n                            const branchB = treeCache.branches[nodeB.data.branchId];\n\n                            if (!branchA || !branchB) {\n                                return 0;\n                            }\n\n                            return branchA.notePosition - branchB.notePosition;\n                        });\n                    }\n                }\n            }\n        });\n\n        // for some reason node update cannot be in the batchUpdate() block (node is not re-rendered)\n        for (const noteId of noteIdsToUpdate) {\n            for (const node of this.getNodesByNoteId(noteId)) {\n                this.updateNode(node);\n            }\n        }\n\n        if (activeNotePath) {\n            let node = await this.expandToNote(activeNotePath, false);\n\n            if (node && node.data.noteId !== activeNoteId) {\n                // if the active note has been moved elsewhere then it won't be found by the path\n                // so we switch to the alternative of trying to find it by noteId\n                const notesById = this.getNodesByNoteId(activeNoteId);\n\n                // if there are multiple clones then we'd rather not activate any one\n                node = notesById.length === 1 ? notesById[0] : null;\n            }\n\n            if (node) {\n                node.setActive(true, {noEvents: true, noFocus: true});\n            }\n            else {\n                // this is used when original note has been deleted and we want to move the focus to the note above/below\n                node = await this.expandToNote(nextNotePath, false);\n\n                if (node) {\n                    await appContext.tabManager.getActiveTabContext().setNote(nextNotePath);\n                }\n            }\n\n            const newActiveNode = this.getActiveNode();\n\n            // return focus if the previously active node was also focused\n            if (newActiveNode && activeNodeFocused) {\n                await newActiveNode.setFocus(true);\n            }\n        }\n    }\n\n    async setExpanded(branchId, isExpanded) {\n        utils.assertArguments(branchId);\n\n        const branch = treeCache.getBranch(branchId);\n        branch.isExpanded = isExpanded;\n\n        await server.put(`branches/${branchId}/expanded/${isExpanded ? 1 : 0}`);\n    }\n\n    async reloadTreeFromCache() {\n        const activeNode = this.getActiveNode();\n\n        const activeNotePath = activeNode !== null ? treeService.getNotePath(activeNode) : null;\n\n        const rootNode = await this.prepareRootNode();\n\n        await this.batchUpdate(async () => {\n            await this.tree.reload([rootNode]);\n        });\n\n        if (activeNotePath) {\n            const node = await this.getNodeFromPath(activeNotePath, true);\n\n            await node.setActive(true, {noEvents: true, noFocus: true});\n        }\n    }\n\n    hoistedNoteChangedEvent() {\n        this.reloadTreeFromCache();\n    }\n\n    treeCacheReloadedEvent() {\n        this.reloadTreeFromCache();\n    }\n\n    async getHotKeys() {\n        const actions = await keyboardActionsService.getActionsForScope('note-tree');\n        const hotKeyMap = {\n            // code below shouldn't be necessary normally, however there's some problem with interaction with context menu plugin\n            // after opening context menu, standard shortcuts don't work, but they are detected here\n            // so we essentially takeover the standard handling with our implementation.\n            \"left\": node => {\n                node.navigate($.ui.keyCode.LEFT, true);\n                this.clearSelectedNodes();\n\n                return false;\n            },\n            \"right\": node => {\n                node.navigate($.ui.keyCode.RIGHT, true);\n                this.clearSelectedNodes();\n\n                return false;\n            },\n            \"up\": node => {\n                node.navigate($.ui.keyCode.UP, true);\n                this.clearSelectedNodes();\n\n                return false;\n            },\n            \"down\": node => {\n                node.navigate($.ui.keyCode.DOWN, true);\n                this.clearSelectedNodes();\n\n                return false;\n            }\n        };\n\n        for (const action of actions) {\n            for (const shortcut of action.effectiveShortcuts) {\n                hotKeyMap[utils.normalizeShortcut(shortcut)] = node => {\n                    this.triggerCommand(action.actionName, {node});\n\n                    return false;\n                }\n            }\n        }\n\n        return hotKeyMap;\n    }\n\n    /**\n     * @param {FancytreeNode} node\n     */\n    getSelectedOrActiveBranchIds(node) {\n        const nodes = this.getSelectedOrActiveNodes(node);\n\n        return nodes.map(node => node.data.branchId);\n    }\n\n    async deleteNotesCommand({node}) {\n        const branchIds = this.getSelectedOrActiveBranchIds(node);\n\n        await branchService.deleteNotes(branchIds);\n\n        this.clearSelectedNodes();\n    }\n\n    moveNoteUpCommand({node}) {\n        const beforeNode = node.getPrevSibling();\n\n        if (beforeNode !== null) {\n            branchService.moveBeforeBranch([node.data.branchId], beforeNode.data.branchId);\n        }\n    }\n\n    moveNoteDownCommand({node}) {\n        const afterNode = node.getNextSibling();\n        if (afterNode !== null) {\n            branchService.moveAfterBranch([node.data.branchId], afterNode.data.branchId);\n        }\n    }\n\n    moveNoteUpInHierarchyCommand({node}) {\n        branchService.moveNodeUpInHierarchy(node);\n    }\n\n    moveNoteDownInHierarchyCommand({node}) {\n        const toNode = node.getPrevSibling();\n\n        if (toNode !== null) {\n            branchService.moveToParentNote([node.data.branchId], toNode.data.branchId);\n        }\n    }\n\n    addNoteAboveToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const prevSibling = node.getPrevSibling();\n\n        if (prevSibling) {\n            prevSibling.setActive(true, {noEvents: true});\n\n            if (prevSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            prevSibling.setSelected(true);\n        }\n    }\n\n    addNoteBelowToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const nextSibling = node.getNextSibling();\n\n        if (nextSibling) {\n            nextSibling.setActive(true, {noEvents: true});\n\n            if (nextSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            nextSibling.setSelected(true);\n        }\n    }\n\n    expandSubtreeCommand({node}) {\n        this.expandTree(node);\n    }\n\n    collapseSubtreeCommand({node}) {\n        this.collapseTree(node);\n    }\n\n    sortChildNotesCommand({node}) {\n        treeService.sortAlphabetically(node.data.noteId);\n    }\n\n    async recentChangesInSubtreeCommand({node}) {\n        const recentChangesDialog = await import('../dialogs/recent_changes.js');\n\n        recentChangesDialog.showDialog(node.data.noteId);\n    }\n\n    selectAllNotesInParentCommand({node}) {\n        for (const child of node.getParent().getChildren()) {\n            child.setSelected(true);\n        }\n    }\n\n    copyNotesToClipboardCommand({node}) {\n        clipboard.copy(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    cutNotesToClipboardCommand({node}) {\n        clipboard.cut(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    pasteNotesFromClipboardCommand({node}) {\n        clipboard.pasteInto(node.data.branchId);\n    }\n\n    pasteNotesAfterFromClipboard({node}) {\n        clipboard.pasteAfter(node.data.branchId);\n    }\n\n    async exportNoteCommand({node}) {\n        const exportDialog = await import('../dialogs/export.js');\n        const notePath = treeService.getNotePath(node);\n\n        exportDialog.showDialog(notePath,\"subtree\");\n    }\n\n    async importIntoNoteCommand({node}) {\n        const importDialog = await import('../dialogs/import.js');\n        importDialog.showDialog(node.data.noteId);\n    }\n\n    forceNoteSyncCommand({node}) {\n        syncService.forceNoteSync(node.data.noteId);\n    }\n\n    editNoteTitleCommand({node}) {\n        appContext.triggerCommand('focusOnTitle');\n    }\n\n    activateParentNoteCommand({node}) {\n        if (!hoistedNoteService.isRootNode(node)) {\n            node.getParent().setActive().then(this.clearSelectedNodes);\n        }\n    }\n\n    protectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, true, true);\n    }\n\n    unprotectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, false, true);\n    }\n\n    duplicateNoteCommand({node}) {\n        const branch = treeCache.getBranch(node.data.branchId);\n\n        noteCreateService.duplicateNote(node.data.noteId, branch.parentNoteId);\n    }\n}\n","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport treeService from \"../services/tree.js\";\nimport linkService from \"../services/link.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\n\nconst TPL = `\n<div class=\"note-paths-widget\">\n    <style>\n    .note-paths-widget {\n        display: flex; \n        flex-direction: row;\n        border-bottom: 1px solid var(--main-border-color);\n        padding: 5px 10px 5px 10px;\n    }\n    \n    .note-path-list a.current {\n        font-weight: bold;\n    }\n    \n    .note-path-list-button {\n        padding: 0;\n        width: 24px;\n        height: 24px;\n        margin-left: 5px;\n        position: relative;\n        top: -2px;\n    }\n    \n    .note-path-list-button::after {\n        display: none !important; // disabling the standard caret\n    }\n    \n    .current-path {\n        flex-grow: 1;\n        white-space: nowrap; \n        overflow: hidden; \n        text-overflow: ellipsis;\n    }\n    </style>\n\n    <div class=\"current-path\"></div>\n\n    <div class=\"dropdown hide-in-zen-mode\">\n        <button class=\"btn btn-sm dropdown-toggle note-path-list-button bx bx-caret-down\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></button>\n        <ul class=\"note-path-list dropdown-menu dropdown-menu-right\" aria-labelledby=\"note-path-list-button\">\n        </ul>\n    </div>\n</div>`;\n\nexport default class NotePathsWidget extends TabAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$currentPath = this.$widget.find('.current-path');\n        this.$dropdown = this.$widget.find(\".dropdown\");\n\n        this.$notePathList = this.$dropdown.find(\".note-path-list\");\n\n        this.$dropdown.on('show.bs.dropdown', () => this.renderDropdown());\n\n        return this.$widget;\n    }\n\n    async refreshWithNote(note, notePath) {\n        const noteIdsPath = treeService.parseNotePath(notePath);\n\n        this.$currentPath.empty();\n\n        let parentNoteId = 'root';\n        let curPath = '';\n\n        let passedHoistedNote = false;\n\n        for (let i = 0; i < noteIdsPath.length; i++) {\n            const noteId = noteIdsPath[i];\n\n            curPath += (curPath ? '/' : '') + noteId;\n\n            if (noteId === hoistedNoteService.getHoistedNoteId()) {\n                passedHoistedNote = true;\n            }\n\n            if (passedHoistedNote && (noteId !== hoistedNoteService.getHoistedNoteId() || noteIdsPath.length - i < 3)) {\n                this.$currentPath.append(\n                    $(\"<a>\")\n                        .attr('href', '#' + curPath)\n                        .attr('data-note-path', curPath)\n                        .addClass('no-tooltip-preview')\n                        .text(await treeService.getNoteTitle(noteId, parentNoteId))\n                );\n\n                if (i !== noteIdsPath.length - 1) {\n                    this.$currentPath.append(' / ');\n                }\n            }\n\n            parentNoteId = noteId;\n        }\n    }\n\n    async renderDropdown() {\n        this.$notePathList.empty();\n        this.$notePathList.append(\n            $(\"<div>\")\n                .addClass(\"dropdown-header\")\n                .text('This note is placed into the following paths:')\n        );\n\n        if (this.noteId === 'root') {\n            await this.addPath('root', true);\n            return;\n        }\n\n        const pathSegments = treeService.parseNotePath(this.notePath);\n        const activeNoteParentNoteId = pathSegments[pathSegments.length - 2]; // we know this is not root so there must be a parent\n\n        for (const parentNote of this.note.getParentNotes()) {\n            const parentNotePath = await treeService.getSomeNotePath(parentNote);\n            // this is to avoid having root notes leading '/'\n            const notePath = parentNotePath ? (parentNotePath + '/' + this.noteId) : this.noteId;\n            const isCurrent = activeNoteParentNoteId === parentNote.noteId;\n\n            await this.addPath(notePath, isCurrent);\n        }\n\n        const cloneLink = $(\"<div>\")\n            .addClass(\"dropdown-header\")\n            .append(\n                $('<button class=\"btn btn-sm\">')\n                    .text('Clone note to new location...')\n                    .on('click', () => import(\"../dialogs/clone_to.js\").then(d => d.showDialog([this.noteId])))\n            );\n\n        this.$notePathList.append(cloneLink);\n    }\n\n    async addPath(notePath, isCurrent) {\n        const title = await treeService.getNotePathTitle(notePath);\n\n        const noteLink = await linkService.createNoteLink(notePath, {title});\n\n        noteLink\n            .addClass(\"dropdown-item\");\n\n        noteLink\n            .find('a')\n            .addClass(\"no-tooltip-preview\");\n\n        if (isCurrent) {\n            noteLink.addClass(\"current\");\n        }\n\n        this.$notePathList.append(noteLink);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranches().find(branch => branch.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport utils from \"../services/utils.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport server from \"../services/server.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\n\nconst TPL = `\n<div class=\"note-title-container\">\n    <style>\n    .note-title-container {\n        flex-grow: 100;\n    }\n    \n    .note-title-container input.note-title {\n        font-size: 150%;\n        border: 0;\n        min-width: 5em;\n        width: 100%;\n    }\n    \n    .note-title-container input.note-title.protected {\n        text-shadow: 4px 4px 4px var(--muted-text-color);\n    }\n    </style>\n\n    <input autocomplete=\"off\" value=\"\" class=\"note-title\" tabindex=\"1\">\n</div>`;\n\nexport default class NoteTitleWidget extends TabAwareWidget {\n    constructor() {\n        super();\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const title = this.$noteTitle.val();\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n            await server.put(`notes/${this.noteId}/change-title`, {title});\n        });\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteTitle = this.$widget.find(\".note-title\");\n\n        this.$noteTitle.on('input', () => this.spacedUpdate.scheduleUpdate());\n\n        utils.bindElShortcut(this.$noteTitle, 'return', () => {\n            this.triggerCommand('focusOnDetail', {tabId: this.tabContext.tabId});\n        });\n\n        return this.$widget;\n    }\n\n    async refreshWithNote(note) {\n        this.$noteTitle.val(note.title);\n\n        this.$noteTitle.prop(\"readonly\", note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable());\n\n        this.setProtectedStatus(note);\n    }\n\n    setProtectedStatus(note) {\n        this.$noteTitle.toggleClass(\"protected\", !!note.isProtected);\n    }\n\n    async beforeNoteSwitchEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeTabRemoveEvent({tabId}) {\n        if (this.isTab(tabId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    focusOnTitleEvent() {\n        if (this.tabContext && this.tabContext.isActive()) {\n            this.$noteTitle.trigger('focus');\n        }\n    }\n\n    focusAndSelectTitleEvent() {\n        if (this.tabContext && this.tabContext.isActive()) {\n            this.$noteTitle\n                .trigger('focus')\n                .trigger('select');\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            // not updating the title specifically since the synced title might be older than what the user is currently typing\n            this.setProtectedStatus(this.note);\n        }\n    }\n\n    beforeUnloadEvent() {\n        this.spacedUpdate.updateNowIfNecessary();\n    }\n}\n","import TabAwareWidget from \"./tab_aware_widget.js\";\n\nconst TPL = `\n<div style=\"display: inline-flex;\">\n    <button class=\"btn btn-sm icon-button bx bx-play-circle render-button\"\n            data-trigger-command=\"renderActiveNote\"\n            title=\"Render\"></button>\n    \n    <button class=\"btn btn-sm icon-button bx bx-play-circle execute-script-button\"\n            data-trigger-command=\"runActiveNote\"\n            title=\"Execute\"></button>\n</div>`;\n\nexport default class RunScriptButtonsWidget extends TabAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$renderButton = this.$widget.find('.render-button');\n        this.$executeScriptButton = this.$widget.find('.execute-script-button');\n\n        return this.$widget;\n    }\n\n    refreshWithNote(note) {\n        this.$renderButton.toggle(note.type === 'render');\n        this.$executeScriptButton.toggle(note.type === 'code' && note.mime.startsWith('application/javascript'));\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}","import server from '../services/server.js';\nimport mimeTypesService from '../services/mime_types.js';\nimport TabAwareWidget from \"./tab_aware_widget.js\";\n\nconst NOTE_TYPES = [\n    { type: \"file\", title: \"File\", selectable: false },\n    { type: \"image\", title: \"Image\", selectable: false },\n    { type: \"search\", title: \"Saved search\", selectable: false },\n\n    { type: \"text\", mime: \"text/html\", title: \"Text\", selectable: true },\n    { type: \"relation-map\", mime: \"application/json\", title: \"Relation Map\", selectable: true },\n    { type: \"render\", mime: '', title: \"Render Note\", selectable: true },\n    { type: \"book\", mime: '', title: \"Book\", selectable: true },\n    { type: \"code\", mime: 'text/plain', title: \"Code\", selectable: true }\n];\n\nconst TPL = `\n<div class=\"dropdown note-type\">\n    <style>\n    .note-type-dropdown {\n        max-height: 500px;\n        overflow-y: auto;\n        overflow-x: hidden;\n    }\n    </style>\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"btn btn-sm dropdown-toggle note-type-button\">\n        Type: <span class=\"note-type-desc\"></span>\n        <span class=\"caret\"></span>\n    </button>\n    <div class=\"note-type-dropdown dropdown-menu dropdown-menu-right\"></div>\n</div>\n`;\n\nexport default class NoteTypeWidget extends TabAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.on('show.bs.dropdown', () => this.renderDropdown());\n\n        this.$noteTypeDropdown = this.$widget.find(\".note-type-dropdown\");\n        this.$noteTypeButton = this.$widget.find(\".note-type-button\");\n        this.$noteTypeDesc = this.$widget.find(\".note-type-desc\");\n\n        return this.$widget;\n    }\n\n    async refreshWithNote(note) {\n        this.$noteTypeButton.prop(\"disabled\",\n            () => [\"file\", \"image\", \"search\"].includes(note.type));\n\n        this.$noteTypeDesc.text(await this.findTypeTitle(note.type, note.mime));\n    }\n\n    /** actual body is rendered lazily on note-type button click */\n    async renderDropdown() {\n        this.$noteTypeDropdown.empty();\n\n        for (const noteType of NOTE_TYPES.filter(nt => nt.selectable)) {\n            const $typeLink = $('<a class=\"dropdown-item\">')\n                .attr(\"data-note-type\", noteType.type)\n                .append('<span class=\"check\">&check;</span> ')\n                .append($('<strong>').text(noteType.title))\n                .on('click', e => {\n                    const type = $typeLink.attr('data-note-type');\n                    const noteType = NOTE_TYPES.find(nt => nt.type === type);\n\n                    this.save(noteType.type, noteType.mime);\n                });\n\n            if (this.note.type === noteType.type) {\n                $typeLink.addClass(\"selected\");\n            }\n\n            this.$noteTypeDropdown.append($typeLink);\n\n            if (noteType.type !== 'code') {\n                this.$noteTypeDropdown.append('<div class=\"dropdown-divider\"></div>');\n            }\n        }\n\n        for (const mimeType of await mimeTypesService.getMimeTypes()) {\n            if (!mimeType.enabled) {\n                continue;\n            }\n\n            const $mimeLink = $('<a class=\"dropdown-item\">')\n                .attr(\"data-mime-type\", mimeType.mime)\n                .append('<span class=\"check\">&check;</span> ')\n                .append($('<span>').text(mimeType.title))\n                .on('click', e => {\n                    const $link = $(e.target).closest('.dropdown-item');\n\n                    this.save('code', $link.attr('data-mime-type'))\n                });\n\n            if (this.note.type === 'code' && this.note.mime === mimeType.mime) {\n                $mimeLink.addClass(\"selected\");\n\n                this.$noteTypeDesc.text(mimeType.title);\n            }\n\n            this.$noteTypeDropdown.append($mimeLink);\n        }\n    }\n\n    async findTypeTitle(type, mime) {\n        if (type === 'code') {\n            const mimeTypes = await mimeTypesService.getMimeTypes();\n            const found = mimeTypes.find(mt => mt.mime === mime);\n\n            return found ? found.title : mime;\n        }\n        else {\n            const noteType = NOTE_TYPES.find(nt => nt.type === type);\n\n            return noteType ? noteType.title : type;\n        }\n    }\n\n    async save(type, mime) {\n        if (type === this.note.type && mime === this.note.mime) {\n            return;\n        }\n\n        if (type !== this.note.type && !await this.confirmChangeIfContent()) {\n            return;\n        }\n\n        await server.put('notes/' + this.noteId\n            + '/type/' + encodeURIComponent(type)\n            + '/mime/' + encodeURIComponent(mime));\n    }\n\n    async confirmChangeIfContent() {\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        if (!noteComplement.content || !noteComplement.content.trim().length) {\n            return true;\n        }\n\n        const confirmDialog = await import(\"../dialogs/confirm.js\");\n        return await confirmDialog.confirm(\"It is not recommended to change note type when note content is not empty. Do you want to continue anyway?\");\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId, this.componentId)) {\n            this.refresh();\n        }\n    }\n}","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\n\nconst TPL = `\n<div class=\"dropdown note-actions\">\n    <style>\n    .note-actions .dropdown-menu {\n        width: 15em;\n    }\n    \n    .note-actions .dropdown-item[disabled], .note-actions .dropdown-item[disabled]:hover {\n        color: var(--muted-text-color) !important;\n        background-color: transparent !important;\n        pointer-events: none; /* makes it unclickable */\n    }\n    \n    /* The switch - the box around the slider */\n    .switch {\n        position: relative;\n        display: inline-block;\n        width: 50px;\n        height: 24px;\n        float: right;\n    }\n    \n    /* The slider */\n    .slider {\n        border-radius: 24px;\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: var(--more-accented-background-color);\n        transition: .4s;\n    }\n    \n    .slider:before {\n        border-radius: 50%;\n        position: absolute;\n        content: \"\";\n        height: 16px;\n        width: 16px;\n        left: 4px;\n        bottom: 4px;\n        background-color: var(--main-background-color);\n        -webkit-transition: .4s;\n        transition: .4s;\n    }\n    \n    .slider.checked {\n        background-color: var(--main-text-color);\n    }\n    \n    .slider.checked:before {\n        transform: translateX(26px);\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"btn btn-sm dropdown-toggle\">\n        Note actions\n        <span class=\"caret\"></span>\n    </button>\n    <div class=\"dropdown-menu dropdown-menu-right\">\n        <div class=\"dropdown-item protect-button\">\n            Protect the note\n        \n            <span title=\"Note is not protected, click to make it protected\">\n                <label class=\"switch\">\n                <span class=\"slider\"></span>\n            </span>\n        </div>\n        <div class=\"dropdown-item unprotect-button\">\n            Unprotect the note\n        \n            <span title=\"Note is protected, click to make it unprotected\">\n                <label class=\"switch\">\n                <span class=\"slider checked\"></span>\n            </span>\n        </div>\n        <a data-trigger-command=\"showNoteRevisions\" class=\"dropdown-item show-note-revisions-button\">Revisions</a>\n        <a data-trigger-command=\"showAttributes\" class=\"dropdown-item show-attributes-button\"><kbd data-command=\"showAttributes\"></kbd> Attributes</a>\n        <a data-trigger-command=\"showLinkMap\" class=\"dropdown-item show-link-map-button\"><kbd data-command=\"showLinkMap\"></kbd> Link map</a>\n        <a data-trigger-command=\"showNoteSource\" class=\"dropdown-item show-source-button\"><kbd data-command=\"showNoteSource\"></kbd> Note source</a>\n        <a class=\"dropdown-item import-files-button\">Import files</a>\n        <a class=\"dropdown-item export-note-button\">Export note</a>\n        <a data-trigger-command=\"printActiveNote\" class=\"dropdown-item print-note-button\"><kbd data-command=\"printActiveNote\"></kbd> Print note</a>\n        <a data-trigger-command=\"showNoteInfo\" class=\"dropdown-item show-note-info-button\"><kbd data-command=\"showNoteInfo\"></kbd> Note info</a>\n    </div>\n</div>`;\n\nexport default class NoteActionsWidget extends TabAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$showSourceButton = this.$widget.find('.show-source-button');\n\n        this.$exportNoteButton = this.$widget.find('.export-note-button');\n        this.$exportNoteButton.on(\"click\", () => {\n            if (this.$exportNoteButton.hasClass(\"disabled\")) {\n                return;\n            }\n\n            import('../dialogs/export.js').then(d => d.showDialog(this.tabContext.notePath, 'single'));\n        });\n\n        this.$importNoteButton = this.$widget.find('.import-files-button');\n        this.$importNoteButton.on(\"click\", () => import('../dialogs/import.js').then(d => d.showDialog(this.noteId)));\n\n        this.$protectButton = this.$widget.find(\".protect-button\");\n        this.$protectButton.on('click', () => protectedSessionService.protectNote(this.noteId, true, false));\n\n        this.$unprotectButton = this.$widget.find(\".unprotect-button\");\n        this.$unprotectButton.on('click', () => protectedSessionService.protectNote(this.noteId, false, false));\n\n        return this.$widget;\n    }\n\n    refreshWithNote(note) {\n        if (['text', 'relation-map', 'search', 'code'].includes(note.type)) {\n            this.$showSourceButton.removeAttr('disabled');\n        } else {\n            this.$showSourceButton.attr('disabled', 'disabled');\n        }\n\n        if (note.type === 'text') {\n            this.$exportNoteButton.removeAttr('disabled');\n        }\n        else {\n            this.$exportNoteButton.attr('disabled', 'disabled');\n        }\n\n        this.$protectButton.toggle(!note.isProtected);\n        this.$unprotectButton.toggle(!!note.isProtected);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}","import server from \"../services/server.js\";\nimport ws from \"../services/ws.js\";\nimport treeService from \"../services/tree.js\";\nimport noteAutocompleteService from \"../services/note_autocomplete.js\";\nimport TabAwareWidget from \"./tab_aware_widget.js\";\n\nconst TPL = `\n<div class=\"promoted-attributes-wrapper\">\n    <style>\n    .promoted-attributes-wrapper {\n        margin: auto;\n        /* setting the display to block since \"table\" doesn't support scrolling */\n        display: block;\n        /** flex-basis: content; - use once \"content\" is implemented by chrome */\n        flex-shrink: 0;\n        flex-grow: 0;\n        overflow: auto;\n    }\n    \n    .promoted-attributes td, .promoted-attributes th {\n        padding: 5px;\n        min-width: 50px; /* otherwise checkboxes can collapse into 0 width (if there are only checkboxes) */\n    }\n    </style>\n    \n    <table class=\"promoted-attributes\"></table>\n</div>\n`;\n\nexport default class PromotedAttributesWidget extends TabAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$container = this.$widget.find(\".promoted-attributes\");\n\n        return this.$widget;\n    }\n\n    async refreshWithNote(note) {\n        this.$container.empty();\n\n        const attributes = note.getAttributes();\n\n        const promoted = attributes\n            .filter(attr => attr.type === 'label-definition' || attr.type === 'relation-definition')\n            .filter(attr => !attr.name.startsWith(\"child:\"))\n            .filter(attr => {\n                const json = attr.jsonValue;\n\n                return json && json.isPromoted;\n            });\n\n        const hidePromotedAttributes = attributes.some(attr => attr.type === 'label' && attr.name === 'hidePromotedAttributes');\n\n        if (promoted.length > 0 && !hidePromotedAttributes) {\n            const $tbody = $(\"<tbody>\");\n\n            for (const definitionAttr of promoted) {\n                const definitionType = definitionAttr.type;\n                const valueType = definitionType.substr(0, definitionType.length - 11);\n\n                let valueAttrs = attributes.filter(el => el.name === definitionAttr.name && el.type === valueType);\n\n                if (valueAttrs.length === 0) {\n                    valueAttrs.push({\n                        attributeId: \"\",\n                        type: valueType,\n                        name: definitionAttr.name,\n                        value: \"\"\n                    });\n                }\n\n                if (definitionAttr.value.multiplicityType === 'singlevalue') {\n                    valueAttrs = valueAttrs.slice(0, 1);\n                }\n\n                for (const valueAttr of valueAttrs) {\n                    const $tr = await this.createPromotedAttributeRow(definitionAttr, valueAttr);\n\n                    $tbody.append($tr);\n                }\n            }\n\n            // we replace the whole content in one step so there can't be any race conditions\n            // (previously we saw promoted attributes doubling)\n            this.$container.empty().append($tbody);\n            this.toggleInt(true);\n        }\n        else {\n            this.toggleInt(false);\n        }\n\n        return attributes;\n    }\n\n    async createPromotedAttributeRow(definitionAttr, valueAttr) {\n        const definition = definitionAttr.jsonValue;\n        const $tr = $(\"<tr>\");\n        const $labelCell = $(\"<th>\").append(valueAttr.name);\n        const $input = $(\"<input>\")\n            .prop(\"tabindex\", definitionAttr.position)\n            .prop(\"attribute-id\", valueAttr.noteId === this.noteId ? valueAttr.attributeId : '') // if not owned, we'll force creation of a new attribute instead of updating the inherited one\n            .prop(\"attribute-type\", valueAttr.type)\n            .prop(\"attribute-name\", valueAttr.name)\n            .prop(\"value\", valueAttr.value)\n            .addClass(\"form-control\")\n            .addClass(\"promoted-attribute-input\")\n            .on('change', event => this.promotedAttributeChanged(event));\n\n        const $inputCell = $(\"<td>\").append($(\"<div>\").addClass(\"input-group\").append($input));\n\n        const $actionCell = $(\"<td>\");\n        const $multiplicityCell = $(\"<td>\")\n            .addClass(\"multiplicity\")\n            .attr(\"nowrap\", true);\n\n        $tr\n            .append($labelCell)\n            .append($inputCell)\n            .append($actionCell)\n            .append($multiplicityCell);\n\n        if (valueAttr.type === 'label') {\n            if (definition.labelType === 'text') {\n                $input.prop(\"type\", \"text\");\n\n                // no need to await for this, can be done asynchronously\n                server.get('attributes/values/' + encodeURIComponent(valueAttr.name)).then(attributeValues => {\n                    if (attributeValues.length === 0) {\n                        return;\n                    }\n\n                    attributeValues = attributeValues.map(attribute => ({ value: attribute }));\n\n                    $input.autocomplete({\n                        appendTo: document.querySelector('body'),\n                        hint: false,\n                        autoselect: false,\n                        openOnFocus: true,\n                        minLength: 0,\n                        tabAutocomplete: false\n                    }, [{\n                        displayKey: 'value',\n                        source: function (term, cb) {\n                            term = term.toLowerCase();\n\n                            const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n                            cb(filtered);\n                        }\n                    }]);\n\n                    $input.on('autocomplete:selected', e => this.promotedAttributeChanged(e))\n                });\n            }\n            else if (definition.labelType === 'number') {\n                $input.prop(\"type\", \"number\");\n\n                let step = 1;\n\n                for (let i = 0; i < (definition.numberPrecision || 0) && i < 10; i++) {\n                    step /= 10;\n                }\n\n                $input.prop(\"step\", step);\n            }\n            else if (definition.labelType === 'boolean') {\n                $input.prop(\"type\", \"checkbox\");\n\n                if (valueAttr.value === \"true\") {\n                    $input.prop(\"checked\", \"checked\");\n                }\n            }\n            else if (definition.labelType === 'date') {\n                $input.prop(\"type\", \"date\");\n            }\n            else if (definition.labelType === 'url') {\n                $input.prop(\"placeholder\", \"http://website...\");\n\n                const $openButton = $(\"<span>\")\n                    .addClass(\"input-group-text open-external-link-button bx bx-trending-up\")\n                    .prop(\"title\", \"Open external link\")\n                    .on('click', () => window.open($input.val(), '_blank'));\n\n                $input.after($(\"<div>\")\n                    .addClass(\"input-group-append\")\n                    .append($openButton));\n            }\n            else {\n                ws.logError(\"Unknown labelType=\" + definitionAttr.labelType);\n            }\n        }\n        else if (valueAttr.type === 'relation') {\n            if (valueAttr.value) {\n                $input.val(await treeService.getNoteTitle(valueAttr.value));\n            }\n\n            // no need to wait for this\n            noteAutocompleteService.initNoteAutocomplete($input);\n\n            $input.on('autocomplete:selected', (event, suggestion, dataset) => {\n                this.promotedAttributeChanged(event);\n            });\n\n            $input.setSelectedPath(valueAttr.value);\n        }\n        else {\n            ws.logError(\"Unknown attribute type=\" + valueAttr.type);\n            return;\n        }\n\n        if (definition.multiplicityType === \"multivalue\") {\n            const addButton = $(\"<span>\")\n                .addClass(\"bx bx-plus pointer\")\n                .prop(\"title\", \"Add new attribute\")\n                .on('click', async () => {\n                    const $new = await this.createPromotedAttributeRow(definitionAttr, {\n                        attributeId: \"\",\n                        type: valueAttr.type,\n                        name: definitionAttr.name,\n                        value: \"\"\n                    });\n\n                    $tr.after($new);\n\n                    $new.find('input').trigger('focus');\n                });\n\n            const removeButton = $(\"<span>\")\n                .addClass(\"bx bx-trash pointer\")\n                .prop(\"title\", \"Remove this attribute\")\n                .on('click', async () => {\n                    if (valueAttr.attributeId) {\n                        await server.remove(\"notes/\" + this.noteId + \"/attributes/\" + valueAttr.attributeId, this.componentId);\n                    }\n\n                    $tr.remove();\n                });\n\n            $multiplicityCell.append(addButton).append(\" &nbsp;\").append(removeButton);\n        }\n\n        return $tr;\n    }\n\n    async promotedAttributeChanged(event) {\n        const $attr = $(event.target);\n\n        let value;\n\n        if ($attr.prop(\"type\") === \"checkbox\") {\n            value = $attr.is(':checked') ? \"true\" : \"false\";\n        }\n        else if ($attr.prop(\"attribute-type\") === \"relation\") {\n            const selectedPath = $attr.getSelectedPath();\n\n            value = selectedPath ? treeService.getNoteIdFromNotePath(selectedPath) : \"\";\n        }\n        else {\n            value = $attr.val();\n        }\n\n        const result = await server.put(`notes/${this.noteId}/attribute`, {\n            attributeId: $attr.prop(\"attribute-id\"),\n            type: $attr.prop(\"attribute-type\"),\n            name: $attr.prop(\"attribute-name\"),\n            value: value\n        }, this.componentId);\n\n        $attr.prop(\"attribute-id\", result.attributeId);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributes(this.componentId).find(attr => attr.isAffecting(this.note))) {\n            this.refresh();\n        }\n    }\n}\n","import TabAwareWidget from \"../tab_aware_widget.js\";\n\nexport default class TypeWidget extends TabAwareWidget {\n    // for overriding\n    static getType() {}\n\n    /**\n     * @param {NoteShort} note\n     */\n    async doRefresh(note) {}\n\n    async refresh() {\n        const thisWidgetType = this.constructor.getType();\n        const noteWidgetType = await this.parent.getWidgetType();\n\n        if (thisWidgetType !== noteWidgetType) {\n            this.toggleInt(false);\n\n            this.cleanup();\n        }\n        else {\n            this.toggleInt(true);\n\n            await this.doRefresh(this.note);\n        }\n    }\n\n    isActive() {\n        return this.$widget.is(\":visible\");\n    }\n\n    getContent() {}\n\n    focus() {}\n\n    scrollToTop() {\n        this.$widget.scrollTop(0);\n    }\n\n    autoBookDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n\n    textPreviewDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n\n    codePreviewDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n}","import server from \"./server.js\";\nimport bundleService from \"./bundle.js\";\n\nasync function render(note, $el) {\n    const relations = note.getRelations('renderNote');\n    const renderNoteIds = relations\n        .map(rel => rel.value)\n        .filter(noteId => noteId);\n\n    $el.empty().toggle(renderNoteIds.length > 0);\n\n    for (const renderNoteId of renderNoteIds) {\n        const bundle = await server.get('script/bundle/' + renderNoteId);\n\n        const $scriptContainer = $('<div>');\n        $el.append($scriptContainer);\n\n        $scriptContainer.append(bundle.html);\n\n        // async so that scripts cannot block trilium execution\n        bundleService.executeBundle(bundle, note, $scriptContainer);\n    }\n\n    return renderNoteIds.length > 0;\n}\n\nexport default {\n    render\n}","import server from \"./server.js\";\nimport utils from \"./utils.js\";\nimport renderService from \"./render.js\";\nimport protectedSessionService from \"./protected_session.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\n\nasync function getRenderedContent(note) {\n    const type = getRenderingType(note);\n\n    let $rendered;\n\n    if (type === 'text') {\n        const fullNote = await server.get('notes/' + note.noteId);\n\n        $rendered = $('<div class=\"ck-content\">').html(fullNote.content);\n    }\n    else if (type === 'code') {\n        const fullNote = await server.get('notes/' + note.noteId);\n\n        $rendered = $(\"<pre>\").text(fullNote.content);\n    }\n    else if (type === 'image') {\n        $rendered = $(\"<img>\")\n            .attr(\"src\", `api/images/${note.noteId}/${note.title}`)\n            .css(\"max-width\", \"100%\");\n    }\n    else if (type === 'file') {\n        function getFileUrl() {\n            return utils.getUrlForDownload(\"api/notes/\" + note.noteId + \"/download\");\n        }\n\n        const $downloadButton = $('<button class=\"file-download btn btn-primary\" type=\"button\">Download</button>');\n        const $openButton = $('<button class=\"file-open btn btn-primary\" type=\"button\">Open</button>');\n\n        $downloadButton.on('click', () => utils.download(getFileUrl()));\n        $openButton.on('click', () => {\n            if (utils.isElectron()) {\n                const open = utils.dynamicRequire(\"open\");\n\n                open(getFileUrl(), {url: true});\n            }\n            else {\n                window.location.href = getFileUrl();\n            }\n        });\n\n        // open doesn't work for protected notes since it works through browser which isn't in protected session\n        $openButton.toggle(!note.isProtected);\n\n        $rendered = $('<div>');\n\n        if (note.mime === 'application/pdf' && utils.isElectron()) {\n            const $pdfPreview = $('<iframe class=\"pdf-preview\" style=\"width: 100%; height: 100%; flex-grow: 100;\"></iframe>');\n            $pdfPreview.attr(\"src\", utils.getUrlForDownload(\"api/notes/\" + note.noteId + \"/open\"));\n\n            $rendered.append($pdfPreview);\n        }\n\n        $rendered\n            .append($downloadButton)\n            .append(' &nbsp; ')\n            .append($openButton);\n    }\n    else if (type === 'render') {\n        $rendered = $('<div>');\n\n        await renderService.render(note, $rendered, this.ctx);\n    }\n    else if (type === 'protected-session') {\n        const $button = $(`<button class=\"btn btn-sm\"><span class=\"bx bx-log-in\"></span> Enter protected session</button>`)\n            .on('click', protectedSessionService.enterProtectedSession);\n\n        $rendered = $(\"<div>\")\n            .append(\"<div>This note is protected and to access it you need to enter password.</div>\")\n            .append(\"<br/>\")\n            .append($button);\n    }\n    else {\n        $rendered = $(\"<em>Content of this note cannot be displayed in the book format</em>\");\n    }\n\n    $rendered.addClass(note.getCssClass());\n\n    return {\n        renderedContent: $rendered,\n        type\n    };\n}\n\nfunction getRenderingType(note) {\n    let type = note.type;\n\n    if (note.isProtected) {\n        if (protectedSessionHolder.isProtectedSessionAvailable()) {\n            protectedSessionHolder.touchProtectedSession();\n        }\n        else {\n            type = 'protected-session';\n        }\n    }\n\n    return type;\n}\n\nexport default {\n    getRenderedContent\n};","import TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../services/app_context.js\";\nimport treeCache from \"../../services/tree_cache.js\";\nimport linkService from \"../../services/link.js\";\nimport noteContentRenderer from \"../../services/note_content_renderer.js\";\n\nexport default class AbstractTextTypeWidget extends TypeWidget {\n    doRender() {\n        this.$widget.on(\"dblclick\", \"img\", e => {\n            const $img = $(e.target);\n            const src = $img.prop(\"src\");\n\n            const match = src.match(/\\/api\\/images\\/([A-Za-z0-9]+)\\//);\n\n            if (match) {\n                const noteId = match[1];\n\n                appContext.tabManager.getActiveTabContext().setNote(noteId);\n            }\n            else {\n                window.open(src, '_blank');\n            }\n        });\n    }\n\n    async loadIncludedNote(noteId, $el) {\n        const note = await treeCache.getNote(noteId);\n\n        if (note) {\n            const $link = await linkService.createNoteLink(note.noteId, {\n                showTooltip: false\n            });\n\n            $el.empty().append(\n                $('<h4 class=\"include-note-title\">')\n                    .append($link)\n            );\n\n            const {renderedContent} = await noteContentRenderer.getRenderedContent(note);\n\n            $el.append(\n                $('<div class=\"include-note-content\">')\n                    .append(renderedContent)\n            );\n        }\n    }\n\n    async loadReferenceLinkTitle(noteId, $el) {\n        const note = await treeCache.getNote(noteId, true);\n\n        let title;\n\n        if (!note) {\n            title = '[missing]';\n        }\n        else if (!note.isDeleted) {\n            title = note.title;\n        }\n        else {\n            title = note.isErased ? '[erased]' : `${note.title} (deleted)`;\n        }\n\n        $el.text(title);\n    }\n\n    refreshIncludedNote($container, noteId) {\n        if ($container) {\n            $container.find(`section[data-note-id=\"${noteId}\"]`).each((_, el) => {\n                this.loadIncludedNote(noteId, $(el));\n            });\n        }\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport noteAutocompleteService from '../../services/note_autocomplete.js';\nimport mimeTypesService from '../../services/mime_types.js';\nimport utils from \"../../services/utils.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\nimport treeCache from \"../../services/tree_cache.js\";\nimport AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\n\nconst ENABLE_INSPECTOR = false;\n\nconst mentionSetup = {\n    feeds: [\n        {\n            marker: '@',\n            feed: queryText => {\n                return new Promise((res, rej) => {\n                    noteAutocompleteService.autocompleteSource(queryText, rows => {\n                        if (rows.length === 1 && rows[0].title === 'No results') {\n                            rows = [];\n                        }\n\n                        for (const row of rows) {\n                            row.text = row.name = row.noteTitle;\n                            row.id = '@' + row.text;\n                            row.link = '#' + row.path;\n                            row.notePath = row.path;\n                        }\n\n                        res(rows);\n                    });\n                });\n            },\n            itemRenderer: item => {\n                const itemElement = document.createElement('span');\n\n                itemElement.classList.add('mentions-item');\n                itemElement.innerHTML = `${item.highlightedTitle} `;\n\n                return itemElement;\n            },\n            minimumCharacters: 0\n        }\n    ]\n};\n\nconst TPL = `\n<div class=\"note-detail-text note-detail-printable\">\n    <style>\n    .note-detail-text h1 { font-size: 2.0em; }\n    .note-detail-text h2 { font-size: 1.8em; }\n    .note-detail-text h3 { font-size: 1.6em; }\n    .note-detail-text h4 { font-size: 1.4em; }\n    .note-detail-text h5 { font-size: 1.2em; }\n    .note-detail-text h6 { font-size: 1.1em; }\n    \n    .note-detail-text {\n        overflow: auto;\n        height: 100%;\n        font-family: var(--detail-text-font-family);\n        padding-left: 12px;\n    }\n    \n    .note-detail-text-editor {\n        padding-top: 10px;\n        border: 0 !important;\n        box-shadow: none !important;\n        /* This is because with empty content height of editor is 0 and it's impossible to click into it */\n        min-height: 500px;\n    }\n    \n    .note-detail-text p:first-child, .note-detail-text::before {\n        margin-top: 0;\n    }\n    </style>\n\n    <div class=\"note-detail-text-editor\" tabindex=\"10000\"></div>\n</div>\n`;\n\nexport default class EditableTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"editable-text\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-text-editor');\n\n        this.initialized = this.initEditor();\n\n        keyboardActionService.setupActionsForElement('text-detail', this.$widget, this);\n\n        super.doRender();\n\n        return this.$widget;\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        const codeBlockLanguages =\n            (await mimeTypesService.getMimeTypes())\n                .filter(mt => mt.enabled)\n                .map(mt => ({\n                        language: mt.mime.toLowerCase().replace(/[\\W_]+/g,\"-\"),\n                        label: mt.title\n                    }));\n\n        // CKEditor since version 12 needs the element to be visible before initialization. At the same time\n        // we want to avoid flicker - i.e. show editor only once everything is ready. That's why we have separate\n        // display of $widget in both branches.\n        this.$widget.show();\n\n        this.textEditor = await BalloonEditor.create(this.$editor[0], {\n            placeholder: \"Type the content of your note here ...\",\n            mention: mentionSetup,\n            codeBlock: {\n                languages: codeBlockLanguages\n            }\n        });\n\n        this.textEditor.model.document.on('change:data', () => this.spacedUpdate.scheduleUpdate());\n\n        if (glob.isDev && ENABLE_INSPECTOR) {\n            await import(/* webpackIgnore: true */'../../../libraries/ckeditor/inspector.js');\n            CKEditorInspector.attach(this.textEditor);\n        }\n    }\n\n    async doRefresh(note) {\n        const noteComplement = await treeCache.getNoteComplement(note.noteId);\n\n        await this.spacedUpdate.allowUpdateWithoutChange(() => {\n            this.textEditor.setData(noteComplement.content);\n        });\n    }\n\n    getContent() {\n        const content = this.textEditor.getData();\n\n        // if content is only tags/whitespace (typically <p>&nbsp;</p>), then just make it empty\n        // this is important when setting new note to code\n        return utils.isHtmlEmpty(content) ? '' : content;\n    }\n\n    focus() {\n        this.$editor.trigger('focus');\n    }\n\n    show() {}\n\n    getEditor() {\n        return this.textEditor;\n    }\n\n    cleanup() {\n        if (this.textEditor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.textEditor.setData('');\n            });\n        }\n    }\n\n    insertDateTimeToTextCommand() {\n        const date = new Date();\n        const dateString = utils.formatDateTime(date);\n\n        this.addTextToEditor(dateString);\n    }\n\n    async addLinkToEditor(linkHref, linkTitle) {\n        await this.initialized;\n\n        this.textEditor.model.change(writer => {\n            const insertPosition = this.textEditor.model.document.selection.getFirstPosition();\n            writer.insertText(linkTitle, {linkHref: linkHref}, insertPosition);\n        });\n    }\n\n    async addTextToEditor(text) {\n        await this.initialized;\n\n        this.textEditor.model.change(writer => {\n            const insertPosition = this.textEditor.model.document.selection.getFirstPosition();\n            writer.insertText(text, insertPosition);\n        });\n    }\n\n    addTextToActiveEditorEvent(text) {\n        if (!this.isActive()) {\n            return;\n        }\n\n        this.addTextToEditor(text);\n    }\n\n    async addLink(notePath, linkTitle) {\n        await this.initialized;\n\n        if (linkTitle) {\n            if (this.hasSelection()) {\n                this.textEditor.execute('link', '#' + notePath);\n            } else {\n                await this.addLinkToEditor('#' + notePath, linkTitle);\n            }\n        }\n        else {\n            this.textEditor.execute('referenceLink', { notePath: notePath });\n        }\n\n        this.textEditor.editing.view.focus();\n    }\n\n    // returns true if user selected some text, false if there's no selection\n    hasSelection() {\n        const model = this.textEditor.model;\n        const selection = model.document.selection;\n\n        return !selection.isCollapsed;\n    }\n\n    async executeInActiveEditorEvent({callback}) {\n        if (!this.isActive()) {\n            return;\n        }\n\n        await this.initialized;\n\n        callback(this.textEditor);\n    }\n\n    addLinkToTextCommand() {\n        import(\"../../dialogs/add_link.js\").then(d => d.showDialog(this));\n    }\n\n    addIncludeNoteToTextCommand() {\n        import(\"../../dialogs/include_note.js\").then(d => d.showDialog(this));\n    }\n\n    addIncludeNote(noteId, boxSize) {\n        this.textEditor.model.change( writer => {\n            // Insert <includeNote>*</includeNote> at the current selection position\n            // in a way that will result in creating a valid model structure\n            this.textEditor.model.insertContent(writer.createElement('includeNote', {\n                noteId: noteId,\n                boxSize: boxSize\n            }));\n        } );\n    }\n\n    async addImage(noteId) {\n        const note = await treeCache.getNote(noteId);\n\n        this.textEditor.model.change( writer => {\n            const src = `api/images/${note.noteId}/${note.title}`;\n\n            const imageElement = writer.createElement( 'image',  { 'src': src } );\n\n            this.textEditor.model.insertContent(imageElement, this.textEditor.model.document.selection);\n        } );\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$editor, noteId);\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport toastService from \"../../services/toast.js\";\nimport server from \"../../services/server.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-image note-detail-printable\">\n    <div class=\"no-print\" style=\"display: flex; justify-content: space-evenly; margin: 10px;\">\n        <button class=\"image-download btn btn-sm btn-primary\" type=\"button\">Download</button>\n\n        <button class=\"image-copy-to-clipboard btn btn-sm btn-primary\" type=\"button\">Copy to clipboard</button>\n\n        <button class=\"image-upload-new-revision btn btn-sm btn-primary\" type=\"button\">Upload new revision</button>\n    </div>\n\n    <div class=\"note-detail-image-wrapper\">\n        <img class=\"note-detail-image-view\" />\n    </div>\n\n    <div style=\"display: flex; justify-content: space-evenly; margin: 10px;\">\n        <span>\n            <strong>Original file name:</strong>\n            <span class=\"image-filename\"></span>\n        </span>\n\n        <span>\n            <strong>File type:</strong>\n            <span class=\"image-filetype\"></span>\n        </span>\n\n        <span>\n            <strong>File size:</strong>\n            <span class=\"image-filesize\"></span>\n        </span>\n    </div>\n\n    <input type=\"file\" class=\"image-upload-new-revision-input\" style=\"display: none\">\n</div>`;\n\nclass ImageTypeWidget extends TypeWidget {\n    static getType() { return \"image\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$imageWrapper = this.$widget.find('.note-detail-image-wrapper');\n        this.$imageView = this.$widget.find('.note-detail-image-view');\n        this.$copyToClipboardButton = this.$widget.find(\".image-copy-to-clipboard\");\n        this.$uploadNewRevisionButton = this.$widget.find(\".image-upload-new-revision\");\n        this.$uploadNewRevisionInput = this.$widget.find(\".image-upload-new-revision-input\");\n        this.$fileName = this.$widget.find(\".image-filename\");\n        this.$fileType = this.$widget.find(\".image-filetype\");\n        this.$fileSize = this.$widget.find(\".image-filesize\");\n\n        this.$imageDownloadButton = this.$widget.find(\".image-download\");\n        this.$imageDownloadButton.on('click', () => utils.download(this.getFileUrl()));\n\n        this.$copyToClipboardButton.on('click',() => {\n            this.$imageWrapper.attr('contenteditable','true');\n\n            try {\n                this.selectImage(this.$imageWrapper.get(0));\n\n                const success = document.execCommand('copy');\n\n                if (success) {\n                    toastService.showMessage(\"Image copied to the clipboard\");\n                }\n                else {\n                    toastService.showAndLogError(\"Could not copy the image to clipboard.\");\n                }\n            }\n            finally {\n                window.getSelection().removeAllRanges();\n                this.$imageWrapper.removeAttr('contenteditable');\n            }\n        });\n\n        this.$uploadNewRevisionButton.on(\"click\", () => {\n            this.$uploadNewRevisionInput.trigger(\"click\");\n        });\n\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const formData = new FormData();\n            formData.append('upload', fileToUpload);\n\n            const result = await $.ajax({\n                url: baseApiUrl + 'images/' + this.noteId,\n                headers: server.getHeaders(),\n                data: formData,\n                type: 'PUT',\n                timeout: 60 * 60 * 1000,\n                contentType: false, // NEEDED, DON'T REMOVE THIS\n                processData: false, // NEEDED, DON'T REMOVE THIS\n            });\n\n            if (result.uploaded) {\n                toastService.showMessage(\"New image revision has been uploaded.\");\n\n                await utils.clearBrowserCache();\n\n                this.refresh();\n            }\n            else {\n                toastService.showError(\"Upload of a new image revision failed: \" + result.message);\n            }\n        });\n\n        return this.$widget;\n    }\n\n    async doRefresh(note) {\n        const attributes = note.getAttributes();\n        const attributeMap = utils.toObject(attributes, l => [l.name, l.value]);\n\n        this.$widget.show();\n\n        this.$fileName.text(attributeMap.originalFileName || \"?\");\n        this.$fileSize.text(note.contentLength + \" bytes\");\n        this.$fileType.text(note.mime);\n\n        const imageHash = utils.randomString(10);\n\n        this.$imageView.prop(\"src\", `api/images/${note.noteId}/${note.title}?${imageHash}`);\n    }\n\n    selectImage(element) {\n        const selection = window.getSelection();\n        const range = document.createRange();\n        range.selectNodeContents(element);\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n\n    getFileUrl() {\n        return utils.getUrlForDownload(`api/notes/${this.noteId}/download`);\n    }\n}\n\nexport default ImageTypeWidget","import server from \"../../services/server.js\";\nimport linkService from \"../../services/link.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport contextMenu from \"../../services/context_menu.js\";\nimport toastService from \"../../services/toast.js\";\nimport attributeAutocompleteService from \"../../services/attribute_autocomplete.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../services/app_context.js\";\nimport utils from \"../../services/utils.js\";\n\nconst uniDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }]\n];\n\nconst biDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst inverseRelationsOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", location: 0.2, id: \"label-source\", cssClass: \"connection-label\" }],\n    [ \"Label\", { label: \"\", location: 0.8, id: \"label-target\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst linkOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ]\n];\n\nconst TPL = `\n<div class=\"note-detail-relation-map note-detail-printable\">\n    <button class=\"relation-map-create-child-note btn btn-sm floating-button no-print\" type=\"button\"\n            title=\"Create new child note and add it into this relation map\">\n        <span class=\"bx bx-folder-plus\"></span>\n\n        Create child note\n    </button>\n\n    <button type=\"button\"\n            class=\"relation-map-reset-pan-zoom btn icon-button floating-button bx bx-crop no-print\"\n            title=\"Reset pan & zoom to initial coordinates and magnification\"\n            style=\"right: 70px;\"></button>\n\n    <div class=\"btn-group floating-button no-print\" style=\"right: 10px;\">\n        <button type=\"button\"\n                class=\"relation-map-zoom-in btn icon-button bx bx-zoom-in\"\n                title=\"Zoom In\"></button>\n\n        <button type=\"button\"\n                class=\"relation-map-zoom-out btn icon-button bx bx-zoom-out\"\n                title=\"Zoom Out\"></button>\n    </div>\n\n    <div class=\"relation-map-wrapper\">\n       <div class=\"relation-map-container\"></div>\n    </div>\n</div>`;\n\nlet containerCounter = 1;\n\nexport default class RelationMapTypeWidget extends TypeWidget {\n    static getType() { return \"relation-map\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$relationMapContainer = this.$widget.find(\".relation-map-container\");\n        this.$createChildNote = this.$widget.find(\".relation-map-create-child-note\");\n        this.$zoomInButton = this.$widget.find(\".relation-map-zoom-in\");\n        this.$zoomOutButton = this.$widget.find(\".relation-map-zoom-out\");\n        this.$resetPanZoomButton = this.$widget.find(\".relation-map-reset-pan-zoom\");\n\n        this.mapData = null;\n        this.jsPlumbInstance = null;\n        // outside of mapData because they are not persisted in the note content\n        this.relations = null;\n        this.pzInstance = null;\n\n        this.$relationMapWrapper = this.$widget.find('.relation-map-wrapper');\n        this.$relationMapWrapper.on('click', event => {\n            if (this.clipboard) {\n                let {x, y} = this.getMousePosition(event);\n\n                // modifying position so that cursor is on the top-center of the box\n                x -= 80;\n                y -= 15;\n\n                this.createNoteBox(this.clipboard.noteId, this.clipboard.title, x, y);\n\n                this.mapData.notes.push({ noteId: this.clipboard.noteId, x, y });\n\n                this.saveData();\n\n                this.clipboard = null;\n            }\n\n            return true;\n        });\n\n        this.$relationMapContainer.attr(\"id\", \"relation-map-container-\" + (containerCounter++));\n        this.$relationMapContainer.on(\"contextmenu\", \".note-box\", e => {\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"Open in new tab\", command: \"openInNewTab\", uiIcon: \"empty\"},\n                    {title: \"Remove note\", command: \"remove\", uiIcon: \"trash\"},\n                    {title: \"Edit title\", command: \"editTitle\", uiIcon: \"pencil\"},\n                ],\n                selectMenuItemHandler: ({command}) => this.contextMenuHandler(command, e.target)\n            });\n\n            return false;\n        });\n\n        this.clipboard = null;\n\n        this.$createChildNote.on('click', async () => {\n            const promptDialog = await import('../../dialogs/prompt.js');\n            const title = await promptDialog.ask({ message: \"Enter title of new note\",  defaultValue: \"new note\" });\n\n            if (!title.trim()) {\n                return;\n            }\n\n            const {note} = await server.post(`notes/${this.noteId}/children?target=into`, {\n                title,\n                content: '',\n                type: 'text'\n            });\n\n            toastService.showMessage(\"Click on canvas to place new note\");\n\n            this.clipboard = { noteId: note.noteId, title };\n        });\n\n        this.$resetPanZoomButton.on('click', () => {\n            // reset to initial pan & zoom state\n            this.pzInstance.zoomTo(0, 0, 1 / this.getZoom());\n            this.pzInstance.moveTo(0, 0);\n        });\n\n        this.$widget.on(\"drop\", ev => this.dropNoteOntoRelationMapHandler(ev));\n        this.$widget.on(\"dragover\", ev => ev.preventDefault());\n\n        this.initialized = new Promise(async res => {\n            await libraryLoader.requireLibrary(libraryLoader.RELATION_MAP);\n\n            jsPlumb.ready(res);\n        });\n\n        return this.$widget;\n    }\n\n    async contextMenuHandler(command, originalTarget) {\n        const $noteBox = $(originalTarget).closest(\".note-box\");\n        const $title = $noteBox.find(\".title a\");\n        const noteId = this.idToNoteId($noteBox.prop(\"id\"));\n\n        if (command === \"openInNewTab\") {\n            appContext.tabManager.openTabWithNote(noteId);\n        }\n        else if (command === \"remove\") {\n            const confirmDialog = await import('../../dialogs/confirm.js');\n\n            if (!await confirmDialog.confirmDeleteNoteBoxWithNote($title.text())) {\n                return;\n            }\n\n            this.jsPlumbInstance.remove(this.noteIdToId(noteId));\n\n            if (confirmDialog.isDeleteNoteChecked()) {\n                const taskId = utils.randomString(10);\n\n                await server.remove(`notes/${noteId}?taskId=${taskId}&last=true`);\n            }\n\n            this.mapData.notes = this.mapData.notes.filter(note => note.noteId !== noteId);\n\n            this.relations = this.relations.filter(relation => relation.sourceNoteId !== noteId && relation.targetNoteId !== noteId);\n\n            this.saveData();\n        }\n        else if (command === \"editTitle\") {\n            const promptDialog = await import(\"../../dialogs/prompt.js\");\n            const title = await promptDialog.ask({\n                message: \"Enter new note title:\",\n                defaultValue: $title.text()\n            });\n\n            if (!title) {\n                return;\n            }\n\n            await server.put(`notes/${noteId}/change-title`, { title });\n\n            $title.text(title);\n        }\n    }\n\n    async loadMapData() {\n        this.mapData = {\n            notes: [],\n            // it is important to have this exact value here so that initial transform is same as this\n            // which will guarantee note won't be saved on first conversion to relation map note type\n            // this keeps the principle that note type change doesn't destroy note content unless user\n            // does some actual change\n            transform: {\n                x: 0,\n                y: 0,\n                scale: 1\n            }\n        };\n\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        if (noteComplement.content) {\n            try {\n                this.mapData = JSON.parse(noteComplement.content);\n            } catch (e) {\n                console.log(\"Could not parse content: \", e);\n            }\n        }\n    }\n\n    noteIdToId(noteId) {\n        return \"rel-map-note-\" + noteId;\n    }\n\n    idToNoteId(id) {\n        return id.substr(13);\n    }\n\n    async doRefresh(note) {\n        await this.loadMapData();\n\n        this.initJsPlumbInstance();\n\n        this.initPanZoom();\n\n        this.loadNotesAndRelations();\n    }\n\n    clearMap() {\n        // delete all endpoints and connections\n        // this is done at this point (after async operations) to reduce flicker to the minimum\n        this.jsPlumbInstance.deleteEveryEndpoint();\n\n        // without this we still end up with note boxes remaining in the canvas\n        this.$relationMapContainer.empty();\n    }\n\n    async loadNotesAndRelations() {\n        const noteIds = this.mapData.notes.map(note => note.noteId);\n        const data = await server.post(\"notes/relation-map\", {noteIds});\n\n        this.relations = [];\n\n        for (const relation of data.relations) {\n            const match = this.relations.find(rel =>\n                rel.name === data.inverseRelations[relation.name]\n                && ((rel.sourceNoteId === relation.sourceNoteId && rel.targetNoteId === relation.targetNoteId)\n                || (rel.sourceNoteId === relation.targetNoteId && rel.targetNoteId === relation.sourceNoteId)));\n\n            if (match) {\n                match.type = relation.type = relation.name === data.inverseRelations[relation.name] ? 'biDirectional' : 'inverse';\n                relation.render = false; // don't render second relation\n            } else {\n                relation.type = 'uniDirectional';\n                relation.render = true;\n            }\n\n            this.relations.push(relation);\n        }\n\n        this.mapData.notes = this.mapData.notes.filter(note => note.noteId in data.noteTitles);\n\n        this.jsPlumbInstance.batch(async () => {\n            this.clearMap();\n\n            for (const note of this.mapData.notes) {\n                const title = data.noteTitles[note.noteId];\n\n                await this.createNoteBox(note.noteId, title, note.x, note.y);\n            }\n\n            for (const relation of this.relations) {\n                if (!relation.render) {\n                    continue;\n                }\n\n                const connection = this.jsPlumbInstance.connect({\n                    source: this.noteIdToId(relation.sourceNoteId),\n                    target: this.noteIdToId(relation.targetNoteId),\n                    type: relation.type\n                });\n\n                connection.id = relation.attributeId;\n\n                if (relation.type === 'inverse') {\n                    connection.getOverlay(\"label-source\").setLabel(relation.name);\n                    connection.getOverlay(\"label-target\").setLabel(data.inverseRelations[relation.name]);\n                }\n                else {\n                    connection.getOverlay(\"label\").setLabel(relation.name);\n                }\n\n                connection.canvas.setAttribute(\"data-connection-id\", connection.id);\n            }\n        });\n    }\n\n    initPanZoom() {\n        if (this.pzInstance) {\n            return;\n        }\n\n        this.pzInstance = panzoom(this.$relationMapContainer[0], {\n            maxZoom: 2,\n            minZoom: 0.3,\n            smoothScroll: false,\n            filterKey: function(e, dx, dy, dz) {\n                // if ALT is pressed then panzoom should bubble the event up\n                // this is to preserve ALT-LEFT, ALT-RIGHT navigation working\n                return e.altKey;\n            }\n        });\n\n        this.pzInstance.on('transform', () => { // gets triggered on any transform change\n            this.jsPlumbInstance.setZoom(this.getZoom());\n\n            this.saveCurrentTransform();\n        });\n\n        if (this.mapData.transform) {\n            this.pzInstance.zoomTo(0, 0, this.mapData.transform.scale);\n\n            this.pzInstance.moveTo(this.mapData.transform.x, this.mapData.transform.y);\n        }\n        else {\n            // set to initial coordinates\n            this.pzInstance.moveTo(0, 0);\n        }\n\n        this.$zoomInButton.on('click', () => this.pzInstance.zoomTo(0, 0, 1.2));\n        this.$zoomOutButton.on('click', () => this.pzInstance.zoomTo(0, 0, 0.8));\n    }\n\n    saveCurrentTransform() {\n        const newTransform = this.pzInstance.getTransform();\n\n        if (JSON.stringify(newTransform) !== JSON.stringify(this.mapData.transform)) {\n            // clone transform object\n            this.mapData.transform = JSON.parse(JSON.stringify(newTransform));\n\n            this.saveData();\n        }\n    }\n\n    cleanup() {\n        if (this.jsPlumbInstance) {\n            this.clearMap();\n        }\n\n        if (this.pzInstance) {\n            this.pzInstance.dispose();\n            this.pzInstance = null;\n        }\n    }\n\n    initJsPlumbInstance () {\n        if (this.jsPlumbInstance) {\n            this.cleanup();\n\n            return;\n        }\n\n        this.jsPlumbInstance = jsPlumb.getInstance({\n            Endpoint: [\"Dot\", {radius: 2}],\n            Connector: \"StateMachine\",\n            ConnectionOverlays: uniDirectionalOverlays,\n            HoverPaintStyle: { stroke: \"#777\", strokeWidth: 1 },\n            Container: this.$relationMapContainer.attr(\"id\")\n        });\n\n        this.jsPlumbInstance.registerConnectionType(\"uniDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: uniDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"biDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: biDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"inverse\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: inverseRelationsOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"link\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: linkOverlays });\n\n        this.jsPlumbInstance.bind(\"connection\", (info, originalEvent) => this.connectionCreatedHandler(info, originalEvent));\n    }\n\n    async connectionCreatedHandler(info, originalEvent) {\n        const connection = info.connection;\n\n        connection.bind(\"contextmenu\", (obj, event) => {\n            if (connection.getType().includes(\"link\")) {\n                // don't create context menu if it's a link since there's nothing to do with link from relation map\n                // (don't open browser menu either)\n                event.preventDefault();\n            }\n            else {\n                event.preventDefault();\n                event.stopPropagation();\n\n                contextMenu.show({\n                    x: event.pageX,\n                    y: event.pageY,\n                    items: [ {title: \"Remove relation\", command: \"remove\", uiIcon: \"trash\"} ],\n                    selectMenuItemHandler: async ({command}) => {\n                        if (command === 'remove') {\n                            const confirmDialog = await import('../../dialogs/confirm.js');\n\n                            if (!await confirmDialog.confirm(\"Are you sure you want to remove the relation?\")) {\n                                return;\n                            }\n\n                            const relation = this.relations.find(rel => rel.attributeId === connection.id);\n\n                            await server.remove(`notes/${relation.sourceNoteId}/relations/${relation.name}/to/${relation.targetNoteId}`);\n\n                            this.jsPlumbInstance.deleteConnection(connection);\n\n                            this.relations = this.relations.filter(relation => relation.attributeId !== connection.id);\n                        }\n                    }\n                });\n            }\n        });\n\n        // if there's no event, then this has been triggered programatically\n        if (!originalEvent) {\n            return;\n        }\n\n        const promptDialog = await import(\"../../dialogs/prompt.js\");\n        const name = await promptDialog.ask({\n            message: \"Specify new relation name:\",\n            shown: ({ $answer }) =>\n                attributeAutocompleteService.initAttributeNameAutocomplete({\n                    $el: $answer,\n                    attributeType: \"relation\",\n                    open: true\n                })\n        });\n\n        if (!name || !name.trim()) {\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        const targetNoteId = this.idToNoteId(connection.target.id);\n        const sourceNoteId = this.idToNoteId(connection.source.id);\n\n        const relationExists = this.relations.some(rel =>\n            rel.targetNoteId === targetNoteId\n            && rel.sourceNoteId === sourceNoteId\n            && rel.name === name);\n\n        if (relationExists) {\n            const infoDialog = await import('../../dialogs/info.js');\n            await infoDialog.info(\"Connection '\" + name + \"' between these notes already exists.\");\n\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        await server.put(`notes/${sourceNoteId}/relations/${name}/to/${targetNoteId}`);\n\n        this.loadNotesAndRelations();\n    }\n\n    saveData() {\n        this.spacedUpdate.scheduleUpdate();\n    }\n\n    async createNoteBox(noteId, title, x, y) {\n        const $link = await linkService.createNoteLink(noteId, {title});\n        $link.mousedown(e => {\n            console.log(e);\n\n            linkService.goToLink(e);\n        });\n\n        const $noteBox = $(\"<div>\")\n            .addClass(\"note-box\")\n            .prop(\"id\", this.noteIdToId(noteId))\n            .append($(\"<span>\").addClass(\"title\").append($link))\n            .append($(\"<div>\").addClass(\"endpoint\").attr(\"title\", \"Start dragging relations from here and drop them on another note.\"))\n            .css(\"left\", x + \"px\")\n            .css(\"top\", y + \"px\");\n\n        this.jsPlumbInstance.getContainer().appendChild($noteBox[0]);\n\n        this.jsPlumbInstance.draggable($noteBox[0], {\n            start: params => {},\n            drag: params => {},\n            stop: params => {\n                const noteId = this.idToNoteId(params.el.id);\n\n                const note = this.mapData.notes.find(note => note.noteId === noteId);\n\n                if (!note) {\n                    console.error(`Note ${noteId} not found!`);\n                    return;\n                }\n\n                [note.x, note.y] = params.finalPos;\n\n                this.saveData();\n            }\n        });\n\n        this.jsPlumbInstance.makeSource($noteBox[0], {\n            filter: \".endpoint\",\n            anchor: \"Continuous\",\n            connectorStyle: { stroke: \"#000\", strokeWidth: 1 },\n            connectionType: \"basic\",\n            extract:{\n                \"action\": \"the-action\"\n            }\n        });\n\n        this.jsPlumbInstance.makeTarget($noteBox[0], {\n            dropOptions: { hoverClass: \"dragHover\" },\n            anchor: \"Continuous\",\n            allowLoopback: true\n        });\n    }\n\n    getZoom() {\n        const matrixRegex = /matrix\\((-?\\d*\\.?\\d+),\\s*0,\\s*0,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+\\)/;\n\n        const transform = this.$relationMapContainer.css('transform');\n\n        if (transform === 'none') {\n            return 1;\n        }\n\n        const matches = transform.match(matrixRegex);\n\n        if (!matches) {\n            throw new Error(\"Cannot match transform: \" + transform);\n        }\n\n        return matches[1];\n    }\n\n    async dropNoteOntoRelationMapHandler(ev) {\n        ev.preventDefault();\n\n        const notes = JSON.parse(ev.originalEvent.dataTransfer.getData(\"text\"));\n\n        let {x, y} = this.getMousePosition(ev);\n\n        for (const note of notes) {\n            const exists = this.mapData.notes.some(n => n.noteId === note.noteId);\n\n            if (exists) {\n                toastService.showError(`Note \"${note.title}\" is already in the diagram.`);\n\n                continue;\n            }\n\n            this.mapData.notes.push({noteId: note.noteId, x, y});\n\n            if (x > 1000) {\n                y += 100;\n                x = 0;\n            }\n            else {\n                x += 200;\n            }\n        }\n\n        this.saveData();\n\n        this.loadNotesAndRelations();\n    }\n\n    getMousePosition(evt) {\n        const rect = this.$relationMapContainer[0].getBoundingClientRect();\n\n        const zoom = this.getZoom();\n\n        return {\n            x: (evt.clientX - rect.left) / zoom,\n            y: (evt.clientY - rect.top) / zoom\n        };\n    }\n\n    getContent() {\n        return JSON.stringify(this.mapData);\n    }\n}","import linkService from \"../../services/link.js\";\nimport treeCache from \"../../services/tree_cache.js\";\nimport noteContentRenderer from \"../../services/note_content_renderer.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst MIN_ZOOM_LEVEL = 1;\nconst MAX_ZOOM_LEVEL = 6;\n\nconst ZOOMS = {\n    1: {\n        width: \"100%\",\n        height: \"100%\"\n    },\n    2: {\n        width: \"49%\",\n        height: \"350px\"\n    },\n    3: {\n        width: \"32%\",\n        height: \"250px\"\n    },\n    4: {\n        width: \"24%\",\n        height: \"200px\"\n    },\n    5: {\n        width: \"19%\",\n        height: \"175px\"\n    },\n    6: {\n        width: \"16%\",\n        height: \"150px\"\n    }\n};\n\nconst TPL = `\n<div class=\"note-detail-book note-detail-printable\">\n    <div class=\"btn-group floating-button\" style=\"right: 20px; top: 20px;\">\n        <button type=\"button\"\n                class=\"expand-children-button btn icon-button bx bx-move-vertical\"\n                title=\"Expand all children\"></button>\n\n        <button type=\"button\"\n                class=\"book-zoom-in-button btn icon-button bx bx-zoom-in\"\n                title=\"Zoom In\"></button>\n\n        <button type=\"button\"\n                class=\"book-zoom-out-button btn icon-button bx bx-zoom-out\"\n                title=\"Zoom Out\"></button>\n    </div>\n\n    <div class=\"note-detail-book-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        This note of type Book doesn't have any child notes so there's nothing to display. See <a href=\"https://github.com/zadam/trilium/wiki/Book-note\">wiki</a> for details.\n    </div>\n\n    <div class=\"note-detail-book-content\"></div>\n</div>`;\n\nexport default class BookTypeWidget extends TypeWidget {\n    static getType() { return \"book\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-book-content');\n        this.$zoomInButton = this.$widget.find('.book-zoom-in-button');\n        this.$zoomOutButton = this.$widget.find('.book-zoom-out-button');\n        this.$expandChildrenButton = this.$widget.find('.expand-children-button');\n        this.$help = this.$widget.find('.note-detail-book-help');\n\n        this.$zoomInButton.on('click', () => this.setZoom(this.zoomLevel - 1));\n        this.$zoomOutButton.on('click', () => this.setZoom(this.zoomLevel + 1));\n\n        this.$expandChildrenButton.on('click', async () => {\n            for (let i = 1; i < 30; i++) { // protection against infinite cycle\n                const $unexpandedLinks = this.$content.find('.note-book-open-children-button:visible');\n\n                if ($unexpandedLinks.length === 0) {\n                    break;\n                }\n\n                for (const link of $unexpandedLinks) {\n                    const $card = $(link).closest(\".note-book-card\");\n\n                    await this.expandCard($card);\n                }\n            }\n        });\n\n        this.$content.on('click', '.note-book-open-children-button', async ev => {\n            const $card = $(ev.target).closest('.note-book-card');\n\n            await this.expandCard($card);\n        });\n\n        this.$content.on('click', '.note-book-hide-children-button', async ev => {\n            const $card = $(ev.target).closest('.note-book-card');\n\n            $card.find('.note-book-open-children-button').show();\n            $card.find('.note-book-hide-children-button').hide();\n\n            $card.find('.note-book-children-content').empty();\n        });\n        \n        return this.$widget;\n    }\n\n    async expandCard($card) {\n        const noteId = $card.attr('data-note-id');\n        const note = await treeCache.getNote(noteId);\n\n        $card.find('.note-book-open-children-button').hide();\n        $card.find('.note-book-hide-children-button').show();\n\n        await this.renderIntoElement(note, $card.find('.note-book-children-content'));\n    }\n\n    setZoom(zoomLevel) {\n        if (!(zoomLevel in ZOOMS)) {\n            zoomLevel = this.getDefaultZoomLevel();\n        }\n\n        this.zoomLevel = zoomLevel;\n\n        this.$zoomInButton.prop(\"disabled\", zoomLevel === MIN_ZOOM_LEVEL);\n        this.$zoomOutButton.prop(\"disabled\", zoomLevel === MAX_ZOOM_LEVEL);\n\n        this.$content.find('.note-book-card').css(\"flex-basis\", ZOOMS[zoomLevel].width);\n        this.$content.find('.note-book-content').css(\"max-height\", ZOOMS[zoomLevel].height);\n    }\n\n    async doRefresh(note) {\n        this.$content.empty();\n        this.$help.hide();\n\n        if (this.isAutoBook()) {\n            const $addTextLink = $('<a href=\"javascript:\">here</a>').on('click', () => {\n                this.tabContext.autoBookDisabled = true;\n\n                this.triggerEvent('autoBookDisabled', {tabContext: this.tabContext});\n            });\n\n            this.$content.append($('<div class=\"note-book-auto-message\"></div>')\n                .append(`This note doesn't have any content so we display its children. <br> Click `)\n                .append($addTextLink)\n                .append(' if you want to add some text.'));\n        }\n\n        const zoomLevel = parseInt(note.getLabelValue('bookZoomLevel')) || this.getDefaultZoomLevel();\n        this.setZoom(zoomLevel);\n\n        await this.renderIntoElement(note, this.$content);\n    }\n\n    async renderIntoElement(note, $container) {\n        const childNotes = await note.getChildNotes();\n\n        if (childNotes.length === 0) {\n            this.$help.show();\n        }\n\n        const imageLinks = note.getRelations('imageLink');\n\n        for (const childNote of childNotes) {\n            // image is already visible in the parent note so no need to display it separately in the book\n            if (imageLinks.find(rel => rel.value === childNote.noteId)) {\n                continue;\n            }\n\n            const $card = await this.renderNote(childNote);\n\n            $container.append($card);\n        }\n    }\n\n    async renderNote(note) {\n        const notePath = this.notePath + '/' + note.noteId;\n\n        const $content = $('<div class=\"note-book-content\">')\n            .css(\"max-height\", ZOOMS[this.zoomLevel].height);\n\n        const $card = $('<div class=\"note-book-card\">')\n            .attr('data-note-id', note.noteId)\n            .css(\"flex-basis\", ZOOMS[this.zoomLevel].width)\n            .append($('<h5 class=\"note-book-title\">').append(await linkService.createNoteLink(notePath, {showTooltip: false})))\n            .append($content);\n\n        try {\n            const {type, renderedContent} = await noteContentRenderer.getRenderedContent(note);\n\n            $card.addClass(\"type-\" + type);\n            $content.append(renderedContent);\n        } catch (e) {\n            console.log(`Caught error while rendering note ${note.noteId} of type ${note.type}: ${e.message}, stack: ${e.stack}`);\n\n            $content.append(\"rendering error\");\n        }\n\n        const imageLinks = note.getRelations('imageLink');\n\n        const childCount = note.getChildNoteIds()\n            .filter(childNoteId => !imageLinks.find(rel => rel.value === childNoteId))\n            .length;\n\n        if (childCount > 0) {\n            const label = `${childCount} child${childCount > 1 ? 'ren' : ''}`;\n\n            $card.append($('<div class=\"note-book-children\">')\n                .append($(`<a class=\"note-book-open-children-button no-print\" href=\"javascript:\">+ Show ${label}</a>`))\n                .append($(`<a class=\"note-book-hide-children-button no-print\" href=\"javascript:\">- Hide ${label}</a>`).hide())\n                .append($('<div class=\"note-book-children-content\">'))\n            );\n        }\n\n        return $card;\n    }\n\n    /** @return {boolean} true if this is \"auto book\" activated (empty text note) and not explicit book note */\n    isAutoBook() {\n        return this.note.type !== 'book';\n    }\n\n    getDefaultZoomLevel() {\n        if (this.isAutoBook()) {\n            const w = this.$widget.width();\n\n            if (w <= 600) {\n                return 1;\n            } else if (w <= 900) {\n                return 2;\n            } else if (w <= 1300) {\n                return 3;\n            } else {\n                return 4;\n            }\n        }\n        else {\n            return 1;\n        }\n    }\n\n    cleanup() {\n        this.$content.empty();\n    }\n}","import TabAwareWidget from \"./tab_aware_widget.js\";\nimport utils from \"../services/utils.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport server from \"../services/server.js\";\nimport libraryLoader from \"../services/library_loader.js\";\nimport EmptyTypeWidget from \"./type_widgets/empty.js\";\nimport EditableTextTypeWidget from \"./type_widgets/editable_text.js\";\nimport EditableCodeTypeWidget from \"./type_widgets/editable_code.js\";\nimport FileTypeWidget from \"./type_widgets/file.js\";\nimport ImageTypeWidget from \"./type_widgets/image.js\";\nimport SearchTypeWidget from \"./type_widgets/search.js\";\nimport RenderTypeWidget from \"./type_widgets/render.js\";\nimport RelationMapTypeWidget from \"./type_widgets/relation_map.js\";\nimport ProtectedSessionTypeWidget from \"./type_widgets/protected_session.js\";\nimport BookTypeWidget from \"./type_widgets/book.js\";\nimport appContext from \"../services/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport DeletedTypeWidget from \"./type_widgets/deleted.js\";\nimport ReadOnlyTextTypeWidget from \"./type_widgets/read_only_text.js\";\nimport ReadOnlyCodeTypeWidget from \"./type_widgets/read_only_code.js\";\n\nconst TPL = `\n<div class=\"note-detail\">\n    <style>\n    .note-detail {\n        height: 100%;\n        min-height: 0;\n        font-family: var(--detail-font-family);\n        font-size: var(--detail-font-size);\n    }\n    </style>\n</div>\n`;\n\nconst typeWidgetClasses = {\n    'empty': EmptyTypeWidget,\n    'deleted': DeletedTypeWidget,\n    'editable-text': EditableTextTypeWidget,\n    'read-only-text': ReadOnlyTextTypeWidget,\n    'editable-code': EditableCodeTypeWidget,\n    'read-only-code': ReadOnlyCodeTypeWidget,\n    'file': FileTypeWidget,\n    'image': ImageTypeWidget,\n    'search': SearchTypeWidget,\n    'render': RenderTypeWidget,\n    'relation-map': RelationMapTypeWidget,\n    'protected-session': ProtectedSessionTypeWidget,\n    'book': BookTypeWidget\n};\n\nexport default class NoteDetailWidget extends TabAwareWidget {\n    constructor() {\n        super();\n\n        this.typeWidgets = {};\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const {note} = this.tabContext;\n            const {noteId} = note;\n\n            const dto = note.dto;\n            dto.content = this.getTypeWidget().getContent();\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(note);\n\n            await server.put('notes/' + noteId, dto, this.componentId);\n        });\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.on(\"dragover\", e => e.preventDefault());\n\n        this.$widget.on(\"dragleave\", e => e.preventDefault());\n\n        this.$widget.on(\"drop\", async e => {\n            const activeNote = appContext.tabManager.getActiveTabNote();\n\n            if (!activeNote) {\n                return;\n            }\n\n            const files = [...e.originalEvent.dataTransfer.files]; // chrome has issue that dataTransfer.files empties after async operation\n\n            const importService = await import(\"../services/import.js\");\n\n            importService.uploadFiles(activeNote.noteId, files, {\n                safeImport: true,\n                shrinkImages: true,\n                textImportedAsText: true,\n                codeImportedAsCode: true,\n                explodeArchives: true\n            });\n        });\n\n        return this.$widget;\n    }\n\n    async refresh() {\n        this.type = await this.getWidgetType();\n        this.mime = this.note ? this.note.mime : null;\n\n        if (!(this.type in this.typeWidgets)) {\n            const clazz = typeWidgetClasses[this.type];\n\n            const typeWidget = this.typeWidgets[this.type] = new clazz();\n            typeWidget.spacedUpdate = this.spacedUpdate;\n            typeWidget.setParent(this);\n\n            const $renderedWidget = typeWidget.render();\n            keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n            this.$widget.append($renderedWidget);\n\n            await typeWidget.handleEvent('setTabContext', {tabContext: this.tabContext});\n\n            // this is happening in update() so note has been already set and we need to reflect this\n            await typeWidget.handleEvent('tabNoteSwitched', {\n                tabContext: this.tabContext,\n                notePath: this.tabContext.notePath\n            });\n\n            this.child(typeWidget);\n        }\n\n        this.setupClasses();\n    }\n\n    setupClasses() {\n        for (const clazz of Array.from(this.$widget[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz !== 'note-detail' && !clazz.startsWith('hidden-')) {\n                this.$widget.removeClass(clazz);\n            }\n        }\n\n        const note = this.note;\n\n        if (note) {\n            this.$widget.addClass(note.getCssClass());\n\n            this.$widget.addClass(utils.getNoteTypeClass(note.type));\n            this.$widget.addClass(utils.getMimeTypeClass(note.mime));\n\n            this.$widget.toggleClass(\"protected\", note.isProtected);\n        }\n    }\n\n    getTypeWidget() {\n        if (!this.typeWidgets[this.type]) {\n            throw new Error(\"Could not find typeWidget for type: \" + this.type);\n        }\n\n        return this.typeWidgets[this.type];\n    }\n\n    async getWidgetType() {\n        const note = this.note;\n\n        if (!note) {\n            return \"empty\";\n        } else if (note.isDeleted) {\n            return \"deleted\";\n        }\n\n        let type = note.type;\n\n        if (type === 'text' && !this.tabContext.autoBookDisabled\n            && note.hasChildren()\n            && utils.isDesktop()) {\n\n            const noteComplement = await this.tabContext.getNoteComplement();\n\n            if (utils.isHtmlEmpty(noteComplement.content)) {\n                type = 'book';\n            }\n        }\n\n        if (type === 'text' && !this.tabContext.textPreviewDisabled) {\n            const noteComplement = await this.tabContext.getNoteComplement();\n\n            if (note.hasLabel('readOnly') ||\n                (noteComplement.content\n                    && noteComplement.content.length > 10000)\n                    && !note.hasLabel('autoReadOnlyDisabled')) {\n                type = 'read-only-text';\n            }\n        }\n\n        if (type === 'code' && !this.tabContext.codePreviewDisabled) {\n            const noteComplement = await this.tabContext.getNoteComplement();\n\n            if (note.hasLabel('readOnly') ||\n                (noteComplement.content\n                    && noteComplement.content.length > 30000)\n                    && !note.hasLabel('autoReadOnlyDisabled')) {\n                type = 'read-only-code';\n            }\n        }\n\n        if (type === 'text') {\n            type = 'editable-text';\n        }\n\n        if (type === 'code') {\n            type = 'editable-code';\n        }\n\n        if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n            type = 'protected-session';\n        }\n\n        return type;\n    }\n\n    async focusOnDetailEvent({tabId}) {\n        if (this.tabContext.tabId === tabId) {\n            await this.refresh();\n\n            const widget = this.getTypeWidget();\n            widget.focus();\n        }\n    }\n\n    async beforeNoteSwitchEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeTabRemoveEvent({tabId}) {\n        if (this.isTab(tabId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async printActiveNoteEvent() {\n        if (!this.tabContext.isActive()) {\n            return;\n        }\n\n        await libraryLoader.requireLibrary(libraryLoader.PRINT_THIS);\n\n        this.$widget.find('.note-detail-printable:visible').printThis({\n            header: $(\"<h2>\").text(this.note && this.note.title).prop('outerHTML'),\n            footer: \"<script>document.body.className += ' ck-content';</script>\",\n            importCSS: false,\n            loadCSS: [\n                \"libraries/codemirror/codemirror.css\",\n                \"libraries/ckeditor/ckeditor-content.css\",\n                \"libraries/ckeditor/ckeditor-content.css\",\n                \"libraries/bootstrap/css/bootstrap.min.css\",\n                \"stylesheets/print.css\",\n                \"stylesheets/relation_map.css\",\n                \"stylesheets/themes.css\",\n                \"stylesheets/detail.css\"\n            ],\n            debug: true\n        });\n    }\n\n    hoistedNoteChangedEvent() {\n        this.refresh();\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteContentReloaded(this.noteId, this.componentId)\n            || (loadResults.isNoteReloaded(this.noteId, this.componentId) && (this.type !== await this.getWidgetType() || this.mime !== this.note.mime))) {\n\n            this.handleEvent('noteTypeMimeChanged', {noteId: this.noteId});\n        }\n        else {\n            const attrs = loadResults.getAttributes();\n\n            const label = attrs.find(attr =>\n                attr.type === 'label'\n                && ['readOnly', 'autoReadOnlyDisabled', 'cssClass', 'bookZoomLevel'].includes(attr.name)\n                && attr.isAffecting(this.note));\n\n            const relation = attrs.find(attr =>\n                attr.type === 'relation'\n                && ['template', 'renderNote'].includes(attr.name)\n                && attr.isAffecting(this.note));\n\n            if (label || relation) {\n                // probably incorrect event\n                // calling this.refresh() is not enough since the event needs to be propagated to children as well\n                this.handleEvent('noteTypeMimeChanged', {noteId: this.noteId});\n            }\n        }\n    }\n\n    beforeUnloadEvent() {\n        this.spacedUpdate.updateNowIfNecessary();\n    }\n\n    autoBookDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n\n    textPreviewDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n\n    codePreviewDisabledEvent({tabContext}) {\n        if (this.isTab(tabContext.tabId)) {\n            this.refresh();\n        }\n    }\n\n    async cutIntoNoteCommand() {\n        const note = appContext.tabManager.getActiveTabNote();\n\n        if (!note) {\n            return;\n        }\n\n        // without await as this otherwise causes deadlock through component mutex\n        noteCreateService.createNote(note.noteId, {\n            isProtected: note.isProtected,\n            saveSelection: true\n        });\n    }\n}\n","import noteAutocompleteService from '../../services/note_autocomplete.js';\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../services/app_context.js\";\n\nconst TPL = `\n<div class=\"note-detail-empty note-detail-printable\">\n    <div class=\"form-group\">\n        <label>Open note by typing note's title into input below or choose a note in the tree.</label>\n        <div class=\"input-group\">\n            <input class=\"form-control note-autocomplete\" placeholder=\"search for note by its name\">\n        </div>\n    </div>\n</div>`;\n\nexport default class EmptyTypeWidget extends TypeWidget {\n    static getType() { return \"empty\"; }\n\n    doRender() {\n        // FIXME: this might be optimized - cleaned up after use since it's always used only for new tab\n\n        this.$widget = $(TPL);\n        this.$autoComplete = this.$widget.find(\".note-autocomplete\");\n\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, { hideGoToSelectedNoteButton: true })\n            .on('autocomplete:selected', function(event, suggestion, dataset) {\n                if (!suggestion.path) {\n                    return false;\n                }\n\n                appContext.tabManager.getActiveTabContext().setNote(suggestion.path);\n            });\n\n        noteAutocompleteService.showRecentNotes(this.$autoComplete);\n\n        return this.$widget;\n    }\n\n    doRefresh(note) {\n        this.$autoComplete.trigger('focus');\n    }\n}","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-deleted note-detail-printable\">\n    <div style=\"padding: 100px;\">\n        <div class=\"alert alert-warning\" style=\"padding: 20px;\">\n            This note has been deleted.\n        </div>\n    </div>\n</div>`;\n\nexport default class DeletedTypeWidget extends TypeWidget {\n    static getType() { return \"deleted\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        return this.$widget;\n    }\n}","import treeCache from \"../../services/tree_cache.js\";\nimport AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\nimport treeService from \"../../services/tree.js\";\n\nconst TPL = `\n<div class=\"note-detail-readonly-text note-detail-printable\">\n    <style>\n    .note-detail-readonly-text h1 { font-size: 2.0em; }\n    .note-detail-readonly-text h2 { font-size: 1.8em; }\n    .note-detail-readonly-text h3 { font-size: 1.6em; }\n    .note-detail-readonly-text h4 { font-size: 1.4em; }\n    .note-detail-readonly-text h5 { font-size: 1.2em; }\n    .note-detail-readonly-text h6 { font-size: 1.1em; }\n    \n    .note-detail-readonly-text {\n        overflow: auto;\n        height: 100%;\n        padding: 10px;\n        font-family: var(--detail-text-font-family);\n    }\n        \n    .note-detail-readonly-text p:first-child, .note-detail-text::before {\n        margin-top: 0;\n    }\n    \n    .note-detail-readonly-text img {\n        max-width: 100%;\n    }\n    </style>\n\n    <div class=\"alert alert-warning no-print\">\n        Read only text view is shown. <a href=\"#\" class=\"edit-note\">Click here</a> to edit the note.\n    </div>\n\n    <div class=\"note-detail-readonly-text-content ck-content\"></div>\n</div>\n`;\n\nexport default class ReadOnlyTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"read-only-text\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$content = this.$widget.find('.note-detail-readonly-text-content');\n\n        this.$widget.find('a.edit-note').on('click', () => {\n            this.tabContext.textPreviewDisabled = true;\n\n            this.triggerEvent('textPreviewDisabled', {tabContext: this.tabContext});\n        });\n\n        super.doRender();\n\n        return this.$widget;\n    }\n\n    cleanup() {\n        this.$content.html('');\n    }\n\n    scrollToTop() {\n        this.$content.scrollTop(0);\n    }\n\n    async doRefresh(note) {\n        const noteComplement = await treeCache.getNoteComplement(note.noteId);\n\n        this.$content.html(noteComplement.content);\n\n        this.$content.find(\"a.reference-link\").each(async (_, el) => {\n            const notePath = $(el).attr('href');\n            const noteId = treeService.getNoteIdFromNotePath(notePath);\n\n            this.loadReferenceLinkTitle(noteId, $(el));\n        });\n\n        this.$content.find(\"section\").each(async (_, el) => {\n            const noteId = $(el).attr('data-note-id');\n\n            this.loadIncludedNote(noteId, $(el));\n        });\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$content, noteId);\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\n\nconst TPL = `\n<div class=\"note-detail-code note-detail-printable\">\n    <style>\n    .note-detail-code {\n        overflow: auto;\n        height: 100%;\n    }\n    \n    .note-detail-code-editor {\n        min-height: 500px;\n    }\n    </style>\n\n    <div class=\"note-detail-code-editor\"></div>\n</div>`;\n\nexport default class EditableCodeTypeWidget extends TypeWidget {\n    static getType() { return \"editable-code\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-code-editor');\n\n        keyboardActionService.setupActionsForElement('code-detail', this.$widget, this);\n\n        this.initialized = this.initEditor();\n\n        return this.$widget;\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CODE_MIRROR);\n        \n        CodeMirror.keyMap.default[\"Shift-Tab\"] = \"indentLess\";\n        CodeMirror.keyMap.default[\"Tab\"] = \"indentMore\";\n\n        // these conflict with backward/forward navigation shortcuts\n        delete CodeMirror.keyMap.default[\"Alt-Left\"];\n        delete CodeMirror.keyMap.default[\"Alt-Right\"];\n\n        CodeMirror.modeURL = 'libraries/codemirror/mode/%N/%N.js';\n\n        this.codeEditor = CodeMirror(this.$editor[0], {\n            value: \"\",\n            viewportMargin: Infinity,\n            indentUnit: 4,\n            matchBrackets: true,\n            matchTags: {bothTags: true},\n            highlightSelectionMatches: {showToken: /\\w/, annotateScrollbar: false},\n            lint: true,\n            gutters: [\"CodeMirror-lint-markers\"],\n            lineNumbers: true,\n            tabindex: 100,\n            // we linewrap partly also because without it horizontal scrollbar displays only when you scroll\n            // all the way to the bottom of the note. With line wrap there's no horizontal scrollbar so no problem\n            lineWrapping: true,\n            dragDrop: false // with true the editor inlines dropped files which is not what we expect\n        });\n\n        this.codeEditor.on('change', () => this.spacedUpdate.scheduleUpdate());\n    }\n    \n    async doRefresh(note) {\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        this.spacedUpdate.allowUpdateWithoutChange(() => {\n            // CodeMirror breaks pretty badly on null so even though it shouldn't happen (guarded by consistency check)\n            // we provide fallback\n            this.codeEditor.setValue(noteComplement.content || \"\");\n            this.codeEditor.clearHistory();\n\n            const info = CodeMirror.findModeByMIME(note.mime);\n\n            if (info) {\n                this.codeEditor.setOption(\"mode\", info.mime);\n                CodeMirror.autoLoadMode(this.codeEditor, info.mode);\n            }\n        });\n\n        this.show();\n    }\n\n    show() {\n        this.$widget.show();\n\n        if (this.codeEditor) { // show can be called before render\n            this.codeEditor.refresh();\n        }\n    }\n\n    getContent() {\n        return this.codeEditor.getValue();\n    }\n\n    focus() {\n        this.codeEditor.focus();\n    }\n\n    cleanup() {\n        if (this.codeEditor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.codeEditor.setValue('');\n            });\n        }\n    }\n}","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-read-only-code note-detail-printable\">\n    <style>\n    .note-detail-read-only-code {\n        overflow: auto;\n        height: 100%;\n    }\n    \n    .note-detail-read-only-code-content {\n        padding: 10px;\n    }\n    </style>\n\n    <div class=\"alert alert-warning no-print\" style=\"margin-bottom: 0;\">\n        Read only code view is shown. <a href=\"#\" class=\"edit-note\">Click here</a> to edit the note.\n    </div>\n\n    <pre class=\"note-detail-read-only-code-content\"></pre>\n</div>`;\n\nexport default class ReadOnlyCodeTypeWidget extends TypeWidget {\n    static getType() { return \"read-only-code\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-read-only-code-content');\n\n        this.$widget.find('a.edit-note').on('click', () => {\n            this.tabContext.codePreviewDisabled = true;\n\n            this.triggerEvent('codePreviewDisabled', {tabContext: this.tabContext});\n        });\n\n        return this.$widget;\n    }\n\n    async doRefresh(note) {\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        this.$content.text(noteComplement.content);\n    }\n}","import utils from \"../../services/utils.js\";\nimport server from \"../../services/server.js\";\nimport toastService from \"../../services/toast.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-file note-detail-printable\">\n    <style>\n        .file-table td {\n            overflow-wrap: anywhere;\n        }\n    </style>\n\n    <table class=\"file-table\">\n        <tr>\n            <th>Note ID:</th>\n            <td class=\"file-note-id\"></td>\n            <th>Original file name:</th>\n            <td class=\"file-filename\"></td>\n        </tr>\n        <tr>\n            <th>File type:</th>\n            <td class=\"file-filetype\"></td>\n            <th>File size:</th>\n            <td class=\"file-filesize\"></td>\n        </tr>\n    </table>\n    \n    <pre class=\"file-preview-content\"></pre>\n    \n    <iframe class=\"pdf-preview\" style=\"width: 100%; height: 100%; flex-grow: 100;\"></iframe>\n\n    <div style=\"padding: 10px; display: flex; justify-content: space-evenly;\">\n        <button class=\"file-download btn btn-sm btn-primary\" type=\"button\">Download</button>\n        &nbsp;\n        <button class=\"file-open btn btn-sm btn-primary\" type=\"button\">Open</button>\n        &nbsp;\n        <button class=\"file-upload-new-revision btn btn-sm btn-primary\">Upload new revision</button>\n    \n        <input type=\"file\" class=\"file-upload-new-revision-input\" style=\"display: none\">\n    </div>\n</div>`;\n\nexport default class FileTypeWidget extends TypeWidget {\n    static getType() { return \"file\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$fileNoteId = this.$widget.find(\".file-note-id\");\n        this.$fileName = this.$widget.find(\".file-filename\");\n        this.$fileType = this.$widget.find(\".file-filetype\");\n        this.$fileSize = this.$widget.find(\".file-filesize\");\n        this.$previewContent = this.$widget.find(\".file-preview-content\");\n        this.$pdfPreview = this.$widget.find(\".pdf-preview\");\n        this.$downloadButton = this.$widget.find(\".file-download\");\n        this.$openButton = this.$widget.find(\".file-open\");\n        this.$uploadNewRevisionButton = this.$widget.find(\".file-upload-new-revision\");\n        this.$uploadNewRevisionInput = this.$widget.find(\".file-upload-new-revision-input\");\n\n        this.$downloadButton.on('click', () => utils.download(this.getFileUrl()));\n\n        this.$openButton.on('click', () => {\n            if (utils.isElectron()) {\n                const open = utils.dynamicRequire(\"open\");\n\n                open(this.getFileUrl(), {url: true});\n            }\n            else {\n                window.location.href = this.getFileUrl();\n            }\n        });\n\n        this.$uploadNewRevisionButton.on(\"click\", () => {\n            this.$uploadNewRevisionInput.trigger(\"click\");\n        });\n\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const formData = new FormData();\n            formData.append('upload', fileToUpload);\n\n            const result = await $.ajax({\n                url: baseApiUrl + 'notes/' + this.noteId + '/file',\n                headers: server.getHeaders(),\n                data: formData,\n                type: 'PUT',\n                timeout: 60 * 60 * 1000,\n                contentType: false, // NEEDED, DON'T REMOVE THIS\n                processData: false, // NEEDED, DON'T REMOVE THIS\n            });\n\n            if (result.uploaded) {\n                toastService.showMessage(\"New file revision has been uploaded.\");\n\n                this.refresh();\n            }\n            else {\n                toastService.showError(\"Upload of a new file revision failed.\");\n            }\n        });\n\n        return this.$widget;\n    }\n\n    async doRefresh(note) {\n        const attributes = note.getAttributes();\n        const attributeMap = utils.toObject(attributes, l => [l.name, l.value]);\n\n        this.$widget.show();\n\n        this.$fileNoteId.text(note.noteId);\n        this.$fileName.text(attributeMap.originalFileName || \"?\");\n        this.$fileSize.text(note.contentLength + \" bytes\");\n        this.$fileType.text(note.mime);\n\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        this.$previewContent.empty().hide();\n        this.$pdfPreview.attr('src', '').empty().hide();\n\n        if (noteComplement.content) {\n            this.$previewContent.show();\n            this.$previewContent.text(noteComplement.content);\n        }\n        else if (note.mime === 'application/pdf' && utils.isElectron()) {\n            this.$pdfPreview.show();\n            this.$pdfPreview.attr(\"src\", utils.getUrlForDownload(\"api/notes/\" + this.noteId + \"/open\"));\n        }\n\n        // open doesn't work for protected notes since it works through browser which isn't in protected session\n        this.$openButton.toggle(!note.isProtected);\n    }\n\n    getFileUrl() {\n        return utils.getUrlForDownload(\"api/notes/\" + this.noteId + \"/download\");\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-search note-detail-printable\">\n    <div style=\"display: flex; align-items: center; margin-right: 20px; margin-top: 15px;\">\n        <strong>Search string: &nbsp; &nbsp;</strong>\n        <textarea rows=\"4\" style=\"width: auto !important; flex-grow: 4\" class=\"search-string form-control\"></textarea>\n    </div>\n\n    <br />\n\n    <div class=\"note-detail-search-help\"></div>\n</div>`;\n\nexport default class SearchTypeWidget extends TypeWidget {\n    static getType() { return \"search\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$searchString = this.$widget.find(\".search-string\");\n        this.$component = this.$widget.find('.note-detail-search');\n        this.$help = this.$widget.find(\".note-detail-search-help\");\n\n        return this.$widget;\n    }\n\n    async doRefresh(note) {\n        this.$help.html(window.glob.SEARCH_HELP_TEXT);\n\n        this.$component.show();\n\n        try {\n            const noteComplement = await this.tabContext.getNoteComplement();\n            const json = JSON.parse(noteComplement.content);\n\n            this.$searchString.val(json.searchString);\n        }\n        catch (e) {\n            console.log(e);\n            this.$searchString.val('');\n        }\n\n        this.$searchString.on('input', () => this.spacedUpdate.scheduleUpdate());\n    }\n\n    getContent() {\n        return JSON.stringify({\n            searchString: this.$searchString.val()\n        });\n    }\n}","import renderService from \"../../services/render.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-render note-detail-printable\">\n    <style>\n        .note-detail-render {\n            height: 100%;\n        }\n    </style>\n\n    <div class=\"note-detail-render-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        <p><strong>This help note is shown because this note of type Render HTML doesn't have required relation to function properly.</strong></p>\n\n        <p>Render HTML note type is used for <a href=\"https://github.com/zadam/trilium/wiki/Scripts\">scripting</a>. In short, you have a HTML code note (optionally with some JavaScript) and this note will render it. To make it work, you need to define a relation (in <a class=\"show-attributes-button\">Attributes dialog</a>) called \"renderNote\" pointing to the HTML note to render. Once that's defined you can click on the \"play\" button to render.</p>\n    </div>\n\n    <div class=\"note-detail-render-content\" style=\"height: 100%; overflow: auto;\"></div>\n</div>`;\n\nexport default class RenderTypeWidget extends TypeWidget {\n    static getType() { return \"render\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteDetailRenderHelp = this.$widget.find('.note-detail-render-help');\n        this.$noteDetailRenderContent = this.$widget.find('.note-detail-render-content');\n\n        return this.$widget;\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n        this.$noteDetailRenderHelp.hide();\n\n        const renderNotesFound = await renderService.render(note, this.$noteDetailRenderContent);\n\n        if (!renderNotesFound) {\n            this.$noteDetailRenderHelp.show();\n        }\n    }\n\n    cleanup() {\n        this.$noteDetailRenderContent.empty();\n    }\n\n    renderActiveNoteEvent() {\n        if (this.tabContext.isActive()) {\n            this.refresh();\n        }\n    }\n}","import protectedSessionService from '../../services/protected_session.js';\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"protected-session-password-component note-detail-printable\">\n    <style>\n    .protected-session-password-component {\n        width: 300px;\n        margin: 30px auto auto;\n    }\n    </style>\n\n    <form class=\"protected-session-password-form\">\n        <div class=\"form-group\">\n            <label for=\"protected-session-password-in-detail\">Showing protected note requires entering your password:</label>\n            <input class=\"protected-session-password-in-detail form-control protected-session-password\" type=\"password\">\n        </div>\n\n        <button class=\"btn btn-primary\">Start protected session <kbd>enter</kbd></button>\n    </form>\n</div>`;\n\nexport default class ProtectedSessionTypeWidget extends TypeWidget {\n    static getType() { return \"protected-session\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$passwordForm = this.$widget.find(\".protected-session-password-form\");\n        this.$passwordInput = this.$widget.find(\".protected-session-password\");\n\n        this.$passwordForm.on('submit', () => {\n            const password = this.$passwordInput.val();\n            this.$passwordInput.val(\"\");\n\n            protectedSessionService.setupProtectedSession(password);\n\n            return false;\n        });\n        \n        return this.$widget;\n    }\n}","import CollapsibleWidget from \"../collapsible_widget.js\";\n\nconst TPL = `\n<table class=\"note-info-widget-table\">\n    <style>\n        .note-info-widget-table {\n            width: 100%;\n        } \n   \n        .note-info-widget-table td, .note-info-widget-table th {\n            padding: 5px;\n        }\n        \n        .note-info-mime {\n            max-width: 13em;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n    </style>\n\n    <tr>\n        <th>Note ID:</th>\n        <td class=\"note-info-note-id\"></td>\n    </tr>\n    <tr>\n        <th>Created:</th>\n        <td class=\"note-info-date-created\"></td>\n    </tr>\n    <tr>\n        <th>Modified:</th>\n        <td class=\"note-info-date-modified\"></td>\n    </tr>\n    <tr>\n        <th>Type:</th>\n        <td>\n            <span class=\"note-info-type\"></span>\n            \n            <span class=\"note-info-mime\"></span>\n        </td>\n    </tr>\n</table>\n`;\n\nexport default class NoteInfoWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Note info\"; }\n\n    async doRenderBody() {\n        this.$body.html(TPL);\n\n        this.$noteId = this.$body.find(\".note-info-note-id\");\n        this.$dateCreated = this.$body.find(\".note-info-date-created\");\n        this.$dateModified = this.$body.find(\".note-info-date-modified\");\n        this.$type = this.$body.find(\".note-info-type\");\n        this.$mime = this.$body.find(\".note-info-mime\");\n    }\n\n    async refreshWithNote(note) {\n        const noteComplement = await this.tabContext.getNoteComplement();\n\n        this.$noteId.text(note.noteId);\n        this.$dateCreated\n            .text(noteComplement.dateCreated.substr(0, 16))\n            .attr(\"title\", noteComplement.dateCreated);\n\n        this.$dateModified\n            .text(noteComplement.dateModified.substr(0, 16))\n            .attr(\"title\", noteComplement.dateCreated);\n\n        this.$type.text(note.type);\n\n        if (note.mime) {\n            this.$mime.text('(' + note.mime + ')');\n        }\n        else {\n            this.$mime.empty();\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import CollapsibleWidget from \"../collapsible_widget.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport utils from \"../../services/utils.js\";\nimport dateNoteService from \"../../services/date_notes.js\";\nimport server from \"../../services/server.js\";\nimport appContext from \"../../services/app_context.js\";\n\nconst TPL = `\n<div class=\"calendar-widget\">\n  <div class=\"calendar-header\">\n    <button class=\"calendar-btn bx bx-left-arrow-alt\" data-calendar-toggle=\"previous\"></button>\n\n    <div class=\"calendar-header-label\" data-calendar-label=\"month\">\n      March 2017\n    </div>\n\n    <button class=\"calendar-btn bx bx-right-arrow-alt\" data-calendar-toggle=\"next\"></button>\n  </div>\n\n  <div class=\"calendar-week\">\n    <span>Mon</span> <span>Tue</span><span>Wed</span> <span>Thu</span> <span>Fri</span> <span>Sat</span> <span>Sun</span>\n  </div>\n  <div class=\"calendar-body\" data-calendar-area=\"month\"></div>\n</div>\n`;\n\nexport default class CalendarWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Calendar\"; }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.hasOwnedLabel(\"dateNote\");\n    }\n\n    async doRenderBody() {\n        await libraryLoader.requireLibrary(libraryLoader.CALENDAR_WIDGET);\n\n        this.$body.html(TPL);\n\n        this.$month = this.$body.find('[data-calendar-area=\"month\"]');\n        this.$next = this.$body.find('[data-calendar-toggle=\"next\"]');\n        this.$previous = this.$body.find('[data-calendar-toggle=\"previous\"]');\n        this.$label = this.$body.find('[data-calendar-label=\"month\"]');\n\n        this.$next.on('click', () => {\n            this.date.setMonth(this.date.getMonth() + 1);\n            this.createMonth();\n        });\n\n        this.$previous.on('click', () => {\n            this.date.setMonth(this.date.getMonth() - 1);\n            this.createMonth();\n        });\n\n        this.$body.on('click', '.calendar-date', async ev => {\n            const date = $(ev.target).closest('.calendar-date').attr('data-calendar-date');\n\n            const note = await dateNoteService.getDateNote(date);\n\n            if (note) {\n                appContext.tabManager.getActiveTabContext().setNote(note.noteId);\n            }\n            else {\n                alert(\"Cannot find day note\");\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        this.init(this.$body, note.getOwnedLabelValue(\"dateNote\"));\n    }\n\n    init($el, activeDate) {\n        this.activeDate = new Date(activeDate + \"T12:00:00\"); // attaching time fixes local timezone handling\n        this.todaysDate = new Date();\n        this.date = new Date(this.activeDate.getTime());\n        this.date.setDate(1);\n\n        this.createMonth();\n    }\n\n    createDay(dateNotesForMonth, num, day) {\n        const $newDay = $('<a>')\n            .addClass(\"calendar-date\")\n            .attr('data-calendar-date', utils.formatDateISO(this.date));\n        const $date = $('<span>').html(num);\n\n        // if it's the first day of the month\n        if (num === 1) {\n            if (day === 0) {\n                $newDay.css(\"marginLeft\", (6 * 14.28) + '%');\n            } else {\n                $newDay.css(\"marginLeft\", ((day - 1) * 14.28) + '%');\n            }\n        }\n\n        const dateNoteId = dateNotesForMonth[utils.formatDateISO(this.date)];\n\n        if (dateNoteId) {\n            $newDay.addClass('calendar-date-exists');\n            $newDay.attr(\"data-note-path\", dateNoteId);\n        }\n\n        if (this.isEqual(this.date, this.activeDate)) {\n            $newDay.addClass('calendar-date-active');\n        }\n\n        if (this.isEqual(this.date, this.todaysDate)) {\n            $newDay.addClass('calendar-date-today');\n        }\n\n        $newDay.append($date);\n        return $newDay;\n    }\n\n    isEqual(a, b) {\n        return a.getFullYear() === b.getFullYear()\n            && a.getMonth() === b.getMonth()\n            && a.getDate() === b.getDate();\n    }\n\n    async createMonth() {\n        const month = utils.formatDateISO(this.date).substr(0, 7);\n        const dateNotesForMonth = await server.get('date-notes/notes-for-month/' + month);\n\n        this.$month.empty();\n\n        const currentMonth = this.date.getMonth();\n        while (this.date.getMonth() === currentMonth) {\n            const $day = this.createDay(\n                dateNotesForMonth,\n                this.date.getDate(),\n                this.date.getDay(),\n                this.date.getFullYear()\n            );\n\n            this.$month.append($day);\n\n            this.date.setDate(this.date.getDate() + 1);\n        }\n        // while loop trips over and day is at 30/31, bring it back\n        this.date.setDate(1);\n        this.date.setMonth(this.date.getMonth() - 1);\n\n        this.$label.html(this.monthsAsString(this.date.getMonth()) + ' ' + this.date.getFullYear());\n    }\n\n    monthsAsString(monthIndex) {\n        return [\n            'January',\n            'Febuary',\n            'March',\n            'April',\n            'May',\n            'June',\n            'July',\n            'August',\n            'September',\n            'October',\n            'November',\n            'December'\n        ][monthIndex];\n    }\n}","import utils from \"../../services/utils.js\";\nimport linkService from \"../../services/link.js\";\nimport ws from \"../../services/ws.js\";\nimport CollapsibleWidget from \"../collapsible_widget.js\";\n\nexport default class AttributesWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Attributes\"; }\n\n    get help() {\n        return {\n            title: \"Attributes are key-value records owned by assigned to this note.\",\n            url: \"https://github.com/zadam/trilium/wiki/Attributes\"\n        };\n    }\n\n    get headerActions() {\n        const $showFullButton = $(\"<a>\").append(\"show dialog\").addClass('widget-header-action');\n        $showFullButton.on('click', async () => {\n            const attributesDialog = await import(\"../../dialogs/attributes.js\");\n            attributesDialog.showDialog();\n        });\n\n        return [$showFullButton];\n    }\n\n    async refreshWithNote(note) {\n        const ownedAttributes = note.getOwnedAttributes();\n        const $attributesContainer = $(\"<div>\");\n\n        await this.renderAttributes(ownedAttributes, $attributesContainer);\n\n        const $inheritedAttrs = $(\"<span>\").append($(\"<strong>\").text(\"Inherited: \"));\n        const $showInheritedAttributes = $(\"<a>\")\n            .attr(\"href\", \"javascript:\")\n            .text(\"+show inherited\")\n            .on('click', async () => {\n                const attributes = note.getAttributes();\n                const inheritedAttributes = attributes.filter(attr => attr.noteId !== this.noteId);\n\n                if (inheritedAttributes.length === 0) {\n                    $inheritedAttrs.text(\"No inherited attributes yet...\");\n                }\n                else {\n                    await this.renderAttributes(inheritedAttributes, $inheritedAttrs);\n                }\n\n                $inheritedAttrs.show();\n                $showInheritedAttributes.hide();\n                $hideInheritedAttributes.show();\n            });\n\n        const $hideInheritedAttributes = $(\"<a>\")\n            .attr(\"href\", \"javascript:\")\n            .text(\"-hide inherited\")\n            .on('click', () => {\n                $showInheritedAttributes.show();\n                $hideInheritedAttributes.hide();\n                $inheritedAttrs.empty().hide();\n            });\n\n        $attributesContainer.append($showInheritedAttributes, $inheritedAttrs, $hideInheritedAttributes);\n\n        $inheritedAttrs.hide();\n        $hideInheritedAttributes.hide();\n\n        this.$body.empty().append($attributesContainer);\n    }\n\n    async renderAttributes(attributes, $container) {\n        for (const attribute of attributes) {\n            if (attribute.type === 'label') {\n                $container.append(utils.formatLabel(attribute) + \" \");\n            } else if (attribute.type === 'relation') {\n                if (attribute.value) {\n                    $container.append('@' + attribute.name + \"=\");\n                    $container.append(await linkService.createNoteLink(attribute.value));\n                    $container.append(\" \");\n                } else {\n                    ws.logError(`Relation ${attribute.attributeId} has empty target`);\n                }\n            } else if (attribute.type === 'label-definition' || attribute.type === 'relation-definition') {\n                $container.append(attribute.name + \" definition \");\n            } else {\n                ws.logError(\"Unknown attr type: \" + attribute.type);\n            }\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributes().find(attr => attr.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}","import CollapsibleWidget from \"../collapsible_widget.js\";\n\nlet linkMapContainerIdCtr = 1;\n\nconst TPL = `\n<div class=\"link-map-widget\">\n    <div class=\"link-map-container\" style=\"height: 300px;\"></div>\n</div>\n`;\n\nexport default class LinkMapWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Link map\"; }\n\n    get help() {\n        return {\n            title: \"Link map shows incoming and outgoing links from/to the current note.\",\n            url: \"https://github.com/zadam/trilium/wiki/Link-map\"\n        };\n    }\n\n    get headerActions() {\n        const $showFullButton = $(\"<a>\").append(\"show full\").addClass('widget-header-action');\n        $showFullButton.on('click', async () => {\n            const linkMapDialog = await import(\"../../dialogs/link_map.js\");\n            linkMapDialog.showDialog();\n        });\n\n        return [$showFullButton];\n    }\n\n    decorateWidget() {\n        this.$body.css(\"max-height\", \"400px\");\n    }\n\n    async refreshWithNote(note) {\n        const noteId = this.noteId;\n\n        let shown = false;\n\n        // avoid executing this expensive operation multiple times when just going through notes (with keyboard especially)\n        // until the users settles on a note\n        setTimeout(() => {\n            if (this.noteId === noteId) {\n                // there's a problem with centering the rendered link map before it is actually shown on the screen\n                // that's why we make the whole process lazy and with the help of IntersectionObserver wait until the\n                // tab is really shown and only then render\n                const observer = new IntersectionObserver(entries => {\n                    if (!shown && entries[0].isIntersecting) {\n                        shown = true;\n                        this.displayLinkMap(note);\n                    }\n                }, {\n                    rootMargin: '0px',\n                    threshold: 0.1\n                });\n\n                observer.observe(this.$body[0]);\n            }\n        }, 1000);\n    }\n\n    async displayLinkMap(note) {\n        this.$body.css('opacity', 0);\n        this.$body.html(TPL);\n\n        const $linkMapContainer = this.$body.find('.link-map-container');\n        $linkMapContainer.attr(\"id\", \"link-map-container-\" + linkMapContainerIdCtr++);\n\n        const LinkMapServiceClass = (await import('../../services/link_map.js')).default;\n\n        this.linkMapService = new LinkMapServiceClass(note, $linkMapContainer, {\n            maxDepth: 1,\n            zoom: 0.6,\n            stopCheckerCallback: () => this.noteId !== note.noteId // stop when current note is not what was originally requested\n        });\n\n        await this.linkMapService.render();\n\n        this.$body.animate({opacity: 1}, 300);\n    }\n\n    cleanup() {\n        if (this.linkMapService) {\n            this.linkMapService.cleanup();\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributes().find(attr => attr.type === 'relation' && (attr.noteId === this.noteId || attr.value === this.noteId))) {\n            this.noteSwitched();\n        }\n    }\n}","import server from \"../../services/server.js\";\nimport CollapsibleWidget from \"../collapsible_widget.js\";\n\nconst TPL = `\n<ul class=\"note-revision-list\" style=\"max-height: 150px; overflow: auto;\">\n</ul>\n`;\n\nclass NoteRevisionsWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Note revisions\"; }\n\n    get help() {\n        return {\n            title: \"Note revisions track changes in the note across the time.\",\n            url: \"https://github.com/zadam/trilium/wiki/Note-revisions\"\n        };\n    }\n\n    get headerActions() {\n        const $showFullButton = $(\"<a>\").append(\"show dialog\").addClass('widget-header-action');\n        $showFullButton.on('click', async () => {\n            const attributesDialog = await import(\"../../dialogs/note_revisions.js\");\n            attributesDialog.showCurrentNoteRevisions(this.noteId);\n        });\n\n        return [$showFullButton];\n    }\n\n    noteSwitched() {\n        const noteId = this.noteId;\n\n        // avoid executing this expensive operation multiple times when just going through notes (with keyboard especially)\n        // until the users settles on a note\n        setTimeout(() => {\n            if (this.noteId === noteId) {\n                this.refresh();\n            }\n        }, 1000);\n    }\n\n    async refreshWithNote(note) {\n        const revisionItems = await server.get(`notes/${note.noteId}/revisions`);\n\n        if (revisionItems.length === 0) {\n            this.$body.text(\"No revisions yet...\");\n            return;\n        }\n\n        if (note.noteId !== this.noteId) {\n            return;\n        }\n\n        this.$body.html(TPL);\n\n        const $list = this.$body.find('.note-revision-list');\n\n        for (const item of revisionItems) {\n            const $listItem = $('<li>').append($(\"<a>\", {\n                'data-action': 'note-revision',\n                'data-note-path': note.noteId,\n                'data-note-revision-id': item.noteRevisionId,\n                title: 'This revision was last edited on ' + item.dateLastEdited,\n                href: 'javascript:'\n            }).text(item.dateLastEdited.substr(0, 16)));\n\n            if (item.contentLength !== null) {\n                $listItem.append($(\"<span>\").text(` (${item.contentLength} bytes)`))\n            }\n\n            $list.append($listItem);\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.hasNoteRevisionForNote(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n\nexport default NoteRevisionsWidget;","import CollapsibleWidget from \"../collapsible_widget.js\";\nimport linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport treeCache from \"../../services/tree_cache.js\";\n\nexport default class SimilarNotesWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Similar notes\"; }\n\n    get help() {\n        return {\n            title: \"This list contains notes which might be similar to the current note based on textual similarity of note title.\"\n        };\n    }\n\n    noteSwitched() {\n        const noteId = this.noteId;\n\n        this.$body.empty();\n\n        // avoid executing this expensive operation multiple times when just going through notes (with keyboard especially)\n        // until the users settles on a note\n        setTimeout(() => {\n            if (this.noteId === noteId) {\n                this.refresh();\n            }\n        }, 1000);\n    }\n\n    async refreshWithNote(note) {\n        // remember which title was when we found the similar notes\n        this.title = note.title;\n\n        const similarNotes = await server.get('similar-notes/' + this.noteId);\n\n        if (similarNotes.length === 0) {\n            this.$body.text(\"No similar notes found ...\");\n            return;\n        }\n\n        const noteIds = similarNotes.flatMap(note => note.notePath);\n\n        await treeCache.getNotes(noteIds, true); // preload all at once\n\n        const $list = $('<ul>');\n\n        for (const similarNote of similarNotes) {\n            const note = await treeCache.getNote(similarNote.noteId, true);\n\n            if (!note) {\n                continue;\n            }\n\n            const $item = $(\"<li>\")\n                .append(await linkService.createNoteLink(similarNote.notePath.join(\"/\"), {showNotePath: true}));\n\n            $list.append($item);\n        }\n\n        this.$body.empty().append($list);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (this.note && this.title !== this.note.title) {\n            this.rendered = false;\n\n            this.refresh();\n        }\n    }\n}","import CollapsibleWidget from \"../collapsible_widget.js\";\nimport linkService from \"../../services/link.js\";\n\nexport default class WhatLinksHereWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"What links here\"; }\n\n    get help() {\n        return {\n            title: \"This list contains all notes which link to this note through links and relations.\"\n        };\n    }\n\n    get headerActions() {\n        const $showFullButton = $(\"<a>\").append(\"show link map\").addClass('widget-header-action');\n        $showFullButton.on('click', async () => {\n            const linkMapDialog = await import(\"../../dialogs/link_map.js\");\n            linkMapDialog.showDialog();\n        });\n\n        return [$showFullButton];\n    }\n\n    async refreshWithNote(note) {\n        const targetRelations = note.getTargetRelations();\n\n        if (targetRelations.length === 0) {\n            this.$body.text(\"Nothing links here yet ...\");\n            return;\n        }\n\n        const $list = $(\"<ul>\");\n        let i = 0;\n\n        for (; i < targetRelations.length && i < 50; i++) {\n            const rel = targetRelations[i];\n\n            const $item = $(\"<li>\")\n                .append(await linkService.createNoteLink(rel.noteId))\n                .append($(\"<span>\").text(\" (\" + rel.name + \")\"));\n\n            $list.append($item);\n        }\n\n        if (i < targetRelations.length) {\n            $list.append($(\"<li>\").text(`${targetRelations.length - i} more links ...`));\n        }\n\n        this.$body.empty().append($list);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributes().find(attr => attr.type === 'relation' && attr.value === this.noteId)) {\n            this.refresh();\n        }\n    }\n}","import options from \"./options.js\";\n\nlet instance;\n\nfunction setupSplit(left, right) {\n    if (instance) {\n        instance.destroy();\n        instance = null;\n    }\n\n    if (!left && !right) {\n        $(\"#center-pane\").css('width', '100%');\n\n        return;\n    }\n\n    const leftPaneWidth = options.getInt('leftPaneWidth');\n    const rightPaneWidth = options.getInt('rightPaneWidth');\n\n    if (left && right) {\n        instance = Split(['#left-pane', '#center-pane', '#right-pane'], {\n            sizes: [leftPaneWidth, 100 - leftPaneWidth - rightPaneWidth, rightPaneWidth],\n            gutterSize: 5,\n            onDragEnd: sizes => {\n                options.save('leftPaneWidth', Math.round(sizes[0]));\n                options.save('rightPaneWidth', Math.round(sizes[2]));\n            }\n        });\n    }\n    else if (left) {\n        instance = Split(['#left-pane', '#center-pane'], {\n            sizes: [leftPaneWidth, 100 - leftPaneWidth],\n            gutterSize: 5,\n            onDragEnd: sizes => {\n                options.save('leftPaneWidth', Math.round(sizes[0]));\n            }\n        });\n    }\n    else if (right) {\n        instance = Split(['#center-pane', '#right-pane'], {\n            sizes: [100 - rightPaneWidth, rightPaneWidth],\n            gutterSize: 5,\n            onDragEnd: sizes => {\n                options.save('rightPaneWidth', Math.round(sizes[1]));\n            }\n        });\n    }\n}\n\nexport default {\n    setupSplit\n};","import options from \"../services/options.js\";\nimport splitService from \"../services/split.js\";\nimport BasicWidget from \"./basic_widget.js\";\n\nconst TPL = `\n<div class=\"hide-in-zen-mode\">\n    <style>\n    .hide-right-pane-button, .show-right-pane-button {\n        position: fixed;\n        bottom: 10px;\n        right: 10px;\n        z-index: 1000;\n    }\n    \n    .hide-left-pane-button, .show-left-pane-button {\n        position: fixed;\n        bottom: 10px;\n        left: 10px;\n        z-index: 1000;\n    }\n    </style>\n    \n    <button class=\"hide-left-pane-button btn btn-sm icon-button bx bx-chevrons-left\" title=\"Show sidebar\"></button>\n    <button class=\"show-left-pane-button btn btn-sm icon-button bx bx-chevrons-right\" title=\"Hide sidebar\"></button>\n            \n    <button class=\"hide-right-pane-button btn btn-sm icon-button bx bx-chevrons-right\" title=\"Hide sidebar\"></button>\n    <button class=\"show-right-pane-button btn btn-sm icon-button bx bx-chevrons-left\" title=\"Show sidebar\"></button>\n</div>\n`;\n\nexport default class SidePaneToggles extends BasicWidget {\n    constructor() {\n        super();\n\n        this.paneVisible = {};\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".show-right-pane-button\").on('click', () => this.toggleAndSave('right', true));\n        this.$widget.find(\".hide-right-pane-button\").on('click', () => this.toggleAndSave('right', false));\n\n        this.$widget.find(\".show-left-pane-button\").on('click', () => this.toggleAndSave('left', true));\n        this.$widget.find(\".hide-left-pane-button\").on('click', () => this.toggleAndSave('left', false));\n\n        return this.$widget;\n    }\n\n    toggleSidebar(side, show) {\n        $(`#${side}-pane`).toggle(show);\n        this.$widget.find(`.show-${side}-pane-button`).toggle(!show);\n        this.$widget.find(`.hide-${side}-pane-button`).toggle(show);\n\n        this.paneVisible[side] = show;\n    }\n\n    async toggleAndSave(side, show) {\n        await options.save(`${side}PaneVisible`, show.toString());\n\n        this.toggleSidebar(side, show);\n\n        splitService.setupSplit(this.paneVisible.left, this.paneVisible.right);\n\n        this.triggerEvent('sidebarVisibilityChanged', {side, show});\n    }\n\n    initialRenderCompleteEvent() {\n        this.toggleSidebar('left', options.is('leftPaneVisible'));\n        this.toggleSidebar('right', options.is('rightPaneVisible'));\n\n        splitService.setupSplit(this.paneVisible.left, this.paneVisible.right);\n    }\n}\n","import CollapsibleWidget from \"../collapsible_widget.js\";\nimport linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport treeCache from \"../../services/tree_cache.js\";\n\nexport default class EditedNotesWidget extends CollapsibleWidget {\n    get widgetTitle() { return \"Edited notes on this day\"; }\n\n    get help() {\n        return {\n            title: \"This contains a list of notes created or updated on this day.\"\n        };\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.hasOwnedLabel(\"dateNote\");\n    }\n\n    async refreshWithNote(note) {\n        // remember which title was when we found the similar notes\n        this.title = note.title;\n        let editedNotes = await server.get('edited-notes/' + note.getLabelValue(\"dateNote\"));\n\n        editedNotes = editedNotes.filter(n => n.noteId !== note.noteId);\n\n        if (editedNotes.length === 0) {\n            this.$body.text(\"No edited notes on this day yet ...\");\n            return;\n        }\n\n        const noteIds = editedNotes.flatMap(n => n.noteId);\n\n        await treeCache.getNotes(noteIds, true); // preload all at once\n\n        const $list = $('<ul>');\n\n        for (const editedNote of editedNotes) {\n            const $item = $(\"<li>\");\n\n            if (editedNote.isDeleted) {\n                $item.append($(\"<i>\").text(editedNote.title + \" (deleted)\"));\n            }\n            else {\n                $item.append(editedNote.notePath ? await linkService.createNoteLink(editedNote.notePath.join(\"/\"), {showNotePath: true}) : editedNote.title);\n            }\n\n            $list.append($item);\n        }\n\n        this.$body.empty().append($list);\n    }\n}","import FlexContainer from \"../widgets/flex_container.js\";\nimport GlobalMenuWidget from \"../widgets/global_menu.js\";\nimport TabRowWidget from \"../widgets/tab_row.js\";\nimport TitleBarButtonsWidget from \"../widgets/title_bar_buttons.js\";\nimport StandardTopWidget from \"../widgets/standard_top_widget.js\";\nimport SidePaneContainer from \"../widgets/side_pane_container.js\";\nimport GlobalButtonsWidget from \"../widgets/global_buttons.js\";\nimport SearchBoxWidget from \"../widgets/search_box.js\";\nimport SearchResultsWidget from \"../widgets/search_results.js\";\nimport NoteTreeWidget from \"../widgets/note_tree.js\";\nimport TabCachingWidget from \"../widgets/tab_caching_widget.js\";\nimport NotePathsWidget from \"../widgets/note_paths.js\";\nimport NoteTitleWidget from \"../widgets/note_title.js\";\nimport RunScriptButtonsWidget from \"../widgets/run_script_buttons.js\";\nimport NoteTypeWidget from \"../widgets/note_type.js\";\nimport NoteActionsWidget from \"../widgets/note_actions.js\";\nimport PromotedAttributesWidget from \"../widgets/promoted_attributes.js\";\nimport NoteDetailWidget from \"../widgets/note_detail.js\";\nimport NoteInfoWidget from \"../widgets/collapsible_widgets/note_info.js\";\nimport CalendarWidget from \"../widgets/collapsible_widgets/calendar.js\";\nimport AttributesWidget from \"../widgets/collapsible_widgets/attributes.js\";\nimport LinkMapWidget from \"../widgets/collapsible_widgets/link_map.js\";\nimport NoteRevisionsWidget from \"../widgets/collapsible_widgets/note_revisions.js\";\nimport SimilarNotesWidget from \"../widgets/collapsible_widgets/similar_notes.js\";\nimport WhatLinksHereWidget from \"../widgets/collapsible_widgets/what_links_here.js\";\nimport SidePaneToggles from \"../widgets/side_pane_toggles.js\";\nimport EditedNotesWidget from \"../widgets/collapsible_widgets/edited_notes.js\";\n\nconst RIGHT_PANE_CSS = `\n<style>\n#right-pane {\n    overflow: auto;\n}\n\n#right-pane .card {\n    border: 0;\n    display: flex;\n    flex-shrink: 0;\n    flex-direction: column;\n}\n\n#right-pane .card-header {\n    background: inherit;\n    padding: 3px 10px 3px 10px;\n    width: 99%; /* to give minimal right margin */\n    background-color: var(--button-background-color);\n    border-color: var(--button-border-color);\n    border-width: 1px;\n    border-radius: 4px;\n    border-style: solid;\n    display: flex;\n    justify-content: space-between;\n}\n\n#right-pane .widget-title {\n    border-radius: 0;\n    padding: 0;\n    border: 0;\n    background: inherit;\n    font-weight: bold;\n    text-transform: uppercase;\n    color: var(--muted-text-color) !important;\n}\n\n#right-pane .widget-header-action {\n    color: var(--link-color) !important;\n    cursor: pointer;\n}\n\n#right-pane .widget-help {\n    color: var(--muted-text-color);\n    position: relative;\n    top: 2px;\n}\n\n#right-pane .widget-help.no-link:hover {\n    cursor: default;\n    text-decoration: none;\n}\n\n#right-pane .body-wrapper {\n    overflow: auto;\n}\n\n#right-pane .card-body {\n    width: 100%;\n    padding: 8px;\n    border: 0;\n    height: 100%;\n    overflow: auto;\n    max-height: 300px;\n}\n\n#right-pane .card-body ul {\n    padding-left: 25px;\n    margin-bottom: 5px;\n}\n</style>`;\n\nexport default class DesktopMainWindowLayout {\n    constructor(customWidgets) {\n        this.customWidgets = customWidgets;\n    }\n\n    getRootWidget(appContext) {\n        appContext.mainTreeWidget = new NoteTreeWidget(\"main\");\n\n        return new FlexContainer('column')\n            .setParent(appContext)\n            .id('root-widget')\n            .css('height', '100vh')\n            .child(new FlexContainer('row')\n                .child(new GlobalMenuWidget())\n                .child(new TabRowWidget())\n                .child(new TitleBarButtonsWidget()))\n            .child(new StandardTopWidget()\n                .hideInZenMode())\n            .child(new FlexContainer('row')\n                .collapsible()\n                .filling()\n                .child(new SidePaneContainer('left')\n                    .hideInZenMode()\n                    .child(new GlobalButtonsWidget())\n                    .child(new SearchBoxWidget())\n                    .child(new SearchResultsWidget())\n                    .child(new TabCachingWidget(() => new NotePathsWidget()))\n                    .child(appContext.mainTreeWidget)\n                    .child(...this.customWidgets.get('left-pane'))\n                )\n                .child(new FlexContainer('column').id('center-pane')\n                    .child(new FlexContainer('row').class('title-row')\n                        .cssBlock('.title-row > * { margin: 5px; }')\n                        .child(new NoteTitleWidget())\n                        .child(new RunScriptButtonsWidget().hideInZenMode())\n                        .child(new NoteTypeWidget().hideInZenMode())\n                        .child(new NoteActionsWidget().hideInZenMode())\n                    )\n                    .child(new TabCachingWidget(() => new PromotedAttributesWidget()))\n                    .child(new TabCachingWidget(() => new NoteDetailWidget()))\n                    .child(...this.customWidgets.get('center-pane'))\n                )\n                .child(new SidePaneContainer('right')\n                    .cssBlock(RIGHT_PANE_CSS)\n                    .hideInZenMode()\n                    .child(new NoteInfoWidget())\n                    .child(new TabCachingWidget(() => new CalendarWidget()))\n                    .child(new TabCachingWidget(() => new EditedNotesWidget()))\n                    .child(new TabCachingWidget(() => new AttributesWidget()))\n                    .child(new TabCachingWidget(() => new LinkMapWidget()))\n                    .child(new TabCachingWidget(() => new NoteRevisionsWidget()))\n                    .child(new TabCachingWidget(() => new SimilarNotesWidget()))\n                    .child(new TabCachingWidget(() => new WhatLinksHereWidget()))\n                    .child(...this.customWidgets.get('right-pane'))\n                )\n                .child(new SidePaneToggles().hideInZenMode())\n            );\n    }\n}\n","import utils from \"./utils.js\";\nimport appContext from \"./app_context.js\";\nimport server from \"./server.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport ws from \"./ws.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport treeCache from \"./tree_cache.js\";\n\nfunction setupGlobs() {\n    window.glob.PROFILING_LOG = false;\n\n    window.glob.isDesktop = utils.isDesktop;\n    window.glob.isMobile = utils.isMobile;\n\n    window.glob.getComponentByEl = el => appContext.getComponentByEl(el);\n    window.glob.getHeaders = server.getHeaders;\n\n    // required for ESLint plugin and CKEditor\n    window.glob.getActiveTabNote = () => appContext.tabManager.getActiveTabNote();\n    window.glob.requireLibrary = libraryLoader.requireLibrary;\n    window.glob.ESLINT = libraryLoader.ESLINT;\n    window.glob.appContext = appContext; // for debugging\n    window.glob.treeCache = treeCache;\n\n    // for CKEditor integration (button on block toolbar)\n    window.glob.importMarkdownInline = async () => {\n        const dialog = await import(\"../dialogs/markdown_import.js\");\n\n        dialog.importMarkdownInline();\n    };\n\n    window.glob.SEARCH_HELP_TEXT = `\n    <strong>Search tips</strong> - also see <button class=\"btn btn-sm\" type=\"button\" data-help-page=\"Search\">complete help on search</button>\n    <p>\n    <ul>\n        <li>Just enter any text for full text search</li>\n        <li><code>@abc</code> - returns notes with label abc</li>\n        <li><code>@year=2019</code> - matches notes with label <code>year</code> having value <code>2019</code></li>\n        <li><code>@rock @pop</code> - matches notes which have both <code>rock</code> and <code>pop</code> labels</li>\n        <li><code>@rock or @pop</code> - only one of the labels must be present</li>\n        <li><code>@year&lt;=2000</code> - numerical comparison (also &gt;, &gt;=, &lt;).</li>\n        <li><code>@dateCreated>=MONTH-1</code> - notes created in the last month</li>\n        <li><code>=handler</code> - will execute script defined in <code>handler</code> relation to get results</li>\n    </ul>\n    </p>`;\n\n    window.onerror = function (msg, url, lineNo, columnNo, error) {\n        const string = msg.toLowerCase();\n\n        let message = \"Uncaught error: \";\n\n        if (string.includes(\"script error\")) {\n            message += 'No details available';\n        } else {\n            message += [\n                'Message: ' + msg,\n                'URL: ' + url,\n                'Line: ' + lineNo,\n                'Column: ' + columnNo,\n                'Error object: ' + JSON.stringify(error),\n                'Stack: ' + error && error.stack\n            ].join(', ');\n        }\n\n        ws.logError(message);\n\n        return false;\n    };\n\n    protectedSessionHolder.setProtectedSessionId(null);\n\n    for (const appCssNoteId of glob.appCssNoteIds || []) {\n        libraryLoader.requireCss(`api/notes/download/${appCssNoteId}`);\n    }\n\n    const wikiBaseUrl = \"https://github.com/zadam/trilium/wiki/\";\n\n    $(document).on(\"click\", \"button[data-help-page]\", e => {\n        const $button = $(e.target);\n\n        window.open(wikiBaseUrl + $button.attr(\"data-help-page\"), '_blank');\n    });\n\n    $(\"body\").on(\"click\", \"a.external\", function () {\n        window.open($(this).attr(\"href\"), '_blank');\n    });\n}\n\nexport default {\n    setupGlobs\n}\n","import FlexContainer from \"../widgets/flex_container.js\";\nimport GlobalMenuWidget from \"../widgets/global_menu.js\";\nimport TabRowWidget from \"../widgets/tab_row.js\";\nimport TitleBarButtonsWidget from \"../widgets/title_bar_buttons.js\";\nimport NoteTreeWidget from \"../widgets/note_tree.js\";\nimport TabCachingWidget from \"../widgets/tab_caching_widget.js\";\nimport NoteTitleWidget from \"../widgets/note_title.js\";\nimport RunScriptButtonsWidget from \"../widgets/run_script_buttons.js\";\nimport NoteTypeWidget from \"../widgets/note_type.js\";\nimport NoteActionsWidget from \"../widgets/note_actions.js\";\nimport PromotedAttributesWidget from \"../widgets/promoted_attributes.js\";\nimport NoteDetailWidget from \"../widgets/note_detail.js\";\n\nexport default class DesktopExtraWindowLayout {\n    constructor(customWidgets) {\n        this.customWidgets = customWidgets;\n    }\n\n    getRootWidget(appContext) {\n        appContext.mainTreeWidget = new NoteTreeWidget();\n\n        return new FlexContainer('column')\n            .setParent(appContext)\n            .id('root-widget')\n            .css('height', '100vh')\n            .child(new FlexContainer('row')\n                .child(new GlobalMenuWidget())\n                .child(new TabRowWidget())\n                .child(new TitleBarButtonsWidget()))\n            .child(new FlexContainer('row')\n                .collapsible()\n                .child(new FlexContainer('column').id('center-pane').css('flex-grow', '1')\n                    .child(new FlexContainer('row').class('title-row')\n                        .cssBlock('.title-row > * { margin: 5px; }')\n                        .child(new NoteTitleWidget())\n                        .child(new RunScriptButtonsWidget().hideInZenMode())\n                        .child(new NoteTypeWidget().hideInZenMode())\n                        .child(new NoteActionsWidget().hideInZenMode())\n                    )\n                    .child(new TabCachingWidget(() => new PromotedAttributesWidget()))\n                    .child(new TabCachingWidget(() => new NoteDetailWidget()))\n                    .child(...this.customWidgets.get('center-pane'))\n                )\n            );\n    }\n}","import appContext from \"./services/app_context.js\";\nimport utils from './services/utils.js';\nimport noteTooltipService from './services/note_tooltip.js';\nimport bundleService from \"./services/bundle.js\";\nimport noteAutocompleteService from './services/note_autocomplete.js';\nimport macInit from './services/mac_init.js';\nimport contextMenu from \"./services/context_menu.js\";\nimport DesktopMainWindowLayout from \"./layouts/desktop_main_window_layout.js\";\nimport glob from \"./services/glob.js\";\nimport DesktopExtraWindowLayout from \"./layouts/desktop_extra_window_layout.js\";\nimport zoomService from './services/zoom.js';\n\nglob.setupGlobs();\n\nif (utils.isElectron()) {\n    utils.dynamicRequire('electron').ipcRenderer.on('globalShortcut', async function(event, actionName) {\n        appContext.triggerCommand(actionName);\n    });\n}\n\n$('[data-toggle=\"tooltip\"]').tooltip({\n    html: true\n});\n\nmacInit.init();\n\nbundleService.getWidgetBundlesByParent().then(widgetBundles => {\n    const layout = window.glob.isMainWindow\n        ? new DesktopMainWindowLayout(widgetBundles)\n        : new DesktopExtraWindowLayout(widgetBundles);\n\n    appContext.setLayout(layout);\n    appContext.start();\n});\n\nnoteTooltipService.setupGlobalTooltip();\n\nnoteAutocompleteService.init();\n\nif (utils.isElectron()) {\n    const electron = utils.dynamicRequire('electron');\n    const {webContents} = electron.remote.getCurrentWindow();\n\n    webContents.on('context-menu', (event, params) => {\n        const {editFlags} = params;\n        const hasText = params.selectionText.trim().length > 0;\n        const isMac = process.platform === \"darwin\";\n        const platformModifier = isMac ? 'Meta' : 'Ctrl';\n\n        const items = [];\n\n        if (params.misspelledWord) {\n            for (const suggestion of params.dictionarySuggestions) {\n                items.push({\n                    title: suggestion,\n                    command: \"replaceMisspelling\",\n                    spellingSuggestion: suggestion,\n                    uiIcon: \"empty\"\n                });\n            }\n\n            items.push({\n                title: `Add \"${params.misspelledWord}\" to dictionary`,\n                uiIcon: \"plus\",\n                handler: () => webContents.session.addWordToSpellCheckerDictionary(params.misspelledWord)\n            });\n\n            items.push({ title: `----` });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canCut && hasText,\n                title: `Cut <kbd>${platformModifier}+X`,\n                uiIcon: \"cut\",\n                handler: () => webContents.cut()\n            });\n        }\n\n        if (params.isEditable || hasText) {\n            items.push({\n                enabled: editFlags.canCopy && hasText,\n                title: `Copy <kbd>${platformModifier}+C`,\n                uiIcon: \"copy\",\n                handler: () => webContents.copy()\n            });\n        }\n\n        if (![\"\", \"javascript:\", \"about:blank#blocked\"].includes(params.linkURL) && params.mediaType === 'none') {\n            items.push({\n                title: `Copy link`,\n                uiIcon: \"copy\",\n                handler: () => {\n                    electron.clipboard.write({\n                        bookmark: params.linkText,\n                        text: params.linkURL\n                    });\n                }\n            });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `Paste <kbd>${platformModifier}+V`,\n                uiIcon: \"paste\",\n                handler: () => webContents.paste()\n            });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `Paste as plain text <kbd>${platformModifier}+Shift+V`,\n                uiIcon: \"paste\",\n                handler: () => webContents.pasteAndMatchStyle()\n            });\n        }\n\n        if (hasText) {\n            const shortenedSelection = params.selectionText.length > 15\n                ? (params.selectionText.substr(0, 13) + \"…\")\n                : params.selectionText;\n\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `Search for \"${shortenedSelection}\" with DuckDuckGo`,\n                uiIcon: \"search-alt\",\n                handler: () => electron.shell.openExternal(`https://duckduckgo.com/?q=${encodeURIComponent(params.selectionText)}`)\n            });\n        }\n\n        if (items.length === 0) {\n            return;\n        }\n\n        const zoomLevel = zoomService.getCurrentZoom();\n\n        contextMenu.show({\n            x: params.x / zoomLevel,\n            y: params.y / zoomLevel,\n            items,\n            selectMenuItemHandler: ({command, spellingSuggestion}) => {\n                if (command === 'replaceMisspelling') {\n                    webContents.insertText(spellingSuggestion);\n                }\n            }\n        });\n    });\n}\n"],"sourceRoot":""}