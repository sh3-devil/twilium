(()=>{var e={46:(e,t,o)=>{"use strict";function n(e){return(e<=9?"0":"")+e}function r(e){return n(e.getHours())+":"+n(e.getMinutes())}function s(e){return n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())}function i(e){return a(e)}function a(e){return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())}function c(){return!!(window&&window.process&&window.process.type)}o.d(t,{Z:()=>y});const u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function l(e){return/[^\w_-]/.test(e)?'"'+e+'"':e}function d(e,t,o){m()&&(t=p(t),e.bind("keydown",t,e=>{o(e),e.preventDefault(),e.stopPropagation()}))}function p(e){return e.toLowerCase().replace("enter","return").replace("delete","del").replace("ctrl+alt","alt+ctrl").replace("meta+alt","alt+meta")}function m(){return"desktop"===window.device||!window.device&&!/Mobi/.test(navigator.userAgent)}function f(){glob.activeDialog&&(glob.activeDialog.modal("hide"),glob.activeDialog=null)}let h=null;function w(){h=$(":focus")}function b(){if(h){if(h.hasClass("ck")){h.closest(".ck-editor__editable").prop("ckeditorInstance").editing.view.focus()}else h.focus();h=null}}function g(e){return"undefined"!=typeof require?require(e):o(676)(e)}const y={reloadApp:function(){window.location.reload(!0)},parseDate:function(e){try{return new Date(Date.parse(e))}catch(t){throw new Error("Can't parse date from "+e+": "+t.stack)}},padNum:n,formatTime:r,formatTimeWithSeconds:s,formatDate:i,formatDateISO:a,formatDateTime:function(e){return i(e)+" "+r(e)},localNowDateTime:function(){return dayjs().format("YYYY-MM-DD HH:mm:ss.SSSZZ")},now:function(){return s(new Date)},isElectron:c,isMac:function(){return navigator.platform.indexOf("Mac")>-1},assertArguments:function(){for(const e in arguments)arguments[e]||console.trace(`Argument idx#${e} should not be falsy: ${arguments[e]}`)},escapeHtml:function(e){return e.replace(/[&<>"'`=\/]/g,e=>u[e])},stopWatch:async function(e,t){const o=new Date,n=await t(),r=Date.now()-o.getTime();return console.log(`${e} took ${r}ms`),n},formatLabel:function(e){let t="@"+l(e.name);return""!==e.value&&(t+="="+l(e.value)),t},download:function(e){if(e+="?"+Date.now(),c()){g("electron").remote.getCurrentWebContents().downloadURL(e)}else window.location.href=e},toObject:function(e,t){const o={};for(const n of e){const[e,r]=t(n);o[e]=r}return o},randomString:function(e){let t="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},bindGlobalShortcut:function(e,t){d($(document),e,t)},bindElShortcut:d,isMobile:function(){return"mobile"===window.device||!window.device&&/Mobi/.test(navigator.userAgent)},isDesktop:m,setCookie:function(e,t){const o="; expires="+new Date(Date.now()+31536e7).toUTCString();document.cookie=e+"="+(t||"")+o+";"},setSessionCookie:function(e,t){document.cookie=e+"="+(t||"")+";"},getCookie:function(e){const t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},getNoteTypeClass:function(e){return"type-"+e},getMimeTypeClass:function(e){const t=e.indexOf(";");return-1!==t&&(e=e.substr(0,t)),"mime-"+e.toLowerCase().replace(/[\W_]+/g,"-")},closeActiveDialog:f,openDialog:async function(e){f(),glob.activeDialog=e,w(),e.modal(),e.on("hidden.bs.modal",()=>{glob.activeDialog&&glob.activeDialog!==e||b()}),(await o.e(800).then(o.bind(o,604))).default.updateDisplayedShortcuts(e)},saveFocusedElement:w,focusSavedElement:b,isHtmlEmpty:function(e){return!e||!(e=e.toLowerCase()).includes("<img")&&!e.includes("<section")&&0===$("<div>").html(e).text().trim().length},clearBrowserCache:async function(){if(c()){const e=g("electron").remote.getCurrentWindow();await e.webContents.session.clearCache()}},getUrlForDownload:function(e){return c()?function(){const e=new URL(window.location.href);return e.protocol+"//"+e.hostname+":"+e.port}()+"/"+e:e},normalizeShortcut:p,copySelectionToClipboard:function(){const e=window.getSelection().toString();navigator.clipboard&&navigator.clipboard.writeText(e)},isCKEditorInitialized:function(){return!(!window||!window.cutToNote)},dynamicRequire:g,timeLimit:function(e,t){const o=new Error("Process exceeded time limit "+t);return new Promise((n,r)=>{let s=!1;e.then(e=>{s=!0,n(e)}),setTimeout(()=>{s||r(o)},t)})}}},676:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=676,e.exports=t}},t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.m=e,o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,n)=>(o.f[n](e,t),t),[])),o.u=e=>e+".setup.js",o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="app-dist/",(()=>{var e={8:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise((o,n)=>{r=e[t]=[o,n]});n.push(r[2]=s);var i,a=o.p+o.u(t),c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=a;var u=new Error;i=n=>{i=()=>{},c.onerror=c.onload=null,clearTimeout(l);var s=(()=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r))return r[1]})();if(s){var a=n&&("load"===n.type?"missing":n.type),d=n&&n.target&&n.target.src;u.message="Loading chunk "+t+" failed.\n("+a+": "+d+")",u.name="ChunkLoadError",u.type=a,u.request=d,s(u)}};var l=setTimeout(()=>{i({type:"timeout",target:c})},12e4);c.onerror=c.onload=i,document.head.appendChild(c)}};var t=window.webpackJsonptrilium=window.webpackJsonptrilium||[],n=t.push.bind(t);t.push=function(t){for(var n,s,i=t[0],a=t[1],c=t[3],u=0,l=[];u<i.length;u++)s=i[u],o.o(e,s)&&e[s]&&l.push(e[s][0]),e[s]=0;for(n in a)o.o(a,n)&&(o.m[n]=a[n]);for(c&&c(o),r&&r(t);l.length;)l.shift()()};var r=n})(),(()=>{"use strict";var e=o(46);function t(e){return document.execCommand(e),!1}async function n(){const{stats:t,initialized:o}=await $.get("api/sync/stats");if(o){const t=e.Z.dynamicRequire("electron").remote;t.app.relaunch(),t.app.exit(0)}else{const e=t.outstandingPushes+t.outstandingPulls;$("#outstanding-syncs").html(e)}}function r(e){$("#alert").html(e),$("#alert").show()}({init:function(){e.Z.isElectron()&&e.Z.isMac()&&(e.Z.bindGlobalShortcut("meta+c",()=>t("copy")),e.Z.bindGlobalShortcut("meta+v",()=>t("paste")),e.Z.bindGlobalShortcut("meta+x",()=>t("cut")),e.Z.bindGlobalShortcut("meta+a",()=>t("selectAll")),e.Z.bindGlobalShortcut("meta+z",()=>t("undo")),e.Z.bindGlobalShortcut("meta+y",()=>t("redo")))}}).init(),ko.applyBindings(new function(){syncInProgress&&setInterval(n,1e3);const t=location.protocol+"//"+location.host;$("#current-host").html(t),this.step=ko.observable(syncInProgress?"sync-in-progress":"setup-type"),this.setupType=ko.observable(),this.setupNewDocument=ko.observable(!1),this.setupSyncFromDesktop=ko.observable(!1),this.setupSyncFromServer=ko.observable(!1),this.username=ko.observable(),this.password1=ko.observable(),this.password2=ko.observable(),this.theme=ko.observable("white"),this.theme.subscribe((function(e){const t=$("body");for(const e of Array.from(t[0].classList))e.startsWith("theme-")&&t.removeClass(e);t.addClass("theme-"+e)})),this.syncServerHost=ko.observable(),this.syncProxy=ko.observable(),this.instanceType=e.Z.isElectron()?"desktop":"server",this.setupTypeSelected=()=>!!this.setupType(),this.selectSetupType=()=>{this.step(this.setupType())},this.back=()=>{this.step("setup-type"),this.setupType("")},this.finish=async()=>{if("new-document"===this.setupType()){const e=this.username(),t=this.password1(),o=this.password2(),n=this.theme();if(!e)return void r("Username can't be empty");if(!t)return void r("Password can't be empty");if(t!==o)return void r("Both password fields need be identical.");this.step("new-document-in-progress"),$.post("api/setup/new-document",{username:e,password:t,theme:n}).then(()=>{window.location.replace("./setup")})}else if("sync-from-server"===this.setupType()){const e=this.syncServerHost(),t=this.syncProxy(),o=this.username(),s=this.password1();if(!e)return void r("Trilium server address can't be empty");if(!o)return void r("Username can't be empty");if(!s)return void r("Password can't be empty");const i=await $.post("api/setup/sync-from-server",{syncServerHost:e,syncProxy:t,username:o,password:s});"success"===i.result?(this.step("sync-in-progress"),setInterval(n,1e3),$("#alert").hide()):r("Sync setup failed: "+i.error)}}},document.getElementById("setup-dialog")),$("#setup-dialog").show()})()})();
//# sourceMappingURL=setup.js.map