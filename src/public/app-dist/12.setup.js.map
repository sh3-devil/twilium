{"version":3,"sources":["webpack://trilium/./src/public/app/dialogs/options/appearance.js","webpack://trilium/./src/public/app/services/library_loader.js"],"names":["ApperanceOptions","$","html","this","$themeSelect","$zoomFactorSelect","$nativeTitleBarSelect","$mainFontSize","$treeFontSize","$detailFontSize","$body","on","newTheme","val","clazz","Array","from","classList","startsWith","removeClass","noteId","find","attr","addClass","zoomFactor","nativeTitleBarVisible","async","applyFontSizes","options","themes","title","concat","empty","theme","append","prop","mainFontSize","treeFontSize","detailFontSize","get","style","setProperty","loadedScriptPromises","requireScript","url","ajax","dataType","cache","requireCss","document","querySelectorAll","map","el","href","some","l","endsWith","requireLibrary","library","css","cssUrl","js","scriptUrl","CKEDITOR","CODE_MIRROR","ESLINT","COMMONMARK","RELATION_MAP","LINK_MAP","PRINT_THIS","KNOCKOUT","CALENDAR_WIDGET"],"mappings":"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","file":"12.setup.js","sourcesContent":["import server from \"../../services/server.js\";\nimport utils from \"../../services/utils.js\";\nimport appContext from \"../../services/app_context.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\n\nconst TPL = `\n<p><strong>Settings on this options tab are saved automatically after each change.</strong></p>\n\n<form>\n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label for=\"theme-select\">Theme</label>\n            <select class=\"form-control\" id=\"theme-select\"></select>\n        </div>\n\n        <div class=\"col-4\">\n            <label for=\"zoom-factor-select\">Zoom factor (desktop build only)</label>\n\n            <input type=\"number\" class=\"form-control\" id=\"zoom-factor-select\" min=\"0.3\" max=\"2.0\" step=\"0.1\"/>\n        </div>\n        \n        <div class=\"col-4\">\n            <label for=\"native-title-bar-select\">Native title bar (requires app restart)</label>\n\n            <select class=\"form-control\" id=\"native-title-bar-select\">\n                <option value=\"show\">enabled</option>\n                <option value=\"hide\">disabled</option>\n            </select>\n        </div>\n    </div>\n\n    <p>Zooming can be controlled with CTRL-+ and CTRL-= shortcuts as well.</p>\n\n    <h4>Font sizes</h4>\n\n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label for=\"main-font-size\">Main font size</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"form-control\" id=\"main-font-size\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"col-4\">\n            <label for=\"tree-font-size\">Note tree font size</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"form-control\" id=\"tree-font-size\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"col-4\">\n            <label for=\"detail-font-size\">Note detail font size</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"form-control\" id=\"detail-font-size\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <p>Note that tree and detail font sizing is relative to the main font size setting.</p>\n</form>`;\n\nexport default class ApperanceOptions {\n    constructor() {\n        $(\"#options-appearance\").html(TPL);\n\n        this.$themeSelect = $(\"#theme-select\");\n        this.$zoomFactorSelect = $(\"#zoom-factor-select\");\n        this.$nativeTitleBarSelect = $(\"#native-title-bar-select\");\n        this.$mainFontSize = $(\"#main-font-size\");\n        this.$treeFontSize = $(\"#tree-font-size\");\n        this.$detailFontSize = $(\"#detail-font-size\");\n        this.$body = $(\"body\");\n\n        this.$themeSelect.on('change', () => {\n            const newTheme = this.$themeSelect.val();\n\n            for (const clazz of Array.from(this.$body[0].classList)) { // create copy to safely iterate over while removing classes\n                if (clazz.startsWith(\"theme-\")) {\n                    this.$body.removeClass(clazz);\n                }\n            }\n\n            const noteId = $(this).find(\":selected\").attr(\"data-note-id\");\n\n            if (noteId) {\n                // make sure the CSS is loaded\n                // if the CSS has been loaded and then updated then the changes won't take effect though\n                libraryLoader.requireCss(`api/notes/download/${noteId}`);\n            }\n\n            this.$body.addClass(\"theme-\" + newTheme);\n\n            server.put('options/theme/' + newTheme);\n        });\n\n        this.$zoomFactorSelect.on('change', () => { appContext.triggerCommand('setZoomFactorAndSave', {zoomFactor: this.$zoomFactorSelect.val()}); });\n\n        this.$nativeTitleBarSelect.on('change', () => {\n            const nativeTitleBarVisible = this.$nativeTitleBarSelect.val() === 'show' ? 'true' : 'false';\n\n            server.put('options/nativeTitleBarVisible/' + nativeTitleBarVisible);\n        });\n\n        this.$mainFontSize.on('change', async () => {\n            await server.put('options/mainFontSize/' + this.$mainFontSize.val());\n\n            this.applyFontSizes();\n        });\n\n        this.$treeFontSize.on('change', async () => {\n            await server.put('options/treeFontSize/' + this.$treeFontSize.val());\n\n            this.applyFontSizes();\n        });\n\n        this.$detailFontSize.on('change', async () => {\n            await server.put('options/detailFontSize/' + this.$detailFontSize.val());\n\n            this.applyFontSizes();\n        });\n    }\n\n    async optionsLoaded(options) {\n        const themes = [\n            { val: 'white', title: 'White' },\n            { val: 'dark', title: 'Dark' },\n            { val: 'black', title: 'Black' }\n        ].concat(await server.get('options/user-themes'));\n\n        this.$themeSelect.empty();\n\n        for (const theme of themes) {\n            this.$themeSelect.append($(\"<option>\")\n                .attr(\"value\", theme.val)\n                .attr(\"data-note-id\", theme.noteId)\n                .html(theme.title));\n        }\n\n        this.$themeSelect.val(options.theme);\n\n        if (utils.isElectron()) {\n            this.$zoomFactorSelect.val(options.zoomFactor);\n        }\n        else {\n            this.$zoomFactorSelect.prop('disabled', true);\n        }\n\n        this.$nativeTitleBarSelect.val(options.nativeTitleBarVisible === 'true' ? 'show' : 'hide');\n\n        this.$mainFontSize.val(options.mainFontSize);\n        this.$treeFontSize.val(options.treeFontSize);\n        this.$detailFontSize.val(options.detailFontSize);\n    }\n\n    applyFontSizes() {\n        this.$body.get(0).style.setProperty(\"--main-font-size\", this.$mainFontSize.val() + \"%\");\n        this.$body.get(0).style.setProperty(\"--tree-font-size\", this.$treeFontSize.val() + \"%\");\n        this.$body.get(0).style.setProperty(\"--detail-font-size\", this.$detailFontSize.val() + \"%\");\n    }\n}","const CKEDITOR = {\"js\": [\"libraries/ckeditor/ckeditor.js\"]};\n\nconst CODE_MIRROR = {\n    js: [\n        \"libraries/codemirror/codemirror.js\",\n        \"libraries/codemirror/addon/mode/loadmode.js\",\n        \"libraries/codemirror/addon/fold/xml-fold.js\",\n        \"libraries/codemirror/addon/edit/matchbrackets.js\",\n        \"libraries/codemirror/addon/edit/matchtags.js\",\n        \"libraries/codemirror/addon/search/match-highlighter.js\",\n        \"libraries/codemirror/mode/meta.js\",\n        \"libraries/codemirror/addon/lint/lint.js\",\n        \"libraries/codemirror/addon/lint/eslint.js\"\n    ],\n    css: [\n        \"libraries/codemirror/codemirror.css\",\n        \"libraries/codemirror/addon/lint/lint.css\"\n    ]\n};\n\nconst ESLINT = {js: [\"libraries/eslint.js\"]};\n\nconst COMMONMARK = {js: [\"libraries/commonmark.min.js\"]};\n\nconst RELATION_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\"\n    ],\n    css: [\n        \"stylesheets/relation_map.css\"\n    ]\n};\n\nconst LINK_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\",\n        \"libraries/springy.js\"\n    ],\n    css: [\n        \"stylesheets/link_map.css\"\n    ]\n};\n\nconst PRINT_THIS = {js: [\"libraries/printThis.js\"]};\n\nconst KNOCKOUT = {js: [\"libraries/knockout.min.js\"]};\n\nconst CALENDAR_WIDGET = {css: [\"stylesheets/calendar.css\"]};\n\nasync function requireLibrary(library) {\n    if (library.css) {\n        library.css.map(cssUrl => requireCss(cssUrl));\n    }\n\n    if (library.js) {\n        for (const scriptUrl of library.js) {\n            await requireScript(scriptUrl);\n        }\n    }\n}\n\n// we save the promises in case of the same script being required concurrently multiple times\nconst loadedScriptPromises = {};\n\nasync function requireScript(url) {\n    if (!loadedScriptPromises[url]) {\n        loadedScriptPromises[url] = $.ajax({\n            url: url,\n            dataType: \"script\",\n            cache: true\n        });\n    }\n\n    await loadedScriptPromises[url];\n}\n\nasync function requireCss(url) {\n    const cssLinks = Array\n        .from(document.querySelectorAll('link'))\n        .map(el => el.href);\n\n    if (!cssLinks.some(l => l.endsWith(url))) {\n        $('head').append($('<link rel=\"stylesheet\" type=\"text/css\" />').attr('href', url));\n    }\n}\n\nexport default {\n    requireCss,\n    requireLibrary,\n    CKEDITOR,\n    CODE_MIRROR,\n    ESLINT,\n    COMMONMARK,\n    RELATION_MAP,\n    LINK_MAP,\n    PRINT_THIS,\n    KNOCKOUT,\n    CALENDAR_WIDGET\n}"],"sourceRoot":""}