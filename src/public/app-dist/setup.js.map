{"version":3,"sources":["webpack://trilium/./src/public/app/services/utils.js","webpack://trilium/./src/public/app/services|sync","webpack://trilium/webpack/bootstrap","webpack://trilium/webpack/runtime/define property getters","webpack://trilium/webpack/runtime/ensure chunk","webpack://trilium/webpack/runtime/get javascript chunk filename","webpack://trilium/webpack/runtime/hasOwnProperty shorthand","webpack://trilium/webpack/runtime/make namespace object","webpack://trilium/webpack/runtime/publicPath","webpack://trilium/webpack/runtime/jsonp chunk loading","webpack://trilium/./src/public/app/services/mac_init.js","webpack://trilium/./src/public/app/setup.js"],"names":["padNum","num","formatTime","date","getHours","getMinutes","formatTimeWithSeconds","getSeconds","formatDate","formatDateISO","getFullYear","getMonth","getDate","isElectron","window","process","type","entityMap","formatValueWithWhitespace","val","test","bindElShortcut","$el","keyboardShortcut","handler","isDesktop","normalizeShortcut","bind","e","preventDefault","stopPropagation","shortcut","toLowerCase","replace","device","navigator","userAgent","closeActiveDialog","glob","activeDialog","modal","$lastFocusedElement","saveFocusedElement","$","focusSavedElement","hasClass","closest","prop","editing","view","focus","dynamicRequire","moduleName","reloadApp","location","reload","parseDate","str","Date","parse","Error","stack","formatDateTime","localNowDateTime","dayjs","format","now","isMac","platform","indexOf","assertArguments","i","arguments","console","trace","escapeHtml","s","stopWatch","async","what","func","start","ret","tookMs","getTime","log","formatLabel","label","name","value","download","url","remote","getCurrentWebContents","downloadURL","href","toObject","array","fn","obj","item","key","randomString","len","text","possible","charAt","Math","floor","random","length","bindGlobalShortcut","document","isMobile","setCookie","expires","toUTCString","cookie","setSessionCookie","getCookie","valueMatch","match","getNoteTypeClass","getMimeTypeClass","mime","semicolonIdx","substr","openDialog","$dialog","on","default","updateDisplayedShortcuts","isHtmlEmpty","html","includes","trim","clearBrowserCache","win","getCurrentWindow","webContents","session","clearCache","getUrlForDownload","URL","protocol","hostname","port","getHost","copySelectionToClipboard","getSelection","toString","clipboard","writeText","isCKEditorInitialized","cutToNote","timeLimit","promise","limitMs","error","Promise","res","rej","resolved","then","result","setTimeout","webpackEmptyContext","req","code","keys","resolve","id","module","exports","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","m","d","definition","o","Object","defineProperty","enumerable","get","f","chunkId","all","reduce","promises","u","prototype","hasOwnProperty","call","r","Symbol","toStringTag","p","installedChunks","8","j","installedChunkData","undefined","push","reject","onScriptComplete","script","createElement","charset","timeout","nc","setAttribute","src","event","onerror","onload","clearTimeout","reportError","loadingEnded","errorType","realSrc","target","message","request","head","appendChild","jsonpArray","oldJsonpFunction","data","chunkIds","moreModules","runtime","resolves","parentJsonpFunction","shift","exec","cmd","execCommand","checkOutstandingSyncs","stats","initialized","utils","app","relaunch","exit","totalOutstandingSyncs","outstandingPushes","outstandingPulls","showAlert","show","init","ko","applyBindings","syncInProgress","setInterval","serverAddress","host","this","step","observable","setupType","setupNewDocument","setupSyncFromDesktop","setupSyncFromServer","username","password1","password2","theme","subscribe","newTheme","$body","clazz","Array","from","classList","startsWith","removeClass","addClass","syncServerHost","syncProxy","instanceType","setupTypeSelected","selectSetupType","back","finish","post","password","resp","hide","getElementById"],"mappings":"uCAaA,SAASA,EAAOC,GACZ,OAAQA,GAAO,EAAI,IAAM,IAAMA,EAGnC,SAASC,EAAWC,GAChB,OAAOH,EAAOG,EAAKC,YAAc,IAAMJ,EAAOG,EAAKE,cAGvD,SAASC,EAAsBH,GAC3B,OAAOH,EAAOG,EAAKC,YAAc,IAAMJ,EAAOG,EAAKE,cAAgB,IAAML,EAAOG,EAAKI,cAIzF,SAASC,EAAWL,GAIhB,OAAOM,EAAcN,GAIzB,SAASM,EAAcN,GACnB,OAAOA,EAAKO,cAAgB,IAAMV,EAAOG,EAAKQ,WAAa,GAAK,IAAMX,EAAOG,EAAKS,WAetF,SAASC,IACL,SAAUC,QAAUA,OAAOC,SAAWD,OAAOC,QAAQC,M,iBAezD,MAAMC,EAAY,CACd,IAAK,QACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,QACL,IAAK,SACL,IAAK,SACL,IAAK,UAmBT,SAASC,EAA0BC,GAC/B,MAAO,UAAUC,KAAKD,GAAO,IAAMA,EAAM,IAAMA,EA0DnD,SAASE,EAAeC,EAAKC,EAAkBC,GACvCC,MACAF,EAAmBG,EAAkBH,GAErCD,EAAIK,KAAK,UAAWJ,EAAkBK,IAClCJ,EAAQI,GAERA,EAAEC,iBACFD,EAAEE,qBAQd,SAASJ,EAAkBK,GACvB,OAAOA,EACFC,cACAC,QAAQ,QAAS,UACjBA,QAAQ,SAAU,OAClBA,QAAQ,WAAY,YACpBA,QAAQ,WAAY,YAS7B,SAASR,IACL,MAAyB,YAAlBX,OAAOoB,SAELpB,OAAOoB,SAAW,OAAOd,KAAKe,UAAUC,WAqCrD,SAASC,IACDC,KAAKC,eACLD,KAAKC,aAAaC,MAAM,QACxBF,KAAKC,aAAe,MAI5B,IAAIE,EAAsB,KAE1B,SAASC,IACLD,EAAsBE,EAAE,UAG5B,SAASC,IACL,GAAKH,EAAL,CAIA,GAAIA,EAAoBI,SAAS,MAAO,CAGrBJ,EACVK,QAAQ,wBACRC,KAAK,oBAEHC,QAAQC,KAAKC,aAEpBT,EAAoBS,QAGxBT,EAAsB,MAmE1B,SAASU,EAAeC,GACpB,MAAuC,oBAA5B,QACA,QAAwBA,GAGxB,OAAQA,GAyBvB,SACIC,UA/VJ,WACIvC,OAAOwC,SAASC,QAAO,IA+VvBC,UA5VJ,SAAmBC,GACf,IACI,OAAO,IAAIC,KAAKA,KAAKC,MAAMF,IAE/B,MAAO7B,GACH,MAAM,IAAIgC,MAAM,yBAA2BH,EAAM,KAAO7B,EAAEiC,SAwV9D7D,SACAE,aACAI,wBACAE,aACAC,gBACAqD,eAhUJ,SAAwB3D,GACpB,OAAOK,EAAWL,GAAQ,IAAMD,EAAWC,IAgU3C4D,iBA7TJ,WACI,OAAOC,QAAQC,OAAO,8BA6TtBC,IA1TJ,WACI,OAAO5D,EAAsB,IAAIoD,OA0TjC7C,aACAsD,MApTJ,WACI,OAAOhC,UAAUiC,SAASC,QAAQ,QAAU,GAoT5CC,gBAjTJ,WACI,IAAK,MAAMC,KAAKC,UACPA,UAAUD,IACXE,QAAQC,MAAM,gBAAgBH,0BAA0BC,UAAUD,OA+S1EI,WA/RJ,SAAoBlB,GAChB,OAAOA,EAAIxB,QAAQ,eAAgB2C,GAAK3D,EAAU2D,KA+RlDC,UA5RJC,eAAyBC,EAAMC,GAC3B,MAAMC,EAAQ,IAAIvB,KAEZwB,QAAYF,IAEZG,EAASzB,KAAKQ,MAAQe,EAAMG,UAIlC,OAFAX,QAAQY,IAAI,GAAGN,UAAaI,OAErBD,GAoRPI,YA7QJ,SAAqBC,GACjB,IAAI9B,EAAM,IAAMvC,EAA0BqE,EAAMC,MAMhD,MAJoB,KAAhBD,EAAME,QACNhC,GAAO,IAAMvC,EAA0BqE,EAAME,QAG1ChC,GAuQPiC,SA/PJ,SAAkBC,GAGd,GAFAA,GAAO,IAAMjC,KAAKQ,MAEdrD,IAAc,CACCsC,EAAe,YAAYyC,OAEnCC,wBAAwBC,YAAYH,QAG3C7E,OAAOwC,SAASyC,KAAOJ,GAuP3BK,SAnPJ,SAAkBC,EAAOC,GACrB,MAAMC,EAAM,GAEZ,IAAK,MAAMC,KAAQH,EAAO,CACtB,MAAOI,EAAKZ,GAASS,EAAGE,GAExBD,EAAIE,GAAOZ,EAGf,OAAOU,GA2OPG,aAxOJ,SAAsBC,GAClB,IAAIC,EAAO,GACX,MAAMC,EAAW,iEAEjB,IAAK,IAAIlC,EAAI,EAAGA,EAAIgC,EAAKhC,IACrBiC,GAAQC,EAASC,OAAOC,KAAKC,MAAMD,KAAKE,SAAWJ,EAASK,SAGhE,OAAON,GAiOPO,mBA9NJ,SAA4BxF,EAAkBC,GAC1CH,EAAesB,EAAEqE,UAAWzF,EAAkBC,IA8N9CH,iBACA4F,SAnMJ,WACI,MAAyB,WAAlBnG,OAAOoB,SAELpB,OAAOoB,QAAU,OAAOd,KAAKe,UAAUC,YAiMhDX,YACAyF,UAtLJ,SAAmB1B,EAAMC,GACrB,MACM0B,EAAU,aADH,IAAIzD,KAAKA,KAAKQ,MAAQ,SACCkD,cAEpCJ,SAASK,OAAS7B,EAAO,KAAOC,GAAS,IAAO0B,EAAU,KAmL1DG,iBAhLJ,SAA0B9B,EAAMC,GAC5BuB,SAASK,OAAS7B,EAAO,KAAOC,GAAS,IAAM,KAgL/C8B,UA7KJ,SAAmB/B,GACf,MAAMgC,EAAaR,SAASK,OAAOI,MAAM,UAAYjC,EAAO,iBAC5D,OAAOgC,EAAaA,EAAW,GAAK,MA4KpCE,iBAzKJ,SAA0B1G,GACtB,MAAO,QAAUA,GAyKjB2G,iBAtKJ,SAA0BC,GACtB,MAAMC,EAAeD,EAAKvD,QAAQ,KAOlC,OALsB,IAAlBwD,IAEAD,EAAOA,EAAKE,OAAO,EAAGD,IAGnB,QAAUD,EAAK5F,cAAcC,QAAQ,UAAU,MA+JtDI,oBACA0F,WA5HJjD,eAA0BkD,GACtB3F,IAEAC,KAAKC,aAAeyF,EAEpBtF,IAEAsF,EAAQxF,QAERwF,EAAQC,GAAG,kBAAmB,KACrB3F,KAAKC,cAAgBD,KAAKC,eAAiByF,GAC5CpF,aAI8B,8BAAiCsF,QAChDC,yBAAyBH,IA6GhDtF,qBACAE,oBACAwF,YA5GJ,SAAqBC,GACjB,OAAKA,KAILA,EAAOA,EAAKrG,eAECsG,SAAS,UACdD,EAAKC,SAAS,aAEgC,IAA/C3F,EAAE,SAAS0F,KAAKA,GAAM7B,OAAO+B,OAAOzB,QAmG3C0B,kBAhGJ1D,iBACI,GAAIjE,IAAc,CACd,MAAM4H,EAAMtF,EAAe,YAAYyC,OAAO8C,yBACxCD,EAAIE,YAAYC,QAAQC,eA8FlCC,kBAvFJ,SAA2BnD,GACvB,OAAI9E,IAhMR,WACI,MAAM8E,EAAM,IAAIoD,IAAIjI,OAAOwC,SAASyC,MACpC,OAAOJ,EAAIqD,SAAW,KAAOrD,EAAIsD,SAAW,IAAMtD,EAAIuD,KAgM3CC,GAAY,IAAMxD,EAIlBA,GAiFXjE,oBACA0H,yBA9EJ,WACI,MAAM5C,EAAO1F,OAAOuI,eAAeC,WAC/BnH,UAAUoH,WACVpH,UAAUoH,UAAUC,UAAUhD,IA4ElCiD,sBAxEJ,WACI,SAAU3I,SAAUA,OAAO4I,YAwE3BvG,iBACAwG,UA7DJ,SAAmBC,EAASC,GAExB,MAAMC,EAAQ,IAAIlG,MAAM,+BAAiCiG,GAEzD,OAAO,IAAIE,QAAQ,CAACC,EAAKC,KACrB,IAAIC,GAAW,EAEfN,EAAQO,KAAKC,IACTF,GAAW,EAEXF,EAAII,KAGRC,WAAW,KACFH,GACDD,EAAIH,IAETD,Q,QC1VX,SAASS,EAAoBC,GAC5B,IAAI3I,EAAI,IAAIgC,MAAM,uBAAyB2G,EAAM,KAEjD,MADA3I,EAAE4I,KAAO,mBACH5I,EAEP0I,EAAoBG,KAAO,IAAM,GACjCH,EAAoBI,QAAUJ,EAC9BA,EAAoBK,GAAK,IACzBC,EAAOC,QAAUP,ICPbQ,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAUH,QAG3C,IAAID,EAASE,EAAyBE,GAAY,CAGjDH,QAAS,IAOV,OAHAI,EAAoBD,GAAUJ,EAAQA,EAAOC,QAASE,GAG/CH,EAAOC,QAIfE,EAAoBG,EAAID,ECvBxBF,EAAoBI,EAAI,CAACN,EAASO,KACjC,IAAI,IAAI/E,KAAO+E,EACXL,EAAoBM,EAAED,EAAY/E,KAAS0E,EAAoBM,EAAER,EAASxE,IAC5EiF,OAAOC,eAAeV,EAASxE,EAAK,CAAEmF,YAAY,EAAMC,IAAKL,EAAW/E,MCJ3E0E,EAAoBW,EAAI,GAGxBX,EAAoBnJ,EAAK+J,GACjB5B,QAAQ6B,IAAIN,OAAOb,KAAKM,EAAoBW,GAAGG,OAAO,CAACC,EAAUzF,KACvE0E,EAAoBW,EAAErF,GAAKsF,EAASG,GAC7BA,GACL,KCNJf,EAAoBgB,EAAKJ,GAEZA,EAAU,YCHvBZ,EAAoBM,EAAI,CAAClF,EAAKpD,IAASuI,OAAOU,UAAUC,eAAeC,KAAK/F,EAAKpD,GCCjFgI,EAAoBoB,EAAKtB,IACH,oBAAXuB,QAA0BA,OAAOC,aAC1Cf,OAAOC,eAAeV,EAASuB,OAAOC,YAAa,CAAE5G,MAAO,WAE7D6F,OAAOC,eAAeV,EAAS,aAAc,CAAEpF,OAAO,KCLvDsF,EAAoBuB,EAAI,Y,MCGxB,IAAIC,EAAkB,CACrBC,EAAG,GAIJzB,EAAoBW,EAAEe,EAAI,CAACd,EAASG,KAElC,IAAIY,EAAqB3B,EAAoBM,EAAEkB,EAAiBZ,GAAWY,EAAgBZ,QAAWgB,EACtG,GAA0B,IAAvBD,EAGF,GAAGA,EACFZ,EAASc,KAAKF,EAAmB,QAC3B,CAGL,IAAI9C,EAAU,IAAIG,QAAQ,CAACW,EAASmC,KACnCH,EAAqBH,EAAgBZ,GAAW,CAACjB,EAASmC,KAE3Df,EAASc,KAAKF,EAAmB,GAAK9C,GAGtC,IASIkD,EATAnH,EAAMoF,EAAoBuB,EAAIvB,EAAoBgB,EAAEJ,GAQpDoB,EAAS/F,SAASgG,cAAc,UAGpCD,EAAOE,QAAU,QACjBF,EAAOG,QAAU,IACbnC,EAAoBoC,IACvBJ,EAAOK,aAAa,QAASrC,EAAoBoC,IAElDJ,EAAOM,IAAM1H,EAGb,IAAImE,EAAQ,IAAIlG,MAChBkJ,EAAoBQ,IACnBR,EAAmB,OAInBC,EAAOQ,QAAUR,EAAOS,OAAS,KACjCC,aAAaP,GACb,IAAIQ,EA1Bc,MAClB,GAAG3C,EAAoBM,EAAEkB,EAAiBZ,KAEf,KAD1Be,EAAqBH,EAAgBZ,MACRY,EAAgBZ,QAAWgB,GACrDD,GAAoB,OAAOA,EAAmB,IAsBhCiB,GAClB,GAAGD,EAAa,CACf,IAAIE,EAAYN,IAAyB,SAAfA,EAAMtM,KAAkB,UAAYsM,EAAMtM,MAChE6M,EAAUP,GAASA,EAAMQ,QAAUR,EAAMQ,OAAOT,IACpDvD,EAAMiE,QAAU,iBAAmBpC,EAAU,cAAgBiC,EAAY,KAAOC,EAAU,IAC1F/D,EAAMtE,KAAO,iBACbsE,EAAM9I,KAAO4M,EACb9D,EAAMkE,QAAUH,EAChBH,EAAY5D,KAId,IAAIoD,EAAU7C,WAAW,KACxByC,EAAiB,CAAE9L,KAAM,UAAW8M,OAAQf,KAC1C,MACHA,EAAOQ,QAAUR,EAAOS,OAASV,EACjC9F,SAASiH,KAAKC,YAAYnB,KA6C/B,IAAIoB,EAAarN,OAA4B,oBAAIA,OAA4B,qBAAK,GAC9EsN,EAAmBD,EAAWvB,KAAKjL,KAAKwM,GAC5CA,EAAWvB,KA9BX,SAA8ByB,GAQ7B,IAPA,IAMIrD,EAAUW,EANV2C,EAAWD,EAAK,GAChBE,EAAcF,EAAK,GAEnBG,EAAUH,EAAK,GAGI9J,EAAI,EAAGkK,EAAW,GACpClK,EAAI+J,EAASxH,OAAQvC,IACzBoH,EAAU2C,EAAS/J,GAChBwG,EAAoBM,EAAEkB,EAAiBZ,IAAYY,EAAgBZ,IACrE8C,EAAS7B,KAAKL,EAAgBZ,GAAS,IAExCY,EAAgBZ,GAAW,EAE5B,IAAIX,KAAYuD,EACZxD,EAAoBM,EAAEkD,EAAavD,KACrCD,EAAoBG,EAAEF,GAAYuD,EAAYvD,IAKhD,IAFGwD,GAASA,EAAQzD,GACjB2D,GAAqBA,EAAoBL,GACtCI,EAAS3H,QACd2H,EAASE,OAATF,IAQF,IAAIC,EAAsBN,G,kCCpG1B,SAASQ,EAAKC,GAGV,OAFA7H,SAAS8H,YAAYD,IAEd,ECgHX/J,eAAeiK,IACX,MAAM,MAAEC,EAAK,YAAEC,SAAsBtM,EAAE8I,IAAI,kBAE3C,GAAIwD,EAAa,CACb,MAAMrJ,EAASsJ,EAAA,iBAAqB,YAAYtJ,OAChDA,EAAOuJ,IAAIC,WACXxJ,EAAOuJ,IAAIE,KAAK,OAEf,CACD,MAAMC,EAAwBN,EAAMO,kBAAoBP,EAAMQ,iBAE9D7M,EAAE,sBAAsB0F,KAAKiH,IAIrC,SAASG,EAAU1B,GACfpL,EAAE,UAAU0F,KAAK0F,GACjBpL,EAAE,UAAU+M,QD9HhB,CACIC,KAlBJ,WACQT,EAAA,gBAAsBA,EAAA,YACtBA,EAAA,qBAAyB,SAAU,IAAMN,EAAK,SAC9CM,EAAA,qBAAyB,SAAU,IAAMN,EAAK,UAC9CM,EAAA,qBAAyB,SAAU,IAAMN,EAAK,QAC9CM,EAAA,qBAAyB,SAAU,IAAMN,EAAK,cAC9CM,EAAA,qBAAyB,SAAU,IAAMN,EAAK,SAC9CM,EAAA,qBAAyB,SAAU,IAAMN,EAAK,aCTtD,OAwJAgB,GAAGC,cAAc,IAtJjB,WACQC,gBACAC,YAAYhB,EAAuB,KAGvC,MAAMiB,EAAgB1M,SAAS0F,SAAW,KAAO1F,SAAS2M,KAE1DtN,EAAE,iBAAiB0F,KAAK2H,GAExBE,KAAKC,KAAOP,GAAGQ,WAAWN,eAAiB,mBAAqB,cAChEI,KAAKG,UAAYT,GAAGQ,aAEpBF,KAAKI,iBAAmBV,GAAGQ,YAAW,GACtCF,KAAKK,qBAAuBX,GAAGQ,YAAW,GAC1CF,KAAKM,oBAAsBZ,GAAGQ,YAAW,GAEzCF,KAAKO,SAAWb,GAAGQ,aACnBF,KAAKQ,UAAYd,GAAGQ,aACpBF,KAAKS,UAAYf,GAAGQ,aAEpBF,KAAKU,MAAQhB,GAAGQ,WAAW,SAC3BF,KAAKU,MAAMC,WAAU,SAASC,GAC1B,MAAMC,EAAQpO,EAAE,QAEhB,IAAK,MAAMqO,KAASC,MAAMC,KAAKH,EAAM,GAAGI,WAChCH,EAAMI,WAAW,WACjBL,EAAMM,YAAYL,GAI1BD,EAAMO,SAAS,SAAWR,MAG9BZ,KAAKqB,eAAiB3B,GAAGQ,aACzBF,KAAKsB,UAAY5B,GAAGQ,aAEpBF,KAAKuB,aAAevC,EAAA,eAAqB,UAAY,SAErDgB,KAAKwB,kBAAoB,MAAQxB,KAAKG,YAEtCH,KAAKyB,gBAAkB,KACnBzB,KAAKC,KAAKD,KAAKG,cAGnBH,KAAK0B,KAAO,KACR1B,KAAKC,KAAK,cAEVD,KAAKG,UAAU,KAGnBH,KAAK2B,OAAS/M,UACV,GAAyB,iBAArBoL,KAAKG,YAAgC,CACrC,MAAMI,EAAWP,KAAKO,WAChBC,EAAYR,KAAKQ,YACjBC,EAAYT,KAAKS,YACjBC,EAAQV,KAAKU,QAEnB,IAAKH,EAED,YADAhB,EAAU,2BAId,IAAKiB,EAED,YADAjB,EAAU,2BAId,GAAIiB,IAAcC,EAEd,YADAlB,EAAU,2CAIdS,KAAKC,KAAK,4BAGVxN,EAAEmP,KAAK,yBAA0B,CAC7BrB,SAAUA,EACVsB,SAAUrB,EACVE,MAAOA,IACRzG,KAAK,KACJrJ,OAAOwC,SAASrB,QAAQ,kBAG3B,GAAyB,qBAArBiO,KAAKG,YAAoC,CAC9C,MAAMkB,EAAiBrB,KAAKqB,iBACtBC,EAAYtB,KAAKsB,YACjBf,EAAWP,KAAKO,WAChBsB,EAAW7B,KAAKQ,YAEtB,IAAKa,EAED,YADA9B,EAAU,yCAId,IAAKgB,EAED,YADAhB,EAAU,2BAId,IAAKsC,EAED,YADAtC,EAAU,2BAKd,MAAMuC,QAAarP,EAAEmP,KAAK,6BAA8B,CACpDP,eAAgBA,EAChBC,UAAWA,EACXf,SAAUA,EACVsB,SAAUA,IAGM,YAAhBC,EAAK5H,QACL8F,KAAKC,KAAK,oBAEVJ,YAAYhB,EAAuB,KAgC/CpM,EAAE,UAAUsP,QA3BAxC,EAAU,sBAAwBuC,EAAKlI,UA8BpB9C,SAASkL,eAAe,iBAE3DvP,EAAE,iBAAiB+M,Q","file":"setup.js","sourcesContent":["function reloadApp() {\n    window.location.reload(true);\n}\n\nfunction parseDate(str) {\n    try {\n        return new Date(Date.parse(str));\n    }\n    catch (e) {\n        throw new Error(\"Can't parse date from \" + str + \": \" + e.stack);\n    }\n}\n\nfunction padNum(num) {\n    return (num <= 9 ? \"0\" : \"\") + num;\n}\n\nfunction formatTime(date) {\n    return padNum(date.getHours()) + \":\" + padNum(date.getMinutes());\n}\n\nfunction formatTimeWithSeconds(date) {\n    return padNum(date.getHours()) + \":\" + padNum(date.getMinutes()) + \":\" + padNum(date.getSeconds());\n}\n\n// this is producing local time!\nfunction formatDate(date) {\n//    return padNum(date.getDate()) + \". \" + padNum(date.getMonth() + 1) + \". \" + date.getFullYear();\n    // instead of european format we'll just use ISO as that's pretty unambiguous\n\n    return formatDateISO(date);\n}\n\n// this is producing local time!\nfunction formatDateISO(date) {\n    return date.getFullYear() + \"-\" + padNum(date.getMonth() + 1) + \"-\" + padNum(date.getDate());\n}\n\nfunction formatDateTime(date) {\n    return formatDate(date) + \" \" + formatTime(date);\n}\n\nfunction localNowDateTime() {\n    return dayjs().format('YYYY-MM-DD HH:mm:ss.SSSZZ')\n}\n\nfunction now() {\n    return formatTimeWithSeconds(new Date());\n}\n\nfunction isElectron() {\n    return !!(window && window.process && window.process.type);\n}\n\nfunction isMac() {\n    return navigator.platform.indexOf('Mac') > -1;\n}\n\nfunction assertArguments() {\n    for (const i in arguments) {\n        if (!arguments[i]) {\n            console.trace(`Argument idx#${i} should not be falsy: ${arguments[i]}`);\n        }\n    }\n}\n\nconst entityMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '/': '&#x2F;',\n    '`': '&#x60;',\n    '=': '&#x3D;'\n};\n\nfunction escapeHtml(str) {\n    return str.replace(/[&<>\"'`=\\/]/g, s => entityMap[s]);\n}\n\nasync function stopWatch(what, func) {\n    const start = new Date();\n\n    const ret = await func();\n\n    const tookMs = Date.now() - start.getTime();\n\n    console.log(`${what} took ${tookMs}ms`);\n\n    return ret;\n}\n\nfunction formatValueWithWhitespace(val) {\n    return /[^\\w_-]/.test(val) ? '\"' + val + '\"' : val;\n}\n\nfunction formatLabel(label) {\n    let str = \"@\" + formatValueWithWhitespace(label.name);\n\n    if (label.value !== \"\") {\n        str += \"=\" + formatValueWithWhitespace(label.value);\n    }\n\n    return str;\n}\n\nfunction getHost() {\n    const url = new URL(window.location.href);\n    return url.protocol + \"//\" + url.hostname + \":\" + url.port;\n}\n\nfunction download(url) {\n    url += '?' + Date.now(); // don't use cache\n\n    if (isElectron()) {\n        const remote = dynamicRequire('electron').remote;\n\n        remote.getCurrentWebContents().downloadURL(url);\n    }\n    else {\n        window.location.href = url;\n    }\n}\n\nfunction toObject(array, fn) {\n    const obj = {};\n\n    for (const item of array) {\n        const [key, value] = fn(item);\n\n        obj[key] = value;\n    }\n\n    return obj;\n}\n\nfunction randomString(len) {\n    let text = \"\";\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (let i = 0; i < len; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\nfunction bindGlobalShortcut(keyboardShortcut, handler) {\n    bindElShortcut($(document), keyboardShortcut, handler);\n}\n\nfunction bindElShortcut($el, keyboardShortcut, handler) {\n    if (isDesktop()) {\n        keyboardShortcut = normalizeShortcut(keyboardShortcut);\n\n        $el.bind('keydown', keyboardShortcut, e => {\n            handler(e);\n\n            e.preventDefault();\n            e.stopPropagation();\n        });\n    }\n}\n\n/**\n * Normalize to the form expected by the jquery.hotkeys.js\n */\nfunction normalizeShortcut(shortcut) {\n    return shortcut\n        .toLowerCase()\n        .replace(\"enter\", \"return\")\n        .replace(\"delete\", \"del\")\n        .replace(\"ctrl+alt\", \"alt+ctrl\")\n        .replace(\"meta+alt\", \"alt+meta\"); // alt needs to be first;\n}\n\nfunction isMobile() {\n    return window.device === \"mobile\"\n        // window.device is not available in setup\n        || (!window.device && /Mobi/.test(navigator.userAgent));\n}\n\nfunction isDesktop() {\n    return window.device === \"desktop\"\n        // window.device is not available in setup\n        || (!window.device && !/Mobi/.test(navigator.userAgent));\n}\n\n// cookie code below works for simple use cases only - ASCII only\n// not setting path so that cookies do not leak into other websites if multiplexed with reverse proxy\n\nfunction setCookie(name, value) {\n    const date = new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000);\n    const expires = \"; expires=\" + date.toUTCString();\n\n    document.cookie = name + \"=\" + (value || \"\")  + expires + \";\";\n}\n\nfunction setSessionCookie(name, value) {\n    document.cookie = name + \"=\" + (value || \"\") + \";\";\n}\n\nfunction getCookie(name) {\n    const valueMatch = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');\n    return valueMatch ? valueMatch[2] : null;\n}\n\nfunction getNoteTypeClass(type) {\n    return \"type-\" + type;\n}\n\nfunction getMimeTypeClass(mime) {\n    const semicolonIdx = mime.indexOf(';');\n\n    if (semicolonIdx !== -1) {\n        // stripping everything following the semicolon\n        mime = mime.substr(0, semicolonIdx);\n    }\n\n    return 'mime-' + mime.toLowerCase().replace(/[\\W_]+/g,\"-\");\n}\n\nfunction closeActiveDialog() {\n    if (glob.activeDialog) {\n        glob.activeDialog.modal('hide');\n        glob.activeDialog = null;\n    }\n}\n\nlet $lastFocusedElement = null;\n\nfunction saveFocusedElement() {\n    $lastFocusedElement = $(\":focus\");\n}\n\nfunction focusSavedElement() {\n    if (!$lastFocusedElement) {\n        return;\n    }\n\n    if ($lastFocusedElement.hasClass(\"ck\")) {\n        // must handle CKEditor separately because of this bug: https://github.com/ckeditor/ckeditor5/issues/607\n\n        const editor = $lastFocusedElement\n            .closest('.ck-editor__editable')\n            .prop('ckeditorInstance');\n\n        editor.editing.view.focus();\n    } else {\n        $lastFocusedElement.focus();\n    }\n\n    $lastFocusedElement = null;\n}\n\nasync function openDialog($dialog) {\n    closeActiveDialog();\n\n    glob.activeDialog = $dialog;\n\n    saveFocusedElement();\n\n    $dialog.modal();\n\n    $dialog.on('hidden.bs.modal', () => {\n        if (!glob.activeDialog || glob.activeDialog === $dialog) {\n            focusSavedElement();\n        }\n    });\n\n    const keyboardActionsService = (await import(\"./keyboard_actions.js\")).default;\n    keyboardActionsService.updateDisplayedShortcuts($dialog);\n}\n\nfunction isHtmlEmpty(html) {\n    if (!html) {\n        return true;\n    }\n\n    html = html.toLowerCase();\n\n    return !html.includes('<img')\n        && !html.includes('<section')\n        // line below will actually attempt to load images so better to check for images first\n        && $(\"<div>\").html(html).text().trim().length === 0;\n}\n\nasync function clearBrowserCache() {\n    if (isElectron()) {\n        const win = dynamicRequire('electron').remote.getCurrentWindow();\n        await win.webContents.session.clearCache();\n    }\n}\n\n/**\n * @param url - should be without initial slash!!!\n */\nfunction getUrlForDownload(url) {\n    if (isElectron()) {\n        // electron needs absolute URL so we extract current host, port, protocol\n        return getHost() + '/' + url;\n    }\n    else {\n        // web server can be deployed on subdomain so we need to use relative path\n        return url;\n    }\n}\n\nfunction copySelectionToClipboard() {\n    const text = window.getSelection().toString();\n    if (navigator.clipboard) {\n        navigator.clipboard.writeText(text);\n    }\n}\n\nfunction isCKEditorInitialized() {\n    return !!(window && window.cutToNote);\n}\n\nfunction dynamicRequire(moduleName) {\n    if (typeof __non_webpack_require__ !== 'undefined') {\n        return __non_webpack_require__(moduleName);\n    }\n    else {\n        return require(moduleName);\n    }\n}\n\nfunction timeLimit(promise, limitMs) {\n    // better stack trace if created outside of promise\n    const error = new Error('Process exceeded time limit ' + limitMs);\n\n    return new Promise((res, rej) => {\n        let resolved = false;\n\n        promise.then(result => {\n            resolved = true;\n\n            res(result);\n        });\n\n        setTimeout(() => {\n            if (!resolved) {\n                rej(error);\n            }\n        }, limitMs);\n    });\n}\n\nexport default {\n    reloadApp,\n    parseDate,\n    padNum,\n    formatTime,\n    formatTimeWithSeconds,\n    formatDate,\n    formatDateISO,\n    formatDateTime,\n    localNowDateTime,\n    now,\n    isElectron,\n    isMac,\n    assertArguments,\n    escapeHtml,\n    stopWatch,\n    formatLabel,\n    download,\n    toObject,\n    randomString,\n    bindGlobalShortcut,\n    bindElShortcut,\n    isMobile,\n    isDesktop,\n    setCookie,\n    setSessionCookie,\n    getCookie,\n    getNoteTypeClass,\n    getMimeTypeClass,\n    closeActiveDialog,\n    openDialog,\n    saveFocusedElement,\n    focusSavedElement,\n    isHtmlEmpty,\n    clearBrowserCache,\n    getUrlForDownload,\n    normalizeShortcut,\n    copySelectionToClipboard,\n    isCKEditorInitialized,\n    dynamicRequire,\n    timeLimit\n};\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => [];\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 676;\nmodule.exports = webpackEmptyContext;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".setup.js\";\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"app-dist/\";","// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8: 0\n};\n\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n\t\t\t\t\t});\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\tvar loadingEnded = () => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) return installedChunkData[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tvar script = document.createElement('script');\n\t\t\t\t\tvar onScriptComplete;\n\n\t\t\t\t\tscript.charset = 'utf-8';\n\t\t\t\t\tscript.timeout = 120;\n\t\t\t\t\tif (__webpack_require__.nc) {\n\t\t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t\t\t\t}\n\t\t\t\t\tscript.src = url;\n\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tonScriptComplete = (event) => {\n\t\t\t\t\t\tonScriptComplete = () => {\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// avoid mem leaks in IE.\n\t\t\t\t\t\tscript.onerror = script.onload = null;\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\tvar reportError = loadingEnded();\n\t\t\t\t\t\tif(reportError) {\n\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\treportError(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t;\n\t\t\t\t\tvar timeout = setTimeout(() => {\n\t\t\t\t\t\tonScriptComplete({ type: 'timeout', target: script })\n\t\t\t\t\t}, 120000);\n\t\t\t\t\tscript.onerror = script.onload = onScriptComplete;\n\t\t\t\t\tdocument.head.appendChild(script);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no deferred startup\n\n// install a JSONP callback for chunk loading\nfunction webpackJsonpCallback(data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\n\tvar runtime = data[3];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentJsonpFunction) parentJsonpFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n};\n\nvar jsonpArray = window[\"webpackJsonptrilium\"] = window[\"webpackJsonptrilium\"] || [];\nvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\njsonpArray.push = webpackJsonpCallback;\nvar parentJsonpFunction = oldJsonpFunction;","/**\n * Mac specific initialization\n */\nimport utils from \"./utils.js\";\n\nfunction init() {\n    if (utils.isElectron() && utils.isMac()) {\n        utils.bindGlobalShortcut('meta+c', () => exec(\"copy\"));\n        utils.bindGlobalShortcut('meta+v', () => exec('paste'));\n        utils.bindGlobalShortcut('meta+x', () => exec('cut'));\n        utils.bindGlobalShortcut('meta+a', () => exec('selectAll'));\n        utils.bindGlobalShortcut('meta+z', () => exec('undo'));\n        utils.bindGlobalShortcut('meta+y', () => exec('redo'));\n    }\n}\n\nfunction exec(cmd) {\n    document.execCommand(cmd);\n\n    return false;\n}\n\nexport default {\n    init\n}","import utils from \"./services/utils.js\";\nimport macInit from './services/mac_init.js';\n\nmacInit.init();\n\nfunction SetupModel() {\n    if (syncInProgress) {\n        setInterval(checkOutstandingSyncs, 1000);\n    }\n\n    const serverAddress = location.protocol + '//' + location.host;\n\n    $(\"#current-host\").html(serverAddress);\n\n    this.step = ko.observable(syncInProgress ? \"sync-in-progress\" : \"setup-type\");\n    this.setupType = ko.observable();\n\n    this.setupNewDocument = ko.observable(false);\n    this.setupSyncFromDesktop = ko.observable(false);\n    this.setupSyncFromServer = ko.observable(false);\n\n    this.username = ko.observable();\n    this.password1 = ko.observable();\n    this.password2 = ko.observable();\n\n    this.theme = ko.observable(\"white\");\n    this.theme.subscribe(function(newTheme) {\n        const $body = $(\"body\");\n\n        for (const clazz of Array.from($body[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz.startsWith(\"theme-\")) {\n                $body.removeClass(clazz);\n            }\n        }\n\n        $body.addClass(\"theme-\" + newTheme);\n    });\n\n    this.syncServerHost = ko.observable();\n    this.syncProxy = ko.observable();\n\n    this.instanceType = utils.isElectron() ? \"desktop\" : \"server\";\n\n    this.setupTypeSelected = () => !!this.setupType();\n\n    this.selectSetupType = () => {\n        this.step(this.setupType());\n    };\n\n    this.back = () => {\n        this.step(\"setup-type\");\n\n        this.setupType(\"\");\n    };\n\n    this.finish = async () => {\n        if (this.setupType() === 'new-document') {\n            const username = this.username();\n            const password1 = this.password1();\n            const password2 = this.password2();\n            const theme = this.theme();\n\n            if (!username) {\n                showAlert(\"Username can't be empty\");\n                return;\n            }\n\n            if (!password1) {\n                showAlert(\"Password can't be empty\");\n                return;\n            }\n\n            if (password1 !== password2) {\n                showAlert(\"Both password fields need be identical.\");\n                return;\n            }\n\n            this.step('new-document-in-progress');\n\n            // not using server.js because it loads too many dependencies\n            $.post('api/setup/new-document', {\n                username: username,\n                password: password1,\n                theme: theme\n            }).then(() => {\n                window.location.replace(\"./setup\");\n            });\n        }\n        else if (this.setupType() === 'sync-from-server') {\n            const syncServerHost = this.syncServerHost();\n            const syncProxy = this.syncProxy();\n            const username = this.username();\n            const password = this.password1();\n\n            if (!syncServerHost) {\n                showAlert(\"Trilium server address can't be empty\");\n                return;\n            }\n\n            if (!username) {\n                showAlert(\"Username can't be empty\");\n                return;\n            }\n\n            if (!password) {\n                showAlert(\"Password can't be empty\");\n                return;\n            }\n\n            // not using server.js because it loads too many dependencies\n            const resp = await $.post('api/setup/sync-from-server', {\n                syncServerHost: syncServerHost,\n                syncProxy: syncProxy,\n                username: username,\n                password: password\n            });\n\n            if (resp.result === 'success') {\n                this.step('sync-in-progress');\n\n                setInterval(checkOutstandingSyncs, 1000);\n\n                hideAlert();\n            }\n            else {\n                showAlert('Sync setup failed: ' + resp.error);\n            }\n        }\n    };\n}\n\nasync function checkOutstandingSyncs() {\n    const { stats, initialized } = await $.get('api/sync/stats');\n\n    if (initialized) {\n        const remote = utils.dynamicRequire('electron').remote;\n        remote.app.relaunch();\n        remote.app.exit(0);\n    }\n    else {\n        const totalOutstandingSyncs = stats.outstandingPushes + stats.outstandingPulls;\n\n        $(\"#outstanding-syncs\").html(totalOutstandingSyncs);\n    }\n}\n\nfunction showAlert(message) {\n    $(\"#alert\").html(message);\n    $(\"#alert\").show();\n}\n\nfunction hideAlert() {\n    $(\"#alert\").hide();\n}\n\nko.applyBindings(new SetupModel(), document.getElementById('setup-dialog'));\n\n$(\"#setup-dialog\").show();"],"sourceRoot":""}